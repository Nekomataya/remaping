<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="TOKN">﻿</span><span class="COMM">/**
<span class='line'>  2</span>  * @fileoverview レンダー乙女ライブラリ
<span class='line'>  3</span>  *
<span class='line'>  4</span>  * 乙女がとりついて色々とオーバーライドしたり働きます。
<span class='line'>  5</span>  * レンダー乙女ライブラリ
<span class='line'>  6</span>  */</span><span class="WHIT">
<span class='line'>  7</span> </span><span class="COMM">/**
<span class='line'>  8</span>  * @namespace nas.otome
<span class='line'>  9</span>  */</span><span class="WHIT">
<span class='line'> 10</span> </span><span class="NAME">nas.otome</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 11</span> </span><span class="COMM">/** @contant */</span><span class="WHIT">
<span class='line'> 12</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">moduleName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"otomeLib"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 13</span> </span><span class="COMM">/** @contant */</span><span class="WHIT">
<span class='line'> 14</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myFilename</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">"$RCSfile: nas_OtomeLib.js,v $"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 15</span> </span><span class="COMM">/** @contant */</span><span class="WHIT">
<span class='line'> 16</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myFilerevision</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">"$Revision: 1.2 $"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">"$"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 17</span> 
<span class='line'> 18</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.Version</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 19</span> </span><span class="WHIT">    </span><span class="NAME">nas.Version</span><span class="PUNC">[</span><span class="NAME">moduleName</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">moduleName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" :"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myFilename</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" :"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myFilerevision</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 20</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 21</span> </span><span class="COMM">/*
<span class='line'> 22</span>  * 識別
<span class='line'> 23</span>  * 作業用プロパティ
<span class='line'> 24</span>  */</span><span class="WHIT">
<span class='line'> 25</span> </span><span class="COMM">//	otome="possessed";//とりついてます</span><span class="WHIT">
<span class='line'> 26</span> 
<span class='line'> 27</span> </span><span class="COMM">//============================================================ 乙女とりつきプロパティ</span><span class="WHIT">
<span class='line'> 28</span> 
<span class='line'> 29</span> </span><span class="COMM">/**
<span class='line'> 30</span>  * システムオブジェクトに取り付いてイロイロ拡張プロパティを貼り付けます。
<span class='line'> 31</span>  */</span><span class="WHIT">
<span class='line'> 32</span> </span><span class="COMM">//Folder.nas=(System.osName.match(/Windows/))?</span><span class="WHIT">
<span class='line'> 33</span> </span><span class="COMM">//	new Folder(Folder.startup.fsName+"\\Scripts\\nas"):</span><span class="WHIT">
<span class='line'> 34</span> </span><span class="COMM">//	new Folder(Folder.startup.fsName+"/Scripts/nas");</span><span class="WHIT">
<span class='line'> 35</span> </span><span class="NAME">Folder.nas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.baseLocation</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 36</span> 
<span class='line'> 37</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isWindows</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 38</span> </span><span class="WHIT">    </span><span class="NAME">Folder.scripts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Folder</span><span class="PUNC">(</span><span class="NAME">Folder.startup.path.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"/"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Folder.startup.name.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"/Scripts"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 39</span> </span><span class="WHIT">    </span><span class="NAME">File.currentApp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">File</span><span class="PUNC">(</span><span class="NAME">Folder.startup.path.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"/AfterFX.exe"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//Windows</span><span class="WHIT">
<span class='line'> 40</span> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 41</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">app.version.split</span><span class="PUNC">(</span><span class="STRN">"."</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">8</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 42</span> </span><span class="WHIT">        </span><span class="NAME">Folder.scripts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Folder</span><span class="PUNC">(</span><span class="NAME">Folder.startup.parent.parent.parent.path.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"/Scripts"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 43</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 44</span> </span><span class="WHIT">        </span><span class="NAME">Folder.scripts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Folder</span><span class="PUNC">(</span><span class="NAME">Folder.startup.parent.parent.path.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"/Scripts"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//AE8</span><span class="WHIT">
<span class='line'> 45</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 46</span> </span><span class="WHIT">    </span><span class="NAME">File.currentApp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">File</span><span class="PUNC">(</span><span class="NAME">Folder.startup.path.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"/AfterFX"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//MacOSX</span><span class="WHIT">
<span class='line'> 47</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 48</span> </span><span class="COMM">/**
<span class='line'> 49</span>  *Folder.userScriptは、AE12.2以上のバージョンで利用可能
<span class='line'> 50</span>  */</span><span class="WHIT">
<span class='line'> 51</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">app.version</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">12.2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 52</span> </span><span class="WHIT">        </span><span class="NAME">Folder.userScript</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="WHIT">
<span class='line'> 53</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 54</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentVersion</span><span class="PUNC">=</span><span class="NAME">app.version.split</span><span class="PUNC">(</span><span class="STRN">"x"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 55</span> </span><span class="WHIT">        </span><span class="NAME">currentVersion</span><span class="PUNC">=</span><span class="NAME">currentVersion.split</span><span class="PUNC">(</span><span class="STRN">"."</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">slice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">"."</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 56</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isWindows</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 57</span> </span><span class="WHIT">            </span><span class="NAME">Folder.userScript</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Folder</span><span class="PUNC">(</span><span class="NAME">Folder.userData.fullName</span><span class="PUNC">+</span><span class="STRN">"/Adobe/After Effects/"</span><span class="PUNC">+</span><span class="NAME">currentVersion</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 58</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 59</span> </span><span class="WHIT">            </span><span class="NAME">Folder.userScript</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Folder</span><span class="PUNC">(</span><span class="NAME">Folder.userData.parent.fullName</span><span class="PUNC">+</span><span class="STRN">"/Preferences/Adobe/After Effects/"</span><span class="PUNC">+</span><span class="NAME">currentVersion</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 60</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 61</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 62</span> </span><span class="COMM">//*====================================================乙女とりつきメソッド*//</span><span class="WHIT">
<span class='line'> 63</span> 
<span class='line'> 64</span> </span><span class="COMM">/**
<span class='line'> 65</span>  * FootgeItem.activate()
<span class='line'> 66</span>  * CompItem.activate()
<span class='line'> 67</span>  * FoldereItem.activate()
<span class='line'> 68</span>  * ちと凶悪だが無理やりアクティベートするメソドッドを実装する
<span class='line'> 69</span>  * 一応アクティブでないことを内部的に確認してから実行するよう作る
<span class='line'> 70</span>  * 一旦プロジェクトウインドウを非表示にして再表示するとフォーカスが入るので
<span class='line'> 71</span>  * それを利用する
<span class='line'> 72</span>  *
<span class='line'> 73</span>  * @returns {_activate}
<span class='line'> 74</span>  * @private
<span class='line'> 75</span>  */</span><span class="WHIT">
<span class='line'> 76</span> </span><span class="NAME">_activate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 77</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">app.project.activeItem</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 78</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="WHIT">
<span class='line'> 79</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 80</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">app.project.items.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 81</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">app.project.item</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">selected</span><span class="PUNC">)</span><span class="NAME">app.project.item</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">selected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 82</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 83</span> </span><span class="WHIT">    </span><span class="NAME">this.selected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 84</span> </span><span class="WHIT">    </span><span class="NAME">app.project.showWindow</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 85</span> </span><span class="WHIT">    </span><span class="NAME">app.project.showWindow</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 86</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 87</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 88</span> 
<span class='line'> 89</span> </span><span class="NAME">FootageItem.prototype.activate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_activate</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 90</span> </span><span class="NAME">FolderItem.prototype.activate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_activate</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 91</span> </span><span class="NAME">CompItem.prototype.activate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_activate</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 92</span> 
<span class='line'> 93</span> </span><span class="COMM">/**
<span class='line'> 94</span>  * getItemByName(itemName); 名前で指定したアイテムを返す
<span class='line'> 95</span>  * 引数:    アイテム名
<span class='line'> 96</span>  * 例:
<span class='line'> 97</span>  *        myItem=app.project.getItemByName("平面");
<span class='line'> 98</span>  *
<span class='line'> 99</span>  * getItemByName はアイテム名で指定したアイテムの配列を返す。
<span class='line'>100</span>  * 該当アイテムがなければ nullを返す。
<span class='line'>101</span>  * 引数が正規表現の場合は正規表現にマッチする全てのオブジェクトを返すように変更(2009.10.23)
<span class='line'>102</span>  *
<span class='line'>103</span>  * @param itemName
<span class='line'>104</span>  * @returns {*}
<span class='line'>105</span>  */</span><span class="WHIT">
<span class='line'>106</span> </span><span class="NAME">Project.prototype.getItemByName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">itemName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>107</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">itemName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>108</span> </span><span class="WHIT">        </span><span class="NAME">itemName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>109</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>110</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">XXs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="COMM">//検索一時配列</span><span class="WHIT">
<span class='line'>111</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">itemIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">itemIndex</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">this.items.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">itemIndex</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>112</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">itemName</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>113</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.item</span><span class="PUNC">(</span><span class="NAME">itemIndex</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">name.match</span><span class="PUNC">(</span><span class="NAME">itemName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>114</span> </span><span class="WHIT">                </span><span class="NAME">XXs.push</span><span class="PUNC">(</span><span class="NAME">this.item</span><span class="PUNC">(</span><span class="NAME">itemIndex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>115</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>116</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>117</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.item</span><span class="PUNC">(</span><span class="NAME">itemIndex</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">itemName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>118</span> </span><span class="WHIT">                </span><span class="NAME">XXs.push</span><span class="PUNC">(</span><span class="NAME">this.item</span><span class="PUNC">(</span><span class="NAME">itemIndex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>119</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>120</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>121</span> </span><span class="WHIT">        </span><span class="NAME">this.item</span><span class="PUNC">(</span><span class="NAME">itemIndex</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">itemIndex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>122</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>123</span> 
<span class='line'>124</span> 
<span class='line'>125</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">XXs.length</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>126</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>127</span>          *  該当
<span class='line'>128</span>          */</span><span class="WHIT">
<span class='line'>129</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">XXs</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>130</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>131</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>132</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>133</span> 
<span class='line'>134</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>135</span> 
<span class='line'>136</span> </span><span class="COMM">/**
<span class='line'>137</span>  *  Project.items.getByName(itemName);アイテムコレクションから指定の名前のアイテムを戻す
<span class='line'>138</span>  *    引数:    itemName
<span class='line'>139</span>  *        省略可
<span class='line'>140</span>  *    例:    var myItemFolder=app.project.items.getByName("_footages").items.getByName("_cell");
<span class='line'>141</span>  *
<span class='line'>142</span>  *    名前を指定してアイテムを取得　最初にマッチしたアイテムを返す名前は正規表現として解釈する
<span class='line'>143</span>  *    引数省略時はfalse アンマッチ時はnull を返す
<span class='line'>144</span>  * げげ日本語がマッチしない　おのれぇぇ
<span class='line'>145</span>  * 正規表現の動作がどうもヘンなので（==）で解決するので名前は完全マッチのみ　09/09/17
<span class='line'>146</span>  *
<span class='line'>147</span>  * @param itemName
<span class='line'>148</span>  * @returns {*}
<span class='line'>149</span>  */</span><span class="WHIT">
<span class='line'>150</span> </span><span class="NAME">ItemCollection.prototype.getByName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">itemName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>151</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">itemName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>152</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>153</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>154</span> </span><span class="WHIT">    </span><span class="COMM">//引数なし　実はこのコードでは数値のゼロを与えてもアイテム"0"が検出できないけどあとで直す</span><span class="WHIT">
<span class='line'>155</span> </span><span class="COMM">//	var myRegex= new RegExp(itemName.toString());</span><span class="WHIT">
<span class='line'>156</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">itemIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">itemIndex</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">itemIndex</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>157</span> </span><span class="COMM">//	alert(this[itemIndex].name+"=?="+itemName.toString()+"=="+this[itemIndex].name.match(myRegex).toString());//ヘンだねどうも</span><span class="WHIT">
<span class='line'>158</span> </span><span class="COMM">//		if(this[itemIndex].name.match(myRegex) ) {return this[itemIndex];};</span><span class="WHIT">
<span class='line'>159</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">itemIndex</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">itemName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>160</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">itemIndex</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>161</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>162</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>163</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="COMM">//マッチなし</span><span class="WHIT">
<span class='line'>164</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>165</span> 
<span class='line'>166</span> </span><span class="COMM">/**
<span class='line'>167</span>  * Project.pickItems(itemClass); 指定されたクラスのアイテムを返す
<span class='line'>168</span>  * 引数:    itemClass
<span class='line'>169</span>  *    省略可 "composition"/"footage"/"folder"のいずれか
<span class='line'>170</span>  * 例:
<span class='line'>171</span>  *    myComps=app.project.pickItems("composition");
<span class='line'>172</span>  *
<span class='line'>173</span>  * pickItem は 各クラスのアイテムを抽出して配列で返す。
<span class='line'>174</span>  * 省略時は、全アイテム。
<span class='line'>175</span>  * 該当アイテムがなければ nullを返す。
<span class='line'>176</span>  *
<span class='line'>177</span>  * @param itemClass
<span class='line'>178</span>  * @returns {*}
<span class='line'>179</span>  */</span><span class="WHIT">
<span class='line'>180</span> </span><span class="NAME">Project.prototype.pickItems</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">itemClass</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>181</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">itemClass</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>182</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.items</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>183</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>184</span> </span><span class="WHIT">    </span><span class="COMM">/*
<span class='line'>185</span>      switch(app.language){
<span class='line'>186</span>      case Language.JAPANESE:
<span class='line'>187</span>      switch(itemClass){
<span class='line'>188</span>      case "composition":	XX="コンポジション";break;
<span class='line'>189</span>      case "footage":	XX="フッテージ";break;
<span class='line'>190</span>      case "folder":	XX="フォルダ";break;
<span class='line'>191</span>      case "solid":	;break;
<span class='line'>192</span>      default:	return null ;
<span class='line'>193</span>      };
<span class='line'>194</span>      break;
<span class='line'>195</span>      case Language.ENGLISH:
<span class='line'>196</span>      case Language.GERMAN:
<span class='line'>197</span>      case Language.FRENCH:
<span class='line'>198</span>      case Language.ITALIAN:
<span class='line'>199</span>      case Language.SPANISH:
<span class='line'>200</span>      default	:
<span class='line'>201</span>      switch(itemClass){
<span class='line'>202</span>      case "composition":
<span class='line'>203</span>      case "footage":
<span class='line'>204</span>      case "folder":
<span class='line'>205</span>      case "solid":
<span class='line'>206</span>      XX=itemClass.toString();break;
<span class='line'>207</span>      default:
<span class='line'>208</span>      return null ;
<span class='line'>209</span>      };
<span class='line'>210</span> 
<span class='line'>211</span>      return false;
<span class='line'>212</span>      } 
<span class='line'>213</span>      */</span><span class="WHIT">
<span class='line'>214</span> </span><span class="WHIT">    </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">itemClass</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>215</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"composition"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>216</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"footage"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>217</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"folder"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>218</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"solid"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>219</span> </span><span class="WHIT">            </span><span class="NAME">XX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">itemClass.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>220</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>221</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"CompItem"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>222</span> </span><span class="WHIT">            </span><span class="NAME">XX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"composition"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>223</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>224</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"FolderItem"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>225</span> </span><span class="WHIT">            </span><span class="NAME">XX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"folder"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>226</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>227</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"FootageItem"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>228</span> </span><span class="WHIT">            </span><span class="NAME">XX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"footage"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>229</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>230</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"Solid"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>231</span> </span><span class="WHIT">            </span><span class="NAME">XX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"solid"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>232</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>233</span> </span><span class="WHIT">        </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>234</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>235</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>236</span> 
<span class='line'>237</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">XXs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>238</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">itemIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">itemIndex</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">this.items.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">itemIndex</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>239</span> 
<span class='line'>240</span> </span><span class="WHIT">        </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">itemClass</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>241</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"composition"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>242</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.item</span><span class="PUNC">(</span><span class="NAME">itemIndex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">CompItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>243</span> </span><span class="WHIT">                    </span><span class="NAME">XXs.push</span><span class="PUNC">(</span><span class="NAME">this.item</span><span class="PUNC">(</span><span class="NAME">itemIndex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>244</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>245</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>246</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"footage"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>247</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.item</span><span class="PUNC">(</span><span class="NAME">itemIndex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FootageItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>248</span> </span><span class="WHIT">                    </span><span class="NAME">XXs.push</span><span class="PUNC">(</span><span class="NAME">this.item</span><span class="PUNC">(</span><span class="NAME">itemIndex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>249</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>250</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>251</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"folder"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>252</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.item</span><span class="PUNC">(</span><span class="NAME">itemIndex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FolderItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>253</span> </span><span class="WHIT">                    </span><span class="NAME">XXs.push</span><span class="PUNC">(</span><span class="NAME">this.item</span><span class="PUNC">(</span><span class="NAME">itemIndex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>254</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>255</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>256</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"solid"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>257</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.item</span><span class="PUNC">(</span><span class="NAME">itemIndex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FootageItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.item</span><span class="PUNC">(</span><span class="NAME">itemIndex</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">mainSource</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">SolidSource</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>258</span> </span><span class="WHIT">                    </span><span class="NAME">XXs.push</span><span class="PUNC">(</span><span class="NAME">this.item</span><span class="PUNC">(</span><span class="NAME">itemIndex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>259</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>260</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>261</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>262</span> </span><span class="COMM">//if(this.item(itemIndex).typeName==XX) {XXs.push(this.item(itemIndex))};</span><span class="WHIT">
<span class='line'>263</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>264</span>          * 参照用に取得時点のインデックスを付ける。そのうち別の方法を考えれ
<span class='line'>265</span>          * @type {number}
<span class='line'>266</span>          */</span><span class="WHIT">
<span class='line'>267</span> </span><span class="WHIT">        </span><span class="NAME">this.item</span><span class="PUNC">(</span><span class="NAME">itemIndex</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">itemIndex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>268</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>269</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">XXs</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>270</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>271</span> </span><span class="COMM">/*
<span class='line'>272</span>  if (! myComp)
<span class='line'>273</span>  {
<span class='line'>274</span>  if(app.project.activeItem.typeName=="コンポジション")
<span class='line'>275</span>  {	myComp=app.project.activeItem	
<span class='line'>276</span>  }else{
<span class='line'>277</span>  return false;
<span class='line'>278</span>  }
<span class='line'>279</span>  }else{
<span class='line'>280</span>  if (myComp.typeName !="コンポジション")	return false;
<span class='line'>281</span>  }
<span class='line'>282</span>  */</span><span class="WHIT">
<span class='line'>283</span> 
<span class='line'>284</span> </span><span class="COMM">/**
<span class='line'>285</span>  * [Object File].isSequenceElements(option)
<span class='line'>286</span>  * 引数    :識別option
<span class='line'>287</span>  * 戻値    :Object/false
<span class='line'>288</span>  * ファイルがシーケンスの一部か否かを判定する
<span class='line'>289</span>  * 識別オプションがtrueのときは、シーケンスの親フォルダがシーケンスプレフィクスと一致しているか否かも判定する厳正なシーケンス判断
<span class='line'>290</span>  * 判定は以下の条件を満たすもの
<span class='line'>291</span>  * ラベルおよび数値部分を持つファイル名であること
<span class='line'>292</span>  * ラベルは空文字列でもよろしいが、その場合は所属フォルダ名がラベルとなる。（所属フォルダがルートの場合は空文字列）
<span class='line'>293</span>  * 指定の拡張子であるもの（nas のプロパティをみる 必須）
<span class='line'>294</span>  * 同一のフォルダに同ラベルのナンバリングファイルが複数あるか
<span class='line'>295</span>  * または単独フォルダであっても数値部分を持つファイルは長さ１のシーケンスとして扱う
<span class='line'>296</span>  *
<span class='line'>297</span>  * 正規表現見直し。ラベルの範囲をひろく採る　2009/10/19
<span class='line'>298</span>  * 戻り値は判別オブジェクト。または、false
<span class='line'>299</span>  * 判別オブジェクトには以下のプロパティがあり以後の操作に使用可能
<span class='line'>300</span>  * .currentNumber    現在の番号
<span class='line'>301</span>  * .prefix    ラベル文字列（空文字の場合がある）
<span class='line'>302</span>  * .startNumber    シーケンス開始（代表）番号
<span class='line'>303</span>  * .ext    拡張子
<span class='line'>304</span>  *
<span class='line'>305</span>  * @param asStrict
<span class='line'>306</span>  * @returns {*}
<span class='line'>307</span>  */</span><span class="WHIT">
<span class='line'>308</span> </span><span class="NAME">File.prototype.isSequenceElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">asStrict</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>309</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">asStrict</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>310</span> </span><span class="WHIT">        </span><span class="NAME">asStrict</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>311</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>312</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>313</span> </span><span class="WHIT">    </span><span class="NAME">myResult.prefix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>314</span> </span><span class="WHIT">    </span><span class="NAME">myResult.startNumber</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>315</span> </span><span class="WHIT">    </span><span class="NAME">myResult.currentNumber</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>316</span> </span><span class="WHIT">    </span><span class="NAME">myResult.ext</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"null"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>317</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>318</span>      * インポートフィルタチェック　拡張子取得
<span class='line'>319</span>      */</span><span class="WHIT">
<span class='line'>320</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.name.match</span><span class="PUNC">(</span><span class="NAME">nas.importFilter</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>321</span> </span><span class="WHIT">        </span><span class="NAME">myResult.ext</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="WHIT">
<span class='line'>322</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>323</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>324</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>325</span> </span><span class="COMM">//	if(this.name.match(nas.cellRegex)){myResult.ext=RegExp.$1}else{return false;};</span><span class="WHIT">
<span class='line'>326</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>327</span>      * ファイル名は単純連番か?その場合は親フォルダの名称をラベルとして取得する
<span class='line'>328</span>      */</span><span class="WHIT">
<span class='line'>329</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.name.match</span><span class="PUNC">(</span><span class="REGX">/^([0-9]+)\..+$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>330</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">numCurrent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>331</span> </span><span class="WHIT">        </span><span class="NAME">myResult.prefix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this.parent.name</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>332</span> </span><span class="WHIT">        </span><span class="NAME">myResult.currentNumber</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">numCurrent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>333</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">files</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.parent.getFiles</span><span class="PUNC">(</span><span class="NAME">numCurrent.replace</span><span class="PUNC">(</span><span class="REGX">/./g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"?"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"."</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myResult.ext</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>334</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ncRegex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"\([0-9]{"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myResult.currentNumber.length</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"})\\."</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>335</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">files</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>336</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">files</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name.match</span><span class="PUNC">(</span><span class="NAME">ncRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>337</span> </span><span class="WHIT">                </span><span class="NAME">myCounts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>338</span> </span><span class="WHIT">                </span><span class="NAME">numCurrent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">numCurrent</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myCounts</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">numCurrent</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">myCounts</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>339</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>340</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>341</span> </span><span class="WHIT">        </span><span class="NAME">myResult.startNumber</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">numCurrent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>342</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>343</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>344</span>          * ラベル付き連番
<span class='line'>345</span>          */</span><span class="WHIT">
<span class='line'>346</span> </span><span class="COMM">//		if(this.name.match(/^([^\-_\s]+[^0-9]?)([0-9]+)\..+$/)){}</span><span class="WHIT">
<span class='line'>347</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.name.match</span><span class="PUNC">(</span><span class="REGX">/^(.*[^0-9]+)([0-9]+)\..+$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>348</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myPrefix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>349</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">numCurrent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>350</span> </span><span class="WHIT">            </span><span class="NAME">myResult.currentNumber</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">numCurrent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>351</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">files</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.parent.getFiles</span><span class="PUNC">(</span><span class="NAME">myPrefix</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myResult.currentNumber.replace</span><span class="PUNC">(</span><span class="REGX">/./g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"?"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"."</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myResult.ext</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>352</span> </span><span class="COMM">//			var ncRegex=new RegExp(myPrefix.replace(/[\_\-\\\.\*\/\?]/g,"\$1")+"([0-9]{"+numCurrent.length+"})\\.");</span><span class="WHIT">
<span class='line'>353</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ncRegex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="NAME">myPrefix</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"([0-9]{"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">numCurrent.length</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"})\\."</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>354</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">files</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>355</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">files</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name.match</span><span class="PUNC">(</span><span class="NAME">ncRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>356</span> </span><span class="WHIT">                    </span><span class="NAME">myCounts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>357</span> </span><span class="WHIT">                    </span><span class="NAME">numCurrent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">numCurrent</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myCounts</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">numCurrent</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">myCounts</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>358</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>359</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>360</span> </span><span class="WHIT">            </span><span class="NAME">myResult.prefix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myPrefix</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>361</span> </span><span class="WHIT">            </span><span class="NAME">myResult.startNumber</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">numCurrent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>362</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>363</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>364</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>365</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>366</span> </span><span class="COMM">//	alert(decodeURI(this.parent.name)+"/"+myResult.prefix);</span><span class="WHIT">
<span class='line'>367</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">asStrict</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>368</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myLbRegex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="NAME">myResult.prefix</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"i"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>369</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">decodeURI</span><span class="PUNC">(</span><span class="NAME">this.parent.name</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="NAME">myLbRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>370</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>371</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>372</span> </span><span class="WHIT">        </span><span class="COMM">//厳密判定</span><span class="WHIT">
<span class='line'>373</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>374</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>375</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>376</span> 
<span class='line'>377</span> </span><span class="COMM">/**
<span class='line'>378</span>  * ファイルから指定バイト数読み出して、1バイトあたり1要素の数値の配列を返す
<span class='line'>379</span>  * このメソッドはファイルのopen/close操作を行わない。
<span class='line'>380</span>  * あらかじめファイルを(r)モードでオープンしておくこと。
<span class='line'>381</span>  * 開かれていないファイルハンドルに対して操作した場合の戻り値は false
<span class='line'>382</span>  *
<span class='line'>383</span>  * @param {Number} readNum
<span class='line'>384</span>  *        読み出しbite数 省略値 ファイルの残りすべて
<span class='line'>385</span>  * @returns {Array}
<span class='line'>386</span>  *        1バイトあたり1要素の配列 / 読み出し幅が1バイトの時のみNumber
<span class='line'>387</span>  * @example
<span class='line'>388</span>  *        myFile.open('r');
<span class='line'>389</span>  *        myContent=myFile.getBin(12);
<span class='line'>390</span>  *        myFile.close();
<span class='line'>391</span>  *        console.log(myContent);
<span class='line'>392</span>  */</span><span class="WHIT">
<span class='line'>393</span> </span><span class="NAME">File.prototype.getBin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">readNum</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>394</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.tell</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="COMM">//シークアドレスが-1 (オープンしてない)</span><span class="WHIT">
<span class='line'>395</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>396</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentAddress</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.tell</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//カレントアドレス取得</span><span class="WHIT">
<span class='line'>397</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentEncoding</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.encoding</span><span class="PUNC">;</span><span class="COMM">//カレントアドレス取得</span><span class="WHIT">
<span class='line'>398</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">readNum</span><span class="PUNC">)</span><span class="WHIT">    </span><span class="NAME">readNum</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">currentAddress</span><span class="PUNC">;</span><span class="COMM">//読み出し幅確認</span><span class="WHIT">
<span class='line'>399</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">startAddress</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentAddress</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>400</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endAddress</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentAddress</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">readNum</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>401</span> </span><span class="WHIT">    </span><span class="NAME">this.encoding</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"BINARY"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>402</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">endAddress</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">this.length</span><span class="PUNC">)</span><span class="NAME">endAddress</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>403</span> </span><span class="WHIT">    </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>404</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">readAddress</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">startAddress</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">readAddress</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">endAddress</span><span class="PUNC">;</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>405</span> </span><span class="WHIT">            </span><span class="NAME">this.seek</span><span class="PUNC">(</span><span class="NAME">readAddress</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>406</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">biteChar</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.read</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>407</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">biteData</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">biteChar.charCodeAt</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>408</span> </span><span class="COMM">//		var biteData=this.read(1).charCodeAt(0);</span><span class="WHIT">
<span class='line'>409</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">btCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.tell</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">readAddress</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>410</span> </span><span class="COMM">//		if(btCount>2){alert(btCount+" : "+biteChar);}</span><span class="WHIT">
<span class='line'>411</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ct</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">btCount</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ct</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ct</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>412</span> </span><span class="WHIT">                </span><span class="NAME">myContent.push</span><span class="PUNC">(</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">biteData</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NUMB">256</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ct</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&</span><span class="WHIT"> </span><span class="NUMB">255</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//上位バイトから順にプッシュ</span><span class="WHIT">
<span class='line'>413</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>414</span> </span><span class="WHIT">            </span><span class="NAME">readAddress</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">readAddress</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">btCount</span><span class="PUNC">;</span><span class="COMM">//</span><span class="WHIT">
<span class='line'>415</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>416</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">er</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>417</span> </span><span class="WHIT">        </span><span class="NAME">this.encoding</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentEncoding</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>418</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>419</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>420</span> </span><span class="WHIT">    </span><span class="COMM">/*
<span class='line'>421</span>      *  読み出しオーバーの場合があるのでシーク位置を強制的に設定値にあわせる/エンコーディングを戻す
<span class='line'>422</span>      */</span><span class="WHIT">
<span class='line'>423</span> </span><span class="WHIT">    </span><span class="NAME">this.seek</span><span class="PUNC">(</span><span class="NAME">endAddress</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>424</span> </span><span class="WHIT">    </span><span class="NAME">this.encoding</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentEncoding</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>425</span> </span><span class="WHIT">    </span><span class="COMM">/*
<span class='line'>426</span>      *  要求された配列分だけ戻す
<span class='line'>427</span>      */</span><span class="WHIT">
<span class='line'>428</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">readNum</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>429</span> 
<span class='line'>430</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myContent.slice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">readNum</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>431</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>432</span> 
<span class='line'>433</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">app.buildName.match</span><span class="PUNC">(</span><span class="REGX">/^6\.[05]/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>434</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>435</span>      * バイナリデータの書き込みを行う(ESTK)(AE7.0以降)
<span class='line'>436</span>      * @example
<span class='line'>437</span>      *     if(! myFile.putBin(myContent)){alert("Write error !")}
<span class='line'>438</span> 
<span class='line'>439</span>      * 1バイトあたり1要素の配列 / 読み出し幅が1バイトの時のみNumber
<span class='line'>440</span>      * このメソッドはファイルのopen/close操作を行わない。
<span class='line'>441</span>      * 負の値は切りあげて 0 ・ 255以上の値は切り捨てて 255
<span class='line'>442</span>      * オプションがあれば、配列の値が255以上の場合 バイト分割して書き込む。
<span class='line'>443</span>      * オプションの値が"big"ならばビッグエンディアン それ以外はリトルエンディアン
<span class='line'>444</span>      * あらかじめファイルを(w)モードでオープンしておくこと。
<span class='line'>445</span>      * 開かれていないファイルハンドルに対して操作した場合の戻り値は false
<span class='line'>446</span>      *
<span class='line'>447</span>      * @param {Array} writeData
<span class='line'>448</span>      *        書き込みデータ配列 省略時 error
<span class='line'>449</span>      *        整数値以外のデータはnullを含め 0 として書き込む&lt;br />
<span class='line'>450</span>      *        データ単独(1要素のみ)の場合は、Numberクラスも可
<span class='line'>451</span>      * @param {boolean} option
<span class='line'>452</span>      *        オプション(true)で書き込みモードバイト分割(リトルエンディアン)にする&lt;br />
<span class='line'>453</span>      *        オプション("big")でビッグエンディアン
<span class='line'>454</span>      * @returns {boolean}
<span class='line'>455</span>      *        書き込み成功時にtrue
<span class='line'>456</span>      */</span><span class="WHIT">
<span class='line'>457</span> </span><span class="WHIT">    </span><span class="NAME">File.prototype.putBin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">writeData</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">option</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>458</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.tell</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="COMM">//シークアドレスが-1 (オープンしてない)</span><span class="WHIT">
<span class='line'>459</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">writeData</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">writeData</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="COMM">//データがない</span><span class="WHIT">
<span class='line'>460</span> 
<span class='line'>461</span> 
<span class='line'>462</span> </span><span class="COMM">//		var myOpenfile = new File(myFile.fsName);不要</span><span class="WHIT">
<span class='line'>463</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">option</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>464</span> </span><span class="WHIT">            </span><span class="NAME">option</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>465</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>466</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">big</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">option</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"big"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>467</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>468</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentEncoding</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.encoding</span><span class="PUNC">;</span><span class="COMM">//現在のエンコーディングを控</span><span class="WHIT">
<span class='line'>469</span> </span><span class="WHIT">        </span><span class="NAME">this.encoding</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"BINARY"</span><span class="PUNC">;</span><span class="COMM">//バイナリに設定</span><span class="WHIT">
<span class='line'>470</span> </span><span class="COMM">//		myOpenfile.lineFeed="unix";</span><span class="WHIT">
<span class='line'>471</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">writeBuf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//書き込みデータバッファ</span><span class="WHIT">
<span class='line'>472</span> </span><span class="WHIT">        </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>473</span> </span><span class="COMM">//		myOpenfile.open("w");</span><span class="WHIT">
<span class='line'>474</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">readAddress</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">readAddress</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">writeData.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">readAddress</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>475</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">writeData</span><span class="PUNC">[</span><span class="NAME">readAddress</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">writeData</span><span class="PUNC">[</span><span class="NAME">readAddress</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>476</span> </span><span class="WHIT">                    </span><span class="NAME">writeBuf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>477</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>478</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">writeData</span><span class="PUNC">[</span><span class="NAME">readAddress</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">255</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>479</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">option</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>480</span> </span><span class="WHIT">                            </span><span class="COMM">/**
<span class='line'>481</span>                              * 処理するバイトオフセット
<span class='line'>482</span>                              * @type {number}
<span class='line'>483</span>                              */</span><span class="WHIT">
<span class='line'>484</span> </span><span class="WHIT">                            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ct</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>485</span> </span><span class="WHIT">                            </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">writeData</span><span class="PUNC">[</span><span class="NAME">readAddress</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NUMB">256</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ct</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>486</span> </span><span class="WHIT">                                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">big</span><span class="PUNC">)</span><span class="NAME">this.write</span><span class="PUNC">(</span><span class="NAME">String.fromCharCode</span><span class="PUNC">(</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">writeData</span><span class="PUNC">[</span><span class="NAME">readAddress</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NUMB">256</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ct</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&</span><span class="WHIT"> </span><span class="NUMB">255</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//上位バイトから順にプッシュ</span><span class="WHIT">
<span class='line'>487</span> </span><span class="WHIT">                                </span><span class="NAME">ct</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="COMM">//1バイト桁をあげる リトルエンディアン</span><span class="WHIT">
<span class='line'>488</span> </span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>489</span> </span><span class="WHIT">                            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">big</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>490</span> </span><span class="WHIT">                                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ctR</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ct</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ctR</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ctR</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>491</span> </span><span class="WHIT">                                    </span><span class="NAME">this.write</span><span class="PUNC">(</span><span class="NAME">String.fromCharCode</span><span class="PUNC">(</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">writeData</span><span class="PUNC">[</span><span class="NAME">readAddress</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NUMB">256</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ct</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&</span><span class="WHIT"> </span><span class="NUMB">255</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//下位バイトから順にプッシュ</span><span class="WHIT">
<span class='line'>492</span> </span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>493</span> </span><span class="WHIT">                            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>494</span> </span><span class="WHIT">                            </span><span class="COMM">/**
<span class='line'>495</span>                              * 書き終わったらループスキップして次のアドレス
<span class='line'>496</span>                              */</span><span class="WHIT">
<span class='line'>497</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>498</span> </span><span class="WHIT">                        </span><span class="NAME">writeBuf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">255</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>499</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>500</span> </span><span class="WHIT">                        </span><span class="NAME">writeBuf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">writeData</span><span class="PUNC">[</span><span class="NAME">readAddress</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>501</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>502</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>503</span> </span><span class="WHIT">                </span><span class="COMM">//	alert(writeBuf);</span><span class="WHIT">
<span class='line'>504</span> </span><span class="WHIT">                </span><span class="NAME">this.write</span><span class="PUNC">(</span><span class="NAME">String.fromCharCode</span><span class="PUNC">(</span><span class="NAME">writeBuf</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>505</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>506</span> </span><span class="COMM">//		myOpenfile.close();</span><span class="WHIT">
<span class='line'>507</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">er</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>508</span> </span><span class="WHIT">            </span><span class="NAME">this.encoding</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentEncoding</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>509</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>510</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>511</span> </span><span class="WHIT">        </span><span class="NAME">this.encoding</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentEncoding</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>512</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>513</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>514</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>515</span> 
<span class='line'>516</span> 
<span class='line'>517</span> </span><span class="COMM">/**
<span class='line'>518</span>  * FolderItem.getItemSources()
<span class='line'>519</span>  *
<span class='line'>520</span>  * 引数    なし
<span class='line'>521</span>  * 戻値    フォルダ配下のアイテムのうちファイルソースをもつアイテムのソースファイルの配列[File,File,File…]
<span class='line'>522</span>  *
<span class='line'>523</span>  * 重複チェック等はしない。再帰検索を行う。
<span class='line'>524</span>  * 配下のオブジェクトにファイルソースが一つもない場合は要素数0の配列でなくfalseを戻す
<span class='line'>525</span>  *
<span class='line'>526</span>  * @returns {*}
<span class='line'>527</span>  */</span><span class="WHIT">
<span class='line'>528</span> </span><span class="NAME">FolderItem.prototype.getItemSources</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>529</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mySources</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>530</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">itmIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">itmIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">this.items.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">itmIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>531</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.items</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FolderItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>532</span> </span><span class="WHIT">            </span><span class="NAME">mySources</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mySources.concat</span><span class="PUNC">(</span><span class="NAME">this.items</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getItemSources</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>533</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>534</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>535</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.items</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FootageItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.items</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">mainSource</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FileSource</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>536</span> </span><span class="WHIT">            </span><span class="NAME">mySources.push</span><span class="PUNC">(</span><span class="NAME">this.items</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">mainSource.file</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>537</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>538</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>539</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mySources.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>540</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">mySources</span><span class="WHIT">
<span class='line'>541</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>542</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>543</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>544</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>545</span> 
<span class='line'>546</span> </span><span class="COMM">/**
<span class='line'>547</span>  * Comp.getItemSources()
<span class='line'>548</span>  * 引数    なし
<span class='line'>549</span>  * 戻値    コンポ配下のレイヤのうちファイルソースをもつレイヤのソースファイルの配列[File,File,File…]
<span class='line'>550</span>  *
<span class='line'>551</span>  * 重複チェック等はしない。再帰検索を行う。
<span class='line'>552</span>  * 配下のオブジェクトにファイルソースが一つもない場合は要素数0の配列でなくfalseを戻す
<span class='line'>553</span>  *
<span class='line'>554</span>  * @returns {*}
<span class='line'>555</span>  */</span><span class="WHIT">
<span class='line'>556</span> </span><span class="NAME">CompItem.prototype.getItemSources</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>557</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mySources</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>558</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lyIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">lyIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">this.layers.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">lyIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>559</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NAME">lyIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">souce</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">CompItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>560</span> </span><span class="WHIT">            </span><span class="NAME">mySources</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mySources.concat</span><span class="PUNC">(</span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NAME">lyIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getItemSources</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>561</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>562</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>563</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NAME">lyIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">source</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FootageItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NAME">lyIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">source.mainSource</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FileSource</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>564</span> </span><span class="WHIT">            </span><span class="NAME">mySources.push</span><span class="PUNC">(</span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NAME">lyIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">source.mainSource.file</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>565</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>566</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>567</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mySources.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>568</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">mySources</span><span class="WHIT">
<span class='line'>569</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>570</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>571</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>572</span> 
<span class='line'>573</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>574</span> 
<span class='line'>575</span> </span><span class="COMM">/**
<span class='line'>576</span>  * CompItem.setFrames()
<span class='line'>577</span>  * 以下のコードを実行するとコンポアイテムに
<span class='line'>578</span>  * setFrames() メソッドが増設されます。
<span class='line'>579</span>  * このメソッドはコンポの継続時間をフレームでセットします。
<span class='line'>580</span>  *
<span class='line'>581</span>  *    例: newDuration=app.project.item(1).setFrames(105);
<span class='line'>582</span>  *
<span class='line'>583</span>  * 現在のフレームレートでフレーム数をオーバーしない長さの継続時間をセットして
<span class='line'>584</span>  * コンポにセットされた継続時間を返します。
<span class='line'>585</span>  * このコードを、AE 7.0以降で実行すると望ましくない副作用が有ります。
<span class='line'>586</span>  * バージョン分岐して7.0以降の環境でこのコードが実行されないよう注意してください。
<span class='line'>587</span>  *        Nekomataya/kiyo 2006/07/26
<span class='line'>588</span>  */</span><span class="WHIT">
<span class='line'>589</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">app.buildName.match</span><span class="PUNC">(</span><span class="REGX">/^6\.[05]/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>590</span> </span><span class="WHIT">    </span><span class="NAME">CompItem.prototype.setFrames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetFrames</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>591</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>592</span>          * (1/2^n)を合成して近似値を求める
<span class='line'>593</span>          * @type {number}
<span class='line'>594</span>          */</span><span class="WHIT">
<span class='line'>595</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myTargetDuration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">targetFrames</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">this.frameRate</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>596</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>597</span>          * 初期係数設定値に誤差がある場合はこの値をフォールダウン
<span class='line'>598</span>          * @type {number}
<span class='line'>599</span>          */</span><span class="WHIT">
<span class='line'>600</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">replayCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">18</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>601</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>602</span>          * 再帰処理ループ
<span class='line'>603</span>          */</span><span class="WHIT">
<span class='line'>604</span> </span><span class="WHIT">        </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>605</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myDuration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myTargetDuration</span><span class="PUNC">;</span><span class="COMM">//再初期化</span><span class="WHIT">
<span class='line'>606</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">coc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>607</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cO</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">cO</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">replayCount</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">cO</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>608</span> </span><span class="WHIT">                </span><span class="NAME">coc</span><span class="PUNC">[</span><span class="NAME">cO</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">myDuration</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>609</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myTargetDuration</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cO</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>610</span> </span><span class="WHIT">                    </span><span class="COMM">/**
<span class='line'>611</span>                      *  割り切れたので終了
<span class='line'>612</span>                      */</span><span class="WHIT">
<span class='line'>613</span> </span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>614</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>615</span> </span><span class="WHIT">                    </span><span class="NAME">myDuration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myDuration</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>616</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>617</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>618</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>619</span>              * 使い終わったので再初期化して流用
<span class='line'>620</span>              * @type {number}
<span class='line'>621</span>              */</span><span class="WHIT">
<span class='line'>622</span> </span><span class="WHIT">            </span><span class="NAME">myDuration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>623</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">coc.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>624</span> </span><span class="WHIT">                </span><span class="NAME">myDuration</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">coc</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>625</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>626</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>627</span>              * コンポに時間を設定する
<span class='line'>628</span>              * @type {number}
<span class='line'>629</span>              */</span><span class="WHIT">
<span class='line'>630</span> </span><span class="WHIT">            </span><span class="NAME">this.duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myDuration</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>631</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>632</span>              * 継続時間が設定値と異なる場合は、設定失敗なので係数を1つ下げて再度トライする
<span class='line'>633</span>              */</span><span class="WHIT">
<span class='line'>634</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.duration</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">myDuration</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>635</span> </span><span class="WHIT">                </span><span class="NAME">replayCount</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>636</span> </span><span class="WHIT">                </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>637</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>638</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>639</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>640</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>641</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.duration</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>642</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>643</span> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>644</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>645</span>      * AE7.0以降用に同機能のメソッド AE7以降では同バグがFIXされている為
<span class='line'>646</span>      * 上記のコードは副作用があるので注意 7以降は以下の同等のメソッドがロードされます。
<span class='line'>647</span>      * @param targetFrames
<span class='line'>648</span>      * @returns {number|*}
<span class='line'>649</span>      */</span><span class="WHIT">
<span class='line'>650</span> </span><span class="WHIT">    </span><span class="NAME">CompItem.prototype.setFrames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetFrames</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>651</span> </span><span class="WHIT">        </span><span class="NAME">this.duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">targetFrames</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">this.frameRate</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>652</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.duration</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>653</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>654</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>655</span> </span><span class="COMM">/**
<span class='line'>656</span>  * AERemapEXの付属コマンドを使用してクリップボードの内容を取得するメソッド
<span class='line'>657</span>  * ScriptUI/AE_Clipboard.exe またはnas/lib/resource/AE_Clipboard.exeを検索して使用
<span class='line'>658</span>  * 現在はWindowsのみのサービスだがMac版はシステムの/usr/bin/pbpaste コマンドを使用ああMac便利
<span class='line'>659</span>  *
<span class='line'>660</span>  * @returns {*}
<span class='line'>661</span>  */</span><span class="WHIT">
<span class='line'>662</span> </span><span class="NAME">nas.otome.getClipboardText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>663</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">nas.otome.clipboardGetter</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>664</span> </span><span class="WHIT">        </span><span class="NAME">nas.otome.clipboardGetter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>665</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isWindows</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>666</span> </span><span class="WHIT">            </span><span class="COMM">//windows</span><span class="WHIT">
<span class='line'>667</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myGetters</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"/Scripts/nas/lib/resource/gc.exe"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"/Scripts/ScriptUI Panels/AE_Clipboard.exe"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>668</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ix</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">myGetters</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>669</span> </span><span class="WHIT">                </span><span class="NAME">nas.otome.clipboardGetter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">File</span><span class="PUNC">(</span><span class="NAME">Folder.scripts.path.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myGetters</span><span class="PUNC">[</span><span class="NAME">ix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>670</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.otome.clipboardGetter.exists</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>671</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>672</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>673</span> </span><span class="WHIT">            </span><span class="NAME">nas.otome.clipboardGetter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">File</span><span class="PUNC">(</span><span class="STRN">"/usr/bin/pbpaste"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//たぶん決め打ちでおっけー　後で確認</span><span class="WHIT">
<span class='line'>674</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>675</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>676</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.otome.clipboardGetter.exists</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>677</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">system.callSystem</span><span class="PUNC">(</span><span class="NAME">nas.otome.clipboardGetter.fsName</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>678</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>679</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>680</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>681</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>682</span> </span><span class="COMM">/**
<span class='line'>683</span>  *
<span class='line'>684</span>  * @param myText
<span class='line'>685</span>  * @returns {*}
<span class='line'>686</span>  */</span><span class="WHIT">
<span class='line'>687</span> </span><span class="NAME">nas.otome.setClipboardText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myText</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>688</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">nas.otome.clipboardWriter</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>689</span> </span><span class="WHIT">        </span><span class="NAME">nas.otome.clipboardWriter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>690</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isWindows</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>691</span> </span><span class="WHIT">            </span><span class="COMM">//windows</span><span class="WHIT">
<span class='line'>692</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myWriters</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"/Scripts/nas/lib/resource/sc.exe"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"/Scripts/nas/lib/resource/AE_Clipboard.exe"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>693</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ix</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">myWriters</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>694</span> </span><span class="WHIT">                </span><span class="NAME">nas.otome.clipboardWriter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">File</span><span class="PUNC">(</span><span class="NAME">Folder.scripts.path.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myWriters</span><span class="PUNC">[</span><span class="NAME">ix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>695</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.otome.clipboardWriter.exists</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>696</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>697</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>698</span> </span><span class="WHIT">            </span><span class="NAME">nas.otome.clipboardWriter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">File</span><span class="PUNC">(</span><span class="STRN">"/usr/bin/pbcopy"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//たぶん決め打ちでおっけー　後で確認</span><span class="WHIT">
<span class='line'>699</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>700</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>701</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.otome.clipboardWriter.exists</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>702</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">system.callSystem</span><span class="PUNC">(</span><span class="STRN">"echo "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myText</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" |"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nas.otome.clipboardWriter.fsName</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>703</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>704</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>705</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>706</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>707</span> </span><span class="COMM">/**
<span class='line'>708</span>  * LayerCollection.addNullA()
<span class='line'>709</span>  * 引数:    なし
<span class='line'>710</span>  * 戻値:    AVLayer(NullObject)
<span class='line'>711</span>  *
<span class='line'>712</span>  * 乙女のサービスとしてヌルオブジェクトのキャッシュを行なう
<span class='line'>713</span>  * LayerCollection.addNull() の代替メソッド
<span class='line'>714</span>  * 当該メソッドで作成したキャッシュからヌルオブジェクトを複製でつくる
<span class='line'>715</span>  *
<span class='line'>716</span>  * メソッドが呼び出された場合、乙女ポケットにキャッシュがあれば当該オブジェクトが使用可能か否か判定して返す
<span class='line'>717</span>  * 使用不能な場合は該当するコンポで新たなヌルオブジェクトを作成してこれをキャッシュする
<span class='line'>718</span>  * 使用不能判定はAVLayerに必ず存在するプロパティをアクセスしてエラーを検知する…で大丈夫かな？
<span class='line'>719</span>  * 2010.10.18
<span class='line'>720</span>  */</span><span class="WHIT">
<span class='line'>721</span> 
<span class='line'>722</span> 
<span class='line'>723</span> </span><span class="COMM">/**
<span class='line'>724</span>  * 乙女のポケットにイロイロ収納します
<span class='line'>725</span>  * @type {{}}
<span class='line'>726</span>  */</span><span class="WHIT">
<span class='line'>727</span> </span><span class="NAME">nas.otome.pocket</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>728</span> </span><span class="COMM">/**
<span class='line'>729</span>  * 初期判定用にnullで初期化
<span class='line'>730</span>  * @type {boolean}
<span class='line'>731</span>  */</span><span class="WHIT">
<span class='line'>732</span> </span><span class="NAME">nas.otome.pocket.nullCache</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>733</span> 
<span class='line'>734</span> </span><span class="NAME">LayerCollection.prototype.addNullA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>735</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">doNewCash</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>736</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>737</span>      * キャッシュにレイヤがある レイヤが有効か否かを判定する
<span class='line'>738</span>      */</span><span class="WHIT">
<span class='line'>739</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.otome.pocket.nullCache</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">AVLayer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>740</span> </span><span class="WHIT">        </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>741</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.otome.pocket.nullCache.nullLayer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>742</span> </span><span class="WHIT">                </span><span class="NAME">doNewCash</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>743</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>744</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">er</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>745</span> </span><span class="WHIT">            </span><span class="NAME">doNewCash</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT">
<span class='line'>746</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>747</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>748</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>749</span>      * すでにキャッシュが有効な場合のみフラグを立てる
<span class='line'>750</span>      */</span><span class="WHIT">
<span class='line'>751</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">doNewCash</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>752</span> </span><span class="WHIT">        </span><span class="NAME">nas.otome.pocket.nullCache</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.addNull</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>753</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">nas.otome.pocket.nullCache</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>754</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>755</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tempLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>756</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.length</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>757</span> </span><span class="WHIT">            </span><span class="NAME">tempLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.addNull</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>758</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>759</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>760</span>          *  レイヤコレクションにレイヤが無い場合コンポ特定のためのレイヤを作成する
<span class='line'>761</span>          */</span><span class="WHIT">
<span class='line'>762</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">targetComp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">containingComp</span><span class="PUNC">;</span><span class="COMM">//事前処理で最低ひとつのレイヤがあるのでそのプロパティから参照</span><span class="WHIT">
<span class='line'>763</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tempLayer</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">AVLayer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>764</span> </span><span class="WHIT">            </span><span class="NAME">tempLayer.source.remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>765</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>766</span> </span><span class="WHIT">        </span><span class="COMM">//一時レイヤを削除</span><span class="WHIT">
<span class='line'>767</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetComp.selectedLayers.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>768</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">targetComp.layers.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>769</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">lIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">targetComp.selectedLayers.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">lIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>770</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">newIdx</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">targetComp.selectedLayers</span><span class="PUNC">[</span><span class="NAME">lIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">index</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>771</span> </span><span class="WHIT">                    </span><span class="NAME">newIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">targetComp.selectedLayers</span><span class="PUNC">[</span><span class="NAME">lIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">index</span><span class="WHIT">
<span class='line'>772</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>773</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>774</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>775</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT">
<span class='line'>776</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>777</span> </span><span class="WHIT">        </span><span class="NAME">nas.otome.pocket.nullCache.copyToComp</span><span class="PUNC">(</span><span class="NAME">targetComp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>778</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">targetComp.layers</span><span class="PUNC">[</span><span class="NAME">newIdx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>779</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>780</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>781</span> 
<span class='line'>782</span> </span><span class="COMM">/**
<span class='line'>783</span>  * LayerCollection.sortByName()
<span class='line'>784</span>  * 引数:なし
<span class='line'>785</span>  * 戻り値：なし
<span class='line'>786</span>  * 　コンポ内のアイテムを名前で並べ替えるメソッド
<span class='line'>787</span>  * レイヤ名を文字列して比較
<span class='line'>788</span>  * レイヤラベルの正規化はcommon
<span class='line'>789</span>  *
<span class='line'>790</span>  * @param myOpt
<span class='line'>791</span>  * @returns {boolean}
<span class='line'>792</span>  */</span><span class="WHIT">
<span class='line'>793</span> </span><span class="NAME">LayerCollection.prototype.sortByName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myOpt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>794</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.length</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>795</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>796</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>797</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>798</span>      * ソート配列を作成
<span class='line'>799</span>      * @type {Array}
<span class='line'>800</span>      */</span><span class="WHIT">
<span class='line'>801</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sortArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>802</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>803</span> </span><span class="WHIT">        </span><span class="NAME">sortArray.push</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>804</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>805</span> </span><span class="WHIT">    </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myOpt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>806</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"cell"</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>807</span> </span><span class="WHIT">            </span><span class="NAME">sortArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sortArray.sort</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>808</span> </span><span class="WHIT">                </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>809</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">A</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.labelNormalization</span><span class="PUNC">(</span><span class="NAME">a.name.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>810</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">B</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.labelNormalization</span><span class="PUNC">(</span><span class="NAME">b.name.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>811</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">A</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">B</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>812</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT">
<span class='line'>813</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>814</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">A</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">B</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>815</span> </span><span class="WHIT">                            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT">
<span class='line'>816</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>817</span> </span><span class="WHIT">                            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>818</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>819</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>820</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>821</span> </span><span class="WHIT">            </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>822</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>823</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"caseIgnore"</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>824</span> </span><span class="WHIT">            </span><span class="NAME">sortArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sortArray.sort</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>825</span> </span><span class="WHIT">                </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>826</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">A</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">a.name.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>827</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">B</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">b.name.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>828</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">A</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">B</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>829</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT">
<span class='line'>830</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>831</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">A</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">B</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>832</span> </span><span class="WHIT">                            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT">
<span class='line'>833</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>834</span> </span><span class="WHIT">                            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>835</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>836</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>837</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>838</span> </span><span class="WHIT">            </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>839</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>840</span> </span><span class="WHIT">        </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>841</span> </span><span class="WHIT">            </span><span class="NAME">sortArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sortArray.sort</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>842</span> </span><span class="WHIT">                </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>843</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">A</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">a.name.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>844</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">B</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">b.name.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>845</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">A</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">B</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>846</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT">
<span class='line'>847</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>848</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">A</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">B</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>849</span> </span><span class="WHIT">                            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT">
<span class='line'>850</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>851</span> </span><span class="WHIT">                            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>852</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>853</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>854</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>855</span> </span><span class="WHIT">            </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>856</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>857</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>858</span>      * レイヤ並び替え
<span class='line'>859</span>      */</span><span class="WHIT">
<span class='line'>860</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sortArray.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>861</span> </span><span class="WHIT">        </span><span class="NAME">sortArray</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">moveToBeginning</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>862</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>863</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>864</span> 
<span class='line'>865</span> </span><span class="COMM">//app.project.activeItem.layers.sortByName();</span><span class="WHIT">
<span class='line'>866</span> 
<span class='line'>867</span> </span><span class="COMM">/**
<span class='line'>868</span>  * AVLayer.applyPresetA(myFfxFile,skipUndo)
<span class='line'>869</span>  * 引数    myFfxFile    File    プリセットファイル
<span class='line'>870</span>  * skipUndo    boolean    undoGrooupの設定をスキップする。省略値は false
<span class='line'>871</span>  *
<span class='line'>872</span>  * 例
<span class='line'>873</span>  * app.project.activeItem.selectedLayers[0].applyPreset(myFfxFile);
<span class='line'>874</span>  *
<span class='line'>875</span>  * app.project.item(1).applyPreset(myFfxFile,true);
<span class='line'>876</span>  *
<span class='line'>877</span>  * レイヤにアニメーションプリセットを適用する
<span class='line'>878</span>  * AE7でコンポ内でのプリセット適用バグの回避のためのラッパメソッド
<span class='line'>879</span>  * オプションが与えられない場合はプリセットにundoGroupを設定してundoの混乱を回避する
<span class='line'>880</span>  * スクリプト内で複雑なundoが発生する場合はskipUndoをtrueにすることを推奨
<span class='line'>881</span>  *
<span class='line'>882</span>  * えーっと　CompItemのapplyPreset()は放置しておく　私は使わないから…
<span class='line'>883</span>  * 2009/10/24
<span class='line'>884</span>  */</span><span class="WHIT">
<span class='line'>885</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">AEVersion</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">7</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>886</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">AEVersion</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">9</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>887</span> </span><span class="WHIT">        </span><span class="NAME">AVLayer.prototype.applyPresetA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myFile</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">skipUndo</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>888</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>889</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myFile</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">File</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myFile.exists</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>890</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">skipUndo</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>891</span> </span><span class="WHIT">                    </span><span class="NAME">skipUndo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>892</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>893</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mySelection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>894</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">skipUndo</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>895</span> </span><span class="WHIT">                    </span><span class="NAME">nas.otome.beginUndoGroup</span><span class="PUNC">(</span><span class="STRN">'myApplyPreset '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myFile.name</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>896</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>897</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.containingComp.layers.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>898</span> </span><span class="WHIT">                    </span><span class="NAME">mySelection.push</span><span class="PUNC">(</span><span class="NAME">this.containingComp.layers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">selected</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>899</span> </span><span class="WHIT">                    </span><span class="NAME">this.containingComp.layers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">selected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>900</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>901</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>902</span>                  * 選択状態を保存して解除
<span class='line'>903</span>                  * @type {boolean}
<span class='line'>904</span>                  */</span><span class="WHIT">
<span class='line'>905</span> </span><span class="WHIT">                </span><span class="NAME">this.selected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>906</span> </span><span class="WHIT">                </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.applyPreset</span><span class="PUNC">(</span><span class="NAME">myFile</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//本体レイヤを選択して適用</span><span class="WHIT">
<span class='line'>907</span> 
<span class='line'>908</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.containingComp.layers.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>909</span> </span><span class="WHIT">                    </span><span class="NAME">this.containingComp.layers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">selected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mySelection</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>910</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>911</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>912</span>                  * 選択状態復帰
<span class='line'>913</span>                  */</span><span class="WHIT">
<span class='line'>914</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">skipUndo</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>915</span> </span><span class="WHIT">                    </span><span class="NAME">nas.otome.endUndoGroup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>916</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>917</span> </span><span class="COMM">//	}else{</span><span class="WHIT">
<span class='line'>918</span> </span><span class="COMM">//		エラーメッセージが必要ならここをアクティブに 不要ならばブロックごと削除</span><span class="WHIT">
<span class='line'>919</span> </span><span class="COMM">//	alert("no File "+myFile.name);</span><span class="WHIT">
<span class='line'>920</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>921</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>922</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>923</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>924</span> </span><span class="WHIT">        </span><span class="NAME">AVLayer.prototype.applyPresetA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myFile</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">skipUndo</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>925</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">skipUndo</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>926</span> </span><span class="WHIT">                </span><span class="NAME">skipUndo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>927</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>928</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">skipUndo</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">nas.otome.beginUndoGroup</span><span class="PUNC">(</span><span class="STRN">"myApplyPreset "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myFile.name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>929</span> </span><span class="WHIT">            </span><span class="NAME">this.applyPreset</span><span class="PUNC">(</span><span class="NAME">myFile</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>930</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">skipUndo</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">nas.otome.endUndoGroup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>931</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>932</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>933</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>934</span> 
<span class='line'>935</span> </span><span class="COMM">/**
<span class='line'>936</span>  * AVLayer.getLinkRoot()
<span class='line'>937</span>  * 引数:    なし
<span class='line'>938</span>  * 戻り値:    AVLayer
<span class='line'>939</span>  * リンクネットワークの親を再帰的にたどって返すメソッド
<span class='line'>940</span>  *
<span class='line'>941</span>  * @returns {AVLayer}
<span class='line'>942</span>  */</span><span class="WHIT">
<span class='line'>943</span> </span><span class="NAME">AVLayer.prototype.getLinkRoot</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>944</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>945</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.parent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>946</span> </span><span class="WHIT">        </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.parent.getLinkRoot</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>947</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>948</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>949</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>950</span> 
<span class='line'>951</span> </span><span class="COMM">/*=============================オートビルダ関連タイムシート適用メソッド=====================2009/10/22=======*/</span><span class="WHIT">
<span class='line'>952</span> 
<span class='line'>953</span> </span><span class="COMM">/**
<span class='line'>954</span>  * Xpsオブジェクト用ＡＥ特化拡張
<span class='line'>955</span>  * リンク先自動判定メソッド
<span class='line'>956</span>  * Ｘｐｓ.guessLink(Layer)
<span class='line'>957</span>  * 引数　:AEレイヤオブジェクト
<span class='line'>958</span>  * 戻り値‘リンクID
<span class='line'>959</span>  * AEのレイヤを引数で与える
<span class='line'>960</span>  * 戻り値はオフセット2を加えて返す。ID 0/1 は予約
<span class='line'>961</span>  * 0    :リンクなし    リンクすべきタイムランがない
<span class='line'>962</span>  * 1    :特殊タイムライン    タイムラインの記述はシート内にないがスチル素材として静止タイムラインを与えるべきである
<span class='line'>963</span>  * 2-    :2以降はリンクすべきタイムラインがある。タイムラインIDは戻値から２減じて得ること
<span class='line'>964</span>  *
<span class='line'>965</span>  * このメソッドはAEに特化しているので、ＡＥ専用拡張に編入するべき(乙女か …乙女だ)
<span class='line'>966</span>  *
<span class='line'>967</span>  * @param myLayer
<span class='line'>968</span>  * @returns {*}
<span class='line'>969</span>  */</span><span class="WHIT">
<span class='line'>970</span> </span><span class="NAME">Xps.prototype.guessLink</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myLayer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>971</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.layers.length</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>972</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>973</span>          * まずもってレイヤにタイムリマップが効かない場合は捨てる(ＩＤ:0　を返す)
<span class='line'>974</span>          */</span><span class="WHIT">
<span class='line'>975</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myLayer.canSetTimeRemapEnabled</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>976</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>977</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>978</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>979</span>          * ソースの継続時間が０なので平面またはそれに類するソースである
<span class='line'>980</span>          */</span><span class="WHIT">
<span class='line'>981</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myLayer.source.duration</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>982</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>983</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>984</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>985</span>          * 判定文字列を生成（レイヤソースの所属フォルダ名称とファイル名を連結したものをあらかじめ作成）しておくほうが良いかも　今日はレイヤ名で
<span class='line'>986</span>          */</span><span class="WHIT">
<span class='line'>987</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">testName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myLayer.name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>988</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>989</span>          * レイヤ名がBG/LO/をスキップ [角カッコ]は振り分けルーチンが背景判定したレイヤ
<span class='line'>990</span>          * ID=1 BG/book等のスチルフッテージと判定
<span class='line'>991</span>          */</span><span class="WHIT">
<span class='line'>992</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">testName.match</span><span class="PUNC">(</span><span class="REGX">/(^[-_].*|bg|lo|book)|(\[.+\])/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>993</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>994</span>              * ソースの継続時間がシート尺をうわまわっている場合はタイムリマップしない
<span class='line'>995</span>              */</span><span class="WHIT">
<span class='line'>996</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myLayer.source.duration</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.duration</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">this.ftramerate</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>997</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>998</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>999</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT">
<span class='line'>1000</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1001</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1002</span> 
<span class='line'>1003</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1004</span>          * 検査(完全一致はやめ　冒頭一致で後ろの文字列は主に数値として許容)
<span class='line'>1005</span>          */</span><span class="WHIT">
<span class='line'>1006</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Xid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">Xid</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.layers.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">Xid</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1007</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Label</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"^"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NAME">Xid</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">".*$"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"i"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1008</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">testName.match</span><span class="PUNC">(</span><span class="NAME">Label</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1009</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Xid</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1010</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1011</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1012</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1013</span>          * 分類フォルダの名称でチェック
<span class='line'>1014</span>          */</span><span class="WHIT">
<span class='line'>1015</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myLayer.source.parentFolder.name</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"[CELL]"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1016</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>1017</span>              * ソースの継続時間がシート尺をうわまわっている場合はタイムリマップしない
<span class='line'>1018</span>              */</span><span class="WHIT">
<span class='line'>1019</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myLayer.source.duration</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.duration</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">this.ftramerate</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1020</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>1021</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1022</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT">
<span class='line'>1023</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1024</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1025</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1026</span>          * 判定を抜けて、セル判定だった
<span class='line'>1027</span>          */</span><span class="WHIT">
<span class='line'>1028</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1029</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1030</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1031</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1032</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1033</span> 
<span class='line'>1034</span> </span><span class="COMM">/**
<span class='line'>1035</span>  * XPS.mkStage(stgName,stgLength,stgResolution,stgWidth,stgHeight,myOptions)
<span class='line'>1036</span>  * 引数
<span class='line'>1037</span>  * stgName    ステージコンポ名を文字列で（省略時はXPSデータから作成）
<span class='line'>1038</span>  * stagLength　ステージの継続時間をフレーム数で(省略時はXPSデータから作成)
<span class='line'>1039</span>  * stgResolution    ステージの基準解像度をdpiで(省略時は入力メディア値から取得)
<span class='line'>1040</span>  * stgWidth    ステージ幅をmm数で(省略時はフッテージから最大値を取得)
<span class='line'>1041</span>  * stgHeight    ステージ奥行きをｍｍ数で(省略時はフッテージから最大値を取得)
<span class='line'>1042</span>  * myOptions    オプション文字列
<span class='line'>1043</span>  * map    ＭＡＰ検索を行なう（デフォルト）
<span class='line'>1044</span>  * nomap    ＭＡＰ検索を行なわない
<span class='line'>1045</span>  * select    現在の選択アイテムをメンバーにする(デフォルトでは無視)
<span class='line'>1046</span>  * align[N]    エレメントの強制アライメントを行なう。 [N]は数値
<span class='line'>1047</span>  * align0    左下
<span class='line'>1048</span>  * align1    下
<span class='line'>1049</span>  * align2    右下
<span class='line'>1050</span>  * align3    左
<span class='line'>1051</span>  * align4    中央(デフォルト)
<span class='line'>1052</span>  * align5    右
<span class='line'>1053</span>  * align6    左上
<span class='line'>1054</span>  * align7    上
<span class='line'>1055</span>  * align8    右上
<span class='line'>1056</span>  * つまり
<span class='line'>1057</span>  * 6    7    8
<span class='line'>1058</span>  * 3    4    5
<span class='line'>1059</span>  * 0    1    2
<span class='line'>1060</span>  * こうです
<span class='line'>1061</span>  * アライメントは未実装(2009.10.23)
<span class='line'>1062</span>  * bg[N]    背景の取り込みオプション(BG/BOOK等のタイミングのないフッテージ全て)
<span class='line'>1063</span>  * bg0    BGを取り込まない
<span class='line'>1064</span>  * bg#    #枚のBGを取り込む(1-9) 9個以上はデフォルトにしといてください　数の制限が主な用途だと思うので
<span class='line'>1065</span>  * bgAll    あるだけ全て取り込む(デフォルト)
<span class='line'>1066</span>  *
<span class='line'>1067</span>  * 自動化を進める観点から主体となるオブジェクトのメソッドで組むのが最も適切っぽい
<span class='line'>1068</span>  * ただし、ＡＥに特化したメソッドなのでotomeのライブラリ中で拡張を行なう
<span class='line'>1069</span>  * ここではコンストラクタの拡張ではなくXPSバッファの機能で実装しておく。ピクセル比率は現在"1"固定
<span class='line'>1070</span>  * この関数は現時点で　XpsオブジェクトではなくXPSバッファの拡張である点に注意　オブジェクトのメソッドコールはできない
<span class='line'>1071</span>  *
<span class='line'>1072</span>  * 各引数は基本的に省略が前提なのであった　要ケーステスト(2009/10/23)
<span class='line'>1073</span>  * 入れ替え時に不都合が発生するケースがあるのでクラスメソッドに変更(2010/11)
<span class='line'>1074</span>  *
<span class='line'>1075</span>  * @param stgName
<span class='line'>1076</span>  * @param stgLength
<span class='line'>1077</span>  * @param stgResolution
<span class='line'>1078</span>  * @param stgWidth
<span class='line'>1079</span>  * @param stgHeight
<span class='line'>1080</span>  * @param myOptions
<span class='line'>1081</span>  * @returns {*}
<span class='line'>1082</span>  */</span><span class="WHIT">
<span class='line'>1083</span> </span><span class="NAME">Xps.prototype.mkStage</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">stgName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">stgLength</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">stgResolution</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">stgWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">stgHeight</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myOptions</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1084</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myStgName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">this.scene</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.cut</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">"_"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//この部分をステージ名を生成する関数で置き換えるべき（2010/10/16）</span><span class="WHIT">
<span class='line'>1085</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">stgName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1086</span> </span><span class="WHIT">        </span><span class="NAME">myStgName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">stgName</span><span class="WHIT">
<span class='line'>1087</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1088</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1089</span>      * 指定があればコンポ名は入れ替え
<span class='line'>1090</span>      * 31バイト制限のためステージ名を前後の余裕を持って
<span class='line'>1091</span>      *（5bitePrefix+myStageName+5bitePostFix "(xxx)NAME tk01"&lt;このくらい）21バイトに制限しておく
<span class='line'>1092</span>      */</span><span class="WHIT">
<span class='line'>1093</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.biteCount</span><span class="PUNC">(</span><span class="NAME">myStgName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">21</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1094</span> </span><span class="WHIT">        </span><span class="NAME">myStgName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">prompt</span><span class="PUNC">(</span><span class="STRN">"ステージ名を21バイト以下で指定してください"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myStgName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1095</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.nas.biteCount</span><span class="PUNC">(</span><span class="NAME">myStgName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">21</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1096</span> </span><span class="WHIT">            </span><span class="NAME">myStgName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.biteClip</span><span class="PUNC">(</span><span class="NAME">myStgName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">21</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1097</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1098</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1099</span>          * 暫定版　一回指定しそこねたら強制的にちじめる　後ろを切るのでじつはあまり役に立たない
<span class='line'>1100</span>          */</span><span class="WHIT">
<span class='line'>1101</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1102</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myAlign</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1103</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myOptions</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myOptions.match</span><span class="PUNC">(</span><span class="REGX">/align(\d)/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1104</span> </span><span class="WHIT">        </span><span class="NAME">myAlign</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT">
<span class='line'>1105</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1106</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">getSelection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1107</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myOptions</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myOptions.match</span><span class="PUNC">(</span><span class="REGX">/select/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1108</span> </span><span class="WHIT">        </span><span class="NAME">getSelecton</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT">
<span class='line'>1109</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1110</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">getMap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1111</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myOptions</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myOptions.match</span><span class="PUNC">(</span><span class="REGX">/nomap/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1112</span> </span><span class="WHIT">        </span><span class="NAME">getMap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>1113</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1114</span> 
<span class='line'>1115</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1116</span>      * 呼び出し時点でプロジェクト内のフッテージが選択されていれば、そのフッテージをメンバーとするコンポを組む
<span class='line'>1117</span>      * オプションがあればユーザ選択を無視して自動判定（ＭＡＰ検索）する
<span class='line'>1118</span>      * メンバーがない場合は処理停止
<span class='line'>1119</span>      * @type {*}
<span class='line'>1120</span>      */</span><span class="WHIT">
<span class='line'>1121</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myLength</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.duration</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1122</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">stgLength</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">stgLength</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1123</span> </span><span class="WHIT">        </span><span class="NAME">myLength</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">stgLength</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1124</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1125</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResolution</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.inputMedias.selectedRecord</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1126</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">stgResolution</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">stgResolution</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1127</span> </span><span class="WHIT">        </span><span class="NAME">myResolution</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">stgResolution</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1128</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1129</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1130</span>      * 入力メディアから初期値を作成する幅や高さの指定があれば上書き。引数をフラグにしてあとで自動判定の際に処理をスキップ
<span class='line'>1131</span>      * @type {Object}
<span class='line'>1132</span>      */</span><span class="WHIT">
<span class='line'>1133</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myFrameAspect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">eval</span><span class="PUNC">(</span><span class="NAME">nas.inputMedias.selectedRecord</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1134</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.ceil</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">nas.inputMedias.selectedRecord</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.inputMedias.selectedRecord</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">25.4</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1135</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.ceil</span><span class="PUNC">(</span><span class="NAME">myWidth</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myFrameAspect</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1136</span> 
<span class='line'>1137</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">stgWidth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">stgWidth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1138</span> </span><span class="WHIT">        </span><span class="NAME">myWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.ceil</span><span class="PUNC">(</span><span class="NAME">stgWidth</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">myResolution</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">25.4</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT">
<span class='line'>1139</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1140</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">stgHeight</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">stgHeight</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1141</span> </span><span class="WHIT">        </span><span class="NAME">myHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.ceil</span><span class="PUNC">(</span><span class="NAME">stgHeight</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">myResolution</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">25.4</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT">
<span class='line'>1142</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1143</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1144</span>      * BG取込オプション
<span class='line'>1145</span>      * @type {null}
<span class='line'>1146</span>      */</span><span class="WHIT">
<span class='line'>1147</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bgOpt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1148</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myOptions</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myOptions.match</span><span class="PUNC">(</span><span class="REGX">/bg(\d)/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1149</span> </span><span class="WHIT">        </span><span class="NAME">bgOpt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT">
<span class='line'>1150</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1151</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1152</span>      * ステージのメンバアイテムトレーラ
<span class='line'>1153</span>      * @type {Array}
<span class='line'>1154</span>      */</span><span class="WHIT">
<span class='line'>1155</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myMembers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1156</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1157</span>      * 初期化終わり　解析
<span class='line'>1158</span>      */</span><span class="WHIT">
<span class='line'>1159</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">getSelection</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">app.project.selection.length</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1160</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">app.project.selection.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1161</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>1162</span>              * ユーザ選択アイテムはAVアイテムである限り無条件で取り込み
<span class='line'>1163</span>              */</span><span class="WHIT">
<span class='line'>1164</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">app.project.selection</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">AVItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1165</span> </span><span class="WHIT">                </span><span class="NAME">myMenbers.push</span><span class="PUNC">(</span><span class="NAME">app.project.selection</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1166</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1167</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1168</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1169</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">getMap</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1170</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myMemberTrailer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">app.project.items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.mapFolders.mapBase</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.mapFolders.cell</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">items</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1171</span> 
<span class='line'>1172</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1173</span>          * MAP処理第一ステージ
<span class='line'>1174</span>          * オプションにしたがって背景を取り込む(暫定処置　そのうちXPS参照でできるようになる…と良いよね)
<span class='line'>1175</span>          * 背景取り込みオプションはひとまず（none/single/all）かな？
<span class='line'>1176</span>          * @type {number}
<span class='line'>1177</span>          */</span><span class="WHIT">
<span class='line'>1178</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bgCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myMemberTrailer.length</span><span class="PUNC">;</span><span class="COMM">//最大値で初期化=ALL</span><span class="WHIT">
<span class='line'>1179</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bgOpt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1180</span> </span><span class="WHIT">            </span><span class="NAME">bgCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bgOpt</span><span class="WHIT">
<span class='line'>1181</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1182</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bgOpt</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1183</span> </span><span class="WHIT">            </span><span class="NAME">bgCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>1184</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1185</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myMemberTrailer.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1186</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bgCount</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1187</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="WHIT">
<span class='line'>1188</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1189</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>1190</span>              *  カウントに達したら抜ける
<span class='line'>1191</span>              */</span><span class="WHIT">
<span class='line'>1192</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myMemberTrailer</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name.match</span><span class="PUNC">(</span><span class="REGX">/\[.+\]/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1193</span> </span><span class="WHIT">                </span><span class="NAME">myMembers.push</span><span class="PUNC">(</span><span class="NAME">myMemberTrailer</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1194</span> </span><span class="WHIT">                </span><span class="NAME">bgCount</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1195</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1196</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1197</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1198</span>          * 取り込んでも取り込まなくても第一ステージ終了
<span class='line'>1199</span>          * 第二ステージは背景以外のフッテージをメンバー追加
<span class='line'>1200</span>          */</span><span class="WHIT">
<span class='line'>1201</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">lIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.layers.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">lIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1202</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mEmber</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myMemberTrailer.getByName</span><span class="PUNC">(</span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NAME">lIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//完全一致で検索</span><span class="WHIT">
<span class='line'>1203</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mEmber</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1204</span> </span><span class="WHIT">                </span><span class="NAME">myMembers.push</span><span class="PUNC">(</span><span class="NAME">mEmber</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1205</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1206</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1207</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1208</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1209</span>      * メンバ収集おしまい
<span class='line'>1210</span>      * メンバ数が0なら処理中断
<span class='line'>1211</span>      */</span><span class="WHIT">
<span class='line'>1212</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myMembers.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1213</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1214</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1215</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1216</span>      * 指定名称のコンポがすでにある場合は、名称にテイクNoを追加して作成する
<span class='line'>1217</span>      * @type {*}
<span class='line'>1218</span>      */</span><span class="WHIT">
<span class='line'>1219</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">existsComps</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">app.project.getItemByName</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"^\\("</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nas.itmFootStamps.stage</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\\)"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myStgName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"(\\s.*)?$"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//ポストフィックスは空白区切り（AEあわせ）</span><span class="WHIT">
<span class='line'>1220</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1221</span>      * 初期化
<span class='line'>1222</span>      * @type {string}
<span class='line'>1223</span>      */</span><span class="WHIT">
<span class='line'>1224</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myPstfix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1225</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">existsComps</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1226</span> </span><span class="COMM">//		myStgName=nas.incrStr(existsComps[existsComps.length-1].name);//ラストのファイル名をincr</span><span class="WHIT">
<span class='line'>1227</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newPstfix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.incrStr</span><span class="PUNC">(</span><span class="NAME">RegExp.$2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1228</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">newPstfix</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">myPstfix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1229</span> </span><span class="WHIT">            </span><span class="NAME">myPstfix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">" tk2"</span><span class="WHIT">
<span class='line'>1230</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1231</span> </span><span class="WHIT">            </span><span class="NAME">myPstfix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newPstfix</span><span class="WHIT">
<span class='line'>1232</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1233</span> </span><span class="WHIT">        </span><span class="NAME">nas.otome.writeConsole</span><span class="PUNC">(</span><span class="STRN">"既存コンポが"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">existsComps.length</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"個あります。"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nas.GUI.LineFeed</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myPstfix</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"を作成します"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1234</span> </span><span class="COMM">//		if(existsComps.length){myStgName=nas.biteClip(myStgName,31-myPstfix.length)+myPstfix};</span><span class="WHIT">
<span class='line'>1235</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1236</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1237</span>      * 指定がなければメンバーのジオメトリをチェックしてコンポサイズを確定する
<span class='line'>1238</span>      */</span><span class="WHIT">
<span class='line'>1239</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myMembers.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1240</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">stgWidth</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myMembers</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">width</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">myWidth</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1241</span> </span><span class="WHIT">            </span><span class="NAME">myWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myMembers</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">width</span><span class="WHIT">
<span class='line'>1242</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1243</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">stgHeight</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myMembers</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">height</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">myHeight</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1244</span> </span><span class="WHIT">            </span><span class="NAME">myHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myMembers</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">height</span><span class="WHIT">
<span class='line'>1245</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1246</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1247</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1248</span>      * 新コンポ作る
<span class='line'>1249</span>      */</span><span class="WHIT">
<span class='line'>1250</span> </span><span class="WHIT">    </span><span class="NAME">nas.otome.beginUndoGroup</span><span class="PUNC">(</span><span class="STRN">"makeStage "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myStgName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1251</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1252</span>      * コンポはルートフォルダに作っちゃうけど良いのかな？　ま暫定でルートだ
<span class='line'>1253</span>      */</span><span class="WHIT">
<span class='line'>1254</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myStage</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">app.project.items.addComp</span><span class="PUNC">(</span><span class="NAME">nas.itmFootStamps.stage</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myStgName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myPstfix</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myHeight</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nas.inputMedias.selectedRecord</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1255</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myStage</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1256</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1257</span>          * 失敗はまずないと思いたいけどあるかも知れない
<span class='line'>1258</span>          * 時間セット
<span class='line'>1259</span>          */</span><span class="WHIT">
<span class='line'>1260</span> </span><span class="WHIT">        </span><span class="NAME">myStage.setFrames</span><span class="PUNC">(</span><span class="NAME">myLength</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1261</span> </span><span class="WHIT">        </span><span class="NAME">myStage.comment</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.itmFootStamps.stage</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="COMM">//フットスタンプぺたら（ここは初作成なのでOK　書き換えや判別は注意）</span><span class="WHIT">
<span class='line'>1262</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1263</span>          * メンバーを順に流しこむ（ユーザ指定は下側だが順番になってるはずなので並べ替えは一応不要）
<span class='line'>1264</span>          */</span><span class="WHIT">
<span class='line'>1265</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myMembers.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1266</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myStage.layers.add</span><span class="PUNC">(</span><span class="NAME">myMembers</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1267</span> </span><span class="COMM">//		myLayer.name=myMembers[idx].name;</span><span class="WHIT">
<span class='line'>1268</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1269</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1270</span> </span><span class="WHIT">    </span><span class="NAME">nas.otome.endUndoGroup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1271</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1272</span>      * ここまで作ったらあとはタイミングの適用で、そのままメソッドのコールが可能　どうしましょう？
<span class='line'>1273</span>      * 常道なら？他のアイテムのセレクトを解除してステージコンポをセレクトして返しておしまいだけど…
<span class='line'>1274</span>      * @type {boolean}
<span class='line'>1275</span>      */</span><span class="WHIT">
<span class='line'>1276</span> </span><span class="WHIT">    </span><span class="NAME">myStage.selected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1277</span> 
<span class='line'>1278</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1279</span>      * 定型処理実行
<span class='line'>1280</span>      * @type {Folder}
<span class='line'>1281</span>      */</span><span class="WHIT">
<span class='line'>1282</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myAction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Folder</span><span class="PUNC">(</span><span class="NAME">Folder.scripts.path.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"/Scripts/nas/(actions)/systemResources/XPS.mkStage"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1283</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myAction.exists</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1284</span> </span><span class="WHIT">        </span><span class="NAME">myStage.executeAction</span><span class="PUNC">(</span><span class="NAME">myAction</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1285</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1286</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myStage</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1287</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1288</span> 
<span class='line'>1289</span> </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>1290</span> </span><span class="COMM">/**
<span class='line'>1291</span>  * XPSオブジェクトに識別情報を問い合わせる（読み出し専用）
<span class='line'>1292</span>  * XPS.getInfo()
<span class='line'>1293</span>  * 引数    なし
<span class='line'>1294</span>  * XPSの識別情報を返す　ストア内に内容の一致するタイムシートがあればその情報を返し、ない場合はオブジェクト自身の情報を作成して返す
<span class='line'>1295</span>  *
<span class='line'>1296</span>  * @returns {Object}
<span class='line'>1297</span>  */</span><span class="WHIT">
<span class='line'>1298</span> </span><span class="NAME">Xps.prototype.getInfo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1299</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">storeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">this.scene</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.cut</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">"_"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1300</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1301</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">nas.XPSStore</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.XPSStore.select</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.XPSStore.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1302</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1303</span>          * ストアのコメントから取得
<span class='line'>1304</span>          * @type {string|*|string|string}
<span class='line'>1305</span>          */</span><span class="WHIT">
<span class='line'>1306</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myProp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.XPSStore.selected.comment</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1307</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1308</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1309</span>          * バッファ内容から生成
<span class='line'>1310</span>          * @type {string}
<span class='line'>1311</span>          */</span><span class="WHIT">
<span class='line'>1312</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myProp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"{"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1313</span> </span><span class="WHIT">        </span><span class="NAME">myProp</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\"name\" :\""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">storeName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\","</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1314</span> </span><span class="WHIT">        </span><span class="NAME">myProp</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\"modified\" :\""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toNASString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\","</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1315</span> </span><span class="WHIT">        </span><span class="NAME">myProp</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\"length\" :\"=="</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myContent.length</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"==\","</span><span class="PUNC">;</span><span class="COMM">//"=="でエスケープしてある場合はファイルなし</span><span class="WHIT">
<span class='line'>1316</span> </span><span class="WHIT">        </span><span class="NAME">myProp</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\"url\" :\"\""</span><span class="PUNC">;</span><span class="COMM">//""ファイルなし</span><span class="WHIT">
<span class='line'>1317</span> </span><span class="WHIT">        </span><span class="NAME">myProp</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"}"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1318</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1319</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1320</span>      * オブジェクトで返す　テキストが良いか？
<span class='line'>1321</span>      */</span><span class="WHIT">
<span class='line'>1322</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">eval</span><span class="PUNC">(</span><span class="STRN">"\("</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myProp</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\)"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1323</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1324</span> </span><span class="COMM">//+++++++++++++++++++++++++++++AEオブジェクト用Ｘｐｓ対応拡張メソッド</span><span class="WHIT">
<span class='line'>1325</span> 
<span class='line'>1326</span> </span><span class="COMM">/**
<span class='line'>1327</span>  * CompItem.applyXPS(ｍｙＸｐｓ)
<span class='line'>1328</span>  * 引数    XPSオブジェクト
<span class='line'>1329</span>  * 引数が与えられなかった場合はXPSStor.selected/XPSバッファ/XPSStore内の同名シートの順で検索する
<span class='line'>1330</span>  * それでも候補がなかった場合はNOPリターン　だけど判定はいまは書かない　そのうち書く　2009/10/20
<span class='line'>1331</span>  *
<span class='line'>1332</span>  * @param myXps
<span class='line'>1333</span>  * @returns {boolean}
<span class='line'>1334</span>  */</span><span class="WHIT">
<span class='line'>1335</span> </span><span class="NAME">CompItem.prototype.applyXPS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myXps</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1336</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myXps</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1337</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>1338</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1339</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1340</span>      *  現在パス
<span class='line'>1341</span>      */</span><span class="WHIT">
<span class='line'>1342</span> </span><span class="WHIT">    </span><span class="NAME">nas.otome.beginUndoGroup</span><span class="PUNC">(</span><span class="STRN">"applyXPS"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1343</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1344</span>      * 指定シートのフレームレート・継続時間を確認して適用
<span class='line'>1345</span>      */</span><span class="WHIT">
<span class='line'>1346</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.frameRate</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">myXps.framerate</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1347</span> </span><span class="WHIT">        </span><span class="NAME">this.frameRate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myXps.framerate</span><span class="WHIT">
<span class='line'>1348</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1349</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myXps.duration</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">this.duration</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">this.frameDuration</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1350</span> </span><span class="WHIT">        </span><span class="NAME">this.setFrames</span><span class="PUNC">(</span><span class="NAME">myXps.duration</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1351</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1352</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1353</span>      * XPS内のタイムラインとレイヤの関連付けは以下の手順で解決
<span class='line'>1354</span>      * 1.XPSStore.links配列を参照　(未実装)
<span class='line'>1355</span>      * 2.easyXPS　オブジェクトがあればその内部のレイヤセレクタを参照　(今回はパス)
<span class='line'>1356</span>      * 3.参照データがなければ推測エンジンを使用
<span class='line'>1357</span>      */</span><span class="WHIT">
<span class='line'>1358</span> 
<span class='line'>1359</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1360</span>      * 推測エンジンはeasyXPSを踏襲　環境整備が終わった状態で使用すればまず外れることはない。
<span class='line'>1361</span>      * 当座それ以外の連結はeasyXPSを使って手作業で解決
<span class='line'>1362</span>      * リンク用内部配列を初期化
<span class='line'>1363</span>      * @type {Array}
<span class='line'>1364</span>      */</span><span class="WHIT">
<span class='line'>1365</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">links</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">this.layers.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//レイヤ数分の配列</span><span class="WHIT">
<span class='line'>1366</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1367</span>      * リンク先を判定
<span class='line'>1368</span>      */</span><span class="WHIT">
<span class='line'>1369</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.layers.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1370</span> </span><span class="WHIT">        </span><span class="NAME">links</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myXps.guessLink</span><span class="PUNC">(</span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1371</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1372</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1373</span>      * リンク先に対して一点ずつ解決
<span class='line'>1374</span>      */</span><span class="WHIT">
<span class='line'>1375</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.layers.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1376</span> </span><span class="WHIT">        </span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">applyTimeline</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myXps</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">links</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1377</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1378</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1379</span>      *  レイヤがタイムリマップ不能な場合はスキップ
<span class='line'>1380</span>      */</span><span class="WHIT">
<span class='line'>1381</span> </span><span class="COMM">//		if(this.layers[idx+1].canEnableTimeRemap){}</span><span class="WHIT">
<span class='line'>1382</span> 
<span class='line'>1383</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1384</span>      * レイヤの並び順をシートに合わせて修正する(意図的に違えている時は…ゴメンネ)
<span class='line'>1385</span>      * 並び替え自体をアクション化することを検討
<span class='line'>1386</span>      * @type {Array}
<span class='line'>1387</span>      */</span><span class="WHIT">
<span class='line'>1388</span> </span><span class="COMM">//    var stackList = new Array(myXps.layers.length + 2);//ID0/1を処理するために2つ加算</span><span class="WHIT">
<span class='line'>1389</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">stackList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">myXps.xpsTracks.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//ID0/1を処理するために2つ加算</span><span class="WHIT">
<span class='line'>1390</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">stackList.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1391</span> </span><span class="WHIT">        </span><span class="NAME">stackList</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>1392</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1393</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1394</span>      * スタックリストを配列で初期化
<span class='line'>1395</span>      */</span><span class="WHIT">
<span class='line'>1396</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.layers.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1397</span> </span><span class="WHIT">        </span><span class="NAME">stackList</span><span class="PUNC">[</span><span class="NAME">links</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1398</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1399</span> 
<span class='line'>1400</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">stackList</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1401</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sIdx</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">stackList</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1402</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">stackList</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">sIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">locked</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1403</span> </span><span class="WHIT">                </span><span class="NAME">stackList</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">sIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">moveToBeginning</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1404</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1405</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1406</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1407</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1408</span>      * 上の並べ替えを行なった場合並び替え対象外のレイヤが必ず下側に入るのでカメラレイヤが下になるので好ましくない
<span class='line'>1409</span>      * クリッピングターゲットがすでに存在した場合最も上に移動　このくだりはアクションの方がよいかも…一考
<span class='line'>1410</span>      */</span><span class="WHIT">
<span class='line'>1411</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">this.layers.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1412</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">comment.indexOf</span><span class="PUNC">(</span><span class="STRN">"##nas.otome cameraWorkTarget"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1413</span> </span><span class="WHIT">            </span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">moveToBeginning</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1414</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1415</span> </span><span class="WHIT">        </span><span class="COMM">//footPrint が固定コーディングなので注意</span><span class="WHIT">
<span class='line'>1416</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1417</span> 
<span class='line'>1418</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1419</span>      * フットスタンプにXPS識別情報を加える。シートIDは当てにならない上にキケンなので、シートの比較情報
<span class='line'>1420</span>      */</span><span class="WHIT">
<span class='line'>1421</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.XPSStore.select</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1422</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.XPSStore.selected.comment</span><span class="WHIT">
<span class='line'>1423</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1424</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="WHIT">
<span class='line'>1425</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1426</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1427</span>      * 選択されたシートがあれば情報コピー
<span class='line'>1428</span>      *
<span class='line'>1429</span>      * 再適用時にタイムシート識別情報が重複するので元のコメントに
<span class='line'>1430</span>      * シート識別情報が存在する場合は元の情報からシート識別情報を削除する
<span class='line'>1431</span>      * データの判定基準は第一行がステージシグネチャであることを確認して
<span class='line'>1432</span>      * 第一行の前方に挿入？入れ替えか？　どんどん増やすと危険なので入れ替える。
<span class='line'>1433</span>      */</span><span class="WHIT">
<span class='line'>1434</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.comment.match</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"^"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nas.itmFootStamps.stage</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1435</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oldContents</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.comment.split</span><span class="PUNC">(</span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1436</span> </span><span class="WHIT">        </span><span class="NAME">this.comment</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">nas.itmFootStamps.stage</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oldContents.slice</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oldContents.length</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1437</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1438</span> </span><span class="WHIT">        </span><span class="NAME">this.comment</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.comment</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1439</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1440</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1441</span>      * おしまいさん
<span class='line'>1442</span>      */</span><span class="WHIT">
<span class='line'>1443</span> </span><span class="WHIT">    </span><span class="NAME">nas.otome.endUndoGroup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1444</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1445</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1446</span>          * 定型処理実行
<span class='line'>1447</span>          * @type {Folder}
<span class='line'>1448</span>          */</span><span class="WHIT">
<span class='line'>1449</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myAction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Folder</span><span class="PUNC">(</span><span class="NAME">Folder.scripts.path.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"/Scripts/nas/(actions)/systemResources/CompItem.applyXPS"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1450</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myAction.exists</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1451</span> </span><span class="WHIT">            </span><span class="NAME">this.executeAction</span><span class="PUNC">(</span><span class="NAME">myAction</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1452</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1453</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1454</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1455</span> </span><span class="COMM">/**
<span class='line'>1456</span>  * AVLayer.applyTimeline(親コンポ,myXps,リンクID)
<span class='line'>1457</span>  * 引数
<span class='line'>1458</span>  * 親コンポ　AE7以降なら不要なのだがAE65での実行のために与える
<span class='line'>1459</span>  * XPSオブジェクト    必ず必要
<span class='line'>1460</span>  * リンクID 呼び出し側でXPSのどのタイムラインを適用するか決定して与える
<span class='line'>1461</span>  *
<span class='line'>1462</span>  * 引数が与えられなかった場合は動作不定
<span class='line'>1463</span>  * 基本的にはこのメソッドは親コンポからの呼び出し専用である
<span class='line'>1464</span>  *
<span class='line'>1465</span>  * @param parentComp
<span class='line'>1466</span>  * @param myXps
<span class='line'>1467</span>  * @param linkID
<span class='line'>1468</span>  * @returns {*}
<span class='line'>1469</span>  */</span><span class="WHIT">
<span class='line'>1470</span> </span><span class="NAME">AVLayer.prototype.applyTimeline</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">parentComp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myXps</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">linkID</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1471</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.source.duration</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1472</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">this.locked</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1473</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.inPoint</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1474</span> </span><span class="WHIT">                </span><span class="NAME">this.inPoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>1475</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1476</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.outPoint</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">parentComp.duration</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1477</span> </span><span class="WHIT">                </span><span class="NAME">this.outPoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parentComp.duration</span><span class="WHIT">
<span class='line'>1478</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1479</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1480</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>1481</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1482</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1483</span>      *  タイムリマップ不能なレイヤなのでタイムリマップ操作はしないでin/outポイントを調整する
<span class='line'>1484</span>      */</span><span class="WHIT">
<span class='line'>1485</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">linkID</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1486</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>1487</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1488</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1489</span>      * 対応するタイムラインがないのでNOP
<span class='line'>1490</span>      * タイムリマップ初期化(ロックされている場合はパス)
<span class='line'>1491</span>      */</span><span class="WHIT">
<span class='line'>1492</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">this.locked</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1493</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1494</span>          * 全消し
<span class='line'>1495</span>          * @type {boolean}
<span class='line'>1496</span>          */</span><span class="WHIT">
<span class='line'>1497</span> </span><span class="WHIT">        </span><span class="NAME">this.timeRemapEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1498</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1499</span>          * 再有効化でリセット
<span class='line'>1500</span>          * @type {boolean}
<span class='line'>1501</span>          */</span><span class="WHIT">
<span class='line'>1502</span> </span><span class="WHIT">        </span><span class="NAME">this.timeRemapEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1503</span> 
<span class='line'>1504</span> </span><span class="COMM">//	if(this.timeRemapEnabled) {this.timeRemapEnabled=false;};//キーリマップが現在あるなら一端消去</span><span class="WHIT">
<span class='line'>1505</span> </span><span class="COMM">//	this.timeRemapEnabled=true;//その後再度有効化してリセット</span><span class="WHIT">
<span class='line'>1506</span> </span><span class="WHIT">        </span><span class="NAME">this.timeRemap.removeKey</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//有効化直後はキーが二つあるので単純に一個消す</span><span class="WHIT">
<span class='line'>1507</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1508</span>          * in/outポイントを調整する
<span class='line'>1509</span>          */</span><span class="WHIT">
<span class='line'>1510</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.inPoint</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1511</span> </span><span class="WHIT">            </span><span class="NAME">this.inPoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>1512</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1513</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.outPoint</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">parentComp.duration</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1514</span> </span><span class="WHIT">            </span><span class="NAME">this.outPoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parentComp.duration</span><span class="WHIT">
<span class='line'>1515</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1516</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1517</span>          * カラセルエフェクトがもしあれば消す
<span class='line'>1518</span>          */</span><span class="WHIT">
<span class='line'>1519</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.effect</span><span class="PUNC">(</span><span class="STRN">"blankTimeLine"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1520</span> </span><span class="WHIT">            </span><span class="NAME">this.effect</span><span class="PUNC">(</span><span class="STRN">"blankTimeLine"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1521</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1522</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1523</span>          * @desc あったら消す
<span class='line'>1524</span>          */</span><span class="WHIT">
<span class='line'>1525</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1526</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">linkID</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1527</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT">
<span class='line'>1528</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1529</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1530</span>      * 背景スチルと判断されたレイヤなのでリマップの初期化のみでリターン
<span class='line'>1531</span>      * XPSからタイムラインを抽出してリマップを作成。
<span class='line'>1532</span>      * カラ処理はAE８以降ならラストフレーム処理それ以前の場合は不透明度エクスプレッションで処置
<span class='line'>1533</span>      * offset減じてXPSのタイムラインIDを得る
<span class='line'>1534</span>      * @type {number}
<span class='line'>1535</span>      */</span><span class="WHIT">
<span class='line'>1536</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myTimelineID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">linkID</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1537</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myXps.xpsTracks</span><span class="PUNC">[</span><span class="NAME">myTimelineID</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1538</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1539</span>          * 乙女専用AEキー生成プロシジャ
<span class='line'>1540</span>          *
<span class='line'>1541</span>          * 将来、データツリー構造が拡張された場合、機能開始時点でツリーの仮構築必須 現在は、決め打ち
<span class='line'>1542</span>          * 内部処理に必要な環境を作成
<span class='line'>1543</span>          */</span><span class="WHIT">
<span class='line'>1544</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layerDataArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myXps.xpsTracks</span><span class="PUNC">[</span><span class="NAME">myTimelineID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1545</span> </span><span class="WHIT">        </span><span class="NAME">layerDataArray.label</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myXps.xpsTracks</span><span class="PUNC">[</span><span class="NAME">myTimelineID</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1546</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">blank_method</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myXps.xpsTracks</span><span class="PUNC">[</span><span class="NAME">myTimelineID</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">blmtd</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1547</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">blank_pos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myXps.xpsTracks</span><span class="PUNC">[</span><span class="NAME">myTimelineID</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">blpos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1548</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">app.buildName.split</span><span class="PUNC">(</span><span class="STRN">"."</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">7</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1549</span> </span><span class="WHIT">            </span><span class="NAME">blank_method</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"file"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1550</span> </span><span class="WHIT">            </span><span class="NAME">blank_pos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"end"</span><span class="WHIT">
<span class='line'>1551</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1552</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1553</span>          * AE8以降は強制的に変更
<span class='line'>1554</span>          * @type {string}
<span class='line'>1555</span>          */</span><span class="WHIT">
<span class='line'>1556</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key_method</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">KEYMethod</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1557</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key_max_lot</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">myXps.xpsTracks</span><span class="PUNC">[</span><span class="NAME">myTimelineID</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lot</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT">
<span class='line'>1558</span> </span><span class="WHIT">            </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">myXps.xpsTracks</span><span class="PUNC">[</span><span class="NAME">myTimelineID</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lot</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1559</span> 
<span class='line'>1560</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1561</span>          * ブランク処理フラグ
<span class='line'>1562</span>          * @type {boolean}
<span class='line'>1563</span>          */</span><span class="WHIT">
<span class='line'>1564</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bflag</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">blank_pos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1565</span> 
<span class='line'>1566</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">AE_version</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">AEVersion</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1567</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">compFramerate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myXps.framerate</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1568</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">footageFramerate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">FootageFramerate</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1569</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">footageFramerate</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1570</span> </span><span class="WHIT">            </span><span class="NAME">footageFramerate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">compFramerate</span><span class="WHIT">
<span class='line'>1571</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1572</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sizeX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myXps.xpsTracks</span><span class="PUNC">[</span><span class="NAME">myTimelineID</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sizeX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1573</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sizeY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myXps.xpsTracks</span><span class="PUNC">[</span><span class="NAME">myTimelineID</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sizeY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1574</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">aspect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myXps.xpsTracks</span><span class="PUNC">[</span><span class="NAME">myTimelineID</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">aspect</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1575</span> </span><span class="COMM">//alert("カラセル方式は :"+blank_method+"\n フーテージのフレームレートは :"+footageFramerate);</span><span class="WHIT">
<span class='line'>1576</span> 
<span class='line'>1577</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1578</span>          * レイヤロット変数の初期化
<span class='line'>1579</span>          * @type {number}
<span class='line'>1580</span>          */</span><span class="WHIT">
<span class='line'>1581</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layer_max_lot</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1582</span> 
<span class='line'>1583</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1584</span>          * 前処理 シート配列からキー変換前にフルフレーム有効データの配列を作る
<span class='line'>1585</span>          * 全フレーム分のバッファ配列を作る
<span class='line'>1586</span>          * @type {Array}
<span class='line'>1587</span>          */</span><span class="WHIT">
<span class='line'>1588</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bufDataArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">layerDataArray.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1589</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1590</span>          * キースタック配列を宣言
<span class='line'>1591</span>          * キースタックは可変長
<span class='line'>1592</span>          * @type {Array}
<span class='line'>1593</span>          */</span><span class="WHIT">
<span class='line'>1594</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">keyStackArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1595</span> </span><span class="WHIT">        </span><span class="NAME">keyStackArray</span><span class="PUNC">[</span><span class="STRN">"remap"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1596</span> </span><span class="WHIT">        </span><span class="NAME">keyStackArray</span><span class="PUNC">[</span><span class="STRN">"blank"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1597</span> 
<span class='line'>1598</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1599</span>          * ふたつ リマップキー/ブランクキー 用
<span class='line'>1600</span>          * 第一フレーム評価・エントリが無効な場合空フレームを設定
<span class='line'>1601</span>          * @type {string}
<span class='line'>1602</span>          */</span><span class="WHIT">
<span class='line'>1603</span> </span><span class="WHIT">        </span><span class="NAME">bufDataArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dataCheck</span><span class="PUNC">(</span><span class="NAME">layerDataArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">layerDataArray.label</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bflag</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT">
<span class='line'>1604</span> </span><span class="WHIT">            </span><span class="NAME">dataCheck</span><span class="PUNC">(</span><span class="NAME">layerDataArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">layerDataArray.label</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bflag</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"blank"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1605</span> 
<span class='line'>1606</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1607</span>          * 2?ラストフレームループ
<span class='line'>1608</span>          */</span><span class="WHIT">
<span class='line'>1609</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">layerDataArray.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1610</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>1611</span>              * 有効データを判定して無効データエントリを直前のコピーで埋める
<span class='line'>1612</span>              */</span><span class="WHIT">
<span class='line'>1613</span> </span><span class="WHIT">            </span><span class="NAME">bufDataArray</span><span class="PUNC">[</span><span class="NAME">f</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dataCheck</span><span class="PUNC">(</span><span class="NAME">layerDataArray</span><span class="PUNC">[</span><span class="NAME">f</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">layerDataArray.label</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bflag</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT">
<span class='line'>1614</span> </span><span class="WHIT">                </span><span class="NAME">dataCheck</span><span class="PUNC">(</span><span class="NAME">layerDataArray</span><span class="PUNC">[</span><span class="NAME">f</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">layerDataArray.label</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bflag</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">bufDataArray</span><span class="PUNC">[</span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1615</span> 
<span class='line'>1616</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bufDataArray</span><span class="PUNC">[</span><span class="NAME">f</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">"blank"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1617</span> </span><span class="WHIT">                </span><span class="NAME">layer_max_lot</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">layer_max_lot</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">bufDataArray</span><span class="PUNC">[</span><span class="NAME">f</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT">
<span class='line'>1618</span> </span><span class="WHIT">                    </span><span class="NAME">layer_max_lot</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">bufDataArray</span><span class="PUNC">[</span><span class="NAME">f</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1619</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1620</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1621</span> </span><span class="WHIT">        </span><span class="NAME">max_lot</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">layer_max_lot</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">key_max_lot</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT">
<span class='line'>1622</span> </span><span class="WHIT">            </span><span class="NAME">layer_max_lot</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">key_max_lot</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1623</span> 
<span class='line'>1624</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1625</span>          * あらかじめ与えられた最大ロット変数と有効データ中の最大の値を比較して
<span class='line'>1626</span>          * 大きいほうをとる
<span class='line'>1627</span>          * ここで、layer_max_lot が 0 であった場合変換すべきデータが無いので処理中断
<span class='line'>1628</span>          */</span><span class="WHIT">
<span class='line'>1629</span> 
<span class='line'>1630</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">layer_max_lot</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1631</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"変換すべきデータがありません。\n処理を中断します。"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1632</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1633</span> 
<span class='line'>1634</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1635</span>          * 前処理第二 (配列には、キーを作成するフレームを積む)
<span class='line'>1636</span>          */</span><span class="WHIT">
<span class='line'>1637</span> 
<span class='line'>1638</span> </span><span class="WHIT">        </span><span class="NAME">keyStackArray</span><span class="PUNC">[</span><span class="STRN">"remap"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1639</span> </span><span class="WHIT">        </span><span class="NAME">keyStackArray</span><span class="PUNC">[</span><span class="STRN">"blank"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//最初のフレームには無条件でキーを作成</span><span class="WHIT">
<span class='line'>1640</span> 
<span class='line'>1641</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1642</span>          * 有効データで埋まった配列を再評価(2?ラスト)
<span class='line'>1643</span>          */</span><span class="WHIT">
<span class='line'>1644</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">bufDataArray.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1645</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>1646</span>              * キーオプションにしたがって以下の評価でキー配列にスタック(フレームのみ)
<span class='line'>1647</span>              */</span><span class="WHIT">
<span class='line'>1648</span> </span><span class="WHIT">            </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key_method</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1649</span> </span><span class="WHIT">                </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"opt"</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT">	</span><span class="COMM">//	最適化キー(変化点の前後にキー)</span><span class="WHIT">
<span class='line'>1650</span> </span><span class="WHIT">                    </span><span class="COMM">//	○前データと同じで、かつ後ろのデータと</span><span class="WHIT">
<span class='line'>1651</span> </span><span class="WHIT">                    </span><span class="COMM">//	同一のエントリをスキップ</span><span class="WHIT">
<span class='line'>1652</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bufDataArray</span><span class="PUNC">[</span><span class="NAME">f</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">bufDataArray</span><span class="PUNC">[</span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">bufDataArray</span><span class="PUNC">[</span><span class="NAME">f</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">bufDataArray</span><span class="PUNC">[</span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1653</span> </span><span class="WHIT">                        </span><span class="NAME">keyStackArray</span><span class="PUNC">[</span><span class="STRN">"remap"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1654</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1655</span> </span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1656</span> </span><span class="WHIT">                </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"min"</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT">	</span><span class="COMM">//	最少キー(変化点の前後にキー)</span><span class="WHIT">
<span class='line'>1657</span> </span><span class="WHIT">                    </span><span class="COMM">//	○前データと同じエントリをスキップ</span><span class="WHIT">
<span class='line'>1658</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bufDataArray</span><span class="PUNC">[</span><span class="NAME">f</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">bufDataArray</span><span class="PUNC">[</span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1659</span> </span><span class="WHIT">                        </span><span class="NAME">keyStackArray</span><span class="PUNC">[</span><span class="STRN">"remap"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1660</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1661</span> </span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1662</span> </span><span class="WHIT">                </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"max"</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT">	</span><span class="COMM">//	全フレームキー(スキップ無し)</span><span class="WHIT">
<span class='line'>1663</span> </span><span class="WHIT">                </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1664</span> </span><span class="WHIT">                    </span><span class="NAME">keyStackArray</span><span class="PUNC">[</span><span class="STRN">"remap"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1665</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1666</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>1667</span>              * ブランクメソッドにしたがってブランクキーをスタック(フレームのみ)
<span class='line'>1668</span>              * @type {string}
<span class='line'>1669</span>              */</span><span class="WHIT">
<span class='line'>1670</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">prevalue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bufDataArray</span><span class="PUNC">[</span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"blank"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"blank"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"cell"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1671</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentvalue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bufDataArray</span><span class="PUNC">[</span><span class="NAME">f</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"blank"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"blank"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"cell"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1672</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">postvalue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bufDataArray</span><span class="PUNC">[</span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"blank"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"blank"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"cell"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1673</span> </span><span class="WHIT">            </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key_method</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1674</span> </span><span class="WHIT">                </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"opt"</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT">	</span><span class="COMM">//	最適化キー(変化点の前後にキー)</span><span class="WHIT">
<span class='line'>1675</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentvalue</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">prevalue</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">currentvalue</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">postvalue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1676</span> </span><span class="WHIT">                        </span><span class="NAME">keyStackArray</span><span class="PUNC">[</span><span class="STRN">"blank"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1677</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1678</span> </span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1679</span> </span><span class="WHIT">                </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"min"</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT">	</span><span class="COMM">//	最少キー(変化点の前後にキー)</span><span class="WHIT">
<span class='line'>1680</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentvalue</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">prevalue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1681</span> </span><span class="WHIT">                        </span><span class="NAME">keyStackArray</span><span class="PUNC">[</span><span class="STRN">"blank"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1682</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1683</span> </span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1684</span> </span><span class="WHIT">                </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"max"</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT">	</span><span class="COMM">//	全フレームキー(スキップ無し)</span><span class="WHIT">
<span class='line'>1685</span> </span><span class="WHIT">                </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1686</span> </span><span class="WHIT">                    </span><span class="NAME">keyStackArray</span><span class="PUNC">[</span><span class="STRN">"blank"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1687</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1688</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1689</span> 
<span class='line'>1690</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1691</span>          * レイヤ操作系　undoブロックは、一階層上で処理済としておく
<span class='line'>1692</span>          * キー文字列を作成
<span class='line'>1693</span>          * blankoffsetは、カラセル挿入によるタイミングの遷移量・冒頭挿入以外は基本的に0
<span class='line'>1694</span>          */</span><span class="WHIT">
<span class='line'>1695</span> </span><span class="WHIT">        </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">blank_pos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1696</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"first"</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1697</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">blankoffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1698</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1699</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"end"</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1700</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">blankoffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1701</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1702</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"none"</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1703</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">blankoffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1704</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1705</span> </span><span class="WHIT">            </span><span class="KEYW">default</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1706</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">blankoffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1707</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1708</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">footage_frame_duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">footageFramerate</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1709</span> </span><span class="COMM">//var this=thisProject.composition(nas.easymyXps.compSelector.selected).layer(COMPLyrID)</span><span class="WHIT">
<span class='line'>1710</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">this.locked</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1711</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>1712</span>              * タイムリマップがすでに存在する場合、全消去
<span class='line'>1713</span>              */</span><span class="WHIT">
<span class='line'>1714</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.timeRemapEnabled</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1715</span> </span><span class="WHIT">                </span><span class="NAME">this.timeRemapEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1716</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1717</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>1718</span>              * リマップキーを作成/適用
<span class='line'>1719</span>              */</span><span class="WHIT">
<span class='line'>1720</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">blank_method</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">"expression1"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1721</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">keyStackArray</span><span class="PUNC">[</span><span class="STRN">"remap"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1722</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bufDataArray</span><span class="PUNC">[</span><span class="NAME">keyStackArray</span><span class="PUNC">[</span><span class="STRN">"remap"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"blank"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1723</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">seedValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">blank_pos</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"first"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">max_lot</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1724</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1725</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">seedValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bufDataArray</span><span class="PUNC">[</span><span class="NAME">keyStackArray</span><span class="PUNC">[</span><span class="STRN">"remap"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">blankoffset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1726</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1727</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Fr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">keyStackArray</span><span class="PUNC">[</span><span class="STRN">"remap"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">myXps.framerate</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1728</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">blank_method</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"expression2"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>1729</span> </span><span class="WHIT">                        </span><span class="NAME">bufDataArray</span><span class="PUNC">[</span><span class="NAME">keyStackArray</span><span class="PUNC">[</span><span class="STRN">"remap"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"blank"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1730</span> </span><span class="WHIT">                        </span><span class="COMM">/**
<span class='line'>1731</span>                          * エクスプレッション2のカラ
<span class='line'>1732</span>                          * @type {number}
<span class='line'>1733</span>                          */</span><span class="WHIT">
<span class='line'>1734</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Vl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">999999</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1735</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1736</span> </span><span class="WHIT">                        </span><span class="COMM">/**
<span class='line'>1737</span>                          * 通常処理
<span class='line'>1738</span>                          * @type {number}
<span class='line'>1739</span>                          */</span><span class="WHIT">
<span class='line'>1740</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Vl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">seedValue</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">footage_frame_duration</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1741</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1742</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.timeRemapEnabled</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1743</span> </span><span class="WHIT">                        </span><span class="NAME">this.timeRemapEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1744</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1745</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">kid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.property</span><span class="PUNC">(</span><span class="STRN">"ADBE Time Remapping"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addKey</span><span class="PUNC">(</span><span class="NAME">Fr</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1746</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Vl</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">this.source.duration</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1747</span> </span><span class="WHIT">                        </span><span class="NAME">Vl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.source.duration</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1748</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1749</span> </span><span class="WHIT">                    </span><span class="NAME">this.property</span><span class="PUNC">(</span><span class="STRN">"ADBE Time Remapping"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">setValueAtKey</span><span class="PUNC">(</span><span class="NAME">kid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1750</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">kid</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.property</span><span class="PUNC">(</span><span class="STRN">"ADBE Time Remapping"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">numKeys</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1751</span> </span><span class="WHIT">                        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">this.property</span><span class="PUNC">(</span><span class="STRN">"ADBE Time Remapping"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">numKeys</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1752</span> </span><span class="WHIT">                            </span><span class="NAME">this.property</span><span class="PUNC">(</span><span class="STRN">"ADBE Time Remapping"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">removeKey</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1753</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1754</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1755</span> </span><span class="WHIT">                    </span><span class="NAME">this.property</span><span class="PUNC">(</span><span class="STRN">"ADBE Time Remapping"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">setInterpolationTypeAtKey</span><span class="PUNC">(</span><span class="NAME">kid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">KeyframeInterpolationType.HOLD</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1756</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1757</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1758</span> 
<span class='line'>1759</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>1760</span>              * エクスプレッション型
<span class='line'>1761</span>              */</span><span class="WHIT">
<span class='line'>1762</span> </span><span class="COMM">//var expBody='スライダ\tスライダ制御\tEffect\ Parameter\ #1\t\n\tFrame\t\t\n';</span><span class="WHIT">
<span class='line'>1763</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">blank_method</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"expression1"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1764</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">timingTimeLine</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.property</span><span class="PUNC">(</span><span class="STRN">"ADBE Effect Parade"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addProperty</span><span class="PUNC">(</span><span class="STRN">"ADBE Slider Control"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1765</span> </span><span class="WHIT">                </span><span class="NAME">timingTimeLine.name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"XPS_data"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1766</span> </span><span class="WHIT">                </span><span class="NAME">timingTimeLine</span><span class="PUNC">(</span><span class="STRN">"ADBE Slider Control-0001"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">expression</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"//expression-TEST"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1767</span> 
<span class='line'>1768</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">keyStackArray</span><span class="PUNC">[</span><span class="STRN">"remap"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1769</span> </span><span class="WHIT">                    </span><span class="NAME">Fr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">keyStackArray</span><span class="PUNC">[</span><span class="STRN">"remap"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">myXps.framerate</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1770</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bufDataArray</span><span class="PUNC">[</span><span class="NAME">keyStackArray</span><span class="PUNC">[</span><span class="STRN">"remap"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"blank"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1771</span> </span><span class="WHIT">                        </span><span class="NAME">Vl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1772</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1773</span> </span><span class="WHIT">                        </span><span class="NAME">Vl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bufDataArray</span><span class="PUNC">[</span><span class="NAME">keyStackArray</span><span class="PUNC">[</span><span class="STRN">"remap"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1774</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1775</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">kid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">timingTimeLine</span><span class="PUNC">(</span><span class="STRN">"ADBE Slider Control-0001"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addKey</span><span class="PUNC">(</span><span class="NAME">Fr</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1776</span> </span><span class="WHIT">                    </span><span class="NAME">timingTimeLine</span><span class="PUNC">(</span><span class="STRN">"ADBE Slider Control-0001"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">setValueAtKey</span><span class="PUNC">(</span><span class="NAME">kid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1777</span> 
<span class='line'>1778</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">kid</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">timingTimeLine.numKeys</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1779</span> </span><span class="WHIT">                        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">timingTimeLine</span><span class="PUNC">(</span><span class="STRN">"ADBE Slider Control-0001"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">numKeys</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1780</span> </span><span class="WHIT">                            </span><span class="NAME">timingTimeLine</span><span class="PUNC">(</span><span class="STRN">"ADBE Slider Control-0001"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">removeKey</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1781</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1782</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1783</span> </span><span class="WHIT">                    </span><span class="NAME">timingTimeLine</span><span class="PUNC">(</span><span class="STRN">"ADBE Slider Control-0001"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">setInterpolationTypeAtKey</span><span class="PUNC">(</span><span class="NAME">kid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">KeyframeInterpolationType.HOLD</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1784</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1785</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1786</span> 
<span class='line'>1787</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>1788</span>              * ブランクキーを作成
<span class='line'>1789</span>              * エクスプレッション型/ブランクセル無し の場合は不要
<span class='line'>1790</span>              */</span><span class="WHIT">
<span class='line'>1791</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">blank_method</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">"expression1"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">blank_pos</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">"none"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1792</span> </span><span class="WHIT">                </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">blank_method</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1793</span> </span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"opacity"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1794</span> </span><span class="WHIT">                        </span><span class="COMM">/**
<span class='line'>1795</span>                          * 不透明度
<span class='line'>1796</span>                          * @type {string}
<span class='line'>1797</span>                          * @private
<span class='line'>1798</span>                          */</span><span class="WHIT">
<span class='line'>1799</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">blank_</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'0'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1800</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cell_</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'100'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1801</span> </span><span class="WHIT">                        </span><span class="COMM">/**
<span class='line'>1802</span>                          * やはりこの処理は、ちと無理が
<span class='line'>1803</span>                          */</span><span class="WHIT">
<span class='line'>1804</span> </span><span class="WHIT">                        </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1805</span> </span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"wipe"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1806</span> </span><span class="WHIT">                        </span><span class="COMM">/**
<span class='line'>1807</span>                          * ワイプ
<span class='line'>1808</span>                          * @type {string}
<span class='line'>1809</span>                          * @private
<span class='line'>1810</span>                          */</span><span class="WHIT">
<span class='line'>1811</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">blank_</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'100'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1812</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cell_</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'0'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1813</span> </span><span class="WHIT">                        </span><span class="COMM">/**
<span class='line'>1814</span>                          * ブランクタイムラインがすでにあるか否か確認
<span class='line'>1815</span>                          */</span><span class="WHIT">
<span class='line'>1816</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.property</span><span class="PUNC">(</span><span class="STRN">"ADBE Effect Parade"</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="STRN">"blankTimeLine"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1817</span> </span><span class="WHIT">                            </span><span class="COMM">/**
<span class='line'>1818</span>                              * すでにある場合、既存タイムラインを削除。
<span class='line'>1819</span>                              */</span><span class="WHIT">
<span class='line'>1820</span> </span><span class="WHIT">                            </span><span class="NAME">this.property</span><span class="PUNC">(</span><span class="STRN">"ADBE Effect Parade"</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="STRN">"blankTimeLine"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1821</span> </span><span class="WHIT">                            </span><span class="COMM">/**
<span class='line'>1822</span>                              * この処理は、アマアマなので、あとで確定処理に要変更 1/10
<span class='line'>1823</span>                              */</span><span class="WHIT">
<span class='line'>1824</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1825</span> </span><span class="WHIT">                        </span><span class="COMM">/**
<span class='line'>1826</span>                          * ブランク新作
<span class='line'>1827</span>                          */</span><span class="WHIT">
<span class='line'>1828</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">blankTimeLine</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.property</span><span class="PUNC">(</span><span class="STRN">"ADBE Effect Parade"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addProperty</span><span class="PUNC">(</span><span class="STRN">"ADBE Linear Wipe"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1829</span> </span><span class="WHIT">                        </span><span class="NAME">blankTimeLine.name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"blankTimeLine"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1830</span> </span><span class="WHIT">                        </span><span class="NAME">blankTimeLine</span><span class="PUNC">(</span><span class="STRN">"ADBE Linear Wipe-0001"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">expression</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"//--otomeBlankEffecte--\neffect(\"blankTimeLine\")(1);"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1831</span> </span><span class="WHIT">                        </span><span class="NAME">blankTimeLine</span><span class="PUNC">(</span><span class="STRN">"ADBE Linear Wipe-0001"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">expressionEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1832</span> </span><span class="WHIT">                        </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1833</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1834</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">keyStackArray</span><span class="PUNC">[</span><span class="STRN">"blank"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1835</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bufDataArray</span><span class="PUNC">[</span><span class="NAME">keyStackArray</span><span class="PUNC">[</span><span class="STRN">"blank"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"blank"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1836</span> </span><span class="WHIT">                        </span><span class="NAME">Vl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">blank_</span><span class="WHIT">
<span class='line'>1837</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1838</span> </span><span class="WHIT">                        </span><span class="NAME">Vl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cell_</span><span class="WHIT">
<span class='line'>1839</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1840</span> </span><span class="WHIT">                    </span><span class="NAME">Fr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">keyStackArray</span><span class="PUNC">[</span><span class="STRN">"blank"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">myXps.framerate</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1841</span> </span><span class="WHIT">                    </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">blank_method</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1842</span> </span><span class="WHIT">                        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"opacity"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1843</span> </span><span class="WHIT">                            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">kid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.property</span><span class="PUNC">(</span><span class="STRN">"ADBE Opacity"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addKey</span><span class="PUNC">(</span><span class="NAME">Fr</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1844</span> </span><span class="WHIT">                            </span><span class="NAME">this.property</span><span class="PUNC">(</span><span class="STRN">"ADBE Opacity"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">setValueAtKey</span><span class="PUNC">(</span><span class="NAME">kid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1845</span> </span><span class="WHIT">                            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">kid</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.property</span><span class="PUNC">(</span><span class="STRN">"ADBE Opacity"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">numKeys</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1846</span> </span><span class="WHIT">                                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">this.property</span><span class="PUNC">(</span><span class="STRN">"ADBE Opacity"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">numKeys</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1847</span> </span><span class="WHIT">                                    </span><span class="NAME">this.property</span><span class="PUNC">(</span><span class="STRN">"ADBE Opacity"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">removeKey</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1848</span> </span><span class="WHIT">                                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1849</span> </span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1850</span> </span><span class="WHIT">                            </span><span class="NAME">this.property</span><span class="PUNC">(</span><span class="STRN">"ADBE Opacity"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">setInterpolationTypeAtKey</span><span class="PUNC">(</span><span class="NAME">kid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">KeyframeInterpolationType.HOLD</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1851</span> </span><span class="WHIT">                            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1852</span> </span><span class="WHIT">                        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"wipe"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1853</span> </span><span class="WHIT">                            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">kid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">blankTimeLine</span><span class="PUNC">(</span><span class="STRN">"ADBE Linear Wipe-0001"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addKey</span><span class="PUNC">(</span><span class="NAME">Fr</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1854</span> </span><span class="WHIT">                            </span><span class="NAME">blankTimeLine</span><span class="PUNC">(</span><span class="STRN">"ADBE Linear Wipe-0001"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">setValueAtKey</span><span class="PUNC">(</span><span class="NAME">kid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1855</span> </span><span class="WHIT">                            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">kid</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">blankTimeLine</span><span class="PUNC">(</span><span class="STRN">"ADBE Linear Wipe-0001"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">numKeys</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1856</span> </span><span class="WHIT">                                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">blankTimeLine</span><span class="PUNC">(</span><span class="STRN">"ADBE Linear Wipe-0001"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">numKeys</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1857</span> </span><span class="WHIT">                                    </span><span class="NAME">blankTimeLine</span><span class="PUNC">(</span><span class="STRN">"ADBE Linear Wipe-0001"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">removeKey</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1858</span> </span><span class="WHIT">                                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1859</span> </span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1860</span> </span><span class="WHIT">                            </span><span class="NAME">blankTimeLine</span><span class="PUNC">(</span><span class="STRN">"ADBE Linear Wipe-0001"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">setInterpolationTypeAtKey</span><span class="PUNC">(</span><span class="NAME">kid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">KeyframeInterpolationType.HOLD</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1861</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1862</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1863</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1864</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1865</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>1866</span>                  * 出力
<span class='line'>1867</span>                  */</span><span class="WHIT">
<span class='line'>1868</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">blank_method</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">"expression1"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1869</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">blank_method</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"opacity"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1870</span> </span><span class="WHIT">                        </span><span class="COMM">/**
<span class='line'>1871</span>                          * ブランク
<span class='line'>1872</span>                          */</span><span class="WHIT">
<span class='line'>1873</span> </span><span class="WHIT">                        </span><span class="NAME">Result</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">blankBody</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1874</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1875</span> </span><span class="WHIT">                    </span><span class="COMM">/**
<span class='line'>1876</span>                      * リマップ
<span class='line'>1877</span>                      */</span><span class="WHIT">
<span class='line'>1878</span> </span><span class="WHIT">                    </span><span class="NAME">Result</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">remapBody</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1879</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">blank_method</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"wipe"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1880</span> </span><span class="WHIT">                        </span><span class="COMM">/**
<span class='line'>1881</span>                          * ブランク
<span class='line'>1882</span>                          */</span><span class="WHIT">
<span class='line'>1883</span> </span><span class="WHIT">                        </span><span class="NAME">Result</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">blankBody</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1884</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1885</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1886</span> </span><span class="WHIT">                    </span><span class="COMM">/**
<span class='line'>1887</span>                      * エクスプレッション1
<span class='line'>1888</span>                      */</span><span class="WHIT">
<span class='line'>1889</span> </span><span class="WHIT">                    </span><span class="NAME">Result</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">expBody</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1890</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1891</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1892</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1893</span> 
<span class='line'>1894</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1895</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1896</span>      * return Result
<span class='line'>1897</span>      */</span><span class="WHIT">
<span class='line'>1898</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">linkID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1899</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1900</span> </span><span class="COMM">/**
<span class='line'>1901</span>  * CompItem.getRootXps()
<span class='line'>1902</span>  * 引数    なし
<span class='line'>1903</span>  * 戻値    発見時はXpsオブジェクト それ以外はチェック用オブジェクト またはfalse
<span class='line'>1904</span>  * nas オートビルド環境下で、親コンポをたぐって元ステージのXpsオブジェクトを返すメソッド
<span class='line'>1905</span>  *
<span class='line'>1906</span>  * @returns {*}
<span class='line'>1907</span>  */</span><span class="WHIT">
<span class='line'>1908</span> </span><span class="NAME">CompItem.prototype.getRootXps</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1909</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.XPSStore.getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1910</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>1911</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1912</span> 
<span class='line'>1913</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1914</span>      * コンポ自身がステージならばシートマッチを確認して返す
<span class='line'>1915</span>      * 手作業でプロジェクトの変更が行われたり、シートの読み直し・削除等があった場合は該当のXpsがない場合がある。
<span class='line'>1916</span>      * その場合は、チェック用無名オブジェクトを返すので、必要にしたがって処理
<span class='line'>1917</span>      */</span><span class="WHIT">
<span class='line'>1918</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.name.match</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"^\\("</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nas.itmFootStamps.stage</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\\)"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1919</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">CheckString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.comment.split</span><span class="PUNC">(</span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"^"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nas.itmFootStamps.stage</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1920</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1921</span>          * 何らかの事故で識別情報がない場合をチェックして必ず同定に失敗するダミー情報を付ける
<span class='line'>1922</span>          * @type {Object}
<span class='line'>1923</span>          */</span><span class="WHIT">
<span class='line'>1924</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myRecordCheck</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">CheckString.match</span><span class="PUNC">(</span><span class="REGX">/\{[^\}]+\}/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">eval</span><span class="PUNC">(</span><span class="STRN">"("</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">CheckString</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">")"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">eval</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1925</span> </span><span class="WHIT">            </span><span class="STRN">"name"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1926</span> </span><span class="WHIT">            </span><span class="STRN">"modified"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1927</span> </span><span class="WHIT">            </span><span class="STRN">"length"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"0"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1928</span> </span><span class="WHIT">            </span><span class="STRN">"url"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">""</span><span class="WHIT">
<span class='line'>1929</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1930</span> 
<span class='line'>1931</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1932</span>          * チェックレコードを現在のシートと総当りで比較マッチしたら返して終了 //urlは補助情報なので比較対象としない
<span class='line'>1933</span>          */</span><span class="WHIT">
<span class='line'>1934</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">nas.XPSStore.getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1935</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xpsRecord</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.XPSStore.getInfo</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1936</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>1937</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="NAME">xpsRecord</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>1938</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="NAME">myRecordCheck.name</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">xpsRecord.name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>1939</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="NAME">myRecordCheck.modified</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">xpsRecord.modified</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>1940</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="NAME">myRecordCheck.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">xpsRecord.length</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1941</span> </span><span class="WHIT">            </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1942</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">nas.XPSStore.get</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1943</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1944</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1945</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1946</span>          * 総当りではずれ
<span class='line'>1947</span>          */</span><span class="WHIT">
<span class='line'>1948</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myRecordCheck</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1949</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1950</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1951</span>          * コンポがステージではない場合はレイヤを総当りでさかのぼる
<span class='line'>1952</span>          */</span><span class="WHIT">
<span class='line'>1953</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.layers.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1954</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">source</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">CompItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1955</span> </span><span class="WHIT">                </span><span class="COMM">//		if(this.layers[idx+1].source.name.match(new RegExp("^\\("+nas.itmFootStamps.stage[0]+"\\)")))	{	}</span><span class="WHIT">
<span class='line'>1956</span> 
<span class='line'>1957</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myRoot</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">source.getRootXps</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1958</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myRoot</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Xps</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1959</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myRoot</span><span class="WHIT">
<span class='line'>1960</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1961</span> 
<span class='line'>1962</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1963</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1964</span> </span><span class="WHIT">                </span><span class="COMM">//そもそもコンポじゃないのでスキップする</span><span class="WHIT">
<span class='line'>1965</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1966</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1967</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="COMM">//コンポ内ではステージ未発見</span><span class="WHIT">
<span class='line'>1968</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1969</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1970</span> 
<span class='line'>1971</span> </span><span class="COMM">/**
<span class='line'>1972</span>  * CompItem.getRootXps()
<span class='line'>1973</span>  * CompItem.executeAction(Folder)
<span class='line'>1974</span>  *
<span class='line'>1975</span>  * コンポアイテムのメソッド
<span class='line'>1976</span>  * フォルダ内のリソースを順次実行する。
<span class='line'>1977</span>  *
<span class='line'>1978</span>  * 実行するリソースは現在の仕様では以下の通り
<span class='line'>1979</span>  *
<span class='line'>1980</span>  * ##*.ffx / ##*.jsx    (##は整数)
<span class='line'>1981</span>  *
<span class='line'>1982</span>  * 数字で開始されるファイル名を持つアニメーションプリセット、またはスクリプトをこのスクリプトのスコープで逐次実行します。
<span class='line'>1983</span>  * 同じ番号を持つスクリプトとプリセットがあった場合はプリセットを先に適用します。
<span class='line'>1984</span>  * 同じ番号のスクリプト・プリセット同士は昇順ソートで実行されます
<span class='line'>1985</span>  *
<span class='line'>1986</span>  * スクリプトが自動でundoGroupを設定しますので、スクリプト内でundoGroupを利用しない用に推奨
<span class='line'>1987</span>  *
<span class='line'>1988</span>  *
<span class='line'>1989</span>  * スクリプト実行時にthisプロパティはコンポ自身を指すので　利用可能
<span class='line'>1990</span>  *
<span class='line'>1991</span>  * プリセットは以下の順で適用される
<span class='line'>1992</span>  * アクティブなレイヤに順次
<span class='line'>1993</span>  * アクティブなレイヤがない場合はコンポと同じサイズのソリッドを新規作成して適用
<span class='line'>1994</span>  * 選択状態に注意
<span class='line'>1995</span>  * スクリプト内でのカレントフォルダは、ファイル位置に設定済み
<span class='line'>1996</span>  * フォルダの内容はエイリアスやショートカットでも良い(未実装)
<span class='line'>1997</span>  *
<span class='line'>1998</span>  * AE7以前ではスクリプトのみ実行
<span class='line'>1999</span>  *
<span class='line'>2000</span>  * @param targetFolder
<span class='line'>2001</span>  * @param skipUndo
<span class='line'>2002</span>  */</span><span class="WHIT">
<span class='line'>2003</span> </span><span class="NAME">CompItem.prototype.executeAction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetFolder</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">skipUndo</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2004</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">skipUndo</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2005</span> </span><span class="WHIT">        </span><span class="NAME">skipUndo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>2006</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2007</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2008</span>      * skip Undo
<span class='line'>2009</span>      */</span><span class="WHIT">
<span class='line'>2010</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">skipUndo</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="NAME">nas.otome.writeConsole</span><span class="PUNC">(</span><span class="STRN">"skip Undo : "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">targetFolder.name</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2011</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2012</span>      * メソッド内でスクリプトを実行するので誤動作を減らすための囲い込みオブジェクト
<span class='line'>2013</span>      * @type {{}}
<span class='line'>2014</span>      */</span><span class="WHIT">
<span class='line'>2015</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">exAc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2016</span> </span><span class="WHIT">    </span><span class="NAME">exAc.myOrders</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2017</span> </span><span class="WHIT">    </span><span class="NAME">exAc.myActionsF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="COMM">//スクリプトスタック</span><span class="WHIT">
<span class='line'>2018</span> </span><span class="WHIT">    </span><span class="NAME">exAc.myActionsS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="COMM">//アクションスタック</span><span class="WHIT">
<span class='line'>2019</span> 
<span class='line'>2020</span> </span><span class="WHIT">    </span><span class="NAME">exAc.myFiles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">targetFolder.getFiles</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2021</span> 
<span class='line'>2022</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">exAc.myFiles.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2023</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">exAc.myFiles</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name.match</span><span class="PUNC">(</span><span class="REGX">/^([\d]+)[^\d].*\.(jsx|ffx)$/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2024</span> </span><span class="WHIT">            </span><span class="NAME">exAc.myOrderId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2025</span> </span><span class="WHIT">            </span><span class="NAME">exAc.myExt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2026</span> </span><span class="WHIT">            </span><span class="NAME">exAc.myExt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">exAc.myExt.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2027</span> </span><span class="WHIT">            </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">exAc.myExt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2028</span> </span><span class="WHIT">                </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"ffx"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2029</span> </span><span class="WHIT">                    </span><span class="NAME">exAc.myActionsF.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">"orderId"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">exAc.myOrderId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"body"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">exAc.myFiles</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2030</span> </span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2031</span> </span><span class="WHIT">                </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"jsx"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2032</span> </span><span class="WHIT">                    </span><span class="NAME">exAc.myActionsS.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">"orderId"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">exAc.myOrderId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"body"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">exAc.myFiles</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2033</span> </span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2034</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2035</span> </span><span class="WHIT">            </span><span class="NAME">exAc.currentStr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">":"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">exAc.myOrders.join</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2036</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">exAc.currentStr.match</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">exAc.myOrderId</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2037</span> </span><span class="WHIT">                </span><span class="KEYW">continue</span><span class="WHIT">
<span class='line'>2038</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2039</span> </span><span class="WHIT">                </span><span class="NAME">exAc.myOrders.push</span><span class="PUNC">(</span><span class="NAME">exAc.myOrderId</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2040</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2041</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2042</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2043</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">exAc.myOrders.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2044</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>2045</span>          * ソートする
<span class='line'>2046</span>          * @type {Array.&lt;*>}
<span class='line'>2047</span>          */</span><span class="WHIT">
<span class='line'>2048</span> </span><span class="WHIT">        </span><span class="NAME">exAc.doOrders</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">exAc.myOrders.sort</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2049</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>2050</span>          * ソートした順にプリセット・スクリプトを逐次実行
<span class='line'>2051</span>          */</span><span class="WHIT">
<span class='line'>2052</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">exAc.idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">exAc.idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">exAc.doOrders.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">exAc.idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2053</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">AEVersion</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">7</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2054</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">fIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">exAc.myActionsF.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">fIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2055</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">exAc.myActionsF</span><span class="PUNC">[</span><span class="NAME">fIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">orderId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">exAc.doOrders</span><span class="PUNC">[</span><span class="NAME">exAc.idx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2056</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.selectedLayers.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2057</span> </span><span class="WHIT">                            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">lIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.selectedLayers.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">lIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2058</span> </span><span class="WHIT">                                </span><span class="NAME">this.selectedLayers</span><span class="PUNC">[</span><span class="NAME">lIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">applyPresetA</span><span class="PUNC">(</span><span class="NAME">exAc.myActionsF</span><span class="PUNC">[</span><span class="NAME">fIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">body</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2059</span> </span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2060</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2061</span> </span><span class="WHIT">                            </span><span class="NAME">this.applyPreset</span><span class="PUNC">(</span><span class="NAME">exAc.myActionsF</span><span class="PUNC">[</span><span class="NAME">fIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">body</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//プリセット適用(コンポ)</span><span class="WHIT">
<span class='line'>2062</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2063</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2064</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2065</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2066</span> 
<span class='line'>2067</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">exAc.sIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">exAc.sIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">exAc.myActionsS.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">exAc.sIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2068</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">exAc.myActionsS</span><span class="PUNC">[</span><span class="NAME">exAc.sIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">orderId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">exAc.doOrders</span><span class="PUNC">[</span><span class="NAME">exAc.idx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2069</span> </span><span class="WHIT">                    </span><span class="NAME">nas.GUI.prevCurrentFolder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Folder.current</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2070</span> </span><span class="WHIT">                    </span><span class="NAME">exAc.scriptFile</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">File</span><span class="PUNC">(</span><span class="NAME">exAc.myActionsS</span><span class="PUNC">[</span><span class="NAME">exAc.sIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">body.fsName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2071</span> </span><span class="WHIT">                    </span><span class="NAME">Folder.current</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">exAc.scriptFile.path</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2072</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">exAc.scriptFile.exists</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2073</span> </span><span class="COMM">//					nas.otome.writeConsole("open & exec "+exAc.scriptFile.name);</span><span class="WHIT">
<span class='line'>2074</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">skipUndo</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2075</span> </span><span class="WHIT">                            </span><span class="NAME">nas.otome.beginUndoGroup</span><span class="PUNC">(</span><span class="NAME">exAc.scriptFile.name</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2076</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2077</span> </span><span class="WHIT">                        </span><span class="NAME">exAc.scriptFile.open</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2078</span> </span><span class="WHIT">                        </span><span class="NAME">eval</span><span class="PUNC">(</span><span class="NAME">exAc.scriptFile.read</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2079</span> </span><span class="WHIT">                        </span><span class="NAME">exAc.scriptFile.close</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2080</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">skipUndo</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2081</span> </span><span class="WHIT">                            </span><span class="NAME">nas.otome.endUndoGroup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2082</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2083</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2084</span> </span><span class="WHIT">                        </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="NAME">exAc.scriptFile.name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" is not Exists!"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nas.GUI.LineFeed</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"current :"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Folder.current.parent.name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"/"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Folder.current.name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2085</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2086</span> </span><span class="WHIT">                    </span><span class="NAME">Folder.current</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.GUI.prevCurrentFolder</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2087</span> </span><span class="WHIT">                    </span><span class="COMM">/**
<span class='line'>2088</span>                      * @desc ファンクションコールと同内容だがここで実行しないとスコープ変わる
<span class='line'>2089</span>                      */</span><span class="WHIT">
<span class='line'>2090</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2091</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2092</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2093</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2094</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2095</span> 
<span class='line'>2096</span> </span><span class="COMM">/**
<span class='line'>2097</span>  * CompItem.addClipTarget(camWidth,camAspect)
<span class='line'>2098</span>  * 引数
<span class='line'>2099</span>  * camWidth    フレーム横幅をpixelで
<span class='line'>2100</span>  * camAspect    フレーム縦横比を　(幅÷高さ)の単数で与える
<span class='line'>2101</span>  * 3:4(TV)=1.33333333
<span class='line'>2102</span>  * 16:9(HDTV)=1.7777778
<span class='line'>2103</span>  * 22:16(35mmシネ)=1.375
<span class='line'>2104</span>  * 有効桁7桁程度で指定してください。
<span class='line'>2105</span>  * それ以上精度を高くしてもピクセルで丸めちゃうのであまり意味はないです。
<span class='line'>2106</span>  * camColor　カラー配列　流用オブジェクトがあった場合はそちらを優先するので色指定は意味を持たない…いまのところ
<span class='line'>2107</span>  * アニメーション撮影で使用するクリッピングターゲット（カメラレイヤ）を設定するメソッド
<span class='line'>2108</span>  * コンポのメソッドとして実装するので、コンポ特定部分は不要（それはメソッドの外で行なう）
<span class='line'>2109</span>  * 指定なしの場合はnasライブラリの持つ標準値を使用します。
<span class='line'>2110</span>  * ライブラリの書き換を行なっておくと便利です。
<span class='line'>2111</span>  *
<span class='line'>2112</span>  * @param camWidth
<span class='line'>2113</span>  * @param camAspect
<span class='line'>2114</span>  * @param camColor
<span class='line'>2115</span>  * @returns {*}
<span class='line'>2116</span>  */</span><span class="WHIT">
<span class='line'>2117</span> </span><span class="NAME">CompItem.prototype.addClipTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">camWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">camAspect</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">camColor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2118</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">targetName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"_clippingTarget"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2119</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">footPrint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"##nas.otome cameraWorkTarget"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2120</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2121</span>      * 処理済なら終了
<span class='line'>2122</span>      */</span><span class="WHIT">
<span class='line'>2123</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.layers.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">comment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">footPrint</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2124</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2125</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2126</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">camWidth</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2127</span> </span><span class="WHIT">        </span><span class="NAME">camWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.ceil</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">nas.inputMedias.selectedRecord</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.inputMedias.selectedRecord</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">25.4</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2128</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2129</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">camAspect</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2130</span> </span><span class="WHIT">        </span><span class="NAME">camAspect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">eval</span><span class="PUNC">(</span><span class="NAME">nas.inputMedias.selectedRecord</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2131</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2132</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">camColor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2133</span> </span><span class="WHIT">        </span><span class="NAME">camColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>2134</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2135</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2136</span>      * デフォルトキミドリ
<span class='line'>2137</span>      * とりあえずnasプロパティを読むがそのうちMAP参照にきりかえ
<span class='line'>2138</span>      * @type {number}
<span class='line'>2139</span>      */</span><span class="WHIT">
<span class='line'>2140</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">camHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.ceil</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">camWidth</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">camAspect</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2141</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2142</span>      * カメラサイズは偶数ピクセルにしておく
<span class='line'>2143</span>      * カメラ作成時にソースサイズは2の倍数ピクセルで近似値をとります
<span class='line'>2144</span>      */</span><span class="WHIT">
<span class='line'>2145</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myCameraSolid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2146</span> </span><span class="COMM">//alert([camWidth,camHeight,camAspect].join(" / "));</span><span class="WHIT">
<span class='line'>2147</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2148</span>      * プロジェクト内の平面の中からマッチするオブジェクトがあるか否か検索
<span class='line'>2149</span>      * @type {*}
<span class='line'>2150</span>      */</span><span class="WHIT">
<span class='line'>2151</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mySolids</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">app.project.pickItems</span><span class="PUNC">(</span><span class="STRN">"solid"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2152</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">camRegex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="NAME">targetName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"|cam(era)?|カメラ|frame"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"i"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2153</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">iIdx</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">mySolids</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2154</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mySolids</span><span class="PUNC">[</span><span class="NAME">iIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name.match</span><span class="PUNC">(</span><span class="NAME">camRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2155</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>2156</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="NAME">mySolids</span><span class="PUNC">[</span><span class="NAME">iIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">width</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">camWidth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>2157</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="NAME">mySolids</span><span class="PUNC">[</span><span class="NAME">iIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">height</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">camHeight</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2158</span> </span><span class="WHIT">            </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2159</span> </span><span class="WHIT">                </span><span class="NAME">myCameraSolid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mySolids</span><span class="PUNC">[</span><span class="NAME">iIdx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2160</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="COMM">//最初に発見したsolidを使う</span><span class="WHIT">
<span class='line'>2161</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2162</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2163</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2164</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2165</span>      * action
<span class='line'>2166</span>      */</span><span class="WHIT">
<span class='line'>2167</span> </span><span class="WHIT">    </span><span class="NAME">nas.otome.beginUndoGroup</span><span class="PUNC">(</span><span class="STRN">"addClippingTarget(otome)"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2168</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myCameraSolid</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2169</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myCameraLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.layers.addSolid</span><span class="PUNC">(</span><span class="NAME">camColor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">camWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">camHeight</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.duration</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2170</span> </span><span class="WHIT">        </span><span class="NAME">myCameraSolid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCameraLayer.source.mainSource</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2171</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2172</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myCameraLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.layers.add</span><span class="PUNC">(</span><span class="NAME">myCameraSolid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2173</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2174</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2175</span>      *  カメラレイヤのプロパティ調整
<span class='line'>2176</span>      */</span><span class="WHIT">
<span class='line'>2177</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myCameraLayer.name</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">targetName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2178</span> </span><span class="WHIT">        </span><span class="NAME">myCameraLayer.name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">targetName</span><span class="WHIT">
<span class='line'>2179</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2180</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2181</span>      * ブレンドモードを指定モードに
<span class='line'>2182</span>      */</span><span class="WHIT">
<span class='line'>2183</span> </span><span class="WHIT">    </span><span class="NAME">myCameraLayer.blendingMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">BlendingMode.MULTIPLY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2184</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2185</span>      * ガイドレイヤ属性
<span class='line'>2186</span>      * @type {boolean}
<span class='line'>2187</span>      */</span><span class="WHIT">
<span class='line'>2188</span> </span><span class="WHIT">    </span><span class="NAME">myCameraLayer.guideLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2189</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2190</span>      * 開始時間が0以外の場合はシフトする
<span class='line'>2191</span>      */</span><span class="WHIT">
<span class='line'>2192</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myCameraLayer.startTime</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2193</span> </span><span class="WHIT">        </span><span class="NAME">myCameraLayer.startTime</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>2194</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2195</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2196</span>      * 足跡ぽん
<span class='line'>2197</span>      * @type {string}
<span class='line'>2198</span>      */</span><span class="WHIT">
<span class='line'>2199</span> </span><span class="WHIT">    </span><span class="NAME">myCameraLayer.comment</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">footPrint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2200</span> 
<span class='line'>2201</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2202</span>      * タイムシートにカメラワーク指定があればMAP内にキーフレームを検索して配置
<span class='line'>2203</span>      */</span><span class="WHIT">
<span class='line'>2204</span> 
<span class='line'>2205</span> </span><span class="WHIT">    </span><span class="NAME">nas.otome.endUndoGroup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2206</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myCameraLayer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2207</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2208</span> 
<span class='line'>2209</span> 
<span class='line'>2210</span> </span><span class="COMM">/**
<span class='line'>2211</span>  * CompItem.mkClipWindow(compName,myScale,myOption)
<span class='line'>2212</span>  * 引数
<span class='line'>2213</span>  * compName    作成するコンポの名前　省略時は 現在のコンポ名+"(clip)"
<span class='line'>2214</span>  * myScale    クリップウインドウのスケールを%で　省略値は　100 (カメラ等倍)
<span class='line'>2215</span>  * myOption    オプション文字列各種
<span class='line'>2216</span>  * margin##    クリップエリアのマージンを％指定マイナス数値で外側をクリップ 省略値　0
<span class='line'>2217</span>  *
<span class='line'>2218</span>  * コンポにクリップターゲットがある場合のみターゲットを参照するクリッピングコンポを作成する。(通称カメラコンポ)
<span class='line'>2219</span>  * コンポ自身の第一レイヤがクリップターゲットでない場合は動作しない
<span class='line'>2220</span>  * 戻り値は作成したコンポまたはfalse
<span class='line'>2221</span>  *
<span class='line'>2222</span>  * @param compName
<span class='line'>2223</span>  * @param myScale
<span class='line'>2224</span>  * @param myOption
<span class='line'>2225</span>  * @returns {*}
<span class='line'>2226</span>  */</span><span class="WHIT">
<span class='line'>2227</span> </span><span class="NAME">CompItem.prototype.mkClipWindow</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">compName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myScale</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myOption</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2228</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myStgName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.name.replace</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"\\("</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nas.itmFootStamps.stage</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\\)"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//ステージのテイクナンバを含んでプレフィックスを払った文字列</span><span class="WHIT">
<span class='line'>2229</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">compName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2230</span> </span><span class="WHIT">        </span><span class="NAME">compName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.itmFootStamps.clipWindow</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nas.biteClip</span><span class="PUNC">(</span><span class="NAME">compName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">31</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">nas.itmFootStamps.clipWindow</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2231</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2232</span> </span><span class="WHIT">        </span><span class="NAME">compName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.itmFootStamps.clipWindow</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nas.biteClip</span><span class="PUNC">(</span><span class="NAME">myStgName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">31</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">nas.itmFootStamps.clipWindow</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2233</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2234</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myScale</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">myScale</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myScale</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2235</span> </span><span class="WHIT">        </span><span class="NAME">myScale</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="WHIT">
<span class='line'>2236</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2237</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myMargin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2238</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myOption</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">myOption</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myOption.match</span><span class="PUNC">(</span><span class="REGX">/margin(-?\d+)/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2239</span> </span><span class="WHIT">        </span><span class="NAME">myMargin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">RegExp.$1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2240</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2241</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">footPrint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"##nas.otome cameraWorkTarget"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2242</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2243</span>      * 第一レイヤにカメラがなければ終了
<span class='line'>2244</span>      */</span><span class="WHIT">
<span class='line'>2245</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.layer</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">comment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">footPrint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2246</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.layer</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//ターゲット取得</span><span class="WHIT">
<span class='line'>2247</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2248</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>2249</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2250</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2251</span>      * コンポ基準サイズをターゲットから取得
<span class='line'>2252</span>      * @type {number}
<span class='line'>2253</span>      */</span><span class="WHIT">
<span class='line'>2254</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">compWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myTarget.source.width</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">myScale</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">100</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myMargin</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2255</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">compHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myTarget.source.height</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">myScale</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">100</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myMargin</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2256</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2257</span>      * undoグループ開く
<span class='line'>2258</span>      */</span><span class="WHIT">
<span class='line'>2259</span> </span><span class="WHIT">    </span><span class="NAME">nas.otome.beginUndoGroup</span><span class="PUNC">(</span><span class="STRN">"カメラコンポ作成"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2260</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2261</span>      * 作る
<span class='line'>2262</span>      */</span><span class="WHIT">
<span class='line'>2263</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myComp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">app.project.items.addComp</span><span class="PUNC">(</span><span class="NAME">compName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">compWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">compHeight</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.pixelAspect</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.duration</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.frameRate</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2264</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2265</span>      * レイヤ投げ込み
<span class='line'>2266</span>      */</span><span class="WHIT">
<span class='line'>2267</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myComp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2268</span> </span><span class="WHIT">        </span><span class="NAME">myComp.comment</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.itmFootStamps.clipWindow</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2269</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myComp.layers.add</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2270</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2271</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2272</span>      * ここでundo閉じる
<span class='line'>2273</span>      */</span><span class="WHIT">
<span class='line'>2274</span> </span><span class="WHIT">    </span><span class="NAME">nas.otome.endUndoGroup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2275</span> 
<span class='line'>2276</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2277</span>      * 定型処理実行
<span class='line'>2278</span>      * @type {Folder}
<span class='line'>2279</span>      */</span><span class="WHIT">
<span class='line'>2280</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myAction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Folder</span><span class="PUNC">(</span><span class="NAME">Folder.scripts.path.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"/Scripts/nas/(actions)/systemResources/CompItem.clipWindow"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2281</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myLayer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myAction.exists</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2282</span> </span><span class="WHIT">        </span><span class="NAME">myComp.executeAction</span><span class="PUNC">(</span><span class="NAME">myAction</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2283</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2284</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myComp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2285</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2286</span> 
<span class='line'>2287</span> </span><span class="COMM">/**
<span class='line'>2288</span>  * CompItem.mkOutputMedia(compName,omIndex,myOption)
<span class='line'>2289</span>  * 引数
<span class='line'>2290</span>  * compName    作成するコンポの名前　省略時は 現在のコンポ名+"(output)"
<span class='line'>2291</span>  * OMIndex    使用するアウトプットメディアDBのID　省略時は現在選択されているメディア
<span class='line'>2292</span>  * myOption    オプション文字列各種
<span class='line'>2293</span>  * boardOFF    標準のボールド(スレート)を作成しない.別に作成したボールドをつける際などに指定
<span class='line'>2294</span>  *
<span class='line'>2295</span>  * 指定のコンポをスケーリングして出力メディアののコンポにセットする
<span class='line'>2296</span>  * 縦横比が合わない場合は、
<span class='line'>2297</span>  * 戻り値は作成したコンポまたはfalse
<span class='line'>2298</span>  *
<span class='line'>2299</span>  * @param compName
<span class='line'>2300</span>  * @param omIndex
<span class='line'>2301</span>  * @param myOption
<span class='line'>2302</span>  */</span><span class="WHIT">
<span class='line'>2303</span> </span><span class="NAME">CompItem.prototype.mkOutputMedia</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">compName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">omIndex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myOption</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2304</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myStgName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.name.replace</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"\\(...\\)"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//ステージのテイクナンバを含んでプレフィックスを払った文字列</span><span class="WHIT">
<span class='line'>2305</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">compName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2306</span> </span><span class="WHIT">        </span><span class="NAME">compName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.itmFootStamps.outputMedia</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nas.biteClip</span><span class="PUNC">(</span><span class="NAME">compName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">31</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">nas.itmFootStamps.outputMedia</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2307</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2308</span> </span><span class="WHIT">        </span><span class="NAME">compName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.itmFootStamps.outputMedia</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nas.biteClip</span><span class="PUNC">(</span><span class="NAME">myStgName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">31</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">nas.itmFootStamps.outputMedia</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2309</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2310</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">omIndex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2311</span> </span><span class="WHIT">        </span><span class="NAME">nas.outputMedias.select</span><span class="PUNC">(</span><span class="NAME">omIndex</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2312</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2313</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">noBoard</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2314</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myOption</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">myOption</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myOption.match</span><span class="PUNC">(</span><span class="REGX">/boardOFF/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2315</span> </span><span class="WHIT">        </span><span class="NAME">noBoard</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2316</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2317</span> 
<span class='line'>2318</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2319</span>      * コンポサイズをＤＢから取得
<span class='line'>2320</span>      * 文字列で記録されているので数値化 ケースによって整数化が必要だがソレはパラメータ調整で対応？
<span class='line'>2321</span>      * @type {number}
<span class='line'>2322</span>      */</span><span class="WHIT">
<span class='line'>2323</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">compWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.outputMedias.selectedRecord</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2324</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">compHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.outputMedias.selectedRecord</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2325</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">compAspect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.outputMedias.selectedRecord</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2326</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">compFrameRate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.outputMedias.selectedRecord</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2327</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2328</span>      * undoグループ開く
<span class='line'>2329</span>      */</span><span class="WHIT">
<span class='line'>2330</span> </span><span class="WHIT">    </span><span class="NAME">nas.otome.beginUndoGroup</span><span class="PUNC">(</span><span class="STRN">"出力コンポ作成"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2331</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2332</span>      * 作る
<span class='line'>2333</span>      */</span><span class="WHIT">
<span class='line'>2334</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myComp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">app.project.items.addComp</span><span class="PUNC">(</span><span class="NAME">compName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">compWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">compHeight</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">compAspect</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.duration</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">compFrameRate</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//レイヤ投げ込み</span><span class="WHIT">
<span class='line'>2335</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2336</span>      * 作成成功ならレイヤを投入
<span class='line'>2337</span>      */</span><span class="WHIT">
<span class='line'>2338</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myComp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2339</span> </span><span class="WHIT">        </span><span class="NAME">myComp.comment</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.itmFootStamps.outputMedia</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2340</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myComp.layers.add</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2341</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2342</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2343</span>      * ここでundo閉じる
<span class='line'>2344</span>      */</span><span class="WHIT">
<span class='line'>2345</span> </span><span class="WHIT">    </span><span class="NAME">nas.otome.endUndoGroup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2346</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2347</span>      * 定型処理実行レイヤマッチング
<span class='line'>2348</span>      * @type {Folder}
<span class='line'>2349</span>      */</span><span class="WHIT">
<span class='line'>2350</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myAction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Folder</span><span class="PUNC">(</span><span class="NAME">Folder.scripts.path.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"/Scripts/nas/(actions)/systemResources/CompItem.mkOutputMedia"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2351</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myAction.exists</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myLayer</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2352</span> </span><span class="WHIT">        </span><span class="NAME">myComp.executeAction</span><span class="PUNC">(</span><span class="NAME">myAction</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2353</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2354</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2355</span>      * ボールド設定
<span class='line'>2356</span>      */</span><span class="WHIT">
<span class='line'>2357</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myComp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">noBoard</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2358</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myBoldAction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Folder</span><span class="PUNC">(</span><span class="NAME">Folder.scripts.path.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"/Scripts/nas/(actions)/mkBoard"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2359</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myBoldAction.exists</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myLayer</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2360</span> </span><span class="WHIT">            </span><span class="NAME">myComp.executeAction</span><span class="PUNC">(</span><span class="NAME">myBoldAction</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2361</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2362</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>2363</span>          *  コンポのメソッドで呼んでボールドをつける
<span class='line'>2364</span>          */</span><span class="WHIT">
<span class='line'>2365</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2366</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2367</span> 
<span class='line'>2368</span> </span><span class="COMM">/*=============================オートビルダ関連タイムシート適用メソッド=====================2009/10/22=======*/</span><span class="WHIT">
<span class='line'>2369</span> 
<span class='line'>2370</span> </span><span class="COMM">/**
<span class='line'>2371</span>  * nast直下の拡張コマンド
<span class='line'>2372</span>  * 互換のため入れ替え終了までは、同名のユーティリティー関数のラッパであります。
<span class='line'>2373</span>  * 2007/11/07
<span class='line'>2374</span>  */</span><span class="WHIT">
<span class='line'>2375</span> 
<span class='line'>2376</span> </span><span class="NAME">systemOpen</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetFileName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2377</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">nas.otome.systemOpen</span><span class="PUNC">(</span><span class="NAME">targetFileName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2378</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2379</span> </span><span class="NAME">uriOpen</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetURI</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2380</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">nas.otome.uriOpen</span><span class="PUNC">(</span><span class="NAME">targetURI</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2381</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2382</span> </span><span class="NAME">otomeCall</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">order</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2383</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">nas.otome.doComp</span><span class="PUNC">(</span><span class="NAME">order</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2384</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2385</span> </span><span class="NAME">versionView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2386</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">nas.otome.versionView</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2387</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2388</span> 
<span class='line'>2389</span> </span><span class="COMM">/*+++++++++++++++++++++++++++++++++++++XPSトレーラー関連コード++++++++++++++++++++++++++++++++++++++++++++++*/</span><span class="WHIT">
<span class='line'>2390</span> 
<span class='line'>2391</span> </span><span class="COMM">/**
<span class='line'>2392</span>  * XPSStore　(シートトレーラ)
<span class='line'>2393</span>  *
<span class='line'>2394</span>  * XPSheetStore オブジェクト
<span class='line'>2395</span>  * プロジェクト内部にタイムシートを複数記録維持して切り換えて使用する仕組み
<span class='line'>2396</span>  * フッテージストア内部にコンポの形で記録する
<span class='line'>2397</span>  * インデックスがあり、選択値を切り換えてバッファとの間にやりとりを行う
<span class='line'>2398</span>  * バッファはXPS(=従来のXPSオブジェクトをそのまま使用)
<span class='line'>2399</span>  * XpsStore.body        実際にシートを格納してあるコンポ
<span class='line'>2400</span>  * コンポの下にはテキストレイヤを置いてXPSテキストを置く改行は"\\r\\n"に置換
<span class='line'>2401</span>  * XpsStore.selected    カレントのタイムシートレイヤをさす。カレントがない場合もあるその場合はnull または　false
<span class='line'>2402</span>  * デフォルトの値ではnull / レイヤが存在する場合はfalseを与える
<span class='line'>2403</span>  *
<span class='line'>2404</span>  * XpsStore.currentIndex    カレントインデックスを記録する内部変数　外部操作禁止
<span class='line'>2405</span>  *
<span class='line'>2406</span>  * XpsStore.getLength()    シート総数を返す
<span class='line'>2407</span>  * ０を返さずにfalseを返す場合は現状でシート操作環境がない事を表している。
<span class='line'>2408</span>  * もし、シート操作環境が必要な場合は　XpsStore.initBody()メソッドで初期化すると環境が構築される。
<span class='line'>2409</span>  * XpsStore.get(index)    indexで指定されたレイヤからXpsオブジェクトを取得
<span class='line'>2410</span>  * XpsStore.set(index,Xps)    indexで指定されたレイヤにXpsオブジェクトを登録する
<span class='line'>2411</span>  * XpsStore.pop(index)    indexで指定されたシートのデータをXPSバッファに転送する。
<span class='line'>2412</span>  * indexが指定されなければカレントのシートに対して実行
<span class='line'>2413</span>  * XpsStore.push(index)    indexで指定されたシートにXPSバッファのデータをセットする。内部でsetInfo()を実行する。
<span class='line'>2414</span>  * indexが指定されなければカレントのシートに対して実行
<span class='line'>2415</span>  * XpsStore.select(index)    カレントインデックスを切り替えバッファ内容を更新する。
<span class='line'>2416</span>  * 戻り値は選択されているシートのインデックス。数値のほかにキーワード"fwd,prv,start,end"を受け付ける
<span class='line'>2417</span>  * XpsStore.getInfo(index)    指定indexのシートのモディファイド情報を取得
<span class='line'>2418</span>  * 戻り値は情報オブジェクト
<span class='line'>2419</span>  * indexが指定されなければカレントのシートに対して実行
<span class='line'>2420</span>  * XpsStore.setInfo(index)    指定indexのシートに現行のXPSバッファのモディファイド情報を設定
<span class='line'>2421</span>  * 戻り値は情報オブジェクト
<span class='line'>2422</span>  * indexが指定されなければカレントのシートに対して実行
<span class='line'>2423</span>  * XpsStore.add(Xps)    Xpsオブジェクトを直接渡して新規にシート(テキストレイヤ)を作成する。
<span class='line'>2424</span>  * XPSバッファを同時更新
<span class='line'>2425</span>  * カラ指定の場合はXPSバッファから作成
<span class='line'>2426</span>  * 既存シートとの重複は関知しないのであらかじめ確認は必要
<span class='line'>2427</span>  * 戻値は追加成功したテキストレイヤ
<span class='line'>2428</span>  * XpsStore.remove(index)    指定indexのシートをプロジェクトから削除する。インデックスは必ず指定すること。
<span class='line'>2429</span>  * インデックス不指定時は失敗させる
<span class='line'>2430</span>  * 成功時の戻り値は新たなバッファ内容(Xps)またはnull(残シートなしの時)
<span class='line'>2431</span>  * XpsStore.duplicate(index,name)    指定indexのシートをnameで複製する。インデックスは必ず指定すること。
<span class='line'>2432</span>  * 名前が指定されなかった場合は元のカット番号に"copy of "を前置する
<span class='line'>2433</span>  * 成功時の戻り値は新たなバッファ内容(Xps)　失敗時はfalse (未実装　2010 12 19)
<span class='line'>2434</span>  * XpsStore.setBody()    内部で使用するメソッド、ライブラリを参照してbodyを自身のオブジェクトとして再設定する
<span class='line'>2435</span>  * 設定済みの場合は何もしない。外部アクセス禁止
<span class='line'>2436</span>  *
<span class='line'>2437</span>  * XpsStore.initBody()    内部で使用する初期化メソッド
<span class='line'>2438</span>  * カラのトレーラを作るので注意
<span class='line'>2439</span>  *
<span class='line'>2440</span>  * @constructor
<span class='line'>2441</span>  */</span><span class="WHIT">
<span class='line'>2442</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">XpsStore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2443</span> </span><span class="WHIT">    </span><span class="NAME">this.body</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="COMM">//false or CompItem</span><span class="WHIT">
<span class='line'>2444</span> </span><span class="WHIT">    </span><span class="NAME">this.selected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="COMM">//null or TextLayer</span><span class="WHIT">
<span class='line'>2445</span> </span><span class="WHIT">    </span><span class="NAME">this.currentIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//選択状態なし</span><span class="WHIT">
<span class='line'>2446</span> 
<span class='line'>2447</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2448</span>      * AE65用ダミープロパティ
<span class='line'>2449</span>      * 新規プロパティを作る
<span class='line'>2450</span>      * @type {string}
<span class='line'>2451</span>      */</span><span class="WHIT">
<span class='line'>2452</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myProp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"{"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2453</span> </span><span class="WHIT">    </span><span class="NAME">myProp</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\"name\" :\"AE65dummyProp\","</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2454</span> </span><span class="WHIT">    </span><span class="NAME">myProp</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\"modified\" :\""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toNASString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\","</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2455</span> </span><span class="WHIT">    </span><span class="NAME">myProp</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\"length\" :\"==000000==\","</span><span class="PUNC">;</span><span class="COMM">//"=="でエスケープしてある場合はファイルなし</span><span class="WHIT">
<span class='line'>2456</span> </span><span class="WHIT">    </span><span class="NAME">myProp</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\"url\" :\"\"}"</span><span class="PUNC">;</span><span class="COMM">//"=="でエスケープしてある場合はファイルなし</span><span class="WHIT">
<span class='line'>2457</span> </span><span class="WHIT">    </span><span class="NAME">this.AE65Prop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">eval</span><span class="PUNC">(</span><span class="STRN">"\("</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myProp</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\)"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2458</span> 
<span class='line'>2459</span> </span><span class="WHIT">    </span><span class="NAME">this.setBody</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myIndex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2460</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>2461</span>          * myIndexは整数で与えること　初期値はcurrentIndex
<span class='line'>2462</span>          * @type {*}
<span class='line'>2463</span>          */</span><span class="WHIT">
<span class='line'>2464</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">app.project.items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.sheetBinder</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//あとで変更</span><span class="WHIT">
<span class='line'>2465</span> </span><span class="COMM">//		if(myIndex&lt;0)myIndex=0;</span><span class="WHIT">
<span class='line'>2466</span> </span><span class="COMM">//		if(myIndex>myTarget.layers.length)myIndex=myTarget.layers.length;</span><span class="WHIT">
<span class='line'>2467</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>2468</span> </span><span class="WHIT">            </span><span class="PUNC">(</span><span class="NAME">myTarget</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>2469</span> </span><span class="WHIT">            </span><span class="PUNC">(</span><span class="NAME">myTarget.parentFolder.name</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">nas.ftgFolders</span><span class="PUNC">[</span><span class="STRN">"etc"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>2470</span> </span><span class="WHIT">            </span><span class="PUNC">(</span><span class="NAME">myTarget.parentFolder.parentFolder.name</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">nas.ftgFolders</span><span class="PUNC">[</span><span class="STRN">"ftgBase"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2471</span> </span><span class="WHIT">        </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2472</span> </span><span class="WHIT">            </span><span class="NAME">this.body</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myTarget</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2473</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">myIndex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myIndex</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">this.body.layers.length</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2474</span> </span><span class="WHIT">                </span><span class="NAME">myIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.currentIndex</span><span class="WHIT">
<span class='line'>2475</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2476</span> </span><span class="WHIT">            </span><span class="NAME">this.selected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myTarget.layers.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myIndex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">myTarget.layers</span><span class="PUNC">[</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">myIndex</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2477</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2478</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>2479</span>              * ないときに初期化したほうが良いかも？
<span class='line'>2480</span>              * @type {boolean}
<span class='line'>2481</span>              */</span><span class="WHIT">
<span class='line'>2482</span> </span><span class="WHIT">            </span><span class="NAME">this.body</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2483</span> </span><span class="WHIT">            </span><span class="NAME">this.selected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2484</span> </span><span class="WHIT">            </span><span class="NAME">this.currentIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2485</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2486</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myTarget</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2487</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2488</span> 
<span class='line'>2489</span> </span><span class="WHIT">    </span><span class="NAME">this.initBody</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2490</span> 
<span class='line'>2491</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>2492</span>          * すでにあれば空コンポに初期化する。　コンポがなければ新規に作る。　初期化用
<span class='line'>2493</span>          * 初期状態のシート保持数は0 選択インデックスは0
<span class='line'>2494</span>          * @type {*}
<span class='line'>2495</span>          */</span><span class="WHIT">
<span class='line'>2496</span> 
<span class='line'>2497</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">app.project.items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.sheetBinder</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2498</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>2499</span> </span><span class="WHIT">            </span><span class="PUNC">(</span><span class="NAME">myTarget</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>2500</span> </span><span class="WHIT">            </span><span class="PUNC">(</span><span class="NAME">myTarget.parentFolder.name</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">nas.ftgFolders</span><span class="PUNC">[</span><span class="STRN">"etc"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>2501</span> </span><span class="WHIT">            </span><span class="PUNC">(</span><span class="NAME">myTarget.parentFolder.parentFolder.name</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">nas.ftgFolders</span><span class="PUNC">[</span><span class="STRN">"ftgBase"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2502</span> </span><span class="WHIT">        </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2503</span> </span><span class="WHIT">            </span><span class="NAME">this.body</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myTarget</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2504</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">lIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">this.body.layers.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">lIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2505</span> </span><span class="WHIT">                </span><span class="NAME">this.body.layers</span><span class="PUNC">[</span><span class="NAME">lIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2506</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2507</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2508</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">app.project.items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.ftgFolders</span><span class="PUNC">[</span><span class="STRN">"ftgBase"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2509</span> </span><span class="WHIT">                </span><span class="NAME">app.project.items.addFolder</span><span class="PUNC">(</span><span class="NAME">nas.ftgFolders</span><span class="PUNC">[</span><span class="STRN">"ftgBase"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2510</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2511</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">app.project.items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.ftgFolders.ftgBase</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.ftgFolders.etc</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2512</span> </span><span class="WHIT">                </span><span class="NAME">app.project.items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.ftgFolders.ftgBase</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">items.addFolder</span><span class="PUNC">(</span><span class="NAME">nas.ftgFolders.etc</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2513</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2514</span> 
<span class='line'>2515</span> </span><span class="WHIT">            </span><span class="NAME">this.body</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">app.project.items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.ftgFolders.ftgBase</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.ftgFolders.etc</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">items.addComp</span><span class="PUNC">(</span><span class="NAME">nas.sheetBinder</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">640</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">480</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2516</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2517</span> </span><span class="WHIT">        </span><span class="NAME">this.select</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2518</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.body</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2519</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2520</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2521</span>      * 暫定操作メソッド
<span class='line'>2522</span>      */</span><span class="WHIT">
<span class='line'>2523</span> </span><span class="COMM">//getLength of XpSheets</span><span class="WHIT">
<span class='line'>2524</span> </span><span class="WHIT">    </span><span class="NAME">this.getLength</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2525</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.setBody</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2526</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>2527</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2528</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.body.layers.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2529</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2530</span> </span><span class="COMM">//select selectIndex chicetimesheetIndex</span><span class="WHIT">
<span class='line'>2531</span> </span><span class="WHIT">    </span><span class="NAME">this.select</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2532</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">index</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.selected</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">TextLayer</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2533</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2534</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.selected.index</span><span class="WHIT">
<span class='line'>2535</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2536</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2537</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2538</span> </span><span class="WHIT">            </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>2539</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2540</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">this.body.layers.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2541</span> </span><span class="WHIT">            </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.body.layers.length</span><span class="WHIT">
<span class='line'>2542</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2543</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>2544</span>          * 現状ではキーワードは未サポート
<span class='line'>2545</span>          */</span><span class="WHIT">
<span class='line'>2546</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2547</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.setBody</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2548</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2549</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2550</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2551</span> </span><span class="COMM">//			nas.otome.writeConsole("start isSame : index= "+this.selected.index);</span><span class="WHIT">
<span class='line'>2552</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2553</span> </span><span class="WHIT">            </span><span class="NAME">this.currentIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2554</span> </span><span class="WHIT">            </span><span class="NAME">this.selected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2555</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>2556</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2557</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>2558</span>          * 解除（バッファの内容は残る。注意　初期化はしない）;
<span class='line'>2559</span>          */</span><span class="WHIT">
<span class='line'>2560</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2561</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.currentIndex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2562</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2563</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">this.getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2564</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.selected.index</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2565</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2566</span> </span><span class="WHIT">        </span><span class="NAME">this.selected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.body.layers</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2567</span> </span><span class="WHIT">        </span><span class="NAME">this.currentIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2568</span> </span><span class="COMM">//			nas.otome.writeConsole("before isSame : index= "+this.selected.index);</span><span class="WHIT">
<span class='line'>2569</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">XPS.isSame</span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2570</span> </span><span class="WHIT">            </span><span class="NAME">this.pop</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2571</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2572</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>2573</span>          * 現行のバッファの内容をアップデートする　（ないほうが良いかも？？）
<span class='line'>2574</span>          */</span><span class="WHIT">
<span class='line'>2575</span> </span><span class="COMM">//			nas.otome.writeConsole("after isSame : index= "+this.selected.index);</span><span class="WHIT">
<span class='line'>2576</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.selected.index</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2577</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2578</span> </span><span class="COMM">//get Xps from XPSStore</span><span class="WHIT">
<span class='line'>2579</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2580</span>      * このメソッドは取得のみでバッファは無視
<span class='line'>2581</span>      * @param index
<span class='line'>2582</span>      * @returns {*}
<span class='line'>2583</span>      */</span><span class="WHIT">
<span class='line'>2584</span> </span><span class="WHIT">    </span><span class="NAME">this.get</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2585</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2586</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.setBody</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2587</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2588</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2589</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2590</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">index</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2591</span> </span><span class="WHIT">            </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.selected</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this.selected.index</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>2592</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2593</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">this.getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2594</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>2595</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2596</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myXps</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Xps</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2597</span> </span><span class="WHIT">        </span><span class="NAME">myXps.readIN</span><span class="PUNC">(</span><span class="NAME">this.body.layers</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sourceText.value.text.replace</span><span class="PUNC">(</span><span class="REGX">/\\r\\n/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2598</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myXps</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2599</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2600</span> </span><span class="COMM">//set XPSStore from Object Xps</span><span class="WHIT">
<span class='line'>2601</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2602</span>      * このメソッドはセットのみでバッファは無視? セレクトしたほうが重宝かも　一考中
<span class='line'>2603</span>      * @param index
<span class='line'>2604</span>      * @param myXps
<span class='line'>2605</span>      * @returns {*}
<span class='line'>2606</span>      */</span><span class="WHIT">
<span class='line'>2607</span> </span><span class="WHIT">    </span><span class="NAME">this.set</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myXps</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2608</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2609</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.setBody</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2610</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2611</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2612</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2613</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">this.getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2614</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>2615</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2616</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myXps</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2617</span> </span><span class="WHIT">            </span><span class="NAME">myXps</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">XPS</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2618</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2619</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myXps</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Xps</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2620</span> </span><span class="WHIT">            </span><span class="NAME">this.body.layers</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sourceText.setValue</span><span class="PUNC">(</span><span class="NAME">myXps.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\n/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"\\r\\n"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2621</span> </span><span class="WHIT">            </span><span class="NAME">this.pop</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//バッファセット どうしようかな</span><span class="WHIT">
<span class='line'>2622</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2623</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2624</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2625</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2626</span> </span><span class="COMM">//add XPSStore from Object Xps</span><span class="WHIT">
<span class='line'>2627</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2628</span>      * 直接addした場合はsetInfo忘れずに
<span class='line'>2629</span>      * 引数なしの場合は新規Xpsを追加する
<span class='line'>2630</span>      * @param myXps
<span class='line'>2631</span>      * @returns {*}
<span class='line'>2632</span>      */</span><span class="WHIT">
<span class='line'>2633</span> </span><span class="WHIT">    </span><span class="NAME">this.add</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myXps</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2634</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2635</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.setBody</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2636</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2637</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2638</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2639</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myXps</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2640</span> </span><span class="WHIT">            </span><span class="NAME">myXps</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Xps</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2641</span> </span><span class="WHIT">            </span><span class="NAME">myXps.readIN</span><span class="PUNC">(</span><span class="NAME">XPS.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2642</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2643</span> </span><span class="COMM">//		alert((myXps instanceof Xps))</span><span class="WHIT">
<span class='line'>2644</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myXps</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Xps</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2645</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myNewTimeSheet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.body.layers.addText</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">TextDocument</span><span class="PUNC">(</span><span class="NAME">myXps.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\n/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"\\r\\n"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2646</span> </span><span class="WHIT">            </span><span class="NAME">myNewTimeSheet.name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">myXps.scene</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myXps.cut</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">"_"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2647</span> </span><span class="COMM">//			if(XPS.toString()!=myXps.toString()){XPS.readIN(myXps.toString());};//このルーチンの最後のselect()メソッドで解決するのでこの行不要</span><span class="WHIT">
<span class='line'>2648</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>2649</span>              * プロパティ転記
<span class='line'>2650</span>              */</span><span class="WHIT">
<span class='line'>2651</span> </span><span class="WHIT">            </span><span class="COMM">//		this.setInfo(myNewTimeSheet.index);</span><span class="WHIT">
<span class='line'>2652</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.select</span><span class="PUNC">(</span><span class="NAME">myNewTimeSheet.index</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2653</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.selected</span><span class="WHIT">
<span class='line'>2654</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2655</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>2656</span>              * 現行シートを新規ストアしたのでカレントを移す
<span class='line'>2657</span>              * 成功時レイヤを戻す
<span class='line'>2658</span>              */</span><span class="WHIT">
<span class='line'>2659</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2660</span> 
<span class='line'>2661</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2662</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2663</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2664</span>      * remove timesheet
<span class='line'>2665</span>      * @param index
<span class='line'>2666</span>      * @returns {*}
<span class='line'>2667</span>      */</span><span class="WHIT">
<span class='line'>2668</span> </span><span class="WHIT">    </span><span class="NAME">this.remove</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2669</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2670</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.setBody</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2671</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2672</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2673</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2674</span> 
<span class='line'>2675</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">index</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2676</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.selected</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2677</span> </span><span class="WHIT">                </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.selected.index</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2678</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2679</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2680</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2681</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2682</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">this.body.layers.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2683</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2684</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2685</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.selected</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">this.selected.index</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2686</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>2687</span>              * 削除レイヤがカレントより上ならそのまま削除
<span class='line'>2688</span>              * 削除レイヤがカレント以下ならカレントが移動する
<span class='line'>2689</span>              * （元のインデックスを第一候補にして元のインデックスがなくなる場合は一番下げる。ラストならヌルで選択解除）
<span class='line'>2690</span>              * @type {number}
<span class='line'>2691</span>              */</span><span class="WHIT">
<span class='line'>2692</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nextIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="COMM">//すでに0が除外されているので負にはならない。</span><span class="WHIT">
<span class='line'>2693</span> </span><span class="COMM">//			if(nextIndex==this.body.layers.length) nextIndex--;//</span><span class="WHIT">
<span class='line'>2694</span> </span><span class="WHIT">            </span><span class="NAME">this.body.layers</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//削除する</span><span class="WHIT">
<span class='line'>2695</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.body.layers.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2696</span> </span><span class="WHIT">                </span><span class="NAME">this.select</span><span class="PUNC">(</span><span class="NAME">nextIndex</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2697</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2698</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>2699</span>              * カレント移動（0なら解除）
<span class='line'>2700</span>              */</span><span class="WHIT">
<span class='line'>2701</span> </span><span class="COMM">//			if(nextIndex){this.selected=this.body.layers[nextIndex];}else{this.selected=null;}</span><span class="WHIT">
<span class='line'>2702</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2703</span> </span><span class="WHIT">            </span><span class="NAME">this.body.layers</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//レイヤ削除する</span><span class="WHIT">
<span class='line'>2704</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2705</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.selected</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2706</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2707</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2708</span>      * pop XPSContents from XPSStore currentStack toXPSBuffer
<span class='line'>2709</span>      * @param index
<span class='line'>2710</span>      * @returns {*}
<span class='line'>2711</span>      */</span><span class="WHIT">
<span class='line'>2712</span> </span><span class="WHIT">    </span><span class="NAME">this.pop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2713</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2714</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.setBody</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2715</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2716</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2717</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2718</span> 
<span class='line'>2719</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">index</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2720</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.selected</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2721</span> </span><span class="WHIT">                </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.selected.index</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2722</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2723</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2724</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2725</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2726</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">this.body.layers.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2727</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2728</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2729</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.body.layers</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2730</span> </span><span class="WHIT">            </span><span class="NAME">this.selected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.body.layers</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2731</span> </span><span class="WHIT">            </span><span class="NAME">this.currentIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2732</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myContents</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.selected.sourceText.value.text.replace</span><span class="PUNC">(</span><span class="REGX">/\\r\\n/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2733</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myXps</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Xps</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2734</span> </span><span class="WHIT">            </span><span class="NAME">myXps.readIN</span><span class="PUNC">(</span><span class="NAME">myContents</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2735</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">XPS.isSame</span><span class="PUNC">(</span><span class="NAME">myXps</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2736</span> </span><span class="WHIT">                </span><span class="NAME">XPS.readIN</span><span class="PUNC">(</span><span class="NAME">myContents</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2737</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2738</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>2739</span>              *  現行のバッファの内容をアップデートする
<span class='line'>2740</span>              */</span><span class="WHIT">
<span class='line'>2741</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2742</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2743</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2744</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="COMM">//</span><span class="WHIT">
<span class='line'>2745</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2746</span>      * push XPSContents from XPSBuffer to XPSStore currentStack
<span class='line'>2747</span>      * @param index
<span class='line'>2748</span>      * @returns {*}
<span class='line'>2749</span>      */</span><span class="WHIT">
<span class='line'>2750</span> </span><span class="WHIT">    </span><span class="NAME">this.push</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2751</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2752</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.setBody</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2753</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2754</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2755</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2756</span> 
<span class='line'>2757</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">index</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2758</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.selected</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2759</span> </span><span class="WHIT">                </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.selected.index</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2760</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2761</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2762</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2763</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2764</span> </span><span class="WHIT">        </span><span class="NAME">this.selected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.body.layers</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2765</span> </span><span class="WHIT">        </span><span class="NAME">this.currentIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2766</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.selected.sourceText.value.text.replace</span><span class="PUNC">(</span><span class="REGX">/\\r\\n/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">XPS.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2767</span> </span><span class="WHIT">            </span><span class="NAME">this.selected.sourceText.setValue</span><span class="PUNC">(</span><span class="NAME">XPS.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\n/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"\\r\\n"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2768</span> </span><span class="WHIT">            </span><span class="NAME">this.setInfo</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2769</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2770</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2771</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2772</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2773</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2774</span>      * toString resultXPSContent from currentSheet
<span class='line'>2775</span>      * @param index
<span class='line'>2776</span>      * @returns {*}
<span class='line'>2777</span>      */</span><span class="WHIT">
<span class='line'>2778</span> </span><span class="WHIT">    </span><span class="NAME">this.toString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2779</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2780</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.setBody</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2781</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2782</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2783</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2784</span> 
<span class='line'>2785</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">index</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2786</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.selected</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2787</span> </span><span class="WHIT">                </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.selected.index</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2788</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2789</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2790</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2791</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2792</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">this.body.layers.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2793</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2794</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2795</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.body.layers</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2796</span> </span><span class="COMM">//			this.selected=index;//切り替えない</span><span class="WHIT">
<span class='line'>2797</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.body.layers</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sourceText.value.text.replace</span><span class="PUNC">(</span><span class="REGX">/\\r\\n/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\n"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2798</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2799</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2800</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2801</span>      * get XPSInfo from currentSheet
<span class='line'>2802</span>      * @param index
<span class='line'>2803</span>      * @returns {*}
<span class='line'>2804</span>      */</span><span class="WHIT">
<span class='line'>2805</span> </span><span class="WHIT">    </span><span class="NAME">this.getInfo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2806</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2807</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.setBody</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2808</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2809</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2810</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2811</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">AEVersion</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">7</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2812</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.AE65Prop</span><span class="WHIT">
<span class='line'>2813</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2814</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>2815</span>          * AE65の場合はダミープロパティを返す
<span class='line'>2816</span>          */</span><span class="WHIT">
<span class='line'>2817</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">index</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2818</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.selected</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2819</span> </span><span class="WHIT">                </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.selected.index</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2820</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2821</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2822</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2823</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2824</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">this.body.layers.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2825</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2826</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2827</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.body.layers</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2828</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myProps</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">eval</span><span class="PUNC">(</span><span class="STRN">"\("</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.body.layers</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">comment</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\)"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//JSONのはずなんだけど怖いよね</span><span class="WHIT">
<span class='line'>2829</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myProps</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2830</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myXps</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Xps</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2831</span> </span><span class="WHIT">                </span><span class="NAME">myXps.readIN</span><span class="PUNC">(</span><span class="NAME">this.body.layers</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">text.sourceText.value.text</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2832</span> </span><span class="WHIT">                </span><span class="NAME">myProps</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myXps.getInfo</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2833</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2834</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myProps</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2835</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2836</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2837</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2838</span> 
<span class='line'>2839</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2840</span>      * setXPSInfo to currentSheet from XPSBuffer
<span class='line'>2841</span>      * @param myIndex
<span class='line'>2842</span>      * @param myFile
<span class='line'>2843</span>      * @returns {*}
<span class='line'>2844</span>      */</span><span class="WHIT">
<span class='line'>2845</span> </span><span class="WHIT">    </span><span class="NAME">this.setInfo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myIndex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myFile</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2846</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myIndex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2847</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.selected</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2848</span> </span><span class="WHIT">                </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.selected.index</span><span class="WHIT">
<span class='line'>2849</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2850</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>2851</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2852</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2853</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2854</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.setBody</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2855</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2856</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2857</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2858</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">AEVersion</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">7</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2859</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">storeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">XPS.scene</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">XPS.cut</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">"_"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//</span><span class="WHIT">
<span class='line'>2860</span> </span><span class="WHIT">            </span><span class="NAME">this.body.layers</span><span class="PUNC">[</span><span class="NAME">myIndex</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">storeName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2861</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.AE65Prop</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2862</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2863</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>2864</span>          * AE65の場合はダミープロパティを返す
<span class='line'>2865</span>          */</span><span class="WHIT">
<span class='line'>2866</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myIndex</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">this.body.layers.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2867</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2868</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2869</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.body.layers</span><span class="PUNC">[</span><span class="NAME">myIndex</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2870</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">storeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">XPS.scene</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">XPS.cut</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">"_"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//</span><span class="WHIT">
<span class='line'>2871</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">XPS.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2872</span> 
<span class='line'>2873</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>2874</span>              * 新規プロパティを作る
<span class='line'>2875</span>              * ファイルが与えられた場合は、ファイルから　ない場合は現状のデータから
<span class='line'>2876</span>              */</span><span class="WHIT">
<span class='line'>2877</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myFile</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2878</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newProp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"{"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2879</span> </span><span class="WHIT">                </span><span class="NAME">newProp</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\"name\" :\""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myFile.name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\","</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2880</span> </span><span class="WHIT">                </span><span class="NAME">newProp</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\"modified\" :\""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myFile.modified.toNASString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\","</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2881</span> </span><span class="WHIT">                </span><span class="NAME">newProp</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\"length\" :\""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myFile.length</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\","</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2882</span> </span><span class="WHIT">                </span><span class="NAME">newProp</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\"url\" :\""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myFile.absoluteURI</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2883</span> </span><span class="WHIT">                </span><span class="NAME">newProp</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\"}"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2884</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2885</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newProp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">XPS.getInfo</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toSource</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2886</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2887</span> 
<span class='line'>2888</span> </span><span class="COMM">//				alert(newProp + myFile.toString() );</span><span class="WHIT">
<span class='line'>2889</span> </span><span class="WHIT">            </span><span class="NAME">this.body.layers</span><span class="PUNC">[</span><span class="NAME">myIndex</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">comment</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newProp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2890</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>2891</span>              * レイヤ名を識別子で置き換え
<span class='line'>2892</span>              * @type {string}
<span class='line'>2893</span>              */</span><span class="WHIT">
<span class='line'>2894</span> </span><span class="WHIT">            </span><span class="NAME">this.body.layers</span><span class="PUNC">[</span><span class="NAME">myIndex</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">storeName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2895</span> 
<span class='line'>2896</span> 
<span class='line'>2897</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">eval</span><span class="PUNC">(</span><span class="STRN">"\("</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">newProp</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\)"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2898</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2899</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2900</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2901</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2902</span>      * 関連付けられているコンポのupdate
<span class='line'>2903</span>      * @param indx
<span class='line'>2904</span>      * @returns {number}
<span class='line'>2905</span>      */</span><span class="WHIT">
<span class='line'>2906</span> </span><span class="WHIT">    </span><span class="NAME">this.update</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">indx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2907</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>2908</span>          * indxはシートindex =シートキャリアのレイヤインデックスと一致　1～
<span class='line'>2909</span>          * @type {string}
<span class='line'>2910</span>          */</span><span class="WHIT">
<span class='line'>2911</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myIdentifier</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="NAME">indx</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getIdentifier</span><span class="PUNC">(</span><span class="STRN">'cut'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2912</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>2913</span>          * チェックするシートの識別を取得
<span class='line'>2914</span>          * アイテム総当り
<span class='line'>2915</span>          * @type {number}
<span class='line'>2916</span>          */</span><span class="WHIT">
<span class='line'>2917</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2918</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">app.project.items.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2919</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>2920</span>              * CompItem && ステージプレフィックスありコメントシグネチャあり
<span class='line'>2921</span>              * 3条件を自動更新の必要条件にする…かためカモ
<span class='line'>2922</span>              */</span><span class="WHIT">
<span class='line'>2923</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>2924</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="NAME">app.project.item</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">CompItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>2925</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="NAME">app.project.item</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">name.match</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"^\\("</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nas.itmFootStamps.stage</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\\)"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>2926</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="NAME">app.project.item</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">comment.match</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"^"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nas.itmFootStamps.stage</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2927</span> </span><span class="WHIT">            </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2928</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myXps</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">app.project.item</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getRootXps</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//コンポからXPS取得</span><span class="WHIT">
<span class='line'>2929</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myXps</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2930</span> </span><span class="WHIT">                    </span><span class="COMM">/**
<span class='line'>2931</span>                      * Xpsがあれば識別情報を比較　一致したら適用
<span class='line'>2932</span>                      */</span><span class="WHIT">
<span class='line'>2933</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myIdentifier</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">myXps.getIdentifier</span><span class="PUNC">(</span><span class="STRN">'cut'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2934</span> </span><span class="WHIT">                        </span><span class="NAME">app.project.item</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">applyXPS</span><span class="PUNC">(</span><span class="NAME">myXps</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2935</span> </span><span class="WHIT">                        </span><span class="NAME">nas.otome.writeConsole</span><span class="PUNC">(</span><span class="STRN">"updated Comp ["</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"] "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">app.project.item</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2936</span> </span><span class="WHIT">                        </span><span class="COMM">//	myComps.push(app.project.item(idx));</span><span class="WHIT">
<span class='line'>2937</span> </span><span class="WHIT">                        </span><span class="NAME">myResult</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2938</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2939</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2940</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2941</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2942</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2943</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2944</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2945</span>      * このアルゴリズムだと、カット識別が重複した（コンポが複数ある）場合複数のコンポが誤認で更新される場合があるが、それは仕様とする。
<span class='line'>2946</span>      * 同一プロジェクト内部での関連付けの重複である。コンフリクトに注意
<span class='line'>2947</span>      */</span><span class="WHIT">
<span class='line'>2948</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2949</span> </span><span class="NAME">nas.XPSStore</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XpsStore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2950</span> 
<span class='line'>2951</span> </span><span class="COMM">/**
<span class='line'>2952</span>  * 全文比較をやめる
<span class='line'>2953</span>  * XPS同士の比較関数が必要修正点を求めるのにbody/memo/propを比較してやらないと日付のみ違って内容のおなじファイルの処理スキップができない
<span class='line'>2954</span>  * Ｘｐｓ.isSame(targetXps)が要る
<span class='line'>2955</span>  * Xpsioの拡張
<span class='line'>2956</span>  */</span><span class="WHIT">
<span class='line'>2957</span> 
<span class='line'>2958</span> </span><span class="COMM">/*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/</span><span class="WHIT">
<span class='line'>2959</span> 
<span class='line'>2960</span> 
<span class='line'>2961</span> </span><span class="COMM">/**
<span class='line'>2962</span>  * 乙女ユーティリティ関数群
<span class='line'>2963</span>  * 乙女undo
<span class='line'>2964</span>  * 乙女がundoGroupをメモしてundoの管理をします
<span class='line'>2965</span>  * undoGroupが閉じられずに次が発行されたら閉じてから次を打ちますのでエラー回避に役立つはず
<span class='line'>2966</span>  * app.begin/end UndoGroupのラッパです
<span class='line'>2967</span>  *
<span class='line'>2968</span>  * @type {string}
<span class='line'>2969</span>  */</span><span class="WHIT">
<span class='line'>2970</span> </span><span class="NAME">nas.otome.undoGroup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="COMM">//nullで初期化グループ名バッファ</span><span class="WHIT">
<span class='line'>2971</span> </span><span class="NAME">nas.otome.beginUndoGroup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myGroup</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2972</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myGroup</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2973</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>2974</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2975</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.undoGroup</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2976</span> </span><span class="WHIT">        </span><span class="NAME">nas.otome.writeConsole</span><span class="PUNC">(</span><span class="STRN">"undoGroup修正 :"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.undoGroup</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2977</span> </span><span class="WHIT">        </span><span class="NAME">app.endUndoGroup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2978</span> </span><span class="WHIT">        </span><span class="NAME">this.undoGroup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2979</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2980</span> </span><span class="WHIT">    </span><span class="NAME">app.beginUndoGroup</span><span class="PUNC">(</span><span class="NAME">myGroup</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2981</span> </span><span class="WHIT">    </span><span class="NAME">this.undoGroup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myGroup</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2982</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2983</span> </span><span class="NAME">nas.otome.endUndoGroup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myGroup</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2984</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myGroup</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.undoGroup</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2985</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>2986</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2987</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.undoGroup</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2988</span> </span><span class="WHIT">        </span><span class="NAME">app.endUndoGroup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2989</span> </span><span class="WHIT">        </span><span class="NAME">this.undoGroup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2990</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2991</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2992</span> 
<span class='line'>2993</span> </span><span class="COMM">/**
<span class='line'>2994</span>  * 乙女コンソール表示
<span class='line'>2995</span>  * コンソールがほしいのでもうしょうがないから書く
<span class='line'>2996</span>  * 暫定的にtestConsoleオブジェクトを使うが、そのうち受け皿をちゃんとつくる
<span class='line'>2997</span>  * @param msg
<span class='line'>2998</span>  */</span><span class="WHIT">
<span class='line'>2999</span> </span><span class="NAME">nas.otome.writeConsole</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3000</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3001</span>      * そのうちエスケープシーケンス実装する　あれ？テキストエディットオブジェクトがすでにもってるか？　後で調べる
<span class='line'>3002</span>      */</span><span class="WHIT">
<span class='line'>3003</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.otome.dbgConsole</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3004</span> </span><span class="WHIT">        </span><span class="NAME">nas.otome.dbgConsole.resultBox.text</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nas.GUI.LineFeed</span><span class="WHIT">
<span class='line'>3005</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3006</span> </span><span class="WHIT">        </span><span class="NAME">writeLn</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3007</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3008</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3009</span> </span><span class="COMM">/**
<span class='line'>3010</span>  * コンポジションに対する関数実行
<span class='line'>3011</span>  * @param order
<span class='line'>3012</span>  * @returns {boolean}
<span class='line'>3013</span>  */</span><span class="WHIT">
<span class='line'>3014</span> </span><span class="NAME">nas.otome.doComp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">order</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3015</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">app.project</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3016</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">app.project.activeItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">app.project.activeItem</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">CompItem</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3017</span> </span><span class="WHIT">        </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"コンポアイテムを選択してくらさい"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3018</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3019</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3020</span> </span><span class="WHIT">    </span><span class="NAME">this.beginUndoGroup</span><span class="PUNC">(</span><span class="NAME">order</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3021</span> </span><span class="WHIT">    </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">order</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3022</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"セル並び替え"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3023</span> </span><span class="WHIT">            </span><span class="NAME">nas.otome.reOrderCell</span><span class="PUNC">(</span><span class="NAME">app.project.activeItem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3024</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3025</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"L/Oモード変更"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3026</span> </span><span class="WHIT">            </span><span class="NAME">nas.otome.reViewLayout</span><span class="PUNC">(</span><span class="NAME">app.project.activeItem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3027</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3028</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"レイヤ名推測"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3029</span> </span><span class="WHIT">            </span><span class="NAME">nas.otome.reNameCell</span><span class="PUNC">(</span><span class="NAME">app.project.activeItem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3030</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3031</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"セルをゴニョ…"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3032</span> </span><span class="WHIT">            </span><span class="NAME">nas.otome.clipCell</span><span class="PUNC">(</span><span class="NAME">app.project.activeItem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3033</span> </span><span class="WHIT">            </span><span class="NAME">nas.otome.smoothCell</span><span class="PUNC">(</span><span class="NAME">app.project.activeItem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3034</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3035</span> </span><span class="WHIT">        </span><span class="KEYW">default</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3036</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3037</span> </span><span class="WHIT">    </span><span class="NAME">this.endUndoGroup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3038</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3039</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3040</span> 
<span class='line'>3041</span> </span><span class="COMM">/**
<span class='line'>3042</span>  * ファイル名を与えてシステムで実行
<span class='line'>3043</span>  * @param targetFileName
<span class='line'>3044</span>  * @returns {boolean}
<span class='line'>3045</span>  */</span><span class="WHIT">
<span class='line'>3046</span> </span><span class="NAME">nas.otome.systemOpen</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetFileName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3047</span> </span><span class="COMM">//	if(!targetFileName.toString()){return false;};</span><span class="WHIT">
<span class='line'>3048</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">File</span><span class="PUNC">(</span><span class="NAME">targetFileName</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">exists</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3049</span> </span><span class="WHIT">        </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3050</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">File</span><span class="PUNC">(</span><span class="NAME">targetFileName</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">alias</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3051</span> </span><span class="WHIT">                </span><span class="NAME">File</span><span class="PUNC">(</span><span class="NAME">targetFileName</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">resolve</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">execute</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3052</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3053</span> </span><span class="WHIT">                </span><span class="NAME">File</span><span class="PUNC">(</span><span class="NAME">targetFileName</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">execute</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3054</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3055</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3056</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">err</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3057</span> </span><span class="WHIT">            </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"OH NO ERROR"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3058</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3059</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3060</span> </span><span class="WHIT">        </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"no file exists"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3061</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3062</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3063</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3064</span> 
<span class='line'>3065</span> </span><span class="COMM">/**
<span class='line'>3066</span>  * システム実行を使って指定のURLを開く アドレスの存在チェックはしてない
<span class='line'>3067</span>  * @param targetURI
<span class='line'>3068</span>  */</span><span class="WHIT">
<span class='line'>3069</span> </span><span class="NAME">nas.otome.uriOpen</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetURI</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3070</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">TempFile</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">File</span><span class="PUNC">(</span><span class="NAME">Folder.temp.fullName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"/__nasTemp.html"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3071</span> </span><span class="COMM">//	if(TempFile.exists){alert("HEAR!")}else{alert(TempFile.name)};</span><span class="WHIT">
<span class='line'>3072</span> 
<span class='line'>3073</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"&lt;html>&lt;head>&lt;script language=javascript>"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3074</span> </span><span class="WHIT">    </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"location.href=\""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">targetURI</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3075</span> </span><span class="WHIT">    </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"&lt;/script>&lt;/haed>&lt;body>&lt;/body>&lt;/html>"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3076</span> 
<span class='line'>3077</span> </span><span class="WHIT">    </span><span class="NAME">TempFile.open</span><span class="PUNC">(</span><span class="STRN">"w"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3078</span> </span><span class="WHIT">    </span><span class="NAME">TempFile.write</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3079</span> </span><span class="WHIT">    </span><span class="NAME">TempFile.close</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3080</span> </span><span class="COMM">//		File(TempFile.fsName).execute();</span><span class="WHIT">
<span class='line'>3081</span> </span><span class="WHIT">    </span><span class="NAME">TempFile.execute</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3082</span> </span><span class="WHIT">    </span><span class="NAME">TempFile.remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3083</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3084</span> 
<span class='line'>3085</span> </span><span class="COMM">/**
<span class='line'>3086</span>  * おまけコマンド バージョン表示
<span class='line'>3087</span>  * @returns {boolean}
<span class='line'>3088</span>  */</span><span class="WHIT">
<span class='line'>3089</span> </span><span class="NAME">nas.otome.versionView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3090</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myVersions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3091</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myVersioncount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3092</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">item</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">nas.Version</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3093</span> </span><span class="WHIT">        </span><span class="NAME">myVersions</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.Version</span><span class="PUNC">[</span><span class="NAME">item</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nas.GUI.LineFeed</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3094</span> </span><span class="WHIT">        </span><span class="NAME">myVersioncount</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3095</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3096</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"「レンダー乙女」 Ver."</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nas.otomeVersion</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3097</span> </span><span class="WHIT">    </span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\nAdobeAE用 ねこまたや「お道具箱」\n\n"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3098</span> </span><span class="WHIT">    </span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"現在オンメモリのモジュール一覧 :\n"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3099</span> </span><span class="WHIT">    </span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"=============================\n"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3100</span> </span><span class="WHIT">    </span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myVersions.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3101</span> </span><span class="WHIT">    </span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"=============================\n"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3102</span> </span><span class="WHIT">    </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3103</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3104</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3105</span> 
<span class='line'>3106</span> </span><span class="COMM">/**
<span class='line'>3107</span>  * nas.otome.loadXPS(targetFile)
<span class='line'>3108</span>  * 引数:    File ターゲットのファイルオブジェクト
<span class='line'>3109</span>  * 戻値:    読み込み(またはアップデート)成功したXPSオブジェクトのインデックス(=LayerID) または false
<span class='line'>3110</span>  *
<span class='line'>3111</span>  * 与えられたXPSファイルを読み出して、Root/[footages]/_etc/[timeSheetBinder]　コンポへ登録する
<span class='line'>3112</span>  * プロジェクト内では所定のコンポ内へテキストレイヤのソーステキストとして保存する
<span class='line'>3113</span>  * テキストレイヤのコメントデータとして、
<span class='line'>3114</span>  * オリジナルファイルのサイズ
<span class='line'>3115</span>  * オリジナルファイルのパス
<span class='line'>3116</span>  * 最終更新日付
<span class='line'>3117</span>  * を維持して、いずれかが変更されたとき　内容変更の確認が可能なようにしておく
<span class='line'>3118</span>  * ファイルがすでに読み込まれていて、かつ変更されていない場合は読み込みをスキップする
<span class='line'>3119</span>  *
<span class='line'>3120</span>  * 新メソッドでは、ビルドに先立ってXpsオブジェクトが必要なのでMAPビルドに先行して何らかのXPSを初期化する必要がある
<span class='line'>3121</span>  * 読み込んだだけではデフォルトのXPSバッファが初期化されないので、この関数のあとに初期化が必要
<span class='line'>3122</span>  *
<span class='line'>3123</span>  * @param targetFile
<span class='line'>3124</span>  * @returns {*}
<span class='line'>3125</span>  */</span><span class="WHIT">
<span class='line'>3126</span> </span><span class="NAME">nas.otome.loadXPS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetFile</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3127</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.XPSStore.getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3128</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3129</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3130</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3131</span>      * 環境ができていないときは実行しない
<span class='line'>3132</span>      * ファイル識別して分岐
<span class='line'>3133</span>      */</span><span class="WHIT">
<span class='line'>3134</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myOpenfile</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">File</span><span class="PUNC">(</span><span class="NAME">targetFile.fsName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3135</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myFileExt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myOpenfile.name.replace</span><span class="PUNC">(</span><span class="REGX">/^.*\.([^\.]+)$/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"$1"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//拡張子を抜き出す</span><span class="WHIT">
<span class='line'>3136</span> </span><span class="WHIT">    </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myFileExt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3137</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"sts"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3138</span> </span><span class="WHIT">            </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">STS2XPS</span><span class="PUNC">(</span><span class="NAME">myOpenfile</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/(\r\n?|\n)/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3139</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3140</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"ard"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3141</span> </span><span class="WHIT">            </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">AER2XPS</span><span class="PUNC">(</span><span class="NAME">myOpenfile</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/(\r\n?|\n)/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3142</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3143</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"tsh"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3144</span> </span><span class="WHIT">            </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">TSH2XPS</span><span class="PUNC">(</span><span class="NAME">myOpenfile</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/(\r\n?|\n)/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3145</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3146</span> </span><span class="WHIT">        </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3147</span> </span><span class="WHIT">            </span><span class="NAME">myOpenfile.encoding</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"UTF8"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3148</span> </span><span class="WHIT">            </span><span class="NAME">myOpenfile.open</span><span class="PUNC">(</span><span class="STRN">"r"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3149</span> </span><span class="WHIT">            </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myOpenfile.read</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3150</span> </span><span class="WHIT">            </span><span class="NAME">myOpenfile.close</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3151</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3152</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3153</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myXPS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Xps</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3154</span> </span><span class="WHIT">        </span><span class="NAME">myXPS.readIN</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//ローカルにXPSオブジェク形成</span><span class="WHIT">
<span class='line'>3155</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3156</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3157</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3158</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3159</span>      * シートバインダがすでにあるか検査
<span class='line'>3160</span>      */</span><span class="WHIT">
<span class='line'>3161</span> </span><span class="WHIT">    </span><span class="COMM">//if(isNaN(nas.XPSStore.getLength())){return false};//環境なければ失敗</span><span class="WHIT">
<span class='line'>3162</span> 
<span class='line'>3163</span> </span><span class="COMM">//	var myXpsStore=nas.XPSStore.body;//暫定　あとで差し替え</span><span class="WHIT">
<span class='line'>3164</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">fIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">nas.XPSStore.getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">fIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3165</span> </span><span class="WHIT">        </span><span class="COMM">//現在のシートから情報オブジェクト取得</span><span class="WHIT">
<span class='line'>3166</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myCheck</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.XPSStore.getInfo</span><span class="PUNC">(</span><span class="NAME">fIdx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3167</span> </span><span class="WHIT">        </span><span class="COMM">//一致するソースファイル名ならアップデートモード</span><span class="WHIT">
<span class='line'>3168</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myCheck.name</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">targetFile.name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3169</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>3170</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="NAME">myCheck.modified</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">targetFile.modified.toNASString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>3171</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="NAME">myCheck.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">targetFile.length</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3172</span> </span><span class="WHIT">            </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3173</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>3174</span>                  * ファイル一致でかつ変更なしなのでスキップ
<span class='line'>3175</span>                  */</span><span class="WHIT">
<span class='line'>3176</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3177</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3178</span> </span><span class="WHIT">                </span><span class="NAME">this.beginUndoGroup</span><span class="PUNC">(</span><span class="STRN">"update XPS ["</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fIdx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"]"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3179</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>3180</span>                  * ファイル一致で変更ありなのでアップデート
<span class='line'>3181</span>                  * pushメソッドはバッファからのアップデートなのでこれではまずい
<span class='line'>3182</span>                  */</span><span class="WHIT">
<span class='line'>3183</span> </span><span class="COMM">//				nas.XPSStore.set(fIdx+1,myXps);</span><span class="WHIT">
<span class='line'>3184</span> </span><span class="WHIT">                </span><span class="NAME">nas.XPSStore.set</span><span class="PUNC">(</span><span class="NAME">fIdx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myXPS</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3185</span> </span><span class="WHIT">                </span><span class="NAME">nas.XPSStore.setInfo</span><span class="PUNC">(</span><span class="NAME">fIdx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetFile</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3186</span> </span><span class="WHIT">                </span><span class="NAME">this.endUndoGroup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3187</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">fIdx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3188</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3189</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3190</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3191</span>          * シートはあるがファイル一致しないのでスキップ
<span class='line'>3192</span>          */</span><span class="WHIT">
<span class='line'>3193</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3194</span> </span><span class="COMM">//=============既存シートの検査</span><span class="WHIT">
<span class='line'>3195</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3196</span>      * 既存のシートが存在しないので、新規にシートを作成して終了
<span class='line'>3197</span>      */</span><span class="WHIT">
<span class='line'>3198</span> </span><span class="WHIT">    </span><span class="NAME">this.beginUndoGroup</span><span class="PUNC">(</span><span class="STRN">"load New XPS ["</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.XPSStore.getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"]"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3199</span> </span><span class="COMM">//	var myNewTimeSheet=myXpsStore.layers.addText(new TextDocument(myXPS.toString().replace(/\n/g,"\\r\\n")));//これは等価のメソッドと置き換え</span><span class="WHIT">
<span class='line'>3200</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myNewTimeSheet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.XPSStore.add</span><span class="PUNC">(</span><span class="NAME">myXPS</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3201</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myNewTimeSheet</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3202</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3203</span>          * オブジェクトを直接addした場合は情報セットが抜けるので設定必要
<span class='line'>3204</span>          * @type {*}
<span class='line'>3205</span>          */</span><span class="WHIT">
<span class='line'>3206</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myProp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.XPSStore.setInfo</span><span class="PUNC">(</span><span class="NAME">myNewTimeSheet.index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetFile</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3207</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3208</span>          * レイヤ名を識別子で置き換え
<span class='line'>3209</span>          */</span><span class="WHIT">
<span class='line'>3210</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myProp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3211</span> </span><span class="WHIT">            </span><span class="NAME">nas.otome.writeConsole</span><span class="PUNC">(</span><span class="STRN">"NewTimeSheetEntry to sheetBinder"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">targetFile.name</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3212</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3213</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3214</span> </span><span class="WHIT">    </span><span class="NAME">this.endUndoGroup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3215</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myNewTimeSheet</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3216</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myNewTimeSheet.index</span><span class="WHIT">
<span class='line'>3217</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3218</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>3219</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3220</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3221</span> </span><span class="COMM">/**
<span class='line'>3222</span>  * @desc end  loadXPS()
<span class='line'>3223</span>  */</span><span class="WHIT">
<span class='line'>3224</span> 
<span class='line'>3225</span> </span><span class="COMM">/**
<span class='line'>3226</span>  * nas.otome.getXPSheets(Folder)
<span class='line'>3227</span>  * 引数　:Folder　検索の基点フォルダ
<span class='line'>3228</span>  * 戻値    :読み込んだシートの数
<span class='line'>3229</span>  *
<span class='line'>3230</span>  * 与えられたフォルダを基点として再帰検索を行い発見したタイムシートをプロジェクトに取り込む
<span class='line'>3231</span>  * すでにプロジェクト内にあるシート、現在のシートと異なっている場合のみ上書きで読み込む。
<span class='line'>3232</span>  * @param myFolder
<span class='line'>3233</span>  * @returns {*}
<span class='line'>3234</span>  */</span><span class="WHIT">
<span class='line'>3235</span> </span><span class="NAME">nas.otome.getXPSheets</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myFolder</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3236</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myFolder</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">myFolder</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Folder</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3237</span> </span><span class="WHIT">        </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"フォルダを指定してください。"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3238</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="COMM">//空指定は不可</span><span class="WHIT">
<span class='line'>3239</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3240</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myFolder.exists</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3241</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">doCounts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3242</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myContentItems</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myFolder.getFiles</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3243</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">iIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">iIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myContentItems.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">iIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3244</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>3245</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="NAME">myContentItems</span><span class="PUNC">[</span><span class="NAME">iIdx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">File</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>3246</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="NAME">myContentItems</span><span class="PUNC">[</span><span class="NAME">iIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name.match</span><span class="PUNC">(</span><span class="NAME">nas.xpSheetRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3247</span> </span><span class="WHIT">            </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3248</span> </span><span class="WHIT">                </span><span class="COMM">// alert("loading :"+myContentItems[iIdx].name)</span><span class="WHIT">
<span class='line'>3249</span> </span><span class="WHIT">                </span><span class="NAME">this.loadXPS</span><span class="PUNC">(</span><span class="NAME">myContentItems</span><span class="PUNC">[</span><span class="NAME">iIdx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3250</span> </span><span class="WHIT">                </span><span class="NAME">doCounts</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3251</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3252</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myContentItems</span><span class="PUNC">[</span><span class="NAME">iIdx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Folder</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3253</span> </span><span class="WHIT">                    </span><span class="NAME">doCounts</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.getXPSheets</span><span class="PUNC">(</span><span class="NAME">myContentItems</span><span class="PUNC">[</span><span class="NAME">iIdx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3254</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3255</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3256</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3257</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3258</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3259</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3260</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">doCounts</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3261</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3262</span> </span><span class="COMM">/**
<span class='line'>3263</span>  * end getXPSheets()
<span class='line'>3264</span>  */</span><span class="WHIT">
<span class='line'>3265</span> 
<span class='line'>3266</span> 
<span class='line'>3267</span> </span><span class="COMM">/**
<span class='line'>3268</span>  * nas.otome.reOrderCell(Comp)
<span class='line'>3269</span>  * 引数　:コンポアイテム
<span class='line'>3270</span>  * 戻値    :なし
<span class='line'>3271</span>  * レイヤをセル順に並び替える暫定版
<span class='line'>3272</span>  * レイヤ名がフッテージソース名だったらそれっぽい並べ替え用文字列を作る
<span class='line'>3273</span>  * 現在シート参照部分なし
<span class='line'>3274</span>  * @param myComp
<span class='line'>3275</span>  */</span><span class="WHIT">
<span class='line'>3276</span> </span><span class="NAME">nas.otome.reOrderCell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myComp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3277</span> </span><span class="WHIT">    </span><span class="NAME">myOrderList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">myComp.layers.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3278</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myComp.layers.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3279</span> </span><span class="WHIT">        </span><span class="NAME">myOrderList</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3280</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3281</span>          * ファイル名から並べ替え用の名前をつける
<span class='line'>3282</span>          * セルっぽい名前の場合はラベルっぽい部分を抽出
<span class='line'>3283</span>          * if (myComp.layer(n+1).source.file.fsName.match(/[\-\_\/\\]([^\-\_\/\\]+[\-\_\/\\]?[0-9]+)\.(tga|tiff?|psd|png|gif|jpg|eps|sgi|bmp)$/i)){
<span class='line'>3284</span>          * myOrderList[n]=RegExp.$1;
<span class='line'>3285</span>          * //	myComp.layer(n+1).name=RegExp.$1;//リネームしない
<span class='line'>3286</span>          * }else{
<span class='line'>3287</span>          * if(myComp.layer(n+1).source.file.fsName.match(/^.*[\-\_\/\\]([^\-\_\/\\]+)\.(mov|avi|gif|mpg)$/i)){
<span class='line'>3288</span>          * myOrderList[n]=RegExp.$1;
<span class='line'>3289</span>          * //		myComp.layer(n+1).name=
<span class='line'>3290</span>          * }else{
<span class='line'>3291</span>          * myOrderList[n]=myComp.layer(n+1).name.toString()
<span class='line'>3292</span>          * }
<span class='line'>3293</span>          * }
<span class='line'>3294</span>          */</span><span class="WHIT">
<span class='line'>3295</span> </span><span class="WHIT">        </span><span class="NAME">myOrderList</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myComp.layer</span><span class="PUNC">(</span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">source.name.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3296</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3297</span>          * 元アイテムのidを控える
<span class='line'>3298</span>          * @type {string}
<span class='line'>3299</span>          */</span><span class="WHIT">
<span class='line'>3300</span> </span><span class="WHIT">        </span><span class="NAME">myOrderList</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\/"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myComp.layer</span><span class="PUNC">(</span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">source.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3301</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3302</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3303</span>      * sortする
<span class='line'>3304</span>      * @type {Array.&lt;T>}
<span class='line'>3305</span>      */</span><span class="WHIT">
<span class='line'>3306</span> </span><span class="WHIT">    </span><span class="NAME">myOrderList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myOrderList.sort</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3307</span> </span><span class="WHIT">    </span><span class="NAME">myBGList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3308</span> </span><span class="WHIT">    </span><span class="NAME">myMGList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3309</span> </span><span class="WHIT">    </span><span class="NAME">myFGList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3310</span> </span><span class="WHIT">    </span><span class="NAME">myLOList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3311</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myOrderList.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3312</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3313</span>          * 背景を抜き出し
<span class='line'>3314</span>          */</span><span class="WHIT">
<span class='line'>3315</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myOrderList</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="NAME">nas.bgRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3316</span> </span><span class="WHIT">            </span><span class="NAME">myBGList.push</span><span class="PUNC">(</span><span class="NAME">myOrderList</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3317</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3318</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>3319</span>              * Bookを抜き出し
<span class='line'>3320</span>              */</span><span class="WHIT">
<span class='line'>3321</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myOrderList</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="NAME">nas.mgRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3322</span> </span><span class="WHIT">                </span><span class="NAME">myFGList.push</span><span class="PUNC">(</span><span class="NAME">myOrderList</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3323</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3324</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>3325</span>                  * L/Oを抜き出し
<span class='line'>3326</span>                  */</span><span class="WHIT">
<span class='line'>3327</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myOrderList</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="NAME">nas.loRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3328</span> </span><span class="WHIT">                    </span><span class="NAME">myLOList.push</span><span class="PUNC">(</span><span class="NAME">myOrderList</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3329</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3330</span> </span><span class="WHIT">                    </span><span class="COMM">/**
<span class='line'>3331</span>                      * それ以外はセル
<span class='line'>3332</span>                      */</span><span class="WHIT">
<span class='line'>3333</span> </span><span class="WHIT">                    </span><span class="NAME">myMGList.push</span><span class="PUNC">(</span><span class="NAME">myOrderList</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3334</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3335</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3336</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3337</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3338</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3339</span>      * 連結
<span class='line'>3340</span>      * @type {Array.&lt;*>}
<span class='line'>3341</span>      */</span><span class="WHIT">
<span class='line'>3342</span> </span><span class="WHIT">    </span><span class="NAME">myOrderList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myBGList.concat</span><span class="PUNC">(</span><span class="NAME">myMGList</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">concat</span><span class="PUNC">(</span><span class="NAME">myFGList</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">concat</span><span class="PUNC">(</span><span class="NAME">myLOList</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3343</span> 
<span class='line'>3344</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3345</span>      * レイヤ並び替え
<span class='line'>3346</span>      * @type {number}
<span class='line'>3347</span>      */</span><span class="WHIT">
<span class='line'>3348</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">searchCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3349</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myOrderList.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3350</span> </span><span class="WHIT">        </span><span class="NAME">myId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myOrderList</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">"\/"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3351</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3352</span>          * id検索して並べ替え
<span class='line'>3353</span>          */</span><span class="WHIT">
<span class='line'>3354</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">searchCount</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">myOrderList.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3355</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myComp.layer</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">source.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">myId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3356</span> </span><span class="WHIT">                </span><span class="NAME">searchCount</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3357</span> </span><span class="WHIT">                </span><span class="NAME">myComp.layer</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">moveToBeginning</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3358</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3359</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3360</span> 
<span class='line'>3361</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3362</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3363</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3364</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3365</span> </span><span class="COMM">/**
<span class='line'>3366</span>  * コンポ内のセルをそれらしいレイヤ名に変更する
<span class='line'>3367</span>  * @param myComp
<span class='line'>3368</span>  */</span><span class="WHIT">
<span class='line'>3369</span> </span><span class="NAME">nas.otome.reNameCell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myComp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3370</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">myComp.layers.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3371</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myComp.layer</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">myComp.layer</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">source.name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3372</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>3373</span>              * レイヤソース名からそれっぽい名前をつける
<span class='line'>3374</span>              * セルっぽい名前の場合はセル名っぽい名前
<span class='line'>3375</span>              */</span><span class="WHIT">
<span class='line'>3376</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myComp.layer</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">source.mainSource</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FileSource</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">myComp.layer</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">source.mainSource.file.name.match</span><span class="PUNC">(</span><span class="REGX">/^\d+\..+$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3377</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>3378</span>                  * 連番が数値のみの場合はひとつ上のフォルダ名を使う
<span class='line'>3379</span>                  */</span><span class="WHIT">
<span class='line'>3380</span> </span><span class="WHIT">                </span><span class="NAME">myComp.layer</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Folder</span><span class="PUNC">(</span><span class="NAME">myComp.layer</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">source.mainSource.file.path</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3381</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3382</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myComp.layer</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">source.name.match</span><span class="PUNC">(</span><span class="NAME">nas.cellRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3383</span> </span><span class="WHIT">                    </span><span class="COMM">/**
<span class='line'>3384</span>                      * シーケンス リネーム
<span class='line'>3385</span>                      * @type {string}
<span class='line'>3386</span>                      */</span><span class="WHIT">
<span class='line'>3387</span> </span><span class="WHIT">                    </span><span class="NAME">myComp.layer</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3388</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3389</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myComp.layer</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">source.name.match</span><span class="PUNC">(</span><span class="REGX">/^(.*)\..+?$/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3390</span> </span><span class="WHIT">                        </span><span class="COMM">/**
<span class='line'>3391</span>                          * 拡張子を払う
<span class='line'>3392</span>                          * @type {string}
<span class='line'>3393</span>                          */</span><span class="WHIT">
<span class='line'>3394</span> </span><span class="WHIT">                        </span><span class="NAME">myComp.layer</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3395</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3396</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3397</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3398</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3399</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3400</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3401</span> </span><span class="COMM">/**
<span class='line'>3402</span>  * @param myTarget
<span class='line'>3403</span>  * @returns {boolean}
<span class='line'>3404</span>  */</span><span class="WHIT">
<span class='line'>3405</span> </span><span class="NAME">nas.otome.clipCell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myTarget</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3406</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myTarget</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">CompItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3407</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">lIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">myTarget.layers.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">lIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3408</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myTarget.layers</span><span class="PUNC">[</span><span class="NAME">lIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">selected</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myTarget.layers</span><span class="PUNC">[</span><span class="NAME">lIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">source.mainSource</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FileSource</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3409</span> </span><span class="WHIT">                </span><span class="NAME">this.clipCell</span><span class="PUNC">(</span><span class="NAME">myTarget.layers</span><span class="PUNC">[</span><span class="NAME">lIdx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3410</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3411</span> 
<span class='line'>3412</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3413</span> </span><span class="WHIT">            </span><span class="COMM">/*
<span class='line'>3414</span>              for(n=0;n&lt;myComp.selectedLayers.length;n++)
<span class='line'>3415</span>              {	};//選択レイヤループ
<span class='line'>3416</span>              //	レイヤソースがプリコンポなら無条件処理
<span class='line'>3417</span>              if(!(myLayers.source instanceof CompItem)){	}
<span class='line'>3418</span>              //	平面なら無条件でスキップ
<span class='line'>3419</span>              if(myLayers.source.mainSource instanceof SolidSource){continue;}
<span class='line'>3420</span>              //	ファイルソースの場合、ソースファイルの名前を確認
<span class='line'>3421</span>              if (
<span class='line'>3422</span>              (myComp.selectedLayers[n].source.name.match(nas.loRegex)) ||
<span class='line'>3423</span>              (myComp.selectedLayers[n].source.name.match(nas.mgRegex)) ||
<span class='line'>3424</span>              (myComp.selectedLayers[n].source.name.match(nas.bgRegex))
<span class='line'>3425</span>              ){		continue;	}
<span class='line'>3426</span>              //セルらしいので、処理する(すごく狭い。なんかあとで考える)
<span class='line'>3427</span>              */</span><span class="WHIT">
<span class='line'>3428</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3429</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3430</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3431</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3432</span>      * 指定(選択)アイテムのみ処理する仕様に変更 2006/10/17
<span class='line'>3433</span>      * 引数をレイヤに変更　レイヤのメソッドのほうが良いかも　2009・09・30
<span class='line'>3434</span>      */</span><span class="WHIT">
<span class='line'>3435</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">myTarget</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">AVLayer</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3436</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>3437</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3438</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myTarget</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3439</span> 
<span class='line'>3440</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3441</span>      * アルファチャンネルがなければ白透過(カラーキー)
<span class='line'>3442</span>      */</span><span class="WHIT">
<span class='line'>3443</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>3444</span> </span><span class="WHIT">        </span><span class="PUNC">(</span><span class="NAME">nas.goClip</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>3445</span> </span><span class="WHIT">        </span><span class="PUNC">(</span><span class="NAME">myLayer.source</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FootageItem</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3446</span> </span><span class="WHIT">    </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3447</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myLayer.source.mainSource.hasAlpha</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.killAlpha</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3448</span> </span><span class="WHIT">            </span><span class="NAME">myLayer.source.mainSource.alphaMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">AlphaMode.IGUNORE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3449</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3450</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myLayer.property</span><span class="PUNC">(</span><span class="STRN">"ADBE Effect Parade"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="STRN">"clipWhite"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3451</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clipTimeLine</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myLayer.property</span><span class="PUNC">(</span><span class="STRN">"ADBE Effect Parade"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addProperty</span><span class="PUNC">(</span><span class="STRN">"ADBE Linear Color Key2"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3452</span> </span><span class="WHIT">            </span><span class="NAME">clipTimeLine.name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"clipWhite"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3453</span> </span><span class="WHIT">            </span><span class="NAME">clipTimeLine</span><span class="PUNC">(</span><span class="STRN">"ADBE Linear Color Key2-0003"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">expression</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"//--otome clipWhite--\n[1,1,1,1];"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3454</span> </span><span class="WHIT">            </span><span class="NAME">clipTimeLine</span><span class="PUNC">(</span><span class="STRN">"ADBE Linear Color Key2-0003"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">expressionEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3455</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3456</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3457</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3458</span> 
<span class='line'>3459</span> </span><span class="COMM">/**
<span class='line'>3460</span>  * ターゲットにスムージングフィルタをかける
<span class='line'>3461</span>  * ターゲットがコンポの場合はスムーズレイヤを作成
<span class='line'>3462</span>  * レイヤの場合は、スムーズエフェクトを適用する。
<span class='line'>3463</span>  * @param myComp
<span class='line'>3464</span>  */</span><span class="WHIT">
<span class='line'>3465</span> </span><span class="NAME">nas.otome.smoothCell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myComp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3466</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">nas.goSmooth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3467</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3468</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3469</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myClipEffects</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3470</span> </span><span class="WHIT">        </span><span class="NAME">myClipEffects.name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.cellOptions.selectedRecord</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3471</span> </span><span class="WHIT">        </span><span class="NAME">myClipEffects.effects</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.cellOptions.selectedRecord</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3472</span> </span><span class="WHIT">        </span><span class="NAME">myClipEffects.timeline</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.cellOptions.selectedRecord</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3473</span> </span><span class="WHIT">        </span><span class="NAME">myClipEffects.params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.cellOptions.selectedRecord</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3474</span> 
<span class='line'>3475</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3476</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myComp.selectedLayers.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3477</span> 
<span class='line'>3478</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>3479</span>                  * セルのスムージングをかける。すでに処理済みならスキップ。でも決め打ち
<span class='line'>3480</span>                  * 作業パタン上スムージングをかけるタイミングを変更するので別メソッドにしてコールする形に変更 2007/11/07
<span class='line'>3481</span>                  */</span><span class="WHIT">
<span class='line'>3482</span> 
<span class='line'>3483</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>3484</span> </span><span class="WHIT">                    </span><span class="PUNC">(</span><span class="NAME">myComp.selectedLayers</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="STRN">"ADBE Effect Parade"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="STRN">"kp-smooth"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>3485</span> </span><span class="WHIT">                    </span><span class="PUNC">(</span><span class="NAME">myComp.selectedLayers</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="STRN">"ADBE Effect Parade"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="STRN">"KP AntiAliasing"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>3486</span> </span><span class="WHIT">                    </span><span class="PUNC">(</span><span class="NAME">myComp.selectedLayers</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="STRN">"ADBE Effect Parade"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="STRN">"OLM Smoother"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3487</span> </span><span class="WHIT">                </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3488</span> </span><span class="WHIT">                    </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="NAME">myComp.selectedLayers</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" は、すでに処理済みたい"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3489</span> </span><span class="WHIT">                    </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3490</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3491</span> 
<span class='line'>3492</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">smoothEffect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myComp.selectedLayers</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="STRN">"ADBE Effect Parade"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addProperty</span><span class="PUNC">(</span><span class="NAME">myClipEffects.effects</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3493</span> </span><span class="WHIT">                </span><span class="NAME">smoothEffect.name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myClipEffects.name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3494</span> </span><span class="WHIT">                </span><span class="NAME">smoothEffect</span><span class="PUNC">(</span><span class="NAME">myClipEffects.timeline</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">expression</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myClipEffects.params</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3495</span> 
<span class='line'>3496</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myClipEffects.effects</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"smooth"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.smoothClip</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3497</span> </span><span class="WHIT">                    </span><span class="NAME">smoothEffect</span><span class="PUNC">(</span><span class="STRN">"white option"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">expression</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\/\/\-\-otome\ cellClip\-\-\ntrue;"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3498</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3499</span> </span><span class="COMM">//	smoothEffect("range").expressionEnabled=false;</span><span class="WHIT">
<span class='line'>3500</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3501</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>3502</span>              * 選択レイヤループEND
<span class='line'>3503</span>              */</span><span class="WHIT">
<span class='line'>3504</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3505</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3506</span>          * 暫定Smoothレイヤ版
<span class='line'>3507</span>          */</span><span class="WHIT">
<span class='line'>3508</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myComp.layers.addSolid</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"SmoothingLayer"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myComp.width</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myComp.height</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myComp.pixelAspect</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3509</span> </span><span class="WHIT">        </span><span class="NAME">myLayer.adjustmentLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3510</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">smoothEffect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myLayer.property</span><span class="PUNC">(</span><span class="STRN">"ADBE Effect Parade"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addProperty</span><span class="PUNC">(</span><span class="NAME">myClipEffects.effects</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3511</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myClipEffects.effects</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"smooth"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.smoothClip</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3512</span> </span><span class="WHIT">            </span><span class="NAME">smoothEffect</span><span class="PUNC">(</span><span class="STRN">"use color key"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">expression</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\/\/\-\-otome\ cellClip\-\-\ntrue;"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3513</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3514</span> 
<span class='line'>3515</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3516</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3517</span> </span><span class="COMM">/**
<span class='line'>3518</span>  * レイアウトを設定されたモードに変更する
<span class='line'>3519</span>  * @param myComp
<span class='line'>3520</span>  */</span><span class="WHIT">
<span class='line'>3521</span> </span><span class="NAME">nas.otome.reViewLayout</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myComp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3522</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">myComp.layers.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3523</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3524</span>          * Book/LOを抜き出し
<span class='line'>3525</span>          */</span><span class="WHIT">
<span class='line'>3526</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myComp.layer</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">source.name.match</span><span class="PUNC">(</span><span class="NAME">nas.loRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3527</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myComp.layer</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">guideLayer</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">nas.viewLayout.guideLayer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3528</span> </span><span class="WHIT">                </span><span class="NAME">myComp.layer</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">guideLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.viewLayout.guideLayer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3529</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3530</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myComp.layer</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">blendingMode</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">nas.viewLayout.MODE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3531</span> </span><span class="WHIT">                </span><span class="NAME">myComp.layer</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">blendingMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.viewLayout.MODE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3532</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3533</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myComp.layer</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="STRN">"ADBE Opacity"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">nas.viewLayout.RATIO</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3534</span> </span><span class="WHIT">                </span><span class="NAME">myComp.layer</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="STRN">"ADBE Opacity"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">setValue</span><span class="PUNC">(</span><span class="NAME">nas.viewLayout.RATIO</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3535</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3536</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myComp.layer</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">enabled</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">nas.viewLayout.visible</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3537</span> </span><span class="WHIT">                </span><span class="NAME">myComp.layer</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">enabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.viewLayout.visible</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3538</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3539</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3540</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3541</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3542</span> 
<span class='line'>3543</span> </span><span class="COMM">/**
<span class='line'>3544</span>  * nas.otome.isPsdFolder(myFolder,mySource)
<span class='line'>3545</span>  * 引数    myFolder    フォルダアイテム　mySource    チェックするpsdファイル
<span class='line'>3546</span>  * 戻値    フッテージソース　または　false
<span class='line'>3547</span>  * 引数のフォルダが特定のpsdファイルのフッテージフォルダか否かを判定する
<span class='line'>3548</span>  * ソースが省略された場合は最初にあたったファイルソースをあてるので省略可能
<span class='line'>3549</span>  * psd以外の判定はしないでfalseを戻す
<span class='line'>3550</span>  *
<span class='line'>3551</span>  * @param myFolder
<span class='line'>3552</span>  * @param mySource
<span class='line'>3553</span>  * @returns {boolean}
<span class='line'>3554</span>  */</span><span class="WHIT">
<span class='line'>3555</span> </span><span class="NAME">nas.otome.isPsdFolder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myFolder</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">mySource</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3556</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myFolder</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">myFolder</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FolderItem</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myFolder.items.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3557</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>3558</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3559</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mySources</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myFolder.getItemSources</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3560</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">mySource</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mySources.length</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3561</span> </span><span class="WHIT">        </span><span class="NAME">mySource</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mySources</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>3562</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3563</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3564</span>      * getItemSources()はfalseを戻すケースがあるので注意
<span class='line'>3565</span>      * @type {boolean}
<span class='line'>3566</span>      */</span><span class="WHIT">
<span class='line'>3567</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3568</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">mySource</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mySources.length</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3569</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mySource.name.match</span><span class="PUNC">(</span><span class="REGX">/.*\.psd/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3570</span> </span><span class="WHIT">            </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mySource</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3571</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">srcIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">srcIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">mySources.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">srcIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3572</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mySource.fsName</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">mySources</span><span class="PUNC">[</span><span class="NAME">srcIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fsName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3573</span> </span><span class="WHIT">                    </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3574</span> </span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3575</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3576</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3577</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3578</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3579</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3580</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3581</span> </span><span class="COMM">/**
<span class='line'>3582</span>  * 上記関数の拡張版シーケンスフォルダの判定を行なう。ソースの拡張子がpsd以外の場合でも判定を行い、シーケンスファイルの格納フォルダであれば、psdファイルと同等に扱う
<span class='line'>3583</span>  * 戻しのソースはシーケンスの起点ファイルをあてる
<span class='line'>3584</span>  * シーケンスとバラシーケンスの判定を行なうべきなので一応保留　このままでは特殊ケースでヘンな移動が発生しそう
<span class='line'>3585</span>  *
<span class='line'>3586</span>  * @param myFolder
<span class='line'>3587</span>  * @param mySource
<span class='line'>3588</span>  * @returns {boolean}
<span class='line'>3589</span>  */</span><span class="WHIT">
<span class='line'>3590</span> </span><span class="NAME">nas.otome.isXPsdFolder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myFolder</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">mySource</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3591</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myFolder</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">myFolder</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FolderItem</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myFolder.items.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3592</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>3593</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3594</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mySources</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myFolder.getItemSources</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3595</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">mySource</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mySources.length</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3596</span> </span><span class="WHIT">        </span><span class="NAME">mySource</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mySources</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>3597</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3598</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3599</span>      * getItemSources()はfalseを戻すケースがあるので注意
<span class='line'>3600</span>      * @type {boolean}
<span class='line'>3601</span>      */</span><span class="WHIT">
<span class='line'>3602</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3603</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">mySource</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mySources.length</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3604</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mySource.name.match</span><span class="PUNC">(</span><span class="REGX">/.*\.psd/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3605</span> </span><span class="WHIT">            </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mySource</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3606</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">srcIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">srcIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">mySources.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">srcIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3607</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mySource.fsName</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">mySources</span><span class="PUNC">[</span><span class="NAME">srcIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fsName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3608</span> </span><span class="WHIT">                    </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3609</span> </span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3610</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3611</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3612</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3613</span> </span><span class="COMM">//					myResult=isSequenceElements(mySource);</span><span class="WHIT">
<span class='line'>3614</span> </span><span class="WHIT">            </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mySource.isSequenceElements</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//シーケンス識別データを取得、ここでは厳密オプションを付ける</span><span class="WHIT">
<span class='line'>3615</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myResult</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3616</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">srcIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">srcIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">mySources.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">srcIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3617</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentEl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">isSequenceElements</span><span class="PUNC">(</span><span class="NAME">mySources</span><span class="PUNC">[</span><span class="NAME">srcIdx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3618</span> </span><span class="WHIT">                    </span><span class="COMM">/**
<span class='line'>3619</span>                      * シーケンスフォルダ判定条件　フォルダ名がシーケンスプレフィックスを「含んでいる」こと　エレメントがすべて同一のシーケンスであること
<span class='line'>3620</span>                      */</span><span class="WHIT">
<span class='line'>3621</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>3622</span> </span><span class="WHIT">                        </span><span class="PUNC">(</span><span class="NAME">myFolder.name.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="NAME">myResult.prefix.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>3623</span> </span><span class="WHIT">                        </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">currentEl</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>3624</span> </span><span class="WHIT">                        </span><span class="PUNC">(</span><span class="NAME">myResult.prefix</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">currentEl.prefix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>3625</span> </span><span class="WHIT">                        </span><span class="PUNC">(</span><span class="NAME">myResult.ext</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">currentEl.ext</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3626</span> </span><span class="WHIT">                    </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3627</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3628</span> </span><span class="WHIT">                        </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3629</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3630</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3631</span> </span><span class="WHIT">                </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mySource</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3632</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3633</span> </span><span class="WHIT">                </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3634</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3635</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3636</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3637</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3638</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3639</span> </span><span class="COMM">/**
<span class='line'>3640</span>  * nas.otome.isPsdComp(myComp,mySource)
<span class='line'>3641</span>  * 引数    myComp    コンポアイテム　mySource    チェックするpsdファイル
<span class='line'>3642</span>  * 戻値    フッテージソースのファイルオブジェクト
<span class='line'>3643</span>  * 内部のプリコンポを遡り引数のコンポが特定のpsdファイルのコンポか否かを判定する
<span class='line'>3644</span>  * ソースが省略された場合は最初にあたったファイルソースをあてるので省略可能
<span class='line'>3645</span>  * 他のフッテージを登録した時点で判定は外れ。 平面やヌルは判定外
<span class='line'>3646</span>  *
<span class='line'>3647</span>  * @param myComp
<span class='line'>3648</span>  * @param mySource
<span class='line'>3649</span>  * @returns {boolean}
<span class='line'>3650</span>  */</span><span class="WHIT">
<span class='line'>3651</span> </span><span class="NAME">nas.otome.isPsdComp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myComp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">mySource</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3652</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myComp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">myComp</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">CompItem</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myComp.layers.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3653</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>3654</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3655</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mySources</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myComp.getItemSources</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3656</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">mySource</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mySources.length</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3657</span> </span><span class="WHIT">        </span><span class="NAME">mySource</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mySources</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>3658</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3659</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3660</span>      * getItemSources()はfalseを戻すケースがあるので注意
<span class='line'>3661</span>      * @type {boolean}
<span class='line'>3662</span>      */</span><span class="WHIT">
<span class='line'>3663</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3664</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">mySource</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mySources.length</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3665</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mySource.name.match</span><span class="PUNC">(</span><span class="REGX">/.*\.psd/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3666</span> </span><span class="WHIT">            </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mySource</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3667</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">srcIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">srcIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">mySources.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">srcIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3668</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mySource.fsName</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">mySources</span><span class="PUNC">[</span><span class="NAME">srcIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fsName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3669</span> </span><span class="WHIT">                    </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3670</span> </span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3671</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3672</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3673</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3674</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3675</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3676</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3677</span> 
<span class='line'>3678</span> </span><span class="COMM">/**
<span class='line'>3679</span>  * nas.otome.guessFtgCtg(projectItem)
<span class='line'>3680</span>  * 引数　プロジェクトアイテム(CompItem or FolderItem)
<span class='line'>3681</span>  * 戻値    カテゴリID
<span class='line'>3682</span>  *
<span class='line'>3683</span>  * プロジェクトアイテムのフッテージカテゴリを推測するメソッド
<span class='line'>3684</span>  * 実質のカテゴリはファイルシステム内の位置(パス)で判別される
<span class='line'>3685</span>  * カテゴリには以下のものがある
<span class='line'>3686</span>  * false    一般のフォルダ、コンポ等のフッテージとして扱わないもの
<span class='line'>3687</span>  * コンポやフォルダのうち　ｐｓｄフォルダ・コンポは　フッテージに準ずる戻り値をもつ
<span class='line'>3688</span>  * (セル・背景・レイアウト)等の素材カテゴリ
<span class='line'>3689</span>  * そのときどきの登録次第で種別は変化する
<span class='line'>3690</span>  * nas.ftgFolders に情報を登録する
<span class='line'>3691</span>  * nas.ftgFoldersに登録されたシステムフォルダ（および同名フォルダ）は　ID=-1
<span class='line'>3692</span>  * 判別不明なフッテージに対しては ＩＤ=0 を返す
<span class='line'>3693</span>  *
<span class='line'>3694</span>  * 包括クラスのコンストラクタがないので乙女の関数で実装
<span class='line'>3695</span>  *
<span class='line'>3696</span>  * @param myItem
<span class='line'>3697</span>  * @returns {*}
<span class='line'>3698</span>  */</span><span class="WHIT">
<span class='line'>3699</span> </span><span class="NAME">nas.otome.guessFtgCtg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3700</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">checkFile</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3701</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myItem</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FolderItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3702</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myItem.name.match</span><span class="PUNC">(</span><span class="REGX">/^\[.+\]$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3703</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT">
<span class='line'>3704</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3705</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3706</span>          * システム除外
<span class='line'>3707</span>          */</span><span class="WHIT">
<span class='line'>3708</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">nas.ftgFolders.names</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3709</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myItem.name</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">nas.ftgFolders.names</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3710</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT">
<span class='line'>3711</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3712</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3713</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3714</span>          * システム除外
<span class='line'>3715</span>          * @type {boolean}
<span class='line'>3716</span>          */</span><span class="WHIT">
<span class='line'>3717</span> </span><span class="WHIT">        </span><span class="NAME">checkFile</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.otome.isXPsdFolder</span><span class="PUNC">(</span><span class="NAME">myItem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3718</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3719</span>          * ｐｓｄフォルダかシーケンスフォルダか判定してそれ以外の場合はfalse
<span class='line'>3720</span>          */</span><span class="WHIT">
<span class='line'>3721</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3722</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myItem</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">CompItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3723</span> </span><span class="WHIT">        </span><span class="NAME">checkFile</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.otome.isPsdComp</span><span class="PUNC">(</span><span class="NAME">myItem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3724</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3725</span>          * ｐｓｄコンポか否か判定してそれ以外の場合はfalse
<span class='line'>3726</span>          */</span><span class="WHIT">
<span class='line'>3727</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3728</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myItem</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FootageItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myItem.mainSource</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FileSource</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3729</span> </span><span class="WHIT">        </span><span class="NAME">checkFile</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myItem.mainSource.file</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3730</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3731</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">checkFile</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3732</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3733</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3734</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3735</span>      * カテゴリごとに順次検査して最初にマッチしたリザルトを戻す　最後までマッチしなければ　０
<span class='line'>3736</span>      * @type {Array.&lt;*>}
<span class='line'>3737</span>      */</span><span class="WHIT">
<span class='line'>3738</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">checkStringArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decodeURI</span><span class="PUNC">(</span><span class="NAME">checkFile.path</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">"/"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">reverse</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3739</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">stId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">stId</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">checkStringArray.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">stId</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3740</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ctIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ctIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">nas.ftgFolders.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ctIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3741</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">checkStringArray</span><span class="PUNC">[</span><span class="NAME">stId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^[a-z](go|ue|shita|un|over|\+*|\-*)?$/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3742</span> </span><span class="WHIT">                </span><span class="KEYW">continue</span><span class="WHIT">
<span class='line'>3743</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3744</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">checkStringArray</span><span class="PUNC">[</span><span class="NAME">stId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="NAME">nas.ftgFolders.cpRx</span><span class="PUNC">[</span><span class="NAME">ctIdx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3745</span> </span><span class="WHIT">                </span><span class="NAME">nas.otome.writeConsole</span><span class="PUNC">(</span><span class="NAME">checkStringArray</span><span class="PUNC">[</span><span class="NAME">stId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" ; "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nas.ftgFolders.names</span><span class="PUNC">[</span><span class="NAME">ctIdx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">":"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nas.ftgFolders.cpRx</span><span class="PUNC">[</span><span class="NAME">ctIdx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nas.GUI.LineFeed</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3746</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ctIdx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3747</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3748</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3749</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3750</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3751</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3752</span> 
<span class='line'>3753</span> </span><span class="COMM">///////////////////////////////////// nas.otome.guessFtgCtg()</span><span class="WHIT">
<span class='line'>3754</span> 
<span class='line'>3755</span> </span><span class="COMM">/**
<span class='line'>3756</span>  * nas.otome.getFootage(targetFolder)
<span class='line'>3757</span>  * このインポート関数はもともとスマートインポータだったものですが、もう
<span class='line'>3758</span>  * なんか別物? でもリダクションしたい 2006/01/22 kiyo
<span class='line'>3759</span>  * 
<span class='line'>3760</span>  * @param targetFolder
<span class='line'>3761</span>  * @returns {*}
<span class='line'>3762</span>  */</span><span class="WHIT">
<span class='line'>3763</span> </span><span class="NAME">nas.otome.getFootage</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetFolder</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3764</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">targetFolder</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3765</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3766</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3767</span> </span><span class="WHIT">    </span><span class="NAME">nas.GUI.currentFolder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">targetFolder</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3768</span> </span><span class="WHIT">    </span><span class="NAME">Folder.current</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.GUI.prevCurrentFolder</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3769</span> 
<span class='line'>3770</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myImportCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3771</span> 
<span class='line'>3772</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3773</span>      * プロジェクトがなければ、ファイルを登録するプロジェクトを新規作成する。 [23839]
<span class='line'>3774</span>      */</span><span class="WHIT">
<span class='line'>3775</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">app.project</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3776</span> </span><span class="WHIT">        </span><span class="NAME">app.newProject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3777</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3778</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3779</span>      * undoブロック開始
<span class='line'>3780</span>      */</span><span class="WHIT">
<span class='line'>3781</span> </span><span class="WHIT">    </span><span class="NAME">this.beginUndoGroup</span><span class="PUNC">(</span><span class="STRN">"フッテージインポート"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3782</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3783</span>      * ファイル処理
<span class='line'>3784</span>      * 引数のファイルをインポートする(トライでエラートラップをかけて処理が止まらないようにしているみたいだ。)
<span class='line'>3785</span>      * @param theFile
<span class='line'>3786</span>      */</span><span class="WHIT">
<span class='line'>3787</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">processFile</span><span class="PUNC">(</span><span class="NAME">theFile</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3788</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3789</span>          * トライだけだと(開発中)危ないので、ここで制限を一度かける
<span class='line'>3790</span>          */</span><span class="WHIT">
<span class='line'>3791</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">theFile.name.match</span><span class="PUNC">(</span><span class="NAME">nas.importFilter</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3792</span> </span><span class="WHIT">            </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3793</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">importOptions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ImportOptions</span><span class="PUNC">(</span><span class="NAME">theFile</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3794</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>3795</span>                  * ImportOptionsオブジェクト"importOptions"を作る
<span class='line'>3796</span>                  */</span><span class="WHIT">
<span class='line'>3797</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">theFile.name.match</span><span class="PUNC">(</span><span class="REGX">/\.psd$/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3798</span> </span><span class="WHIT">                    </span><span class="NAME">importOptions.importAs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ImportAsType.COMP</span><span class="WHIT">
<span class='line'>3799</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3800</span> </span><span class="WHIT">                    </span><span class="NAME">importOptions.importAs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ImportAsType.FOOTAGE</span><span class="WHIT">
<span class='line'>3801</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3802</span> </span><span class="WHIT">                </span><span class="NAME">importSafeWithError</span><span class="PUNC">(</span><span class="NAME">importOptions</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3803</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>3804</span>                  * エラー出力付きでインポート処理
<span class='line'>3805</span>                  */</span><span class="WHIT">
<span class='line'>3806</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3807</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>3808</span>                  * 単にエラー捨てて継続
<span class='line'>3809</span>                  */</span><span class="WHIT">
<span class='line'>3810</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3811</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3812</span> 
<span class='line'>3813</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3814</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3815</span> 
<span class='line'>3816</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3817</span>      * testForSequence(files)
<span class='line'>3818</span>      * 引数　：　ファイルを要素とする配列
<span class='line'>3819</span>      * 戻値　：　先頭ファイルの配列
<span class='line'>3820</span>      * 基準
<span class='line'>3821</span>      * ラベルおよび数値部分を持つファイル名であること
<span class='line'>3822</span>      * ラベルは空文字列でもよろしい
<span class='line'>3823</span>      * 連番桁あわせは行われていること
<span class='line'>3824</span>      * テスト範囲のフォルダはファイルシステム上で同じ位置であること
<span class='line'>3825</span>      * 元のシーケンス判定はあまり良くないので消す
<span class='line'>3826</span>      * PSDファイルのシーケンスをトラップすることにする
<span class='line'>3827</span>      * 
<span class='line'>3828</span>      * @param files
<span class='line'>3829</span>      * @returns {Array}
<span class='line'>3830</span>      */</span><span class="WHIT">
<span class='line'>3831</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">testForSequence</span><span class="PUNC">(</span><span class="NAME">files</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3832</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resultArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3833</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3834</span>          * カラのフォルダが対象になったときはスキップ
<span class='line'>3835</span>          */</span><span class="WHIT">
<span class='line'>3836</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">files.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3837</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">resultArray</span><span class="WHIT">
<span class='line'>3838</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3839</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3840</span>          * フォルダ配置検査
<span class='line'>3841</span>          * @type {String}
<span class='line'>3842</span>          */</span><span class="WHIT">
<span class='line'>3843</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentFolderPath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">files</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">path</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3844</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fidx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">fidx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">files.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">fidx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3845</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentFolderPath</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">files</span><span class="PUNC">[</span><span class="NAME">fidx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">path</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3846</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">resultArray</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3847</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3848</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3849</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3850</span>          * アンマッチしたら終了(ファイル数多いときついか？要試験)
<span class='line'>3851</span>          * 全部のファイルを検査
<span class='line'>3852</span>          */</span><span class="WHIT">
<span class='line'>3853</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fidx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">fidx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">files.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">fidx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3854</span> </span><span class="COMM">//	var isSQ=isSequenceElements(files[fidx]);//チェックルーチンにまわす</span><span class="WHIT">
<span class='line'>3855</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>3856</span>              * チェックルーチンがFileオブジェクトのメソッドになったのでFolderを渡さないように注意
<span class='line'>3857</span>              * @type {boolean}
<span class='line'>3858</span>              */</span><span class="WHIT">
<span class='line'>3859</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isSQ</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">files</span><span class="PUNC">[</span><span class="NAME">fidx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">File</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">files</span><span class="PUNC">[</span><span class="NAME">fidx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">isSequenceElements</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="COMM">//チェックルーチンにまわす</span><span class="WHIT">
<span class='line'>3860</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isSQ</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3861</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isSQ.prefix.match</span><span class="PUNC">(</span><span class="NAME">nas.bgRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3862</span> </span><span class="WHIT">                    </span><span class="KEYW">continue</span><span class="WHIT">
<span class='line'>3863</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3864</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>3865</span>                  * 背景ぽいファイルをスキップ
<span class='line'>3866</span>                  */</span><span class="WHIT">
<span class='line'>3867</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isSQ.prefix.match</span><span class="PUNC">(</span><span class="NAME">nas.mgRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3868</span> </span><span class="WHIT">                    </span><span class="KEYW">continue</span><span class="WHIT">
<span class='line'>3869</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3870</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>3871</span>                  * 背景ぽいファイルをスキップ
<span class='line'>3872</span>                  */</span><span class="WHIT">
<span class='line'>3873</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isSQ.prefix.match</span><span class="PUNC">(</span><span class="NAME">nas.loRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3874</span> </span><span class="WHIT">                    </span><span class="KEYW">continue</span><span class="WHIT">
<span class='line'>3875</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3876</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>3877</span>                  * 背景ぽいファイルをスキップ
<span class='line'>3878</span>                  */</span><span class="WHIT">
<span class='line'>3879</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myPrefix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">isSQ.prefix</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3880</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">isSQ.currentNumber</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3881</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">isSQ.startNumber</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3882</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myExt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">isSQ.ext</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3883</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myCount</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myStart</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3884</span> </span><span class="WHIT">                    </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="NAME">files</span><span class="PUNC">[</span><span class="NAME">fidx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3885</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3886</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>3887</span>                  * カレントナンバとスタートナンバが一致している場合のみエントリ
<span class='line'>3888</span>                  */</span><span class="WHIT">
<span class='line'>3889</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3890</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3891</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">resultArray</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3892</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3893</span> 
<span class='line'>3894</span> </span><span class="COMM">//end testForSequence()</span><span class="WHIT">
<span class='line'>3895</span> 
<span class='line'>3896</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3897</span>      * importSafeWithError
<span class='line'>3898</span>      * 引数　：インポートオプションオブジェクト
<span class='line'>3899</span>      * 戻値　：なし
<span class='line'>3900</span>      * 名前ほど格好よくないね　とほほ
<span class='line'>3901</span>      * 
<span class='line'>3902</span>      * 与えられた オプションでインポートをトライ
<span class='line'>3903</span>      * @param importOptions
<span class='line'>3904</span>      */</span><span class="WHIT">
<span class='line'>3905</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">importSafeWithError</span><span class="PUNC">(</span><span class="NAME">importOptions</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3906</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3907</span>          * 追加チェック ファイル名(先頭ファイル名)がセルらしく無い場合は無条件でパス
<span class='line'>3908</span>          */</span><span class="WHIT">
<span class='line'>3909</span> </span><span class="COMM">//	if(importOptions.file.name.match(/^[a-z][0-9a-z\-\_]*[\-\_]?[0-9]+\.(mov|mpg|avi|tiff?|tga|psd|png|jpe?g|gif|sgi|eps)$/i)){	}else{return;}</span><span class="WHIT">
<span class='line'>3910</span> </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>3911</span> </span><span class="WHIT">        </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3912</span> </span><span class="WHIT">            </span><span class="NAME">app.project.importFile</span><span class="PUNC">(</span><span class="NAME">importOptions</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3913</span> </span><span class="WHIT">            </span><span class="NAME">myImportCount</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3914</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3915</span> </span><span class="WHIT">            </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="NAME">error.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">importOptions.file.fsName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3916</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3917</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3918</span> 
<span class='line'>3919</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3920</span>      * isImported(file)
<span class='line'>3921</span>      * 引数　：　ファイルオブジェクト
<span class='line'>3922</span>      * 戻値　：　ヒットしたアイテムインデックス
<span class='line'>3923</span>      * ファイルがプロジェクトにすでにインポートされているか否かテストする
<span class='line'>3924</span>      * ヒットがなければfalse
<span class='line'>3925</span>      * 
<span class='line'>3926</span>      * @param theFile
<span class='line'>3927</span>      * @returns {*}
<span class='line'>3928</span>      */</span><span class="WHIT">
<span class='line'>3929</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">isImported</span><span class="PUNC">(</span><span class="NAME">theFile</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3930</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">app.project</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3931</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>3932</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3933</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">app.project.items.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3934</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">app.project.item</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">mainSource</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FileSource</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3935</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">theFile.fsName</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">app.project.item</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">mainSource.file.fsName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3936</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3937</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3938</span> 
<span class='line'>3939</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3940</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3941</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3942</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3943</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3944</span> 
<span class='line'>3945</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3946</span>      * フォルダ処理
<span class='line'>3947</span>      * @param theFolder
<span class='line'>3948</span>      */</span><span class="WHIT">
<span class='line'>3949</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">processFolder</span><span class="PUNC">(</span><span class="NAME">theFolder</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3950</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3951</span>          * 対象フォルダのファイル(オブジェクト)を配列にとる
<span class='line'>3952</span>          */</span><span class="WHIT">
<span class='line'>3953</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">files</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">theFolder.getFiles</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3954</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3955</span>          * フォルダにシーケンスが含まれているか否か検査
<span class='line'>3956</span>          * @type {Array}
<span class='line'>3957</span>          */</span><span class="WHIT">
<span class='line'>3958</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sequenceStartFiles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">testForSequence</span><span class="PUNC">(</span><span class="NAME">files</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//全てのファイルをチェックルーチンにわたす　戻り値は先頭ファイルの配列とする</span><span class="WHIT">
<span class='line'>3959</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3960</span>          * 戻り値があれば未読み込みのエントリはシーケンスとしてインポートする
<span class='line'>3961</span>          */</span><span class="WHIT">
<span class='line'>3962</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fidx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">fidx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sequenceStartFiles.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">fidx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3963</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isExists</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">isImported</span><span class="PUNC">(</span><span class="NAME">sequenceStartFiles</span><span class="PUNC">[</span><span class="NAME">fidx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3964</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isExists</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3965</span> </span><span class="WHIT">                </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3966</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">importOptions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ImportOptions</span><span class="PUNC">(</span><span class="NAME">sequenceStartFiles</span><span class="PUNC">[</span><span class="NAME">fidx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//create a variable containing ImportOptions</span><span class="WHIT">
<span class='line'>3967</span> </span><span class="COMM">//alert(sequenceStartFiles[fidx].name+":" +sequenceStartFiles[fidx].path);</span><span class="WHIT">
<span class='line'>3968</span> </span><span class="WHIT">                    </span><span class="NAME">importOptions.sequence</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3969</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">importOptions.file.name.match</span><span class="PUNC">(</span><span class="REGX">/\.psd$/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3970</span> </span><span class="WHIT">                        </span><span class="NAME">importOptions.importAs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ImportAsType.FOOTAGE</span><span class="WHIT">
<span class='line'>3971</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3972</span> 
<span class='line'>3973</span> </span><span class="WHIT">                    </span><span class="COMM">//importOptions.forceAlphabetical = true; //un-comment this if you want to force alpha order by default</span><span class="WHIT">
<span class='line'>3974</span> </span><span class="WHIT">                    </span><span class="NAME">importSafeWithError</span><span class="PUNC">(</span><span class="NAME">importOptions</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3975</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3976</span> 
<span class='line'>3977</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3978</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3979</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3980</span> 
<span class='line'>3981</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3982</span>          * それ(シーケンス)以外の場合はファイルとしてインポートまたは再帰処理
<span class='line'>3983</span>          */</span><span class="WHIT">
<span class='line'>3984</span> </span><span class="WHIT">        </span><span class="COMM">//otherwise, import the files and recurse</span><span class="WHIT">
<span class='line'>3985</span> 
<span class='line'>3986</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">files</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3987</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>3988</span>              * Go through the array and set each element to singleFile, then run the following
<span class='line'>3989</span>              */</span><span class="WHIT">
<span class='line'>3990</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">files</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">File</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3991</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isExists</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">isImported</span><span class="PUNC">(</span><span class="NAME">files</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3992</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isExists</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3993</span> </span><span class="WHIT">                    </span><span class="COMM">/**
<span class='line'>3994</span>                      * 同じファイルがすでにインポートされている場合は、単にアクティブにしてインポート処理をスキップ
<span class='line'>3995</span>                      * @type {boolean}
<span class='line'>3996</span>                      */</span><span class="WHIT">
<span class='line'>3997</span> </span><span class="WHIT">                    </span><span class="NAME">app.project.item</span><span class="PUNC">(</span><span class="NAME">isExists</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">selected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3998</span> </span><span class="WHIT">                    </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3999</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4000</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>4001</span>                  * ファイルがシーケンスファイルならスキップ
<span class='line'>4002</span>                  * 背景/BOOK/LOファイルファイルとはシーケンスチェックをスキップする
<span class='line'>4003</span>                  */</span><span class="WHIT">
<span class='line'>4004</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>4005</span> </span><span class="WHIT">                    </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>4006</span> </span><span class="WHIT">                        </span><span class="PUNC">(</span><span class="NAME">files</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name.match</span><span class="PUNC">(</span><span class="NAME">nas.bgRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>4007</span> </span><span class="WHIT">                        </span><span class="PUNC">(</span><span class="NAME">files</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name.match</span><span class="PUNC">(</span><span class="NAME">nas.mgRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>4008</span> </span><span class="WHIT">                        </span><span class="PUNC">(</span><span class="NAME">files</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name.match</span><span class="PUNC">(</span><span class="NAME">nas.loRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4009</span> </span><span class="WHIT">                    </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>4010</span> </span><span class="WHIT">                        </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">files</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">isSequenceElements</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>4011</span> </span><span class="WHIT">                        </span><span class="PUNC">(</span><span class="NAME">files</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name.match</span><span class="PUNC">(</span><span class="NAME">nas.importFilter</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4012</span> </span><span class="WHIT">                    </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4013</span> </span><span class="WHIT">                </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4014</span> </span><span class="WHIT">                    </span><span class="COMM">/**
<span class='line'>4015</span>                      * if file is already part of a sequence, don't import it individually
<span class='line'>4016</span>                      * calls the processFile function above
<span class='line'>4017</span>                      */</span><span class="WHIT">
<span class='line'>4018</span> </span><span class="WHIT">                    </span><span class="NAME">processFile</span><span class="PUNC">(</span><span class="NAME">files</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4019</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4020</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4021</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">files</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Folder</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4022</span> </span><span class="WHIT">                </span><span class="NAME">processFolder</span><span class="PUNC">(</span><span class="NAME">files</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// recursion</span><span class="WHIT">
<span class='line'>4023</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4024</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4025</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4026</span> 
<span class='line'>4027</span> </span><span class="WHIT">    </span><span class="NAME">processFolder</span><span class="PUNC">(</span><span class="NAME">targetFolder</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4028</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4029</span>      * Recursively examine that folder
<span class='line'>4030</span>      * undoブロック終了
<span class='line'>4031</span>      */</span><span class="WHIT">
<span class='line'>4032</span> </span><span class="WHIT">    </span><span class="NAME">this.endUndoGroup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4033</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myImportCount</span><span class="PUNC">;</span><span class="COMM">//カウント返す</span><span class="WHIT">
<span class='line'>4034</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4035</span> 
<span class='line'>4036</span> 
<span class='line'>4037</span> </span><span class="COMM">//============================================素材分類用フォルダアイテム作成</span><span class="WHIT">
<span class='line'>4038</span> 
<span class='line'>4039</span> 
<span class='line'>4040</span> </span><span class="COMM">/**
<span class='line'>4041</span>  * nas.otome.mkWorkFolders()
<span class='line'>4042</span>  * 引数	:なし
<span class='line'>4043</span>  * 戻り値	:作成成功したフォルダの配列（一考？
<span class='line'>4044</span>  * プロジェクトにフッテージ格納用のフォルダアイテムを作る
<span class='line'>4045</span>  * オートビルダのための準備関数
<span class='line'>4046</span>  * AE7　以降で動作
<span class='line'>4047</span>  * 乙女の設定を参照して予備的にフォルダアイテムを作成
<span class='line'>4048</span>  * あらかじめフォルダが存在しなくても実際は割り振りプロシージャがフォルダアイテムを作るが、作っておくと何かと便利
<span class='line'>4049</span>  * 
<span class='line'>4050</span>  * @returns {Boolean}
<span class='line'>4051</span>  */</span><span class="WHIT">
<span class='line'>4052</span> </span><span class="NAME">nas.otome.mkWorkFolders</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4053</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4054</span>      * フッテージフォルダを作成　システム予約名で
<span class='line'>4055</span>      * この行為がＭＡＰの初期化と等しので
<span class='line'>4056</span>      * この場でＭＡＰ（エージェント）オブジェクトを生成しておく？
<span class='line'>4057</span>      * というか、マップ初期化ルーチンから呼んだほうが良いか？
<span class='line'>4058</span>      */</span><span class="WHIT">
<span class='line'>4059</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">app.version.split</span><span class="PUNC">(</span><span class="STRN">"."</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">7</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4060</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>4061</span>          * AE6.5の場合は、テンプレートを取り込んで代用する
<span class='line'>4062</span>          */</span><span class="WHIT">
<span class='line'>4063</span> </span><span class="WHIT">        </span><span class="NAME">this.beginUndoGroup</span><span class="PUNC">(</span><span class="STRN">"ワークフォルダ作成"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4064</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myTemplateFileLocation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Folder.scripts.path.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"/Scripts/nas/(tools)/autoBuilder/resources/footages.aep"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4065</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myTemplateItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ImportOptions</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4066</span> </span><span class="WHIT">        </span><span class="NAME">myTemplateItem.file</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">File</span><span class="PUNC">(</span><span class="NAME">myTemplateFileLocation</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4067</span> </span><span class="WHIT">        </span><span class="NAME">myTemplateItem.importAs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ImportAsType.PROJECT</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4068</span> 
<span class='line'>4069</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">app.project.importFile</span><span class="PUNC">(</span><span class="NAME">myTemplateItem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4070</span> </span><span class="WHIT">        </span><span class="NAME">myItem.name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.ftgFolders.ftgBase</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4071</span> 
<span class='line'>4072</span> </span><span class="WHIT">        </span><span class="NAME">this.endUndoGroup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4073</span> </span><span class="WHIT">        </span><span class="NAME">nas.XPSStore.initBody</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//作成時にストア初期化</span><span class="WHIT">
<span class='line'>4074</span> </span><span class="WHIT">        </span><span class="NAME">nas.otome.writeConsole</span><span class="PUNC">(</span><span class="STRN">"read Template"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4075</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myItem</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4076</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4077</span> 
<span class='line'>4078</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4079</span>      * undo group 設定（ワークフォルダ作成）
<span class='line'>4080</span>      */</span><span class="WHIT">
<span class='line'>4081</span> </span><span class="WHIT">    </span><span class="NAME">this.beginUndoGroup</span><span class="PUNC">(</span><span class="STRN">"ワークフォルダ作成"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4082</span> 
<span class='line'>4083</span> 
<span class='line'>4084</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myFootages</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">app.project.items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.ftgFolders.ftgBase</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//設定参照</span><span class="WHIT">
<span class='line'>4085</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myFootages</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4086</span> </span><span class="WHIT">        </span><span class="NAME">myFootages</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">app.project.items.addFolder</span><span class="PUNC">(</span><span class="NAME">nas.ftgFolders.ftgBase</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4087</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4088</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4089</span>      * フッテージサブフォルダ作る
<span class='line'>4090</span>      * @type {string[]}
<span class='line'>4091</span>      */</span><span class="WHIT">
<span class='line'>4092</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">footageFolders</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"bg"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"frame"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"lo"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"paint"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"etc"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"unknown"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="COMM">//今回は決めうち ,"_key","_draw","_rough","_sound","_system"はそのうち</span><span class="WHIT">
<span class='line'>4093</span> 
<span class='line'>4094</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">myIndex</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">footageFolders.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">myIndex</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4095</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">targetName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.ftgFolders</span><span class="PUNC">[</span><span class="NAME">footageFolders</span><span class="PUNC">[</span><span class="NAME">myIndex</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="COMM">//配列[0]データを使用</span><span class="WHIT">
<span class='line'>4096</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>4097</span>          * 現状のプロジェクトに同名のフォルダが存在しない場合のみ作る
<span class='line'>4098</span>          */</span><span class="WHIT">
<span class='line'>4099</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myFootages.items.getByName</span><span class="PUNC">(</span><span class="NAME">targetName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4100</span> </span><span class="WHIT">            </span><span class="NAME">myFootages.items.addFolder</span><span class="PUNC">(</span><span class="NAME">targetName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4101</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4102</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4103</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4104</span>      * フッテージサブフォルダにタイムシート保管コンポを作る(XPSStoreオブジェクトがあれば初期化する)
<span class='line'>4105</span>      */</span><span class="WHIT">
<span class='line'>4106</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">nas.XPSStore</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.XPSStore.getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4107</span> </span><span class="WHIT">        </span><span class="NAME">nas.XPSStore.initBody</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4108</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4109</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4110</span>      * すでにあれば初期化はしない
<span class='line'>4111</span>      * MAP(プレコンポ)フォルダ作る
<span class='line'>4112</span>      * @type {*}
<span class='line'>4113</span>      */</span><span class="WHIT">
<span class='line'>4114</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myMapDatas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">app.project.items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.mapFolders.mapBase</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4115</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myMapDatas</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4116</span> </span><span class="WHIT">        </span><span class="NAME">myMapDatas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">app.project.items.addFolder</span><span class="PUNC">(</span><span class="NAME">nas.mapFolders.mapBase</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4117</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4118</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4119</span>      * MAP(プレコンポ)サブフォルダ作る
<span class='line'>4120</span>      * @type {string[]}
<span class='line'>4121</span>      */</span><span class="WHIT">
<span class='line'>4122</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myFolders</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"cameraWork"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"cell"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"effect"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"sound"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"system"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4123</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">myIndex</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myFolders.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">myIndex</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4124</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">targetName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.mapFolders</span><span class="PUNC">[</span><span class="NAME">myFolders</span><span class="PUNC">[</span><span class="NAME">myIndex</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4125</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myMapDatas.items.getByName</span><span class="PUNC">(</span><span class="NAME">targetName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4126</span> </span><span class="WHIT">            </span><span class="NAME">myMapDatas.items.addFolder</span><span class="PUNC">(</span><span class="NAME">targetName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4127</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4128</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4129</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4130</span>      * undo 閉じる
<span class='line'>4131</span>      */</span><span class="WHIT">
<span class='line'>4132</span> </span><span class="WHIT">    </span><span class="NAME">this.endUndoGroup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4133</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4134</span> </span><span class="COMM">//	 nas.otome.mkWorkFolders();</span><span class="WHIT">
<span class='line'>4135</span> </span><span class="COMM">//============================================フッテージ振り分け</span><span class="WHIT">
<span class='line'>4136</span> 
<span class='line'>4137</span> 
<span class='line'>4138</span> </span><span class="COMM">/**
<span class='line'>4139</span>  * nas.otome.divideFootageItems()
<span class='line'>4140</span>  * 引数	:なし
<span class='line'>4141</span>  * 戻り値	:移動したアイテムの個数
<span class='line'>4142</span>  * 
<span class='line'>4143</span>  * 選択されたアイテムのうちファイルソースフッテージをプロジェクトフォルダに振り分ける
<span class='line'>4144</span>  * 選択されたアイテムが存在しない場合は、
<span class='line'>4145</span>  * ルートフォルダのすべてのフッテージアイテムおよび背景コンポ背景コンポのソースレイヤフォルダを対象に動作する。
<span class='line'>4146</span>  * 
<span class='line'>4147</span>  * フォルダはソースの所属フォルダの名前をそのまま使用　すでに同名のフォルダが存在する場合はそのフォルダを使用
<span class='line'>4148</span>  * フッテージがシーケンスの場合でかつフッテージプレフィックスがフォルダ名と同一の場合のみさらに上のフォルダ名を使用する
<span class='line'>4149</span>  * 
<span class='line'>4150</span>  * 各フォルダは　/[footages]/ の配下に作成する
<span class='line'>4151</span>  * 
<span class='line'>4152</span>  * 現行きめうちで
<span class='line'>4153</span>  *		[footages]
<span class='line'>4154</span>  *			|- _bg  	背景フォルダ "_bg/(BGフォルダ)" 配下にあれば自動登録
<span class='line'>4155</span>  *			|- _etc 	各種素材フォルダ
<span class='line'>4156</span>  *			|- _frame	フレーム設定フォルダ
<span class='line'>4157</span>  *			|- _lo  	レイアウト格納フォルダ　"_lo/(レイアウトフォルダ)"配下にあれば自動登録
<span class='line'>4158</span>  *			|- _paint	セル格納フォルダ　"_paint/(セルフォルダ)"配下にあれば自動登録
<span class='line'>4159</span>  *			|- _sound	(予約)
<span class='line'>4160</span>  *			|- _system	(予約)
<span class='line'>4161</span>  *			|- _rough	(予約)ラフ原用
<span class='line'>4162</span>  *			|- _key　	(予約)原画用
<span class='line'>4163</span>  *			|- _draw(ing)	(予約)動画用
<span class='line'>4164</span>  *			|- _other	不明フッテージを格納
<span class='line'>4165</span>  * 上記のフォルダを対象とする
<span class='line'>4166</span>  * 
<span class='line'>4167</span>  * 拡張仕様として、分類に失敗したアイテムを_othersに格納するか否かを選択可能にすること (スイッチ付ければ可能)2011.0205
<span class='line'>4168</span>  * セルと思われるアイテムの場合セルフォルダ（_paint）に格納するように調整　2011.0205
<span class='line'>4169</span>  * 
<span class='line'>4170</span>  * @returns {number}
<span class='line'>4171</span>  */</span><span class="WHIT">
<span class='line'>4172</span> </span><span class="NAME">nas.otome.divideFootageItems</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4173</span> </span><span class="WHIT">    </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4174</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myXPS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">XPS</span><span class="WHIT">
<span class='line'>4175</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">err</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4176</span> </span><span class="WHIT">        </span><span class="NAME">nas.otome.writeConsole</span><span class="PUNC">(</span><span class="NAME">err.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4177</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4178</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4179</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">app.version.split</span><span class="PUNC">(</span><span class="STRN">"."</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">7</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4180</span> </span><span class="WHIT">        </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"フォルダ振り分けはAE6.5では使用できません。\nこの機能はAE7以降でご使用ください"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4181</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4182</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4183</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4184</span>      * ケース見落としていた。　総アイテム数が０のときは何もする意味がないのでリターン
<span class='line'>4185</span>      */</span><span class="WHIT">
<span class='line'>4186</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">app.project</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">app.project.items.length</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4187</span> </span><span class="WHIT">        </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"no items"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4188</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4189</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4190</span> 
<span class='line'>4191</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">portCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4192</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myItems</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">app.project.selection</span><span class="PUNC">;</span><span class="COMM">//初期化</span><span class="WHIT">
<span class='line'>4193</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4194</span>      * アイテム数0なら対象をデフォルトに変更
<span class='line'>4195</span>      */</span><span class="WHIT">
<span class='line'>4196</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myItems.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4197</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myTargetFolder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">app.project.item</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">parentFolder</span><span class="PUNC">;</span><span class="COMM">//裏技でRootを取得</span><span class="WHIT">
<span class='line'>4198</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">itmIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">itmIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">myTargetFolder.items.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">itmIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4199</span> </span><span class="WHIT">            </span><span class="NAME">myItems.push</span><span class="PUNC">(</span><span class="NAME">myTargetFolder.items</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//Rootフォルダのアイテムをすべて登録(あとで分類)</span><span class="WHIT">
<span class='line'>4200</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4201</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4202</span> </span><span class="COMM">//var targetFolderReg=new RegExp("_(bg|etc|frame|lo|paint|sound|system|rough|key|draw(ing)?)$","i");</span><span class="WHIT">
<span class='line'>4203</span> 
<span class='line'>4204</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4205</span>      * 移動操作に先立って移動先の親フォルダがなければ作成（undo）
<span class='line'>4206</span>      */</span><span class="WHIT">
<span class='line'>4207</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">app.project.items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.ftgFolders.ftgBase</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4208</span> </span><span class="WHIT">        </span><span class="NAME">nas.otome.mkWorkFolders</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//ファンクションコールで全部作る</span><span class="WHIT">
<span class='line'>4209</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4210</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4211</span>      * 移動処理開始
<span class='line'>4212</span>      * @type {Array}
<span class='line'>4213</span>      */</span><span class="WHIT">
<span class='line'>4214</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tansItems</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="COMM">//サブの移動アイテムスタックループセットごとか?</span><span class="WHIT">
<span class='line'>4215</span> 
<span class='line'>4216</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4217</span>      * undo group 設定（カテゴリ別フッテージ振り分け）
<span class='line'>4218</span>      */</span><span class="WHIT">
<span class='line'>4219</span> </span><span class="WHIT">    </span><span class="NAME">this.beginUndoGroup</span><span class="PUNC">(</span><span class="STRN">"フッテージ振り分け"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4220</span> 
<span class='line'>4221</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4222</span>      * @desc 振分移動ループ処理
<span class='line'>4223</span>      */</span><span class="WHIT">
<span class='line'>4224</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>4225</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">itmIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">itmIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myItems.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">itmIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4226</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.otome.isPsdFolder</span><span class="PUNC">(</span><span class="NAME">myItems</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">parentFolder</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4227</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="WHIT">
<span class='line'>4228</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4229</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>4230</span>          * 親フォルダがpsdフォルダなら処理スキップ
<span class='line'>4231</span>          * @type {*}
<span class='line'>4232</span>          */</span><span class="WHIT">
<span class='line'>4233</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myCatg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.otome.guessFtgCtg</span><span class="PUNC">(</span><span class="NAME">myItems</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//推定エンジンに渡す</span><span class="WHIT">
<span class='line'>4234</span> </span><span class="COMM">//		if(myCatg==false){continue};//処理スキップ</span><span class="WHIT">
<span class='line'>4235</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myCatg</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4236</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4237</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4238</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>4239</span>          * 処理スキップ
<span class='line'>4240</span>          * ターゲットが移動先（システムフォルダ）だった場合ｍｙCatgに-1が戻るのでスキップ
<span class='line'>4241</span>          */</span><span class="WHIT">
<span class='line'>4242</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myCatg</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4243</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myCatg</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.dividerOptionUnknown</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4244</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myDestFoldrItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">app.project.items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.ftgFolders.names</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.ftgFolders.unknown</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4245</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4246</span> </span><span class="WHIT">                </span><span class="KEYW">continue</span><span class="WHIT">
<span class='line'>4247</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4248</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4249</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myDestFoldrItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">app.project.items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.ftgFolders.names</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.ftgFolders.names</span><span class="PUNC">[</span><span class="NAME">myCatg</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4250</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>4251</span>              * 移動対象フォルダが設定上存在すべきで、
<span class='line'>4252</span>              * かつ実際には存在しない場合myDestFoldrItemがnullになりかつ
<span class='line'>4253</span>              * myCatgに数値が入るので判定してフォルダを作成する
<span class='line'>4254</span>              */</span><span class="WHIT">
<span class='line'>4255</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myCatg</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myDestFoldrItem</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4256</span> </span><span class="WHIT">                </span><span class="NAME">myDestFoldrItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">app.project.items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.ftgFolders.names</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">items.addFolder</span><span class="PUNC">(</span><span class="NAME">nas.ftgFolders.names</span><span class="PUNC">[</span><span class="NAME">myCatg</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4257</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4258</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4259</span> </span><span class="COMM">//		if((myDestFoldrItem)&&(myItems[itmIdx].parentFolder.name!=myDestFoldrItem.name)){myItems[itmIdx].parentFolder=myDestFoldrItem};</span><span class="WHIT">
<span class='line'>4260</span> </span><span class="COMM">//		continue;</span><span class="WHIT">
<span class='line'>4261</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>4262</span>          * フォルダアイテムのケース
<span class='line'>4263</span>          * この条件を満たした場合はPSDコンポのレイヤフォルダ　またはフッテージ格納フォルダであるはずなので移動対象
<span class='line'>4264</span>          * ただし自動インポートの際はフォルダはセレクトされないので自然と移動対象外になるので
<span class='line'>4265</span>          * その場合は親コンポから移動するように設定する
<span class='line'>4266</span>          * 
<span class='line'>4267</span>          * フォルダの移動はアイテム移動スタックで処理
<span class='line'>4268</span>          */</span><span class="WHIT">
<span class='line'>4269</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>4270</span> </span><span class="WHIT">            </span><span class="PUNC">(</span><span class="NAME">myItems</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FolderItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>4271</span> </span><span class="WHIT">            </span><span class="PUNC">(</span><span class="NAME">nas.otome.isXPsdFolder</span><span class="PUNC">(</span><span class="NAME">myItems</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4272</span> </span><span class="WHIT">        </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4273</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">targetFolder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myItems</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4274</span> </span><span class="WHIT">            </span><span class="NAME">tansItems.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">targetFolder</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myDestFoldrItem</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//ターゲットと移動先をプッシュ</span><span class="WHIT">
<span class='line'>4275</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4276</span> </span><span class="COMM">//					break;</span><span class="WHIT">
<span class='line'>4277</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4278</span> 
<span class='line'>4279</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>4280</span>          * コンポアイテムのケース
<span class='line'>4281</span>          * コンポアイテムが移動対象の場合は背景コンポである可能性が高いので以下の検査を行い
<span class='line'>4282</span>          * 合致していたら背景コンポであるとみなし対象のレイヤ格納フォルダをアイテム移動スタックに積み
<span class='line'>4283</span>          * このファンクションの最後に解決する
<span class='line'>4284</span>          */</span><span class="WHIT">
<span class='line'>4285</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>4286</span> </span><span class="WHIT">            </span><span class="PUNC">(</span><span class="NAME">myItems</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">CompItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>4287</span> </span><span class="WHIT">            </span><span class="PUNC">(</span><span class="NAME">nas.otome.isPsdComp</span><span class="PUNC">(</span><span class="NAME">myItems</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4288</span> </span><span class="WHIT">        </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4289</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">targetFolder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myItems</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">layer</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">source.parentFolder</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4290</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">lid</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myItems</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">layers.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">lid</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4291</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.otome.isPsdFolder</span><span class="PUNC">(</span><span class="NAME">targetFolder</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4292</span> </span><span class="WHIT">                    </span><span class="NAME">tansItems.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">targetFolder</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myDestFoldrItem</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//ターゲットと移動先をプッシュ</span><span class="WHIT">
<span class='line'>4293</span> </span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4294</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4295</span> </span><span class="WHIT">                </span><span class="NAME">targetFolder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myItems</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">layer</span><span class="PUNC">(</span><span class="NAME">lid</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">source.parentFolder</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4296</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4297</span> 
<span class='line'>4298</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4299</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>4300</span>          * 移動操作開始
<span class='line'>4301</span>          */</span><span class="WHIT">
<span class='line'>4302</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>4303</span> </span><span class="WHIT">            </span><span class="PUNC">(</span><span class="NAME">myDestFoldrItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>4304</span> </span><span class="WHIT">            </span><span class="PUNC">(</span><span class="NAME">myItems</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">parentFolder.name</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">myDestFoldrItem.name</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4305</span> </span><span class="WHIT">        </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4306</span> </span><span class="WHIT">            </span><span class="NAME">myItems</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">parentFolder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myDestFoldrItem</span><span class="PUNC">;</span><span class="COMM">//移動</span><span class="WHIT">
<span class='line'>4307</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>4308</span>              * 移動時にXPSの情報に合わせてフッテージを調整
<span class='line'>4309</span>              */</span><span class="WHIT">
<span class='line'>4310</span> </span><span class="WHIT">            </span><span class="NAME">portCount</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4311</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4312</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4313</span> 
<span class='line'>4314</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4315</span>      * @desc 指定アイテム振分移動ループ処理終了
<span class='line'>4316</span>      * 全てのアイテム処理後に派生移動アイテムがあれば移動
<span class='line'>4317</span>      */</span><span class="WHIT">
<span class='line'>4318</span> 
<span class='line'>4319</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4320</span>      * ただしアイテム移動先が存在しない場合は処理をスキップ
<span class='line'>4321</span>      */</span><span class="WHIT">
<span class='line'>4322</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">itmIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">itmIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">tansItems.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">itmIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4323</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tansItems</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4324</span> </span><span class="WHIT">            </span><span class="NAME">tansItems</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">parentFolder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tansItems</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4325</span> </span><span class="WHIT">            </span><span class="NAME">portCount</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4326</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4327</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4328</span> 
<span class='line'>4329</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4330</span>      * @desc サブ移動アイテム移動終了
<span class='line'>4331</span>      */</span><span class="WHIT">
<span class='line'>4332</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>4333</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4334</span>      * undo 閉じる
<span class='line'>4335</span>      */</span><span class="WHIT">
<span class='line'>4336</span> </span><span class="WHIT">    </span><span class="NAME">this.endUndoGroup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4337</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">portCount</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4338</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4339</span> </span><span class="COMM">//	nas.otome.divideFootageItems();</span><span class="WHIT">
<span class='line'>4340</span> 
<span class='line'>4341</span> </span><span class="COMM">/**
<span class='line'>4342</span>  * @desc グループマップ作成
<span class='line'>4343</span>  */</span><span class="WHIT">
<span class='line'>4344</span> 
<span class='line'>4345</span> </span><span class="COMM">/**
<span class='line'>4346</span>  * nas.otome.mkMapGroups()
<span class='line'>4347</span>  * 引数	:なし
<span class='line'>4348</span>  * 戻り値	:作成したプリコンポ（タイムライングループ）の数
<span class='line'>4349</span>  * 
<span class='line'>4350</span>  * XPSオブジェクトを参照してセルのプレコンポ(グループマップ)を作成する
<span class='line'>4351</span>  * XPSオブジェクトが読み込まれていることが前提
<span class='line'>4352</span>  * オートビルダのための準備関数
<span class='line'>4353</span>  * セルの実際の配置は行わない
<span class='line'>4354</span>  * この関数は実際のセルを割り振るときに呼び出す機能関数とするか、またはMAPのメソッドにしたほうが良い
<span class='line'>4355</span>  * 
<span class='line'>4356</span>  * @returns {number}
<span class='line'>4357</span>  */</span><span class="WHIT">
<span class='line'>4358</span> </span><span class="NAME">nas.otome.mkMapGroups</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4359</span> </span><span class="WHIT">    </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4360</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myXPS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">XPS</span><span class="WHIT">
<span class='line'>4361</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">err</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4362</span> </span><span class="WHIT">        </span><span class="NAME">nas.otome.writeConsole</span><span class="PUNC">(</span><span class="NAME">err.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4363</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4364</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4365</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">AEVersion</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">7</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4366</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>4367</span>          * AE6.5の場合は、テンプレートを取り込んで代用する
<span class='line'>4368</span>          */</span><span class="WHIT">
<span class='line'>4369</span> </span><span class="WHIT">        </span><span class="NAME">this.beginUndoGroup</span><span class="PUNC">(</span><span class="STRN">"MAPグループ作成"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4370</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myTemplateFileLocation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Folder.scripts.path.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"/Scripts/nas/(tools)/autoBuilder/resources/map.aep"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4371</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myTemplateItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ImportOptions</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4372</span> </span><span class="WHIT">        </span><span class="NAME">myTemplateItem.file</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">File</span><span class="PUNC">(</span><span class="NAME">myTemplateFileLocation</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4373</span> </span><span class="WHIT">        </span><span class="NAME">myTemplateItem.importAs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ImportAsType.PROJECT</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4374</span> 
<span class='line'>4375</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">app.project.importFile</span><span class="PUNC">(</span><span class="NAME">myTemplateItem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4376</span> </span><span class="WHIT">        </span><span class="NAME">myItem.name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.mapFolders.mapBase</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4377</span> 
<span class='line'>4378</span> </span><span class="WHIT">        </span><span class="NAME">this.endUndoGroup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4379</span> </span><span class="WHIT">        </span><span class="NAME">nas.otome.writeConsole</span><span class="PUNC">(</span><span class="STRN">"read Template"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4380</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4381</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4382</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4383</span>      * undo group 設定（）
<span class='line'>4384</span>      */</span><span class="WHIT">
<span class='line'>4385</span> </span><span class="WHIT">    </span><span class="NAME">this.beginUndoGroup</span><span class="PUNC">(</span><span class="STRN">"MAPグループ作成"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4386</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4387</span>      * XPSオブジェクトがあればまずそれからグループを抽出する
<span class='line'>4388</span>      * 次にXPSStoreから順次作成すべきグループを抽出
<span class='line'>4389</span>      * 
<span class='line'>4390</span>      * @type {Array}
<span class='line'>4391</span>      */</span><span class="WHIT">
<span class='line'>4392</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myStore</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4393</span> </span><span class="WHIT">    </span><span class="NAME">myStore.push</span><span class="PUNC">(</span><span class="NAME">XPS</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//使用するXPSをpush</span><span class="WHIT">
<span class='line'>4394</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.XPSStore.getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4395</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">nas.XPSStore.body.layers.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4396</span> </span><span class="WHIT">            </span><span class="NAME">myStore.push</span><span class="PUNC">(</span><span class="NAME">nas.XPSStore.get</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4397</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4398</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4399</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4400</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">app.project.items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.mapFolders.mapBase</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4401</span> </span><span class="WHIT">        </span><span class="NAME">this.mkWorkFolders</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4402</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4403</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4404</span>      * [CELL]グループにプリコンポを作る
<span class='line'>4405</span>      * @type {*}
<span class='line'>4406</span>      */</span><span class="WHIT">
<span class='line'>4407</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myCellFolder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">app.project.items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.mapFolders.mapBase</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.mapFolders.cell</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4408</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myCellFolder</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4409</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">myStore</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4410</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myXPS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myStore</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4411</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myXPS.xpsTracks.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4412</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">targetComp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCellFolder.items.getByName</span><span class="PUNC">(</span><span class="NAME">myXPS.xpsTracks</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4413</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">targetComp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">targetComp</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">CompItem</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4414</span> </span><span class="WHIT">                    </span><span class="COMM">/**
<span class='line'>4415</span>                      * ターゲットのプリコンポはあるか？ないときは作成
<span class='line'>4416</span>                      */</span><span class="WHIT">
<span class='line'>4417</span> </span><span class="WHIT">                    </span><span class="NAME">targetComp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCellFolder.items.addComp</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>4418</span> </span><span class="WHIT">                        </span><span class="NAME">myXPS.xpsTracks</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4419</span> </span><span class="WHIT">                        </span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">myXPS.xpsTracks</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sizeX</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4420</span> </span><span class="WHIT">                        </span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">myXPS.xpsTracks</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sizeY</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4421</span> </span><span class="WHIT">                        </span><span class="NAME">myXPS.xpsTracks</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">aspect</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4422</span> </span><span class="WHIT">                        </span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">myXPS.xpsTracks</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lot</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">myXPS.xpsTracks</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lot</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">myXPS.framerate</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4423</span> </span><span class="WHIT">                        </span><span class="NAME">myXPS.framerate</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT">
<span class='line'>4424</span> </span><span class="WHIT">                    </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4425</span> </span><span class="WHIT">                    </span><span class="NAME">targetComp.duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4426</span> </span><span class="WHIT">                    </span><span class="NAME">myCount</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4427</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4428</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4429</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4430</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4431</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4432</span>      * どうせあとで調整なのでフレームレート標準値、継続時間1秒でマップコンポを作成しておく
<span class='line'>4433</span>      * undo 閉じる
<span class='line'>4434</span>      */</span><span class="WHIT">
<span class='line'>4435</span> </span><span class="WHIT">    </span><span class="NAME">this.endUndoGroup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4436</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myCount</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4437</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4438</span> </span><span class="COMM">//	nas.otome.mkMapGroups();</span><span class="WHIT">
<span class='line'>4439</span> 
<span class='line'>4440</span> </span><span class="COMM">/**
<span class='line'>4441</span>  * nas.otome.buildMAP()
<span class='line'>4442</span>  * 引数	:なし
<span class='line'>4443</span>  * 戻値	:true/false
<span class='line'>4444</span>  * 
<span class='line'>4445</span>  * 
<span class='line'>4446</span>  * 各機能を連続処理してMAPの自動ビルドを行う
<span class='line'>4447</span>  * 処理成功時はrue / 中断を検知した場合はfalse
<span class='line'>4448</span>  * 
<span class='line'>4449</span>  * 現存のフッテージをあさって　マップグループらしきものを作る
<span class='line'>4450</span>  * (1)フッテージフォルダを検索してマッチしたコンポに投げ込む
<span class='line'>4451</span>  * 下セル・上セル・合成セル・ブラシは一応サポート
<span class='line'>4452</span>  * 判別不能なセルは手動でコンポに入れてほしい。
<span class='line'>4453</span>  * サイズと継続時間は調整するけど、最大マッチで投げ込む
<span class='line'>4454</span>  * (2)レイアウトフォルダとフレームフォルダをあさってカメラワークマップを作る
<span class='line'>4455</span>  * 最大マッチで重ねるのみ
<span class='line'>4456</span>  * (3)フッテージフォルダから背景らしきものを探し出して背景プリコンポを作る。
<span class='line'>4457</span>  * (4)背景プリコンポとカメラワークマップを重ねてステージを作る　カメラレイヤも作成
<span class='line'>4458</span>  * (5)ステージにセルを投げ込んでそこでシートマッピングする
<span class='line'>4459</span>  * (6)ステージをカメラコンポでクリップ
<span class='line'>4460</span>  * (7)カメラコンポを出力コンポにボールドつきで設定　書き出し可能な提携処理を行う
<span class='line'>4461</span>  * 
<span class='line'>4462</span>  * それぞれ別の機能部品に仕立てるが吉
<span class='line'>4463</span>  * 
<span class='line'>4464</span>  * ココでは前提として有効なXPSファイルがターゲットフォルダの配下に含まれていることが前提である
<span class='line'>4465</span>  */</span><span class="WHIT">
<span class='line'>4466</span> </span><span class="NAME">nas.otome.buildMAP</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4467</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">AEVersion</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">7</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4468</span> </span><span class="WHIT">        </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"この機能にはAE7以降が必要です"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4469</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4470</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4471</span> 
<span class='line'>4472</span> </span><span class="WHIT">    </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4473</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myXPS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">XPS</span><span class="WHIT">
<span class='line'>4474</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">err</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4475</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>4476</span>          * ＸＰＳの初期化が済んでいないのでＸＰＳの初期化を促す
<span class='line'>4477</span>          */</span><span class="WHIT">
<span class='line'>4478</span> </span><span class="WHIT">        </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"XPSが見当たりません"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4479</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4480</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4481</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4482</span>      * フッテージ振り分け
<span class='line'>4483</span>      */</span><span class="WHIT">
<span class='line'>4484</span> </span><span class="WHIT">    </span><span class="NAME">nas.otome.divideFootageItems</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4485</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4486</span>      * 振り分けたフォルダを元にコンポをつくる(複数シート拡張&lt;未>)
<span class='line'>4487</span>      */</span><span class="WHIT">
<span class='line'>4488</span> </span><span class="WHIT">    </span><span class="NAME">nas.otome.mkMapGroups</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4489</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4490</span>      * この時点でロードされているＸＰＳを順次選択してMAPをビルドする
<span class='line'>4491</span>      */</span><span class="WHIT">
<span class='line'>4492</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myXpsCounts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.XPSStore.getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4493</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myXpsCounts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4494</span> </span><span class="WHIT">        </span><span class="NAME">myXpsCounts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>4495</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4496</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">nas.XPSStore.getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4497</span> </span><span class="WHIT">        </span><span class="NAME">nas.XPSStore.select</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4498</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>4499</span>          * 全アイテム選択解除;
<span class='line'>4500</span>          */</span><span class="WHIT">
<span class='line'>4501</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">app.project.items.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4502</span> </span><span class="WHIT">            </span><span class="NAME">app.project.items</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">selected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4503</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4504</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>4505</span>          * BGフォルダのフッテージをグループ化(シート参照まだ)
<span class='line'>4506</span>          */</span><span class="WHIT">
<span class='line'>4507</span> </span><span class="WHIT">        </span><span class="NAME">nas.otome.standbyBGFootages</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4508</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>4509</span>          * セルフォルダのフッテージをグループ登録
<span class='line'>4510</span>          */</span><span class="WHIT">
<span class='line'>4511</span> </span><span class="WHIT">        </span><span class="NAME">nas.otome.standbyCellFootages</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4512</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4513</span> 
<span class='line'>4514</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4515</span> 
<span class='line'>4516</span> </span><span class="COMM">/**
<span class='line'>4517</span>  * @desc 背景をMAPに取り込み
<span class='line'>4518</span>  */</span><span class="WHIT">
<span class='line'>4519</span> 
<span class='line'>4520</span> 
<span class='line'>4521</span> </span><span class="COMM">/**	
<span class='line'>4522</span>  * nas.otome.standbyBGFootages()
<span class='line'>4523</span>  * 
<span class='line'>4524</span>  * 引数	:なし
<span class='line'>4525</span>  * 戻り値	:処理成功したアイテムの数
<span class='line'>4526</span>  * 
<span class='line'>4527</span>  * タイムライン外のフッテージをプロジェクト内でMAP配置する
<span class='line'>4528</span>  * 背景BOOK等の暗黙の素材が対象である
<span class='line'>4529</span>  * 
<span class='line'>4530</span>  * インポート済みの背景の想定様態は2種
<span class='line'>4531</span>  * 通常フッテージファイルかまたはフォトショップコンポ
<span class='line'>4532</span>  * 
<span class='line'>4533</span>  * 通常フッテージファイルの場合は[footages]_bg 配下に取り込んで[MAP][CELL]配下にグループプリコンポを置く(一考)
<span class='line'>4534</span>  * PSDコンポの場合は暫定処置で背景用のプリコンポを作成　というか背景のフォトショップファイルをインポート時にコンポで読み込んで
<span class='line'>4535</span>  * フッテージはフォルダをリネームして[footages]_bg　の配下に置き、
<span class='line'>4536</span>  * コンポは[MAP][CELL]フォルダに移動してファイル名でリネームする。
<span class='line'>4537</span>  * 素材配置は元のファイルの情報を維持
<span class='line'>4538</span>  * 継続時間は兼用カット数分のフレーム・オリジナル配置をベースにステージに自動配置してnullでつなぐ？
<span class='line'>4539</span>  * （またはカット継続時間の最長？）
<span class='line'>4540</span>  * 09/21 尺調整未処理
<span class='line'>4541</span>  * 
<span class='line'>4542</span>  * ココでは前提としてインポートおよびプロジェクトフォルダへの配置は済んでいるものとする
<span class='line'>4543</span>  * @returns {number}
<span class='line'>4544</span>  */</span><span class="WHIT">
<span class='line'>4545</span> </span><span class="NAME">nas.otome.standbyBGFootages</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4546</span> </span><span class="WHIT">    </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4547</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myXPS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">XPS</span><span class="WHIT">
<span class='line'>4548</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">err</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4549</span> </span><span class="WHIT">        </span><span class="NAME">nas.otome.writeConsole</span><span class="PUNC">(</span><span class="NAME">err.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4550</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4551</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4552</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">app.version.split</span><span class="PUNC">(</span><span class="STRN">"."</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">7</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4553</span> </span><span class="WHIT">        </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"この機能にはAE7以降が必要です"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4554</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4555</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4556</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myXPS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">XPS</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4557</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myCellFolder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">app.project.items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.mapFolders.mapBase</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.mapFolders.cell</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//ビルド先</span><span class="WHIT">
<span class='line'>4558</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//戻値</span><span class="WHIT">
<span class='line'>4559</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4560</span>      * [footages]_bgフォルダの素材を処置
<span class='line'>4561</span>      * カラ配列初期化(エントリは通常フッテージまたはPSDコンポ)
<span class='line'>4562</span>      * @type {Array}
<span class='line'>4563</span>      */</span><span class="WHIT">
<span class='line'>4564</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myTargetFootages</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4565</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4566</span>      * フォルダ内のアイテム総当りで判定
<span class='line'>4567</span>      * @type {*}
<span class='line'>4568</span>      */</span><span class="WHIT">
<span class='line'>4569</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myStore</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">app.project.items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.ftgFolders.ftgBase</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.ftgFolders.bg</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4570</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4571</span>      * アイテム移動スタック
<span class='line'>4572</span>      * @type {Array}
<span class='line'>4573</span>      */</span><span class="WHIT">
<span class='line'>4574</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">transportItems</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4575</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4576</span>      * undo 開く
<span class='line'>4577</span>      */</span><span class="WHIT">
<span class='line'>4578</span> </span><span class="WHIT">    </span><span class="NAME">this.beginUndoGroup</span><span class="PUNC">(</span><span class="STRN">"BG-MAP作成"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4579</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">itmIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">itmIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">myStore.items.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">itmIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4580</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>4581</span>          * アイテムが通常ファイルフッテージならば[MAP][CELL]配下にグループプリコンポ置く
<span class='line'>4582</span>          */</span><span class="WHIT">
<span class='line'>4583</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myStore.items</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FootageItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4584</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cpName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"["</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myStore.items</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name.replace</span><span class="PUNC">(</span><span class="REGX">/\..+$/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"]"</span><span class="PUNC">;</span><span class="COMM">//拡張子あれば取り払い、前後を囲んでセルと区別する</span><span class="WHIT">
<span class='line'>4585</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cpWdt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myStore.items</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4586</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cpHgt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myStore.items</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4587</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cpApt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myStore.items</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">pixelAspect</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4588</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>4589</span>              * 静止画のフレームレートと継続時間はともに０なので注意
<span class='line'>4590</span>              * @type {number}
<span class='line'>4591</span>              */</span><span class="WHIT">
<span class='line'>4592</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cpDrs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myStore.items</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">duration</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">myStore.items</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">duration</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="COMM">//(1/myXPS.framerate;)</span><span class="WHIT">
<span class='line'>4593</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cpFrs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myStore.items</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">duration</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">myStore.items</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">duration</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">myStore.items</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">frameDuration</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4594</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cpFrt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myStore.items</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">frameRate</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">myStore.items</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">frameRate</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">myXPS.framerate</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4595</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>4596</span>              * 静止画はひとまずXPSのフレームレートで継続1フレームに
<span class='line'>4597</span>              * 同名のコンポがすでにあれば処理しない
<span class='line'>4598</span>              */</span><span class="WHIT">
<span class='line'>4599</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myCellFolder.items.getByName</span><span class="PUNC">(</span><span class="NAME">cpName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4600</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myNewComp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCellFolder.items.addComp</span><span class="PUNC">(</span><span class="NAME">cpName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cpWdt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cpHgt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cpApt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cpDrs</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cpFrt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4601</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>4602</span>                  * 拡張メソッドで尺を割り付け
<span class='line'>4603</span>                  */</span><span class="WHIT">
<span class='line'>4604</span> </span><span class="WHIT">                </span><span class="NAME">myNewComp.setFrames</span><span class="PUNC">(</span><span class="NAME">cpFrs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4605</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>4606</span>                  * セレクトする
<span class='line'>4607</span>                  * @type {boolean}
<span class='line'>4608</span>                  */</span><span class="WHIT">
<span class='line'>4609</span> </span><span class="WHIT">                </span><span class="NAME">myNewComp.selected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4610</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myNewLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myNewComp.layers.add</span><span class="PUNC">(</span><span class="NAME">myStore.items</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//静止画プレコンポに投入</span><span class="WHIT">
<span class='line'>4611</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>4612</span>                  * BGコンポに対して 必要(設定)に従ってコンポに定型処理を施す(外部スクリプトを使う仕様)…多分あまりない
<span class='line'>4613</span>                  * @type {Folder}
<span class='line'>4614</span>                  */</span><span class="WHIT">
<span class='line'>4615</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myBgAction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Folder</span><span class="PUNC">(</span><span class="NAME">Folder.scripts.path.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"/Scripts/nas/(actions)/systemResources/nas.otome.standbyBGFootages"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4616</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myBgAction.exists</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4617</span> </span><span class="WHIT">                    </span><span class="NAME">myNewComp.executeAction</span><span class="PUNC">(</span><span class="NAME">myBgAction</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4618</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4619</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>4620</span>                  * カウンタ追加
<span class='line'>4621</span>                  */</span><span class="WHIT">
<span class='line'>4622</span> </span><span class="WHIT">                </span><span class="NAME">myCount</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4623</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4624</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>4625</span>              * 背景用のタイムラインは現在暗黙の宣言なのでXPS内に存在しないケースが多いので、暫定処置である。注意！
<span class='line'>4626</span>              */</span><span class="WHIT">
<span class='line'>4627</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4628</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>4629</span>          * アイテムがPSDコンポならリネームして[MAP][CELL]配下に移動 ただし移動系はインデックスが変わるので
<span class='line'>4630</span>          * ループ終了時に実行するためのターゲット配列を作成して対応
<span class='line'>4631</span>          */</span><span class="WHIT">
<span class='line'>4632</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myStore.items</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">CompItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4633</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myStore.items</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name.match</span><span class="PUNC">(</span><span class="REGX">/(.+)\..+$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4634</span> </span><span class="WHIT">                </span><span class="NAME">myStore.items</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4635</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4636</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>4637</span>              * 拡張子がついてるときだけリネーム
<span class='line'>4638</span>              */</span><span class="WHIT">
<span class='line'>4639</span> </span><span class="WHIT">            </span><span class="NAME">transportItems.push</span><span class="PUNC">(</span><span class="NAME">myStore.items</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//スタック</span><span class="WHIT">
<span class='line'>4640</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4641</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4642</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>4643</span>              * アイテムがPSDコンポのフッテージフォルダだったらリネーム(これは単純すぐでける)
<span class='line'>4644</span>              */</span><span class="WHIT">
<span class='line'>4645</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myStore.items</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FolderItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4646</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myStore.items</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name.match</span><span class="PUNC">(</span><span class="REGX">/(.+)\sレイヤー/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4647</span> </span><span class="WHIT">                    </span><span class="NAME">myStore.items</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4648</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4649</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>4650</span>                  * @todo 個人的な趣味なので放置でも可…で、放置
<span class='line'>4651</span>                  */</span><span class="WHIT">
<span class='line'>4652</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4653</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4654</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>4655</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>4656</span>          * ループ終了したのでPSDコンポの移動を解決
<span class='line'>4657</span>          * 移動完了後にセレクト
<span class='line'>4658</span>          */</span><span class="WHIT">
<span class='line'>4659</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">transportItems.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4660</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">transportItems.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4661</span> </span><span class="WHIT">                </span><span class="NAME">transportItems</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">parentFolder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCellFolder</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4662</span> </span><span class="WHIT">                </span><span class="NAME">transportItems</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">selected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4663</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>4664</span>                  * PSDコンポに対して 必要(設定)に従ってコンポに定型処理を施す(外部スクリプトを使う仕様)…多分あまりない
<span class='line'>4665</span>                  * @type {Folder}
<span class='line'>4666</span>                  */</span><span class="WHIT">
<span class='line'>4667</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myAction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Folder</span><span class="PUNC">(</span><span class="NAME">Folder.scripts.path.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"/Scripts/nas/(actions)/systemResources/psdBgGroup"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4668</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myAction.exists</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4669</span> </span><span class="WHIT">                    </span><span class="NAME">transportItems</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">executeAction</span><span class="PUNC">(</span><span class="NAME">myAction</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4670</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4671</span> </span><span class="WHIT">                </span><span class="NAME">myCount</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4672</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4673</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4674</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4675</span> </span><span class="WHIT">    </span><span class="NAME">this.endUndoGroup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4676</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myCount</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4677</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4678</span> 
<span class='line'>4679</span> </span><span class="COMM">//	nas.otome.standbyBGFootages();</span><span class="WHIT">
<span class='line'>4680</span> 
<span class='line'>4681</span> </span><span class="COMM">/**
<span class='line'>4682</span>  * nas.otome.standbyCellFootages()
<span class='line'>4683</span>  * 引数	:なし
<span class='line'>4684</span>  * 戻り値	:作成成功したアイテムカウントオブジェクト
<span class='line'>4685</span>  * 
<span class='line'>4686</span>  * この関数を呼び出す場合はプロジェクト内のアイテムの配置が完了しているものとする
<span class='line'>4687</span>  * @returns {number}
<span class='line'>4688</span>  */</span><span class="WHIT">
<span class='line'>4689</span> </span><span class="NAME">nas.otome.standbyCellFootages</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4690</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">nas.XPSStore.getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4691</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT">
<span class='line'>4692</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4693</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myXPS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">XPS</span><span class="WHIT">
<span class='line'>4694</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4695</span> </span><span class="COMM">//try{var myXPS=XPS}catch(err){nas.otome.writeConsole(err.toString());return;}</span><span class="WHIT">
<span class='line'>4696</span> </span><span class="COMM">//	if(app.version.split(".")[0]*1&lt;7){alert("この機能にはAE7以降が必要です");return;};//6.5でも使えるはず</span><span class="WHIT">
<span class='line'>4697</span> 
<span class='line'>4698</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4699</span>      * [CELL]グループのプリコンポにフッテージ登録
<span class='line'>4700</span>      * @type {*}
<span class='line'>4701</span>      */</span><span class="WHIT">
<span class='line'>4702</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myCellFolder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">app.project.items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.mapFolders.mapBase</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.mapFolders.cell</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4703</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myPaintStore</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">app.project.items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.ftgFolders.ftgBase</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">items.getByName</span><span class="PUNC">(</span><span class="NAME">nas.ftgFolders.paint</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4704</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResultCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4705</span> 
<span class='line'>4706</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tempArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">myCellFolder.items.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//分類仮配列初期化</span><span class="WHIT">
<span class='line'>4707</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tlIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">tlIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myCellFolder.items.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">tlIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4708</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>4709</span>          * 各配列を要素なしであらかじめ初期化 0 to length-1
<span class='line'>4710</span>          * @type {Array}
<span class='line'>4711</span>          */</span><span class="WHIT">
<span class='line'>4712</span> </span><span class="WHIT">        </span><span class="NAME">tempArray</span><span class="PUNC">[</span><span class="NAME">tlIdx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4713</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4714</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myCellFolder</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FolderItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myCellFolder.items.length</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4715</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>4716</span>          * undo group 設定（タイムライングループ設定）
<span class='line'>4717</span>          */</span><span class="WHIT">
<span class='line'>4718</span> </span><span class="WHIT">        </span><span class="NAME">this.beginUndoGroup</span><span class="PUNC">(</span><span class="STRN">"CELL-MAP設定"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4719</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>4720</span>          * セルコンポがすでにある場合のみ動作
<span class='line'>4721</span>          * フッテージループ
<span class='line'>4722</span>          */</span><span class="WHIT">
<span class='line'>4723</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ftgIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ftgIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">myPaintStore.items.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ftgIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4724</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>4725</span>              * 仮にここでシートとフレームレートの異なるフッテージを洗う
<span class='line'>4726</span>              * @type {*|PresetItem|Item}
<span class='line'>4727</span>              */</span><span class="WHIT">
<span class='line'>4728</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myFootage</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myPaintStore.items</span><span class="PUNC">[</span><span class="NAME">ftgIdx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4729</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>4730</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="NAME">myFootage</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FootageItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>4731</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">myFootage.mainSource.isStill</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>4732</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="NAME">myFootage.frameRate</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">myXPS.framerate</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4733</span> </span><span class="WHIT">            </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4734</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4735</span> </span><span class="WHIT">                    </span><span class="NAME">myFootage.mainSource.conformFrameRate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myXPS.framerate</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4736</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4737</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cofirm</span><span class="PUNC">(</span><span class="STRN">"フッテージフレームレートがタイムシートと異なります。調整しますか？"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4738</span> </span><span class="WHIT">                        </span><span class="NAME">myFootage.mainSource.conformFrameRate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myXPS.framerate</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4739</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4740</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4741</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4742</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>4743</span>              * 判定文字列を作成
<span class='line'>4744</span>              * @type {String}
<span class='line'>4745</span>              */</span><span class="WHIT">
<span class='line'>4746</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myLabel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myPaintStore.items</span><span class="PUNC">[</span><span class="NAME">ftgIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4747</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>4748</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>4749</span>              * 連番指示部を削除してソースのフレーム数表示部を除く
<span class='line'>4750</span>              * ラベルが残らなかった場合は、ソースパスの最終トークンをラベルにする
<span class='line'>4751</span>              */</span><span class="WHIT">
<span class='line'>4752</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myPaintStore.items</span><span class="PUNC">[</span><span class="NAME">ftgIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">source</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">File</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4753</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4754</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>4755</span>              * 基本的にはファイルソースのみが対象なのでココの判定は無用
<span class='line'>4756</span>              * フッテージ名から拡張子を除く
<span class='line'>4757</span>              * @type {string}
<span class='line'>4758</span>              */</span><span class="WHIT">
<span class='line'>4759</span> </span><span class="WHIT">            </span><span class="NAME">myLabel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myLabel.replace</span><span class="PUNC">(</span><span class="REGX">/\..+$/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4760</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>4761</span>              * 数値指定部を除く
<span class='line'>4762</span>              * @type {string}
<span class='line'>4763</span>              */</span><span class="WHIT">
<span class='line'>4764</span> </span><span class="WHIT">            </span><span class="NAME">myLabel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myLabel.replace</span><span class="PUNC">(</span><span class="REGX">/[_\s-]?\[\d+\-?\d+\]/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4765</span> 
<span class='line'>4766</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myLabel.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4767</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>4768</span>                  * ラベル長が0になった場合は数字のみのファイル名なので(まれにある)ひとつ上のフォルダ名をラベルにする
<span class='line'>4769</span>                  * @type {*}
<span class='line'>4770</span>                  */</span><span class="WHIT">
<span class='line'>4771</span> </span><span class="WHIT">                </span><span class="NAME">myLabel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myPaintStore.items</span><span class="PUNC">[</span><span class="NAME">ftgIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">source.file.path.split</span><span class="PUNC">(</span><span class="STRN">"/"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NAME">myPaintStore.items</span><span class="PUNC">[</span><span class="NAME">ftgIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">source.file.path.split</span><span class="PUNC">(</span><span class="STRN">"/"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4772</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4773</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>4774</span>              * フォルダ名が作品タイトルや話数情報を含んでいると思われる場合はその部分を削除する
<span class='line'>4775</span>              */</span><span class="WHIT">
<span class='line'>4776</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myLabel.match</span><span class="PUNC">(</span><span class="REGX">/[^_\s\-]+([_\s\-][^_\s\-]+)+/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4777</span> </span><span class="WHIT">                </span><span class="NAME">myLabel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$1.replace</span><span class="PUNC">(</span><span class="REGX">/^[_\s\-]/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4778</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4779</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tlIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">tlIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">myCellFolder.items.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">tlIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4780</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>4781</span>                  * マップグループ総当りで、判定ラベルとコンポ名が一致したらそのグループの仮配列にフッテージを登録してブレイク
<span class='line'>4782</span>                  * 基本的にラベルの完全マッチを狙うか、
<span class='line'>4783</span>                  * またはかなりインテリジェントな推測エンジンを作るか
<span class='line'>4784</span>                  * 以下の判定の前処理で補助情報を形成するか
<span class='line'>4785</span>                  * いずれかの処置が必要
<span class='line'>4786</span>                  * 今回は推測エンジンを作る余裕はないので以下の甘いマッチで手作業修正とする
<span class='line'>4787</span>                  * 以下のマッチではラベルの冒頭文字列が一致している最初のグループにフォルダにすべて取り込まれるので
<span class='line'>4788</span>                  * その点は注意(従来名のカブセは自動判定不能)
<span class='line'>4789</span>                  * 要調整
<span class='line'>4790</span>                  * 
<span class='line'>4791</span>                  * @type {String}
<span class='line'>4792</span>                  */</span><span class="WHIT">
<span class='line'>4793</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myTargetLabel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCellFolder.items</span><span class="PUNC">[</span><span class="NAME">tlIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4794</span> </span><span class="COMM">//			if(myLabel.match(new RegExp("^"+myTargetLabel,"i"))){};//こちらは仮にしても弊害多いのでやめ</span><span class="WHIT">
<span class='line'>4795</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myTargetLabel.match</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"^"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myLabel</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"i"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4796</span> </span><span class="WHIT">                    </span><span class="NAME">tempArray</span><span class="PUNC">[</span><span class="NAME">tlIdx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">myPaintStore.items</span><span class="PUNC">[</span><span class="NAME">ftgIdx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//仮配列は添字が-1</span><span class="WHIT">
<span class='line'>4797</span> </span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4798</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4799</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4800</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4801</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>4802</span>          * 仮配列を元にマップグループを形成
<span class='line'>4803</span>          */</span><span class="WHIT">
<span class='line'>4804</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tlIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">tlIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">myCellFolder.items.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">tlIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4805</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>4806</span>              * ここで処理対象外のコンポを振り分ける(BG等のグループが混在しているので)
<span class='line'>4807</span>              */</span><span class="WHIT">
<span class='line'>4808</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myCellFolder.items</span><span class="PUNC">[</span><span class="NAME">tlIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name.match</span><span class="PUNC">(</span><span class="REGX">/\[.+\]/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4809</span> </span><span class="WHIT">                </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4810</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4811</span> 
<span class='line'>4812</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentFrameRate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCellFolder.items</span><span class="PUNC">[</span><span class="NAME">tlIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">frameRate</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4813</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myMaxFrames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4814</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myMaxWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4815</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>4816</span>              * 初期化 ココにピクセルアスペクトが参入されてないので注意
<span class='line'>4817</span>              * @type {number}
<span class='line'>4818</span>              */</span><span class="WHIT">
<span class='line'>4819</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myMaxHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4820</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>4821</span>              * 第一ループ : コンポ情報のみ取得して設定
<span class='line'>4822</span>              */</span><span class="WHIT">
<span class='line'>4823</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">myIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">tempArray</span><span class="PUNC">[</span><span class="NAME">tlIdx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">myIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4824</span> </span><span class="WHIT">                </span><span class="COMM">//tempArray[tlIdx-1][myIdx];//登録アイテム</span><span class="WHIT">
<span class='line'>4825</span> </span><span class="WHIT">                </span><span class="NAME">currentFrameRate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tempArray</span><span class="PUNC">[</span><span class="NAME">tlIdx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">myIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">mainSource.isStill</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">myXPS.framerate</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tempArray</span><span class="PUNC">[</span><span class="NAME">tlIdx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">myIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">frameRate</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4826</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentFrames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tempArray</span><span class="PUNC">[</span><span class="NAME">tlIdx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">myIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">mainSource.isStill</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">tempArray</span><span class="PUNC">[</span><span class="NAME">tlIdx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">myIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">duration</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">tempArray</span><span class="PUNC">[</span><span class="NAME">tlIdx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">myIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">frameDuration</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4827</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tempArray</span><span class="PUNC">[</span><span class="NAME">tlIdx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">myIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4828</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tempArray</span><span class="PUNC">[</span><span class="NAME">tlIdx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">myIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4829</span> 
<span class='line'>4830</span> </span><span class="WHIT">                </span><span class="NAME">myMaxFrames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myMaxFrames</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">currentFrames</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">myMaxFrames</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">currentFrames</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4831</span> </span><span class="WHIT">                </span><span class="NAME">myMaxWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myMaxWidth</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">currentWidth</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">myMaxWidth</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">currentWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4832</span> </span><span class="WHIT">                </span><span class="NAME">myMaxHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myMaxHeight</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">currentHeight</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">myMaxHeight</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">currentHeight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4833</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4834</span> 
<span class='line'>4835</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>4836</span>              * 第一ループ終了・取得データで先行してコンポを調整する
<span class='line'>4837</span>              * ここに問題あり　スマートインポータはよくフレームレートを間違うので
<span class='line'>4838</span>              * シートにあわせた調整が必要　どのタイミングで行なうか一考
<span class='line'>4839</span>              */</span><span class="WHIT">
<span class='line'>4840</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myCellFolder.items</span><span class="PUNC">[</span><span class="NAME">tlIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">frameRate</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">currentFrameRate</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4841</span> </span><span class="WHIT">                </span><span class="NAME">myCellFolder.items</span><span class="PUNC">[</span><span class="NAME">tlIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">frameRate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentFrameRate</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4842</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4843</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myCellFolder.items</span><span class="PUNC">[</span><span class="NAME">tlIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">duration</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">myMaxFrames</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">myXPS.framerate</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myMaxFrames</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4844</span> </span><span class="COMM">//			myCellFolder.items[tlIdx].duration=myMaxFrames/myXPS.framerate;</span><span class="WHIT">
<span class='line'>4845</span> </span><span class="WHIT">                </span><span class="NAME">myCellFolder.items</span><span class="PUNC">[</span><span class="NAME">tlIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">setFrames</span><span class="PUNC">(</span><span class="NAME">myMaxFrames</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4846</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4847</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myCellFolder.items</span><span class="PUNC">[</span><span class="NAME">tlIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">width</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">myMaxWidth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myMaxWidth</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4848</span> </span><span class="WHIT">                </span><span class="NAME">myCellFolder.items</span><span class="PUNC">[</span><span class="NAME">tlIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myMaxWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4849</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4850</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myCellFolder.items</span><span class="PUNC">[</span><span class="NAME">tlIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">height</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">myMaxHeight</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myMaxHeight</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4851</span> </span><span class="WHIT">                </span><span class="NAME">myCellFolder.items</span><span class="PUNC">[</span><span class="NAME">tlIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myMaxHeight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4852</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4853</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>4854</span>              * 第二ループ : ジオメトリデフォルト値でフッテージをグループに登録
<span class='line'>4855</span>              */</span><span class="WHIT">
<span class='line'>4856</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">myIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">tempArray</span><span class="PUNC">[</span><span class="NAME">tlIdx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">myIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4857</span> </span><span class="COMM">//			tempArray[tlIdx-1][myIdx];//登録アイテム</span><span class="WHIT">
<span class='line'>4858</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">myCellFolder.items</span><span class="PUNC">[</span><span class="NAME">tlIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">layers.byName</span><span class="PUNC">(</span><span class="NAME">tempArray</span><span class="PUNC">[</span><span class="NAME">tlIdx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">myIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4859</span> </span><span class="WHIT">                    </span><span class="COMM">/**
<span class='line'>4860</span>                      * 一応重複登録はしない(2度目以降の実行用に回避)
<span class='line'>4861</span>                      * @type {*|Array}
<span class='line'>4862</span>                      */</span><span class="WHIT">
<span class='line'>4863</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCellFolder.items</span><span class="PUNC">[</span><span class="NAME">tlIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">layers.add</span><span class="PUNC">(</span><span class="NAME">tempArray</span><span class="PUNC">[</span><span class="NAME">tlIdx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">myIdx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4864</span> </span><span class="WHIT">                    </span><span class="COMM">/**
<span class='line'>4865</span>                      * 登録時定型処理（基本的にはキー抜きだけだと思うけど別ファンクション推奨　いまは決めうち）
<span class='line'>4866</span>                      */</span><span class="WHIT">
<span class='line'>4867</span> </span><span class="WHIT">                    </span><span class="NAME">this.clipCell</span><span class="PUNC">(</span><span class="NAME">currentLayer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4868</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4869</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4870</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>4871</span>              * コンポ作成後処理 必要(設定)に従ってコンポに定型処理を施す
<span class='line'>4872</span>              * (スムージング等)(外部スクリプトを使う仕様)
<span class='line'>4873</span>              * @type {Folder}
<span class='line'>4874</span>              */</span><span class="WHIT">
<span class='line'>4875</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myAction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Folder</span><span class="PUNC">(</span><span class="NAME">Folder.scripts.path.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"/Scripts/nas/(actions)/systemResources/standbyCellFootages"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4876</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myAction.exists</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4877</span> </span><span class="WHIT">                </span><span class="NAME">myCellFolder.items</span><span class="PUNC">[</span><span class="NAME">tlIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">executeAction</span><span class="PUNC">(</span><span class="NAME">myAction</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4878</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4879</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>4880</span>              * 登録したグループをセレクトしておく
<span class='line'>4881</span>              * @type {boolean}
<span class='line'>4882</span>              */</span><span class="WHIT">
<span class='line'>4883</span> </span><span class="WHIT">            </span><span class="NAME">myCellFolder.items</span><span class="PUNC">[</span><span class="NAME">tlIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">selected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4884</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4885</span> 
<span class='line'>4886</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>4887</span>          * ラベルとフッテージ名を比較して上セル下セル合成親程度まで取り込む?
<span class='line'>4888</span>          * (問題ありそう。だけど効率上何とかしたい)
<span class='line'>4889</span>          * undo 閉じる
<span class='line'>4890</span>          */</span><span class="WHIT">
<span class='line'>4891</span> </span><span class="WHIT">        </span><span class="NAME">this.endUndoGroup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4892</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4893</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResultCount</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4894</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4895</span> </span><span class="COMM">//	nas.otome.standbyCellFootages()</span><span class="WHIT">
<span class='line'>4896</span> 
<span class='line'>4897</span> </span><span class="COMM">/**
<span class='line'>4898</span>  * @desc オブジェクト（プロパティ）ブラウザ関連
<span class='line'>4899</span>  */</span><span class="WHIT">
<span class='line'>4900</span> 
<span class='line'>4901</span> </span><span class="COMM">/**
<span class='line'>4902</span>  * オブジェクト（プロパティ）ブラウザ
<span class='line'>4903</span>  * オブジェクトをツリー表示しつつオブジェクトやプロパティをセレクトできる
<span class='line'>4904</span>  * 戻り値はオブジェクト　または　スクリプト　エクスプレッションで使用可能な文字列
<span class='line'>4905</span>  * ダブルカラムで選択ボタンつき　AE8以降ならダブルクリック選択も可能
<span class='line'>4906</span>  * オブジェクトツリーの取得にAE7以降のプロパティを使用しているので　AE6.5では動きません　あしからず
<span class='line'>4907</span>  * 
<span class='line'>4908</span>  * @param myItem
<span class='line'>4909</span>  * @returns {*}
<span class='line'>4910</span>  */</span><span class="WHIT">
<span class='line'>4911</span> </span><span class="NAME">nas.otome.getElementsFrom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4912</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">AEVersion</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">7</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4913</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>4914</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4915</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4916</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4917</span>      * 0番アイテムとして引数の親アイテムを登録する
<span class='line'>4918</span>      * 1番アイテムとして引数自体を登録する
<span class='line'>4919</span>      * @type {number}
<span class='line'>4920</span>      */</span><span class="WHIT">
<span class='line'>4921</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">itemCounts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4922</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myItem</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FolderItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4923</span> </span><span class="WHIT">        </span><span class="NAME">myResult</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myItem.parentFolder</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4924</span> </span><span class="WHIT">        </span><span class="NAME">myResult</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myItem</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4925</span> </span><span class="WHIT">        </span><span class="NAME">itemCounts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myItem.numItems</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4926</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cnt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">cnt</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">itemCounts</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">cnt</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4927</span> </span><span class="WHIT">            </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="NAME">myItem.item</span><span class="PUNC">(</span><span class="NAME">cnt</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4928</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4929</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4930</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myItem</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">CompItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4931</span> </span><span class="WHIT">            </span><span class="NAME">myResult</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myItem.parentFolder</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4932</span> </span><span class="WHIT">            </span><span class="NAME">myResult</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myItem</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4933</span> </span><span class="WHIT">            </span><span class="NAME">itemCounts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myItem.layers.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4934</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cnt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">cnt</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">itemCounts</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">cnt</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4935</span> </span><span class="WHIT">                </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="NAME">myItem.layer</span><span class="PUNC">(</span><span class="NAME">cnt</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4936</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4937</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4938</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myItem.property</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myItem.numProperties</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4939</span> </span><span class="WHIT">                </span><span class="NAME">myResult</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myItem.propertyDepth</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">myItem.containingComp</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">myItem.parentProperty</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4940</span> </span><span class="WHIT">                </span><span class="NAME">myResult</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myItem</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4941</span> </span><span class="WHIT">                </span><span class="NAME">itemCounts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myItem.numProperties</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4942</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cnt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">cnt</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">itemCounts</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">cnt</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4943</span> </span><span class="WHIT">                    </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="NAME">myItem.property</span><span class="PUNC">(</span><span class="NAME">cnt</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4944</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4945</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4946</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4947</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4948</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4949</span>      * 配下のオブジェクトを配列で返す(全て0オリジン)0,1は予約アイテム
<span class='line'>4950</span>      */</span><span class="WHIT">
<span class='line'>4951</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4952</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4953</span> 
<span class='line'>4954</span> </span><span class="COMM">/**
<span class='line'>4955</span>  * nas.otome.selectProperty(アイテム , オプション)
<span class='line'>4956</span>  * 引数:アイテム　フォルダアイテム(コンポ含む)・レイヤ・プロパティ　/ オプション 　"asObj" / "asExp" / "asJss"
<span class='line'>4957</span>  * 戻値:DOMオブジェクト　またはDOMオブジェクトを表すソース文字列
<span class='line'>4958</span>  * 
<span class='line'>4959</span>  * @param myItem
<span class='line'>4960</span>  * @param myOption
<span class='line'>4961</span>  * @returns {*}
<span class='line'>4962</span>  */</span><span class="WHIT">
<span class='line'>4963</span> </span><span class="NAME">nas.otome.selectProperty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myItem</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myOption</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4964</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">AEVersion</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">7</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4965</span> </span><span class="WHIT">        </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"申し訳ありませんがAE７以上の環境でご使用ください。"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4966</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4967</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4968</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myOption</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4969</span> </span><span class="WHIT">        </span><span class="NAME">myOption</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"asObj"</span><span class="WHIT">
<span class='line'>4970</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4971</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4972</span>      * デフォルトはオブジェクト直戻し？　エクスプレッションが良いかも？
<span class='line'>4973</span>      */</span><span class="WHIT">
<span class='line'>4974</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">app.project</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">app.project.items.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4975</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT">
<span class='line'>4976</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4977</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4978</span> </span><span class="WHIT">        </span><span class="NAME">myItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">app.project.numItems</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">app.project.item</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">parentFolder</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="COMM">//指定がなければルート</span><span class="WHIT">
<span class='line'>4979</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4980</span> 
<span class='line'>4981</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4982</span>      * 戻り値の初期値はスタートアイテム
<span class='line'>4983</span>      */</span><span class="WHIT">
<span class='line'>4984</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myItem</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4985</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4986</span>      * アイテムがフォルダか否かでプロパティのとりかたが違うので注意
<span class='line'>4987</span>      * パスバッファ
<span class='line'>4988</span>      * @type {Array}
<span class='line'>4989</span>      */</span><span class="WHIT">
<span class='line'>4990</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myItemPath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4991</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4992</span>      * パスバッファにアイテムを入れる
<span class='line'>4993</span>      */</span><span class="WHIT">
<span class='line'>4994</span> </span><span class="WHIT">    </span><span class="NAME">myItemPath.push</span><span class="PUNC">(</span><span class="NAME">myItem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4995</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4996</span>      * 初期値のアイテムの配下リストを作成
<span class='line'>4997</span>      * @type {*}
<span class='line'>4998</span>      */</span><span class="WHIT">
<span class='line'>4999</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myCurrentItms</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.otome.getElementsFrom</span><span class="PUNC">(</span><span class="NAME">myItem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5000</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5001</span>      * 存在するならば親のアイテムリストを作成
<span class='line'>5002</span>      * @type {null[]}
<span class='line'>5003</span>      */</span><span class="WHIT">
<span class='line'>5004</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myParentItms</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myCurrentItms</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">nas.otome.getElementsFrom</span><span class="PUNC">(</span><span class="NAME">myCurrentItms</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5005</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5006</span>      * 初期値未設定だった場合のみルートを隠蔽するためにひとステップ下に
<span class='line'>5007</span>      */</span><span class="WHIT">
<span class='line'>5008</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myParentItms</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myParentItms</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5009</span> </span><span class="WHIT">        </span><span class="NAME">myParentItms</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCurrentItms</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5010</span> </span><span class="WHIT">        </span><span class="NAME">myCurrentItms</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>5011</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5012</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>5013</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5014</span>      * アイテムが第一階層だった場合ひとステップ上に
<span class='line'>5015</span>      * @type {Array}
<span class='line'>5016</span>      */</span><span class="WHIT">
<span class='line'>5017</span> </span><span class="COMM">//if((myCurrentItms[0]==null)&&(myParentItms[1]==null)){myParentItms=myCurrentItms;myCurrentItms=[null,null]};</span><span class="WHIT">
<span class='line'>5018</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">prpNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5019</span> 
<span class='line'>5020</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">getNames</span><span class="PUNC">(</span><span class="NAME">Itmlst</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5021</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Itmlst.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5022</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"( .. )"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5023</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cnt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">cnt</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">Itmlst.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">cnt</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5024</span> 
<span class='line'>5025</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Itmlst</span><span class="PUNC">[</span><span class="NAME">cnt</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FolderItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5026</span> </span><span class="WHIT">                    </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="STRN">"-folder->"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Itmlst</span><span class="PUNC">[</span><span class="NAME">cnt</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5027</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5028</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Itmlst</span><span class="PUNC">[</span><span class="NAME">cnt</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">propertyDepth</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5029</span> </span><span class="WHIT">                        </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="NAME">Itmlst</span><span class="PUNC">[</span><span class="NAME">cnt</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5030</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5031</span> </span><span class="WHIT">                        </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="NAME">Itmlst</span><span class="PUNC">[</span><span class="NAME">cnt</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5032</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5033</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5034</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5035</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5036</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"( .. )"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5037</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5038</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5039</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5040</span> 
<span class='line'>5041</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5042</span>      * length個のブール配列指定インデックスだけtrue
<span class='line'>5043</span>      * @param index
<span class='line'>5044</span>      * @param length
<span class='line'>5045</span>      * @returns {Array}
<span class='line'>5046</span>      */</span><span class="WHIT">
<span class='line'>5047</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">getChecks</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5048</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5049</span> </span><span class="COMM">//	for(var id=0;id&lt;length;id++){myResult[id]=(id==index)?true:false};</span><span class="WHIT">
<span class='line'>5050</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5051</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5052</span> </span><span class="WHIT">                </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5053</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5054</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5055</span> </span><span class="WHIT">                </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5056</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5057</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5058</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5059</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5060</span> 
<span class='line'>5061</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">getIndex</span><span class="PUNC">(</span><span class="NAME">myObj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5062</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myObj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5063</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5064</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5065</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myObj.propertyIndex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5066</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myObj.propertyIndex</span><span class="WHIT">
<span class='line'>5067</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5068</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myObj.index</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5069</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myObj.index</span><span class="WHIT">
<span class='line'>5070</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5071</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myObj.id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5072</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">app.project.numItems</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5073</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">app.project.item</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">myObj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5074</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5075</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5076</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5077</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5078</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5079</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5080</span> 
<span class='line'>5081</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5082</span>      * UI
<span class='line'>5083</span>      * @type {number}
<span class='line'>5084</span>      */</span><span class="WHIT">
<span class='line'>5085</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">colWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5086</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">colHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5087</span> 
<span class='line'>5088</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.GUI.newWindow</span><span class="PUNC">(</span><span class="STRN">"dialog"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myResult.name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">colWidth</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">colHeight</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5089</span> </span><span class="WHIT">    </span><span class="NAME">w.up</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.GUI.addListBox</span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">getNames</span><span class="PUNC">(</span><span class="NAME">myParentItms</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">getIndex</span><span class="PUNC">(</span><span class="NAME">myCurrentItms</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">0.3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">colWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">colHeight</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5090</span> </span><span class="WHIT">    </span><span class="NAME">w.lo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.GUI.addListBox</span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">getNames</span><span class="PUNC">(</span><span class="NAME">myCurrentItms</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">colWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">0.3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">colWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">colHeight</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5091</span> </span><span class="WHIT">    </span><span class="NAME">w.btn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.GUI.addButton</span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"select"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">colHeight</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">0.3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">colWidth</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5092</span> 
<span class='line'>5093</span> </span><span class="WHIT">    </span><span class="NAME">w.up.onChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5094</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.selected</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5095</span> </span><span class="WHIT">            </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myParentItms</span><span class="PUNC">[</span><span class="NAME">this.selected</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5096</span> </span><span class="WHIT">            </span><span class="NAME">this.parent.text</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myResult.name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5097</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5098</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.selected</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5099</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>5100</span>              * 上のカラムさらに上へ行くときは下のカラムを破棄して入れ替え　その後上のアイテムを取得
<span class='line'>5101</span>              * 上がルートフォルダだった場合は何もしない
<span class='line'>5102</span>              * @type {null}
<span class='line'>5103</span>              */</span><span class="WHIT">
<span class='line'>5104</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">upperItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myParentItms</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5105</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myParentItms</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5106</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">upperItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5107</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>5108</span>                  * 入れ替え
<span class='line'>5109</span>                  * @type {null[]}
<span class='line'>5110</span>                  */</span><span class="WHIT">
<span class='line'>5111</span> </span><span class="WHIT">                </span><span class="NAME">myCurrentItms</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myParentItms</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5112</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>5113</span>                  * 取得
<span class='line'>5114</span>                  * @type {*}
<span class='line'>5115</span>                  */</span><span class="WHIT">
<span class='line'>5116</span> </span><span class="WHIT">                </span><span class="NAME">myParentItms</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.otome.getElementsFrom</span><span class="PUNC">(</span><span class="NAME">upperItem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5117</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">getIndex</span><span class="PUNC">(</span><span class="NAME">currentItem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5118</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newupperItems</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">getNames</span><span class="PUNC">(</span><span class="NAME">myParentItms</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5119</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newlowerItems</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">getNames</span><span class="PUNC">(</span><span class="NAME">myCurrentItms</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5120</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dbg</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5121</span> </span><span class="WHIT">                    </span><span class="NAME">nas.otome.writeConsole</span><span class="PUNC">(</span><span class="NAME">newupperItems.length</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" : "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">newupperItems.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5122</span> </span><span class="WHIT">                    </span><span class="NAME">nas.otome.writeConsole</span><span class="PUNC">(</span><span class="NAME">getChecks</span><span class="PUNC">(</span><span class="NAME">myIndex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newupperItems.length</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5123</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5124</span> </span><span class="WHIT">                </span><span class="NAME">this.parent.lo.setOptions</span><span class="PUNC">(</span><span class="NAME">newlowerItems</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="KEYW">false</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5125</span> </span><span class="WHIT">                </span><span class="NAME">this.setOptions</span><span class="PUNC">(</span><span class="NAME">newupperItems</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">getChecks</span><span class="PUNC">(</span><span class="NAME">myIndex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newupperItems.length</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5126</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5127</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>5128</span>                  * ツリー上端なので下カラムの選択をクリア
<span class='line'>5129</span>                  */</span><span class="WHIT">
<span class='line'>5130</span> </span><span class="WHIT">                </span><span class="NAME">this.parent.lo.setOptions</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5131</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5132</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5133</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>5134</span>              * 切り替えなので下のアイテムを新規取得してクリア
<span class='line'>5135</span>              * 配下アイテムがない場合は選択のみでスキップ
<span class='line'>5136</span>              * @type {*}
<span class='line'>5137</span>              */</span><span class="WHIT">
<span class='line'>5138</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">selectedItems</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.otome.getElementsFrom</span><span class="PUNC">(</span><span class="NAME">myParentItms</span><span class="PUNC">[</span><span class="NAME">this.selected</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5139</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">selectedItems.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5140</span> </span><span class="WHIT">                </span><span class="NAME">myCurrentItms</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">selectedItems</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5141</span> </span><span class="WHIT">                </span><span class="NAME">this.parent.lo.setOptions</span><span class="PUNC">(</span><span class="NAME">getNames</span><span class="PUNC">(</span><span class="NAME">myCurrentItms</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5142</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5143</span> </span><span class="WHIT">                </span><span class="NAME">this.parent.lo.setOptions</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5144</span> 
<span class='line'>5145</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5146</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5147</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5148</span> 
<span class='line'>5149</span> </span><span class="WHIT">    </span><span class="NAME">w.lo.onChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5150</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.selected</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5151</span> </span><span class="WHIT">            </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCurrentItms</span><span class="PUNC">[</span><span class="NAME">this.selected</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5152</span> </span><span class="WHIT">            </span><span class="NAME">this.parent.text</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myResult.name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5153</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5154</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.selected</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5155</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>5156</span>              * 下のカラム　上へ行くときはnop?
<span class='line'>5157</span>              */</span><span class="WHIT">
<span class='line'>5158</span> </span><span class="WHIT">            </span><span class="COMM">//this.parent.up.setOptions(getNames(myParentItms),[]);</span><span class="WHIT">
<span class='line'>5159</span> </span><span class="WHIT">            </span><span class="COMM">//this.parent.lo.setOptions(getNames(myCurrentItms),[]);</span><span class="WHIT">
<span class='line'>5160</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5161</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>5162</span>              * 切り替え 現状のアイテムを上へ移動して下のアイテムを取得して表示
<span class='line'>5163</span>              * 下位アイテムがなければ選択のみで動作スキップ
<span class='line'>5164</span>              * @type {*}
<span class='line'>5165</span>              */</span><span class="WHIT">
<span class='line'>5166</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">selectedItems</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.otome.getElementsFrom</span><span class="PUNC">(</span><span class="NAME">myCurrentItms</span><span class="PUNC">[</span><span class="NAME">this.selected</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5167</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">selectedItems.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5168</span> </span><span class="WHIT">                </span><span class="NAME">myParentItms</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCurrentItms</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5169</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newupperLists</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">getNames</span><span class="PUNC">(</span><span class="NAME">myParentItms</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//なぜいったん変数にとると安定？</span><span class="WHIT">
<span class='line'>5170</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dbg</span><span class="PUNC">)</span><span class="WHIT">                </span><span class="NAME">nas.otome.writeConsole</span><span class="PUNC">(</span><span class="NAME">newupperLists.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5171</span> </span><span class="WHIT">                </span><span class="NAME">this.parent.up.setOptions</span><span class="PUNC">(</span><span class="NAME">newupperLists</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">getChecks</span><span class="PUNC">(</span><span class="NAME">this.selected</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newupperLists.length</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5172</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dbg</span><span class="PUNC">)</span><span class="WHIT">                </span><span class="NAME">nas.otome.writeConsole</span><span class="PUNC">(</span><span class="NAME">getNames</span><span class="PUNC">(</span><span class="NAME">myParentItms</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5173</span> </span><span class="WHIT">                </span><span class="NAME">myCurrentItms</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">selectedItems</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5174</span> </span><span class="WHIT">                </span><span class="NAME">this.setOptions</span><span class="PUNC">(</span><span class="NAME">getNames</span><span class="PUNC">(</span><span class="NAME">myCurrentItms</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="KEYW">false</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5175</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5176</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5177</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5178</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5179</span> </span><span class="WHIT">    </span><span class="NAME">w.btn.onClick</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5180</span> </span><span class="WHIT">        </span><span class="NAME">this.parent.close</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5181</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5182</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5183</span>      * 新UIのときのみダブルクリック認識
<span class='line'>5184</span>      */</span><span class="WHIT">
<span class='line'>5185</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">w.up.listBox</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5186</span> </span><span class="WHIT">        </span><span class="NAME">w.up.listBox.onDoubleClick</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5187</span> </span><span class="WHIT">            </span><span class="NAME">this.parent.parent.close</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5188</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5189</span> </span><span class="WHIT">        </span><span class="NAME">w.lo.listBox.onDoubleClick</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5190</span> </span><span class="WHIT">            </span><span class="NAME">this.parent.parent.close</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5191</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5192</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5193</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5194</span>      * 終了時処理
<span class='line'>5195</span>      */</span><span class="WHIT">
<span class='line'>5196</span> </span><span class="WHIT">    </span><span class="NAME">w.onClose</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5197</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5198</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5199</span>      * ダイアログが閉じたらリザルトを戻して終了
<span class='line'>5200</span>      */</span><span class="WHIT">
<span class='line'>5201</span> </span><span class="WHIT">    </span><span class="NAME">w.show</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5202</span> 
<span class='line'>5203</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResultText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5204</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5205</span>      * エクスプレッションモードの際は戻せないオブジェクトがあるので、その場合クロースをキャンセルして再帰する
<span class='line'>5206</span>      */</span><span class="WHIT">
<span class='line'>5207</span> </span><span class="WHIT">    </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myOption</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5208</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"asJss"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>5209</span> </span><span class="WHIT">            </span><span class="NAME">myResultText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.otome.asSourceString</span><span class="PUNC">(</span><span class="NAME">myResult</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myItem</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"scripts"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5210</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5211</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"asExp"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>5212</span> </span><span class="WHIT">            </span><span class="NAME">myResultText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.otome.asSourceString</span><span class="PUNC">(</span><span class="NAME">myResult</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myItem</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"expression"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5213</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5214</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"asObj"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>5215</span> </span><span class="WHIT">        </span><span class="KEYW">default</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>5216</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5217</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5218</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myResultText</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5219</span> </span><span class="WHIT">        </span><span class="NAME">myResultText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.otome.selectProperty</span><span class="PUNC">(</span><span class="NAME">myResult</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myOption</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5220</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5221</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResultText</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5222</span> 
<span class='line'>5223</span> </span><span class="COMM">//return myResult;</span><span class="WHIT">
<span class='line'>5224</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5225</span> 
<span class='line'>5226</span> </span><span class="COMM">/**
<span class='line'>5227</span>  * オブジェクトを文字列化する
<span class='line'>5228</span>  * nas.otome.asSourceString(オブジェクト,基点オブジェクト,出力形式)
<span class='line'>5229</span>  * 引数: AE-DOMオブジェクト（プロパティ含む）,基点オブジェクト,戻り値の形式
<span class='line'>5230</span>  * 戻り値:エクスプレッションまたはスクリプトのソーステキスト　または　false
<span class='line'>5231</span>  * 例:
<span class='line'>5232</span>  * myText=nas.otome.asSourceString(app.project.activeItem.layer(1));
<span class='line'>5233</span>  * >> comp("コンポ １").layer("ホワイト平面　１") …等々
<span class='line'>5234</span>  *
<span class='line'>5235</span>  * 引数のAE DOMオブジェクトをエクスプレッション内で利用可能な文字列にして返す関数
<span class='line'>5236</span>  * エクスプレッションモードとスクリプトモードをもつ。デフォルトはエクスプレッション
<span class='line'>5237</span>  * 文字列に変換失敗の場合は、falseを返すので各自判定のこと
<span class='line'>5238</span>  * 基点オブジェクトが指定された場合はそのオブジェクトを検知した場合そこでパス構築を打ち切る
<span class='line'>5239</span>  * デフォルトは"ルート"
<span class='line'>5240</span>  *
<span class='line'>5241</span>  * @param myItem
<span class='line'>5242</span>  * @param myBase
<span class='line'>5243</span>  * @param myForm
<span class='line'>5244</span>  * @returns {*}
<span class='line'>5245</span>  */</span><span class="WHIT">
<span class='line'>5246</span> </span><span class="NAME">nas.otome.asSourceString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myItem</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myBase</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myForm</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5247</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">AEVersion</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">7</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5248</span> </span><span class="WHIT">        </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"申し訳ありませんがAE７以上の環境でご使用ください。"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5249</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5250</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5251</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myForm</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5252</span> </span><span class="WHIT">        </span><span class="NAME">myForm</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"expression"</span><span class="WHIT">
<span class='line'>5253</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5254</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myBase</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5255</span> </span><span class="WHIT">        </span><span class="NAME">myBase</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">app.project.items.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">app.project.items.item</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">parent</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT">
<span class='line'>5256</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5257</span> 
<span class='line'>5258</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5259</span>      * 基点は”ルート”またはnull
<span class='line'>5260</span>      * 内部ファンクション　オブジェクトのインデックス（相当ID）を返す
<span class='line'>5261</span>      * @param myObj
<span class='line'>5262</span>      * @returns {*}
<span class='line'>5263</span>      */</span><span class="WHIT">
<span class='line'>5264</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">getIndex</span><span class="PUNC">(</span><span class="NAME">myObj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5265</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myObj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5266</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>5267</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5268</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>5269</span>          * オブジェクト無ければ０
<span class='line'>5270</span>          */</span><span class="WHIT">
<span class='line'>5271</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myObj.propertyIndex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5272</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myObj.propertyIndex</span><span class="WHIT">
<span class='line'>5273</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5274</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>5275</span>          * プロパティ
<span class='line'>5276</span>          */</span><span class="WHIT">
<span class='line'>5277</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myObj.index</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5278</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myObj.index</span><span class="WHIT">
<span class='line'>5279</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5280</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>5281</span>          * インデックスプロパティをもっている=Layer
<span class='line'>5282</span>          */</span><span class="WHIT">
<span class='line'>5283</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myObj.id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5284</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">app.project.numItems</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5285</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">app.project.item</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">myObj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5286</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT">
<span class='line'>5287</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5288</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5289</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5290</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>5291</span>          * FoldeItem/CompItem/FootageItem等
<span class='line'>5292</span>          */</span><span class="WHIT">
<span class='line'>5293</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//不明（例外）オブジェクト</span><span class="WHIT">
<span class='line'>5294</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5295</span> 
<span class='line'>5296</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5297</span>      * 統一環境のためアイテムフォルダの親子関係は見ないでソース化する…ツリーをとったほうがよいかなぁ
<span class='line'>5298</span>      * @type {number}
<span class='line'>5299</span>      */</span><span class="WHIT">
<span class='line'>5300</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myDepth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5301</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>5302</span> </span><span class="WHIT">        </span><span class="PUNC">(</span><span class="NAME">myItem</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FolderItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>5303</span> </span><span class="WHIT">        </span><span class="PUNC">(</span><span class="NAME">myItem</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">CompItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>5304</span> </span><span class="WHIT">        </span><span class="PUNC">(</span><span class="NAME">myItem</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FootageItem</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5305</span> </span><span class="WHIT">    </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5306</span> </span><span class="WHIT">        </span><span class="NAME">myDepth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5307</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5308</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myItem</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Property</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5309</span> </span><span class="WHIT">            </span><span class="NAME">myDepth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myItem.propertyDepth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5310</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5311</span> </span><span class="WHIT">            </span><span class="NAME">myDepth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5312</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5313</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5314</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5315</span>      * オブジェクトパスを作る
<span class='line'>5316</span>      * @type {Array}
<span class='line'>5317</span>      */</span><span class="WHIT">
<span class='line'>5318</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myObPath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5319</span> </span><span class="WHIT">    </span><span class="NAME">myObPath.push</span><span class="PUNC">(</span><span class="NAME">myItem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5320</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentObj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myItem</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5321</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">did</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myDepth</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">did</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">did</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5322</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentObj</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">myBase</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5323</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="WHIT">
<span class='line'>5324</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5325</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>5326</span>          * 基点と一致したら構築打ち切り
<span class='line'>5327</span>          */</span><span class="WHIT">
<span class='line'>5328</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">currentObj</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FolderItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentObj</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">CompItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentObj</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FootageItem</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5329</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5330</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5331</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentObj.parentProperty</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5332</span> </span><span class="WHIT">                </span><span class="NAME">myObPath.push</span><span class="PUNC">(</span><span class="NAME">currentObj.parentProperty</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5333</span> </span><span class="WHIT">                </span><span class="NAME">currentObj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentObj.parentProperty</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5334</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5335</span> </span><span class="WHIT">                </span><span class="NAME">myObPath.push</span><span class="PUNC">(</span><span class="NAME">currentObj.containingComp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5336</span> </span><span class="WHIT">                </span><span class="NAME">currentObj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentObj.containingComp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5337</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5338</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5339</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>5340</span>          * ループ共通処理
<span class='line'>5341</span>          */</span><span class="WHIT">
<span class='line'>5342</span> 
<span class='line'>5343</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5344</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5345</span>      * 引数オブジェクトをソースで使用可能な文字列に変換する　乙女のメソッドにする　AE専用バージョン縛りアリ
<span class='line'>5346</span>      */</span><span class="WHIT">
<span class='line'>5347</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myForm</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"scripts"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5348</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>5349</span>          * スクリプトでは全て参照可能
<span class='line'>5350</span>          * "app.project.item("+ItemIndex+")" ;//ここからスタート
<span class='line'>5351</span>          * @type {Array}
<span class='line'>5352</span>          */</span><span class="WHIT">
<span class='line'>5353</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myObPthName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5354</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myObPath.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5355</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myObj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myObPath</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5356</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>5357</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="NAME">myObj</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FolderItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>5358</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="NAME">myObj</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FootageItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>5359</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="NAME">myObj</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">CompItem</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5360</span> </span><span class="WHIT">            </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5361</span> </span><span class="WHIT">                </span><span class="NAME">myObPthName.push</span><span class="PUNC">(</span><span class="STRN">"items["</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">getIndex</span><span class="PUNC">(</span><span class="NAME">myObj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"]"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5362</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5363</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myObj.parentProperty</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5364</span> </span><span class="WHIT">                    </span><span class="NAME">myObPthName.push</span><span class="PUNC">(</span><span class="STRN">"property("</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myObj.propertyIndex</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">")"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5365</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5366</span> </span><span class="WHIT">                    </span><span class="NAME">myObPthName.push</span><span class="PUNC">(</span><span class="STRN">"layer("</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myObj.index</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">")"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5367</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5368</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5369</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5370</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myObPthName.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5371</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"app.project."</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myObPthName.reverse</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">"."</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5372</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5373</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5374</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5375</span> 
<span class='line'>5376</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5377</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>5378</span>          * エクスプレッションソースを作成する場合は同じスコープレベルの判定が必要
<span class='line'>5379</span>          * 基点オブジェクトから親レイヤと親コンポを特定
<span class='line'>5380</span>          * 同じコンポ内ならコンポは省略　同じレイヤ内なら親レイヤまで省略可能　というステップでゆくべき
<span class='line'>5381</span>          * 前段の基点オブジェクト遭遇での探索打ち切りは、計算アイテムの削減に有効なのでそのまま保持
<span class='line'>5382</span>          *
<span class='line'>5383</span>          * @type {null}
<span class='line'>5384</span>          */</span><span class="WHIT">
<span class='line'>5385</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myParentComp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5386</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myParentLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5387</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myBase.propertyDepth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myBase.propertyDepth</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5388</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentObj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myBase.propertyDepth</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">myBase.containingComp</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">myBase.parentProperty</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5389</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">myBase.propertyDepth</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5390</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentObj</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">CompItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5391</span> </span><span class="WHIT">                    </span><span class="NAME">myParentComp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentObj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5392</span> </span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5393</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5394</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentObj.propertyDepth</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5395</span> </span><span class="WHIT">                    </span><span class="NAME">myParentLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentObj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5396</span> </span><span class="WHIT">                    </span><span class="NAME">currentObj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentObj.containingComp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5397</span> </span><span class="WHIT">                    </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5398</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5399</span> </span><span class="WHIT">                </span><span class="NAME">currentObj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentObj.parentProperty</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5400</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5401</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5402</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>5403</span>          * この下はマッチネームとエクスプレッション用プレフィックスの対比テーブルAEバージョン変更時に再検査必要
<span class='line'>5404</span>          * @type {string[]}
<span class='line'>5405</span>          */</span><span class="WHIT">
<span class='line'>5406</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myPrefixes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>5407</span> </span><span class="WHIT">            </span><span class="STRN">"marker"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5408</span> </span><span class="WHIT">            </span><span class="STRN">"timeRemap"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5409</span> </span><span class="WHIT">            </span><span class="STRN">"motionTracker"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5410</span> </span><span class="WHIT">            </span><span class="STRN">"mask"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5411</span> </span><span class="WHIT">            </span><span class="STRN">"effect"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5412</span> </span><span class="WHIT">            </span><span class="STRN">"transform"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5413</span> </span><span class="WHIT">            </span><span class="STRN">"layerStyle"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5414</span> </span><span class="WHIT">            </span><span class="STRN">"materialOption"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5415</span> </span><span class="WHIT">            </span><span class="STRN">"audio"</span><span class="WHIT">
<span class='line'>5416</span> </span><span class="WHIT">        </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5417</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>5418</span>          * @type {string[]}
<span class='line'>5419</span>          */</span><span class="WHIT">
<span class='line'>5420</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">matchNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>5421</span> </span><span class="WHIT">            </span><span class="STRN">"ADBE Marker"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5422</span> </span><span class="WHIT">            </span><span class="STRN">"ADBE Time Remapping"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5423</span> </span><span class="WHIT">            </span><span class="STRN">"ADBE MTrackers"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5424</span> </span><span class="WHIT">            </span><span class="STRN">"ADBE Mask Parade"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5425</span> </span><span class="WHIT">            </span><span class="STRN">"ADBE Effect Parade"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5426</span> </span><span class="WHIT">            </span><span class="STRN">"ADBE Transform Group"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5427</span> </span><span class="WHIT">            </span><span class="STRN">"ADBE Layer Styles"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5428</span> </span><span class="WHIT">            </span><span class="STRN">"ADBE Material Options Group"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5429</span> </span><span class="WHIT">            </span><span class="STRN">"ADBE Audio Group"</span><span class="WHIT">
<span class='line'>5430</span> </span><span class="WHIT">        </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5431</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myPRFX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5432</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myPrefixes.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5433</span> </span><span class="WHIT">            </span><span class="NAME">myPRFX</span><span class="PUNC">[</span><span class="NAME">matchNames</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myPrefixes</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>5434</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5435</span> 
<span class='line'>5436</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myObPthName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5437</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myObPath.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5438</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myObj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myObPath</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5439</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>5440</span>              * FolderとFootage‘はスキップする必要アリ
<span class='line'>5441</span>              */</span><span class="WHIT">
<span class='line'>5442</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myObj</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">myParentComp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myObj</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">myParentLayer</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5443</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="WHIT">
<span class='line'>5444</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5445</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myObj</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FolderItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myObj</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">FootageItem</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5446</span> </span><span class="WHIT">                </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5447</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5448</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myObj</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">CompItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5449</span> </span><span class="WHIT">                </span><span class="NAME">myObPthName.push</span><span class="PUNC">(</span><span class="STRN">"comp(\""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myObj.name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\")."</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5450</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5451</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myObj.parentProperty</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5452</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myObj.propertyDepth</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5453</span> </span><span class="WHIT">                        </span><span class="NAME">myObPthName.push</span><span class="PUNC">(</span><span class="NAME">myPRFX</span><span class="PUNC">[</span><span class="NAME">myObj.matchName</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5454</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5455</span> </span><span class="WHIT">                        </span><span class="NAME">myObPthName.push</span><span class="PUNC">(</span><span class="STRN">"(\""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myObj.name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\")"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5456</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5457</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5458</span> </span><span class="WHIT">                    </span><span class="NAME">myObPthName.push</span><span class="PUNC">(</span><span class="STRN">"layer(\""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myObj.name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\")."</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5459</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5460</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5461</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5462</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myObPthName.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5463</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myObPthName.reverse</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\.$/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5464</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5465</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5466</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5467</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5468</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5469</span> 
<span class='line'>5470</span> </span><span class="COMM">/**
<span class='line'>5471</span>  * オブジェクト（プロパティ）ブラウザ関連
<span class='line'>5472</span>  * 乙女プリファレンスの読み込みと保存
<span class='line'>5473</span>  * 保存するオブジェクトをそれぞれ１ファイルで設定フォルダへjsonテキストで保存する
<span class='line'>5474</span>  * 拡張子は.json
<span class='line'>5475</span>  * ファイル名はオブジェクト（プロパティ）名をそのまま
<span class='line'>5476</span>  * 例: nas.inputMedias.body.json 等
<span class='line'>5477</span>  * プリファレンスとして保存するオブジェクトはこのファイルの設定として固定
<span class='line'>5478</span>  * 読み込みは記録フォルダの内部を検索してオブジェクトの存在するもの全て
<span class='line'>5479</span>  * 新規のオブジェクトは作成しない
<span class='line'>5480</span>  */</span><span class="WHIT">
<span class='line'>5481</span> 
<span class='line'>5482</span> </span><span class="COMM">//nas.otome.preferenceFolder=new Folder(Folder.nas.path+"/nas/lib/etc");//保存場所固定</span><span class="WHIT">
<span class='line'>5483</span> </span><span class="NAME">nas.otome.preferenceFolder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Folder</span><span class="PUNC">(</span><span class="NAME">Folder.userData.path</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"/"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Folder.userData.name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"/nas/lib/etc"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//保存場所固定</span><span class="WHIT">
<span class='line'>5484</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">nas.otome.preferenceFolder.exists</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5485</span> </span><span class="WHIT">    </span><span class="NAME">nas.otome.preferenceFolder.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5486</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5487</span> </span><span class="COMM">/**
<span class='line'>5488</span>  * nas.otome.readPreference(myPropName)
<span class='line'>5489</span>  * 設定の保存・復帰用関数
<span class='line'>5490</span>  * 引数:プロパティ名
<span class='line'>5491</span>  * 戻値:なし
<span class='line'>5492</span>  * 引数が指定されない場合は保存されている全てのプロパティを読み込む
<span class='line'>5493</span>  * 読み込まれた同名のプロパティは上書き
<span class='line'>5494</span>  *
<span class='line'>5495</span>  * @param myPropName
<span class='line'>5496</span>  */</span><span class="WHIT">
<span class='line'>5497</span> </span><span class="NAME">nas.otome.readPreference</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myPropName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5498</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myPropName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5499</span> </span><span class="WHIT">        </span><span class="NAME">myPropName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"*"</span><span class="WHIT">
<span class='line'>5500</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5501</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myPrefFiles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.preferenceFolder.getFiles</span><span class="PUNC">(</span><span class="NAME">myPropName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">".json"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5502</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myPrefFiles.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5503</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myPropName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myPrefFiles</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name.replace</span><span class="PUNC">(</span><span class="REGX">/\.json$/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5504</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">eval</span><span class="PUNC">(</span><span class="NAME">myPropName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5505</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myOpenFile</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">File</span><span class="PUNC">(</span><span class="NAME">myPrefFiles</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fsName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5506</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">canRead</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myOpenFile.open</span><span class="PUNC">(</span><span class="STRN">"r"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5507</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">canRead</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5508</span> </span><span class="WHIT">                </span><span class="NAME">myOpenFile.encoding</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"UTF-8"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5509</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myOpenFile.read</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5510</span> </span><span class="WHIT">                </span><span class="NAME">myOpenFile.close</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5511</span> </span><span class="WHIT">                </span><span class="NAME">nas.otome.writeConsole</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5512</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myContent.match</span><span class="PUNC">(</span><span class="REGX">/\(new\sNumber\(([0-9\.]+)\)\)/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5513</span> </span><span class="WHIT">                    </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myContent.replace</span><span class="PUNC">(</span><span class="REGX">/\(new\sNumber(\([0-9\.]+\))\)/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5514</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myPropName.match</span><span class="PUNC">(</span><span class="REGX">/(.*[^\.])\.selected/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">eval</span><span class="PUNC">(</span><span class="NAME">RegExp.$1</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"  instanceof nTable"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5515</span> </span><span class="WHIT">                        </span><span class="NAME">eval</span><span class="PUNC">(</span><span class="NAME">RegExp.$1</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">".select\("</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\)"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5516</span> </span><span class="COMM">//	alert(myContent);</span><span class="WHIT">
<span class='line'>5517</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5518</span> </span><span class="WHIT">                        </span><span class="NAME">eval</span><span class="PUNC">(</span><span class="NAME">myPropName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" =("</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">")"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5519</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5520</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5521</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myContent.match</span><span class="PUNC">(</span><span class="REGX">/\(new\sString\((.+)\)\)/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5522</span> </span><span class="WHIT">                        </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myContent.replace</span><span class="PUNC">(</span><span class="REGX">/\(new\sString(\(.+)\)\)/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5523</span> </span><span class="WHIT">                        </span><span class="NAME">eval</span><span class="PUNC">(</span><span class="NAME">myPropName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" ="</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5524</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5525</span> </span><span class="WHIT">                        </span><span class="NAME">nas.otome.writeConsole</span><span class="PUNC">(</span><span class="NAME">myPropName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" = eval("</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">")"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5526</span> </span><span class="WHIT">                        </span><span class="NAME">eval</span><span class="PUNC">(</span><span class="NAME">myPropName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" =eval("</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">")"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5527</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5528</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5529</span> 
<span class='line'>5530</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5531</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5532</span> </span><span class="WHIT">            </span><span class="NAME">nas.otome.writeConsole</span><span class="PUNC">(</span><span class="STRN">"cannot Replace prop "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myPropName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5533</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5534</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5535</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5536</span> 
<span class='line'>5537</span> </span><span class="COMM">/**
<span class='line'>5538</span>  * nas.otome.writePreference(myPrefs)
<span class='line'>5539</span>  * 設定の保存・復帰用関数
<span class='line'>5540</span>  * 引数:オブジェクト
<span class='line'>5541</span>  * 戻値:なし
<span class='line'>5542</span>  * 引数のオブジェクトをjsonで規定のフォルダに保存する
<span class='line'>5543</span>  * １オブジェクトにつき1ファイルを書き出す
<span class='line'>5544</span>  * jsonで保存に適さないオブジェクトを指定しないように注意すること
<span class='line'>5545</span>  * 引数が指定されない場合はシステム指定のオブジェクトを保存する
<span class='line'>5546</span>  *
<span class='line'>5547</span>  * @param myPrefs
<span class='line'>5548</span>  */</span><span class="WHIT">
<span class='line'>5549</span> </span><span class="NAME">nas.otome.writePreference</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myPrefs</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5550</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myPrefs</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5551</span> </span><span class="WHIT">        </span><span class="NAME">myPrefs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>5552</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5553</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">myPrefs</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5554</span> </span><span class="WHIT">        </span><span class="NAME">myPrefs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">myPrefs</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>5555</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5556</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5557</span>      * 配列に
<span class='line'>5558</span>      */</span><span class="WHIT">
<span class='line'>5559</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myPrefs.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5560</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>5561</span>          * 試験用あとで調整
<span class='line'>5562</span>          * @type {string[]}
<span class='line'>5563</span>          */</span><span class="WHIT">
<span class='line'>5564</span> </span><span class="WHIT">        </span><span class="NAME">myPrefs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>5565</span> </span><span class="WHIT">            </span><span class="STRN">"nas.inputMedias.bodys"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5566</span> </span><span class="WHIT">            </span><span class="STRN">"nas.inputMedias.selected"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5567</span> </span><span class="WHIT">            </span><span class="STRN">"nas.outputMedias.bodys"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5568</span> </span><span class="WHIT">            </span><span class="STRN">"nas.outputMedias.selected"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5569</span> </span><span class="WHIT">            </span><span class="STRN">"nas.workTitles.bodys"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5570</span> </span><span class="WHIT">            </span><span class="STRN">"nas.workTitles.selected"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5571</span> </span><span class="WHIT">            </span><span class="STRN">"myName"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5572</span> </span><span class="WHIT">            </span><span class="STRN">"nas.RESOLUTION"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5573</span> </span><span class="WHIT">            </span><span class="STRN">"nas.FRATE"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5574</span> </span><span class="WHIT">            </span><span class="STRN">"nas.SheetLength"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5575</span> </span><span class="WHIT">            </span><span class="STRN">"nas.importFilter"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5576</span> </span><span class="WHIT">            </span><span class="STRN">"nas.cellRegex"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5577</span> </span><span class="WHIT">            </span><span class="STRN">"nas.bgRegex"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5578</span> </span><span class="WHIT">            </span><span class="STRN">"nas.mgRegex"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5579</span> </span><span class="WHIT">            </span><span class="STRN">"nas.loRegex"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5580</span> </span><span class="WHIT">            </span><span class="STRN">"nas.expressions"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5581</span> </span><span class="WHIT">            </span><span class="STRN">"nas.ftgFolders.lo"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5582</span> </span><span class="WHIT">            </span><span class="STRN">"nas.ftgFolders.frame"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5583</span> </span><span class="WHIT">            </span><span class="STRN">"nas.ftgFolders.bg"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5584</span> </span><span class="WHIT">            </span><span class="STRN">"nas.ftgFolders.paint"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5585</span> </span><span class="WHIT">            </span><span class="STRN">"nas.ftgFolders.etc"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5586</span> </span><span class="WHIT">            </span><span class="STRN">"nas.ftgFolders.key"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5587</span> </span><span class="WHIT">            </span><span class="STRN">"nas.ftgFolders.drawing"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5588</span> </span><span class="WHIT">            </span><span class="STRN">"nas.ftgFolders.sound"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5589</span> </span><span class="WHIT">            </span><span class="STRN">"nas.ftgFolders.unknown"</span><span class="WHIT">
<span class='line'>5590</span> </span><span class="WHIT">        </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5591</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5592</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5593</span>      * ,"nas.ftgFolders";//
<span class='line'>5594</span>      */</span><span class="WHIT">
<span class='line'>5595</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.preferenceFolder.exists</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">this.preferenceFolder.readonly</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5596</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myPrefs.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5597</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">eval</span><span class="PUNC">(</span><span class="NAME">myPrefs</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5598</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">eval</span><span class="PUNC">(</span><span class="NAME">myPrefs</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5599</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">eval</span><span class="PUNC">(</span><span class="NAME">myPrefs</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">".toString()"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5600</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myContent.match</span><span class="PUNC">(</span><span class="REGX">/\/([ig]+)$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5601</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myRegOpt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5602</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5603</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myRegOpt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5604</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5605</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myContentBody</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myContent.slice</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myContent.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">myRegOpt.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\\/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"\\\\"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5606</span> </span><span class="WHIT">                    </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\(new RegExp\(\""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myContentBody</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\",\""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myRegOpt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\"\)\)"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5607</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5608</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">eval</span><span class="PUNC">(</span><span class="NAME">myPrefs</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">".toSource()"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5609</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5610</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myFileName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myPrefs</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">".json"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5611</span> </span><span class="WHIT">                </span><span class="NAME">nas.otome.writeConsole</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5612</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myOpenFile</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">File</span><span class="PUNC">(</span><span class="NAME">this.preferenceFolder.path</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"/"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.preferenceFolder.name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"/"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myFileName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5613</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">canWrite</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myOpenFile.open</span><span class="PUNC">(</span><span class="STRN">"w"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5614</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">canWrite</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5615</span> </span><span class="WHIT">                    </span><span class="NAME">nas.otome.writeConsole</span><span class="PUNC">(</span><span class="NAME">myOpenFile.fsName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5616</span> </span><span class="WHIT">                    </span><span class="NAME">myOpenFile.encoding</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"UTF-8"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5617</span> </span><span class="WHIT">                    </span><span class="NAME">myOpenFile.write</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5618</span> </span><span class="WHIT">                    </span><span class="NAME">myOpenFile.close</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5619</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5620</span> </span><span class="WHIT">                    </span><span class="NAME">nas.otome.writeConsole</span><span class="PUNC">(</span><span class="NAME">myOpenFile.fsName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">": これなんか書けないカンジ"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5621</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5622</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>5623</span>                  * ファイルが既存かとか調べない　うほほ
<span class='line'>5624</span>                  */</span><span class="WHIT">
<span class='line'>5625</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5626</span> </span><span class="WHIT">                </span><span class="NAME">nas.otome.writeConsole</span><span class="PUNC">(</span><span class="STRN">"object :"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myPrefs</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"は存在しないようです。保存できません。"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5627</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5628</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5629</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5630</span> </span><span class="WHIT">    </span><span class="COMM">//else{alert("GOGO")}</span><span class="WHIT">
<span class='line'>5631</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5632</span> 
<span class='line'>5633</span> </span><span class="COMM">/**
<span class='line'>5634</span>  * nas.otome.readPreference();
<span class='line'>5635</span>  * スクリプト他のファイル類の実行サービスを乙女のライブラリに移動する
<span class='line'>5636</span>  * 振り分けルーチンは使用してもしなくてもかまわない
<span class='line'>5637</span>  * doFFX / doAction / doScript / throwSystem
<span class='line'>5638</span>  */</span><span class="WHIT">
<span class='line'>5639</span> 
<span class='line'>5640</span> </span><span class="COMM">/**
<span class='line'>5641</span>  * nas.otome.doFiles(Files)
<span class='line'>5642</span>  * 指定のファイルを振り分けて実行する
<span class='line'>5643</span>  * スクリプトファイルは乙女のスコープで実行
<span class='line'>5644</span>  * データファイル / システム実行ファイルはシステムで実行
<span class='line'>5645</span>  * アクションフォルダはアクションとして実行
<span class='line'>5646</span>  * ｆｆｘは選択されたコンポに対して適用
<span class='line'>5647</span>  * それぞれのサービスのラッパです
<span class='line'>5648</span>  * @param myFiles
<span class='line'>5649</span>  */</span><span class="WHIT">
<span class='line'>5650</span> </span><span class="NAME">nas.otome.doFiles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myFiles</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5651</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5652</span>      * 指定ファイルは複数（配列）　配列でない場合は配列化する
<span class='line'>5653</span>      */</span><span class="WHIT">
<span class='line'>5654</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">myFiles</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5655</span> </span><span class="WHIT">        </span><span class="NAME">myFiles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">myFiles</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>5656</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5657</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ix</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">myFiles</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5658</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>5659</span>          * 順次処理
<span class='line'>5660</span>          */</span><span class="WHIT">
<span class='line'>5661</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myFiles</span><span class="PUNC">[</span><span class="NAME">ix</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5662</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myTarget</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">File</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5663</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myTarget.exists</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5664</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myTarget.name.match</span><span class="PUNC">(</span><span class="REGX">/\.jsx?$/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5665</span> </span><span class="WHIT">                    </span><span class="NAME">this.doScript</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">myTarget.path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myTarget.name</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">"/"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5666</span> </span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5667</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5668</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myTarget.name.match</span><span class="PUNC">(</span><span class="REGX">/\.ffx$/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5669</span> </span><span class="WHIT">                    </span><span class="NAME">this.doFFX</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">myTarget.path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myTarget.name</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">"/"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5670</span> </span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5671</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5672</span> </span><span class="WHIT">                </span><span class="NAME">this.systemOpen</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">myTarget.path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myTarget.name</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">"/"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5673</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5674</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5675</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5676</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myTarget</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Folder</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5677</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>5678</span>                  * フォルダ内の設定ファイルの有無を調べてアクション指定が存在する場合のみアクションとして振分
<span class='line'>5679</span>                  */</span><span class="WHIT">
<span class='line'>5680</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myConfigFile</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">File</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">myTarget.path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myTarget.name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"_subMenu.js"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">"/"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5681</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isAction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5682</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myConfigFile.exists</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5683</span> </span><span class="WHIT">                    </span><span class="NAME">myConfigFile</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">File</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">myTarget.path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myTarget.name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"_subMenu.jsx"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">"/"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5684</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5685</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myConfigFile.exists</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5686</span> </span><span class="WHIT">                    </span><span class="NAME">myConfigFile.open</span><span class="PUNC">(</span><span class="STRN">"r"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5687</span> </span><span class="WHIT">                    </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myConfigFile.readln</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5688</span> </span><span class="COMM">//						myContent += "\n";</span><span class="WHIT">
<span class='line'>5689</span> </span><span class="WHIT">                    </span><span class="COMM">/**
<span class='line'>5690</span>                      * 2行読み込み
<span class='line'>5691</span>                      */</span><span class="WHIT">
<span class='line'>5692</span> </span><span class="WHIT">                    </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myConfigFile.readln</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5693</span> </span><span class="WHIT">                    </span><span class="COMM">/**
<span class='line'>5694</span>                      * 3行読み込み
<span class='line'>5695</span>                      */</span><span class="WHIT">
<span class='line'>5696</span> </span><span class="WHIT">                    </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myConfigFile.readln</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5697</span> </span><span class="WHIT">                    </span><span class="NAME">myConfigFile.close</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5698</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myContent.match</span><span class="PUNC">(</span><span class="REGX">/^\/\/no\x20launch/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5699</span> </span><span class="WHIT">                        </span><span class="KEYW">break</span><span class="WHIT">
<span class='line'>5700</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5701</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myContent.match</span><span class="PUNC">(</span><span class="REGX">/\/\/actionFolder/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5702</span> </span><span class="WHIT">                        </span><span class="NAME">isAction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT">
<span class='line'>5703</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5704</span> 
<span class='line'>5705</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isAction</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5706</span> </span><span class="WHIT">                        </span><span class="NAME">this.doAction</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">myTarget.path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myTarget.name</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">"/"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5707</span> </span><span class="WHIT">                        </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5708</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5709</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5710</span> </span><span class="WHIT">                </span><span class="NAME">this.systemOpen</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">myTarget.path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myTarget.name</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">"/"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5711</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5712</span> </span><span class="WHIT">            </span><span class="COMM">// if File Folder</span><span class="WHIT">
<span class='line'>5713</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5714</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5715</span> </span><span class="WHIT">        </span><span class="COMM">//for</span><span class="WHIT">
<span class='line'>5716</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5717</span> </span><span class="WHIT">    </span><span class="COMM">//if</span><span class="WHIT">
<span class='line'>5718</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5719</span> </span><span class="COMM">/**
<span class='line'>5720</span>  * nas.otome.doScript(myPath)
<span class='line'>5721</span>  * スクリプトファイルのパスを与えて実行する
<span class='line'>5722</span>  * スクリプトファイルの実行ファイル存在の確認等は行なわないのであらかじめチェックすること
<span class='line'>5723</span>  * @param myPath
<span class='line'>5724</span>  */</span><span class="WHIT">
<span class='line'>5725</span> </span><span class="NAME">nas.otome.doScript</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myPath</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5726</span> </span><span class="WHIT">    </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>5727</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myFile</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">File</span><span class="PUNC">(</span><span class="NAME">myPath</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5728</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5729</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">prevCurrentFolder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Folder.current</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5730</span> </span><span class="WHIT">    </span><span class="NAME">Folder.current</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Folder</span><span class="PUNC">(</span><span class="NAME">myFile.path</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5731</span> </span><span class="WHIT">    </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5732</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scriptFile</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myFile</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5733</span> </span><span class="WHIT">        </span><span class="NAME">scriptFile.open</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5734</span> </span><span class="WHIT">        </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">eval</span><span class="PUNC">(</span><span class="NAME">scriptFile.read</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5735</span> </span><span class="WHIT">        </span><span class="NAME">scriptFile.close</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5736</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">err</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5737</span> </span><span class="WHIT">        </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">err</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5738</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5739</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5740</span> </span><span class="WHIT">        </span><span class="NAME">this.writeConsole</span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5741</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5742</span> </span><span class="WHIT">    </span><span class="NAME">Folder.current</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">prevCurrentFolder</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5743</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5744</span> </span><span class="COMM">/**
<span class='line'>5745</span>  * nas.otome.doAction(myPath)
<span class='line'>5746</span>  * 現在の選択アイテムがコンポだった場合アクションフォルダの適用を行なう
<span class='line'>5747</span>  * フォルダがアクションとして成立しているか否かは感知しない
<span class='line'>5748</span>  * 複数のアイテムが選択されている場合は、選択された全てのコンポアイテム
<span class='line'>5749</span>  * に対してアクションの適用を行なう。
<span class='line'>5750</span>  * 対象アイテム数が多い場合中断ダイアログを出す
<span class='line'>5751</span>  *
<span class='line'>5752</span>  * @param myPath
<span class='line'>5753</span>  */</span><span class="WHIT">
<span class='line'>5754</span> </span><span class="NAME">nas.otome.doAction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myPath</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5755</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">borderCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">25</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5756</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myFolder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Folder</span><span class="PUNC">(</span><span class="NAME">myPath</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5757</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myTargets</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">app.project.activeItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">app.project.activeItem</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">app.project.selection</span><span class="PUNC">;</span><span class="COMM">//アクティブアイテムがあればターゲットになければ選択されたアイテム全て</span><span class="WHIT">
<span class='line'>5758</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">doFlag</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5759</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myTargets.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">borderCount</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5760</span> </span><span class="WHIT">        </span><span class="NAME">doFlag</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">confirm</span><span class="PUNC">(</span><span class="NAME">myTargets.length</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" アイテムの処理が指定されました。"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nas.GUI.LineFeed</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"続行しますか？"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5761</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5762</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">doFlag</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5763</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">itmIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">itmIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myTargets.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">itmIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5764</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myTargets</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">CompItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myFolder.exists</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5765</span> </span><span class="WHIT">                </span><span class="NAME">myTargets</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">executeAction</span><span class="PUNC">(</span><span class="NAME">myFolder</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5766</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5767</span> </span><span class="WHIT">                </span><span class="NAME">nas.otome.writeConsole</span><span class="PUNC">(</span><span class="STRN">"skip action for "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myTargets</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5768</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5769</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5770</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5771</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5772</span> </span><span class="COMM">/**
<span class='line'>5773</span>  * nas.ToolBox.doAction(FolderPath)
<span class='line'>5774</span>  * nas.otome.doFFX(myPath)
<span class='line'>5775</span>  * 現在の選択アイテムがコンポだった場合コンポ内のレイヤにFFXの適用を行なう
<span class='line'>5776</span>  * コンポにアクティブなレイヤがない場合はコンポのプリセット適用を行なう
<span class='line'>5777</span>  * @param myPath
<span class='line'>5778</span>  */</span><span class="WHIT">
<span class='line'>5779</span> </span><span class="NAME">nas.otome.doFFX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myPath</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5780</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">borderCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">25</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5781</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myFFX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">File</span><span class="PUNC">(</span><span class="NAME">myPath</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5782</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myTargets</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">app.project.activeItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">app.project.activeItem</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">app.project.selection</span><span class="PUNC">;</span><span class="COMM">//アクティブアイテムがあればターゲットになければ選択されたアイテム全て</span><span class="WHIT">
<span class='line'>5783</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">doFlag</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5784</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myTargets.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">borderCount</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5785</span> </span><span class="WHIT">        </span><span class="NAME">doFlag</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">confirm</span><span class="PUNC">(</span><span class="NAME">myTargets.length</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" アイテムの処理が指定されました。"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nas.GUI.LineFeed</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"続行しますか？"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5786</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5787</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">doFlag</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5788</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">itmIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">itmIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myTargets.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">itmIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5789</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myTargets</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">CompItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myFFX.exists</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5790</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myTargets</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">selectedLayers.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5791</span> </span><span class="WHIT">                    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">lIdx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myTargets</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">selectedLayers.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">lIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5792</span> </span><span class="WHIT">                        </span><span class="NAME">myTargets</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">selectedLayers</span><span class="PUNC">[</span><span class="NAME">lIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">applyPresetA</span><span class="PUNC">(</span><span class="NAME">myFFX</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5793</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5794</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5795</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myTargets</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">applyPreset</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5796</span> </span><span class="WHIT">                        </span><span class="NAME">myTargets</span><span class="PUNC">[</span><span class="NAME">itmIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">applyPreset</span><span class="PUNC">(</span><span class="NAME">myFFX</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5797</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5798</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5799</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5800</span> </span><span class="WHIT">                </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"プリセット適用は、コンポをアクティブにして実行してください"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5801</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5802</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5803</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5804</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5805</span> </span><span class="COMM">//===============================nas.ToolBox.doFFX(FilePath)</span><span class="WHIT">
<span class='line'>5806</span> </span></pre></body></html>