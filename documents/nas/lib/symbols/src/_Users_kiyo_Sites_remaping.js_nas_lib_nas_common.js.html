<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="TOKN">﻿</span><span class="COMM">/**
<span class='line'>  2</span>  * @fileOverview
<span class='line'>  3</span>  * nas_common.js
<span class='line'>  4</span>  * 共用可能スクリプト部分
<span class='line'>  5</span>  * アニメーション一般ライブラリ&lt;br />
<span class='line'>  6</span>  * AE等のAdobe Script 環境で使用可能な機能を提供します
<span class='line'>  7</span>  * 2016/01/29
<span class='line'>  8</span>  */</span><span class="WHIT">
<span class='line'>  9</span> 
<span class='line'> 10</span> </span><span class="COMM">/* --- おことわり
<span class='line'> 11</span>  *
<span class='line'> 12</span>  * このプログラムの著作権は「ねこまたや」にあります。
<span class='line'> 13</span>  *
<span class='line'> 14</span>  * あなたは、このプログラムのこの著作権表示を改変しないかぎり
<span class='line'> 15</span>  * 自由にプログラムの使用・複製・再配布などを行うことができます。
<span class='line'> 16</span>  *
<span class='line'> 17</span>  * あなたは、このプログラムを自己の目的にしたがって改造することができます。
<span class='line'> 18</span>  * その場合、このプログラムを改造したものであることを明記して、この著作権表示を
<span class='line'> 19</span>  * 添付するように努めてください。
<span class='line'> 20</span>  *
<span class='line'> 21</span>  * このプログラムを使うも使わないもあなたの自由なのです。
<span class='line'> 22</span>  *
<span class='line'> 23</span>  * 作者はこのプログラムを使用したことによって起きたいかなる
<span class='line'> 24</span>  * 不利益に対しても責任を負いません。
<span class='line'> 25</span>  * あなたは、あなたの判断と責任においてこのプログラムを使用するのです。
<span class='line'> 26</span>  *
<span class='line'> 27</span>  * なんか、困ったことがあったら以下で連絡してもらえると何とかなるかもしれません。
<span class='line'> 28</span>  * http://www.nekomataya.info/
<span class='line'> 29</span>  * mailto:kiyo@nekomataya.info
<span class='line'> 30</span>  *
<span class='line'> 31</span>  * そんな感じです。
<span class='line'> 32</span>  *
<span class='line'> 33</span>  * 追伸
<span class='line'> 34</span>  * このプログラムは、汎用のモジュール群です。
<span class='line'> 35</span>  * 組み込みでつかえるかどうかは作者の作業時間とセンスに左右されます。
<span class='line'> 36</span>  * nas汎用オブジェクトとメソッドで構成することに決定。
<span class='line'> 37</span>  * 呼び出しかたが変わるのでこのバージョン以降互換性無し。
<span class='line'> 38</span>  *
<span class='line'> 39</span>  * 2015 07-11
<span class='line'> 40</span>  * 基礎オブジェクトの大幅変更
<span class='line'> 41</span>  * 以降のライブラリは基本的に後方互換性を失うので注意
<span class='line'> 42</span>  *
<span class='line'> 43</span>  * 2016 01-29
<span class='line'> 44</span>  * 懸案だったベクトル関連の演算ライブラリを少し整理してこのモジュールに組み込む
<span class='line'> 45</span>  * 関連の関数は全てnas.配下に組み入れるので、使用の際はコードの置きかえまたはエイリアスからのアクセスが必要
<span class='line'> 46</span>  * 移行した関数
<span class='line'> 47</span>  * preformvector add sub mul div clamp dot cross length normalize
<span class='line'> 48</span>  * degreesToRadians radiansToDegrees
<span class='line'> 49</span>  *
<span class='line'> 50</span>  * =======    現在のメソッド一覧 ======= 2016/01/29
<span class='line'> 51</span>  *
<span class='line'> 52</span>  * nas.dt2sc(z距離)
<span class='line'> 53</span>  * z軸距離(ピクセル)からスケールを求める
<span class='line'> 54</span>  *
<span class='line'> 55</span>  * nas.sc2dt(スケール)
<span class='line'> 56</span>  * スケールからz軸距離を求める。
<span class='line'> 57</span>  *
<span class='line'> 58</span>  * nas.fl2fr(撮影フレーム)
<span class='line'> 59</span>  * 撮影フレームからレタス撮影フレームを求める。
<span class='line'> 60</span>  *
<span class='line'> 61</span>  * nas.fr2fl(レタス撮影フレーム)
<span class='line'> 62</span>  * レタスフレームから撮影フレームを求める。
<span class='line'> 63</span>  *
<span class='line'> 64</span>  * nas.fl2sc(撮影フレーム)
<span class='line'> 65</span>  * 撮影フレームからスケールを求める。
<span class='line'> 66</span>  * nas.fr2sc(レタス撮影フレーム)
<span class='line'> 67</span>  * レタス撮影フレームからスケールを求める。
<span class='line'> 68</span>  * nas.sc2fl(スケール)
<span class='line'> 69</span>  * スケールから撮影フレームを求める。
<span class='line'> 70</span>  * nas.sc2fr(スケール)
<span class='line'> 71</span>  * スケールからレタス撮影フレームを求める。
<span class='line'> 72</span>  * nas.kac(開始寸法,終了寸法,助変数)
<span class='line'> 73</span>  * 開始寸法・終了寸法と助変数を与えて、対応する寸法を求める。
<span class='line'> 74</span>  * nas.cak(開始寸法,終了寸法,拡大率)
<span class='line'> 75</span>  * 開始寸法・終了寸法と任意寸法を与えて、寸法に対応する助変数を求める。
<span class='line'> 76</span>  *
<span class='line'> 77</span>  * nas.Zf(数値,桁数)
<span class='line'> 78</span>  * 数値を指定桁数のゼロで埋める。
<span class='line'> 79</span>  *
<span class='line'> 80</span>  * nas.ms2fr(ミリ秒数)
<span class='line'> 81</span>  * ミリ秒数から、フレーム数を求める。
<span class='line'> 82</span>  * nas.fr2ms(フレーム数)
<span class='line'> 83</span>  * フレーム数から、ミリ秒数を求める。
<span class='line'> 84</span>  * nas.ms2FCT(ミリ秒数,カウンタタイプ,オリジネーション[,フレームレート])
<span class='line'> 85</span>  * ミリ秒数から、カウンタ文字列への変換。
<span class='line'> 86</span>  * カウンタータイプ・オリジネーション・フレームレートを指定
<span class='line'> 87</span>  * nas.FCT2ms(カウンタ文字列)
<span class='line'> 88</span>  * カウンタ文字列から、ミリ秒数への変換。
<span class='line'> 89</span>  * nas.Frm2FCT(フレーム数,カウンタタイプ,オリジネーション[,フレームレート])
<span class='line'> 90</span>  * フレーム数(0オリジン)から、カウンタ文字列への変換
<span class='line'> 91</span>  * カウンタータイプ・オリジネーション・フレームレートを指定
<span class='line'> 92</span>  * nas.FCT2Frm(カウンタ文字列[,フレームレート])
<span class='line'> 93</span>  * カウンタ文字列から、フレーム数(0オリジン)への変換
<span class='line'> 94</span>  * フレームレート省略可能
<span class='line'> 95</span>  * nas.docodeUnit(入力値,変換単位)
<span class='line'> 96</span>  * 入力値の単位を変換した数値を戻す(mm,cm,px,pt,in)
<span class='line'> 97</span>  *
<span class='line'> 98</span>  * ==== 色彩関連(web用)
<span class='line'> 99</span>  * nas.colorStr2Ary(カラー文字列)
<span class='line'>100</span>  * WEB色指定用の文字列を3次元の配列にして返す
<span class='line'>101</span>  * nas.colorAry2Str([配列])
<span class='line'>102</span>  * 配列で与えられたRGB値を16進文字列で返す。
<span class='line'>103</span>  * ==== ベクトル関連
<span class='line'>104</span>  * nas.vec2azi(ベクトル,[フォーマット])
<span class='line'>105</span>  * 与えられたベクトルの方位角を返す。文字フォーマットも可
<span class='line'>106</span>  * ==== 行列計算
<span class='line'>107</span>  * 行列演算関数の行列は配列の組み合わせでなく、要素のストリーム文字列である。
<span class='line'>108</span>  *
<span class='line'>109</span>  * nas.showMatrix(ラベル,行列文字列,行数,列数)
<span class='line'>110</span>  * 与えられた行列文字列に改行を加えて文字列で返す。
<span class='line'>111</span>  * nas.mDeterminant(行列文字列)
<span class='line'>112</span>  * 行列式(和)を返す。
<span class='line'>113</span>  * nas.multiMatrix(行列文字列1,行列文字列2)
<span class='line'>114</span>  * 行列積を求める。
<span class='line'>115</span>  * nas.mInverse(行列文字列)
<span class='line'>116</span>  * 逆行列を求める。
<span class='line'>117</span>  * nas.transMatrix(行列文字列)
<span class='line'>118</span>  * 行列を転置する。
<span class='line'>119</span>  *
<span class='line'>120</span>  * ==== 文字列操作(Stringクラスにオーバーライドするかも知れないので暫定)
<span class='line'>121</span>  * nas.biteCount(文字列)
<span class='line'>122</span>  * 文字列のバイト数を返す。
<span class='line'>123</span>  * nas.biteClip(文字列,制限バイト数)
<span class='line'>124</span>  * 文字列を指定バイト数以下にクリップ
<span class='line'>125</span>  * nas.incrStr(文字列,step)
<span class='line'>126</span>  * 文字列の末尾の番号部分を１くり上げて返す
<span class='line'>127</span>  * nas.normalizeStr(文字列)
<span class='line'>128</span>  * 文字列を半角数値で比較できるようにフォーマットして返す
<span class='line'>129</span>  * ==== プロパティ操作
<span class='line'>130</span>  * nas.propCount(オブジェクト,リストスイッチ)
<span class='line'>131</span>  * オブジェクトのプロパティをカウントする
<span class='line'>132</span>  * リストスイッチでプロパティ名の配列を返す
<span class='line'>133</span>  * ==== 単位換算
<span class='line'>134</span>  * nas.decodeUnit(入力値,変換単位)
<span class='line'>135</span>  * 単位つきの文字列値を数値にして返すメソッド
<span class='line'>136</span>  * 単位は mm cm in pt px
<span class='line'>137</span>  *
<span class='line'>138</span>  * ========    既存オブジェクトにオーバーライドするメソッド
<span class='line'>139</span>  * "yy/mm/dd hh:mm:ss" 形式を拡張
<span class='line'>140</span>  * Date.toNASString()
<span class='line'>141</span>  * ;returns String
<span class='line'>142</span>  * Date.setNASString("yy/mm/dd hh:mm:ss")
<span class='line'>143</span>  * ; returns object
<span class='line'>144</span>  *
<span class='line'>145</span>  *
<span class='line'>146</span>  */</span><span class="WHIT">
<span class='line'>147</span> 
<span class='line'>148</span> </span><span class="NAME">myFilename</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">'nas_common.js'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>149</span> </span><span class="NAME">myFilerevision</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">'2.0'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>150</span> 
<span class='line'>151</span> </span><span class="COMM">/*
<span class='line'>152</span>  * @description 実行環境の判定
<span class='line'>153</span>  *	isAIR nas.isAIR等を参照していた部分を全面的に環境プロパティ appHostで書きなおす
<span class='line'>154</span>  *  appHost はオブジェクトで作成してプラットフォーム及びバージョンを識別できる情報を与える HTML関連コードからこちらへ移動済み
<span class='line'>155</span>  */</span><span class="WHIT">
<span class='line'>156</span> </span><span class="COMM">/** 環境保持クラス
<span class='line'>157</span>  *  @class AppHost
<span class='line'>158</span>  *
<span class='line'>159</span>  *  @property  {boolean} ESTK Adobe ESTS環境下であるか否かのフラグ
<span class='line'>160</span>  *  @property  {String} platform
<span class='line'>161</span>  *　稼働環境指示変数
<span class='line'>162</span>  *  @property  {String} version
<span class='line'>163</span>  *　稼働環境バージョン変数
<span class='line'>164</span>  *  @property  {String} os
<span class='line'>165</span>  *　稼働OS変数
<span class='line'>166</span> */</span><span class="WHIT">
<span class='line'>167</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">AppHost</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>168</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>169</span> </span><span class="WHIT">    </span><span class="NAME">this.ESTK</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>170</span> </span><span class="WHIT">	</span><span class="NAME">this.platform</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>171</span> </span><span class="WHIT">	</span><span class="NAME">this.version</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>172</span> </span><span class="WHIT">	</span><span class="NAME">this.os</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>173</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>174</span> 
<span class='line'>175</span> </span><span class="NAME">AppHost.prototype.init</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>176</span> </span><span class="WHIT">    </span><span class="COMM">//AdobeESTKの判定</span><span class="WHIT">
<span class='line'>177</span> </span><span class="WHIT">    </span><span class="NAME">this.ESTK</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">app</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>178</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>179</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">uaName</span><span class="PUNC">=</span><span class="NAME">navigator.userAgent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>180</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">window.__adobe_cep__</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>181</span> </span><span class="WHIT">	</span><span class="COMM">//CEP</span><span class="WHIT">
<span class='line'>182</span> </span><span class="WHIT">		</span><span class="NAME">this.platform</span><span class="PUNC">=</span><span class="STRN">"CEP"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>183</span> </span><span class="WHIT">		</span><span class="NAME">this.version</span><span class="PUNC">=</span><span class="NAME">navigator.userAgent.match</span><span class="PUNC">(</span><span class="REGX">/(\sChrome\/)([0-9\.]*)/</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>184</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>185</span> </span><span class="WHIT">	 </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">navigator.userAgent.indexOf</span><span class="PUNC">(</span><span class="STRN">"AdobeAIR"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>186</span> </span><span class="WHIT">	</span><span class="COMM">//AIR(フラッシュ)系</span><span class="WHIT">
<span class='line'>187</span> </span><span class="WHIT">	  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">window.runtime</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>188</span> </span><span class="WHIT">		</span><span class="NAME">this.platform</span><span class="PUNC">=</span><span class="STRN">"AIR"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>189</span> </span><span class="WHIT">		</span><span class="NAME">this.version</span><span class="PUNC">=</span><span class="NAME">navigator.userAgent.match</span><span class="PUNC">(</span><span class="REGX">/(AdobeAIR\/)([0-9\.]*)/</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>190</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>191</span> </span><span class="WHIT">	  </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>192</span> </span><span class="WHIT">		</span><span class="NAME">this.platform</span><span class="PUNC">=</span><span class="STRN">"CSX"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>193</span> </span><span class="WHIT">		</span><span class="NAME">this.version</span><span class="PUNC">=</span><span class="NAME">navigator.userAgent.match</span><span class="PUNC">(</span><span class="REGX">/(AdobeAIR\/)([0-9\.]*)/</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>194</span> </span><span class="WHIT">	  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>195</span> </span><span class="WHIT">	 </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>196</span> </span><span class="WHIT">	</span><span class="COMM">//その他普通のブラウザ</span><span class="WHIT">
<span class='line'>197</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uaName.indexOf</span><span class="PUNC">(</span><span class="STRN">"Chrome"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>198</span> </span><span class="WHIT">		</span><span class="NAME">uaVer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uaName.match</span><span class="PUNC">(</span><span class="REGX">/(Chrome\/)([0-9\.]*)/</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>199</span> </span><span class="WHIT">		</span><span class="NAME">this.version</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uaVer.split</span><span class="PUNC">(</span><span class="STRN">"\."</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>200</span> </span><span class="WHIT">		</span><span class="NAME">this.platform</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Chrome"</span><span class="PUNC">;</span><span class="COMM">//chromeらしい</span><span class="WHIT">
<span class='line'>201</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>202</span> </span><span class="WHIT">	  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uaName.indexOf</span><span class="PUNC">(</span><span class="STRN">"Safari"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>203</span> </span><span class="WHIT">		</span><span class="NAME">uaVer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uaName.match</span><span class="PUNC">(</span><span class="REGX">/(Safari\/)([0-9\.]*)/</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>204</span> </span><span class="WHIT">		</span><span class="NAME">this.version</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uaVer.split</span><span class="PUNC">(</span><span class="STRN">"\."</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">uaVer.split</span><span class="PUNC">(</span><span class="STRN">"\."</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">/</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>205</span> </span><span class="WHIT">		</span><span class="NAME">this.platform</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Safari"</span><span class="PUNC">;</span><span class="COMM">//サファリらしい</span><span class="WHIT">
<span class='line'>206</span> </span><span class="WHIT">	  </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>207</span> </span><span class="WHIT">	  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uaName.indexOf</span><span class="PUNC">(</span><span class="STRN">"Opera"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>208</span> </span><span class="WHIT">		</span><span class="NAME">this.version</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uaName.match</span><span class="PUNC">(</span><span class="REGX">/(Opera[\ \/])([0-9\.]*)/</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>209</span> </span><span class="WHIT">		</span><span class="NAME">this.platform</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Opera"</span><span class="PUNC">;</span><span class="COMM">//オペラである</span><span class="WHIT">
<span class='line'>210</span> </span><span class="WHIT">	    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>211</span> </span><span class="WHIT">	    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uaName.indexOf</span><span class="PUNC">(</span><span class="STRN">"MSIE"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>212</span> </span><span class="WHIT">		</span><span class="NAME">this.version</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uaName.match</span><span class="PUNC">(</span><span class="REGX">/(MSIE[\ \/])([0-9\.]*)/</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>213</span> </span><span class="WHIT">		</span><span class="NAME">this.platform</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'MSIE'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>214</span> </span><span class="WHIT">	      </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>215</span> </span><span class="WHIT">	      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uaName.indexOf</span><span class="PUNC">(</span><span class="STRN">"Netscape"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>216</span> </span><span class="WHIT">		</span><span class="NAME">uaVer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uaName.match</span><span class="PUNC">(</span><span class="REGX">/(Netscape6?[\ \/])([0-9\.]*)/</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>217</span> </span><span class="WHIT">		</span><span class="NAME">this.version</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uaVer.split</span><span class="PUNC">(</span><span class="STRN">"\."</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">uaVer.split</span><span class="PUNC">(</span><span class="STRN">"\."</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">/</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>218</span> </span><span class="WHIT">		</span><span class="NAME">this.platform</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"NN"</span><span class="PUNC">;</span><span class="COMM">//NSにしてみる。</span><span class="WHIT">
<span class='line'>219</span> </span><span class="WHIT">	        </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>220</span> </span><span class="WHIT">	        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uaName.indexOf</span><span class="PUNC">(</span><span class="STRN">"Mozilla"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>221</span> </span><span class="WHIT">		</span><span class="NAME">this.version</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uaName.match</span><span class="PUNC">(</span><span class="REGX">/(Mozilla[\ \/])([0-9\.]*)/</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>222</span> </span><span class="WHIT">		</span><span class="NAME">this.platform</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Mozilla"</span><span class="PUNC">;</span><span class="COMM">//NSでないMozillaにしてみる。</span><span class="WHIT">
<span class='line'>223</span> </span><span class="WHIT">		  </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>224</span> </span><span class="WHIT">		</span><span class="NAME">this.version</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'unKnown'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>225</span> </span><span class="WHIT">		</span><span class="NAME">this.platform</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'unKnown'</span><span class="PUNC">;</span><span class="COMM">//知らないブラウザである。</span><span class="WHIT">
<span class='line'>226</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>227</span> </span><span class="COMM">/*
<span class='line'>228</span> 		this.platform="other";
<span class='line'>229</span> 		this.version="unknown";
<span class='line'>230</span> */</span><span class="WHIT">
<span class='line'>231</span> </span><span class="WHIT">	 </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>232</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>233</span> </span><span class="WHIT">	</span><span class="COMM">//OSもチェックしておく</span><span class="WHIT">
<span class='line'>234</span> </span><span class="WHIT">		</span><span class="NAME">this.os</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Other"</span><span class="PUNC">;</span><span class="COMM">//初期値として設定</span><span class="WHIT">
<span class='line'>235</span> </span><span class="WHIT">	</span><span class="COMM">//判定の幅がでかすぎるひとまずは Mac Win Other で</span><span class="WHIT">
<span class='line'>236</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">window.navigator.platform</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="STRN">"Mac"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>237</span> </span><span class="WHIT">		</span><span class="NAME">this.os</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Mac"</span><span class="PUNC">;</span><span class="COMM">//Mac OS X</span><span class="WHIT">
<span class='line'>238</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>239</span> </span><span class="WHIT">	 </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">window.navigator.platform</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="STRN">"Win"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>240</span> </span><span class="WHIT">		</span><span class="NAME">this.os</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Win"</span><span class="PUNC">;</span><span class="COMM">//Windows</span><span class="WHIT">
<span class='line'>241</span> </span><span class="WHIT">	 </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>242</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>243</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>244</span> 
<span class='line'>245</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">appHost</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">AppHost</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>246</span> </span><span class="WHIT">	</span><span class="NAME">appHost.init</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>247</span> 
<span class='line'>248</span> </span><span class="COMM">// if (navigator.userAgent.indexOf("AdobeAIR") > -1) {isAIR=true}</span><span class="WHIT">
<span class='line'>249</span> </span><span class="COMM">//AIR 環境が 純正/CSX(Configurator)/CEP 三種あるので判定が必要になる</span><span class="WHIT">
<span class='line'>250</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">window.runtime</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>251</span> </span><span class="WHIT">		  </span><span class="NAME">isAIR</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>252</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>253</span> </span><span class="WHIT">		 </span><span class="NAME">isADX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="COMM">//初期値CEP</span><span class="WHIT">
<span class='line'>254</span> </span><span class="WHIT">		  </span><span class="KEYW">try</span><span class="PUNC">{</span><span class="NAME">isADX</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">window.__adobe_cep__</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">er</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">isADX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>255</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>256</span> 
<span class='line'>257</span> 
<span class='line'>258</span> </span><span class="COMM">/*
<span class='line'>259</span>  * namespace として　Class nasを設定
<span class='line'>260</span>  */</span><span class="WHIT">
<span class='line'>261</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">nas</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>262</span> </span><span class="COMM">/**
<span class='line'>263</span>  @namespace*/</span><span class="WHIT">
<span class='line'>264</span> </span><span class="WHIT">    </span><span class="NAME">nas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>265</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>266</span> </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>267</span> </span><span class="WHIT">    </span><span class="COMM">/*
<span class='line'>268</span>      * globalのappオブジェクトを確認してAdobeScript環境を判定
<span class='line'>269</span>      */</span><span class="WHIT">
<span class='line'>270</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">app</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>271</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>272</span>          * Adobe Scripts
<span class='line'>273</span>          * @type {boolean}
<span class='line'>274</span>          */</span><span class="WHIT">
<span class='line'>275</span> </span><span class="WHIT">        </span><span class="NAME">nas.isAdobe</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>276</span> </span><span class="WHIT">        </span><span class="NAME">nas.Version</span><span class="PUNC">[</span><span class="STRN">"common"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"common:"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myFilename</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" :"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myFilerevision</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>277</span> </span><span class="WHIT">        </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>278</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">app.isProfessionalVersion</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>279</span> </span><span class="WHIT">                </span><span class="NAME">app.name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Adobe AfterEffects"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>280</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>281</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ERR</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>282</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>283</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>284</span> </span><span class="WHIT">        </span><span class="NAME">nas.isAdobe</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>285</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>286</span> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ERR</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>287</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>288</span>      * app オブジェクトが無いのでAIRまたはブラウザ
<span class='line'>289</span>      * @type {boolean}
<span class='line'>290</span>      */</span><span class="WHIT">
<span class='line'>291</span> </span><span class="COMM">//var	nas	=new Object();//nas オブジェクトとの生成はこの時点より前に送る</span><span class="WHIT">
<span class='line'>292</span> 
<span class='line'>293</span> </span><span class="WHIT">    </span><span class="NAME">nas.isAdobe</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>294</span> 
<span class='line'>295</span> </span><span class="WHIT">    </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>296</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>297</span>          * Folderオブジェクトを参照してAIR環境の場合nas.baseLocationを設定 psAxe用
<span class='line'>298</span>          * @type {Folder}
<span class='line'>299</span>          */</span><span class="WHIT">
<span class='line'>300</span> </span><span class="WHIT">        </span><span class="NAME">nas.baseLocation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Folder</span><span class="PUNC">(</span><span class="NAME">Folder.userData.fullName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"/nas"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//(Folder.current.name=="Startup")? new Folder("../nas/"):Folder.current;</span><span class="WHIT">
<span class='line'>301</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">err</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>302</span> </span><span class="WHIT">        </span><span class="NAME">nas.baseLocation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>303</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>304</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">MSIE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">navigator.userAgent.indexOf</span><span class="PUNC">(</span><span class="STRN">"MSIE"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>305</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Safari</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">navigator.userAgent.indexOf</span><span class="PUNC">(</span><span class="STRN">"Safari"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>306</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Firefox</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">navigator.userAgent.indexOf</span><span class="PUNC">(</span><span class="STRN">"Firefox"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>307</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>308</span> 
<span class='line'>309</span> </span><span class="COMM">/**
<span class='line'>310</span>  * xUIオブジェクトはHTMLライブラリにおけるUI管理オブジェクトなのでHTML環境外ではfalseで初期化して判定する
<span class='line'>311</span>  * HTML環境下であっても依存機能が初期化完了前にアクセスすることを抑制するためにfalseであらかじめ初期化するのを標準メソッドとする
<span class='line'>312</span>  * すなわちnasライブラリ稼働時は、つねにxUIオブジェクトが存在するものとする
<span class='line'>313</span>  * @type {boolean}
<span class='line'>314</span>  */</span><span class="WHIT">
<span class='line'>315</span> </span><span class="NAME">xUI</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>316</span> 
<span class='line'>317</span> 
<span class='line'>318</span> </span><span class="COMM">/**
<span class='line'>319</span>  *    @desc nas Lib base Object
<span class='line'>320</span>  */</span><span class="WHIT">
<span class='line'>321</span> </span><span class="COMM">/**
<span class='line'>322</span>  *@fileoverview	nas配下に基礎オブジェクト拡張
<span class='line'>323</span>  *
<span class='line'>324</span>  *基礎オブジェクト群は、基底プロパティの記述に使用するので最終的には従来のnas_common.jsよりも先にロードする必要がある。
<span class='line'>325</span>  *又は基礎オブジェクトとしてnas_common.jsに編入
<span class='line'>326</span>  *
<span class='line'>327</span>  *現在はnas_common.jsよりも後にロードされている
<span class='line'>328</span>  *
<span class='line'>329</span>  *デバッグ終了後は、ロード順位が入れ替わるので注意
<span class='line'>330</span>  *相互依存を考慮してマージ
<span class='line'>331</span>  *または、基底プロパティをオブジェクト化しないメソッドを考慮すること 24-06 2016
<span class='line'>332</span>  *
<span class='line'>333</span>  *
<span class='line'>334</span>  *単位付きカプセル化オブジェクトでは、演算の際に期待する値を確実に得るためには Object.as(Unit)で明示的に単位を指定すること
<span class='line'>335</span>  *
<span class='line'>336</span>  */</span><span class="WHIT">
<span class='line'>337</span> </span><span class="COMM">/**
<span class='line'>338</span>  * @class @constractor
<span class='line'>339</span>  *    ユーザ情報オブジェクト&lt;br />
<span class='line'>340</span>  *    表示名(ニックネーム／ハンドル)と識別用メールアドレス(id)を持つ
<span class='line'>341</span>  * @param {String} nameDescription
<span class='line'>342</span>  *  ユーザ記述文字列&lt;br />
<span class='line'>343</span>  *    ドキュメント上の記録形式は以下&lt;br />
<span class='line'>344</span>  *    displayName:uid@domain&lt;br />
<span class='line'>345</span>  *　@example
<span class='line'>346</span>  *var currentUser = new nas.UserInfo("handle:user@example.co.jp")
<span class='line'>347</span>  *var currentUser = new nas.UserInfo("handle")
<span class='line'>348</span>  *var currentUser = new nas.UserInfo("user@example.co.jp")
<span class='line'>349</span>  *var currentUser = new nas.UserInfo("ねこまたや:user@example.com")
<span class='line'>350</span>  *&lt;pre>
<span class='line'>351</span>  *初期化引数に':'が含まれない場合は、引数がメールアドレスか否かを判定して
<span class='line'>352</span>  *メールアドレスなら uid部をハンドルとして使用
<span class='line'>353</span>  *それ以外の場合は、全体をハンドルにしてメールアドレスをnullで初期化する
<span class='line'>354</span>  *メールアドレス整合性のチェックは特になし
<span class='line'>355</span>  *一致比較は、メールアドレス側で行う  null,空白は いずれの場合も一致なし
<span class='line'>356</span>  *空白で初期化したデフォルトの値はシステムで利用しないように注意する&lt;/pre>
<span class='line'>357</span>  */</span><span class="WHIT">
<span class='line'>358</span> </span><span class="NAME">nas.UserInfo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">UserInfo</span><span class="PUNC">(</span><span class="NAME">nameDescription</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>359</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">nameDescription</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">nameDescription</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">nameDescription</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">':'</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>360</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">nameDescription</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^\s*$|^:$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>361</span> </span><span class="WHIT">        </span><span class="NAME">this.handle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>362</span> </span><span class="WHIT">        </span><span class="NAME">this.email</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>363</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nameDescription</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.UserInfo</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>364</span> </span><span class="WHIT">        </span><span class="NAME">this.handle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nameDescription.handle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>365</span> </span><span class="WHIT">        </span><span class="NAME">this.email</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nameDescription.email</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>366</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nameDescription.indexOf</span><span class="PUNC">(</span><span class="STRN">':'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>367</span> </span><span class="COMM">//セパレータなし</span><span class="WHIT">
<span class='line'>368</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nameDescription.indexOf</span><span class="PUNC">(</span><span class="STRN">'@'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>369</span> </span><span class="WHIT">            </span><span class="NAME">this.handle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nameDescription</span><span class="PUNC">;</span><span class="COMM">//メールアドレスでないと思われるので引数全体をハンドルにする</span><span class="WHIT">
<span class='line'>370</span> </span><span class="WHIT">            </span><span class="NAME">this.email</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>371</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>372</span> </span><span class="WHIT">            </span><span class="NAME">this.handle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nameDescription.split</span><span class="PUNC">(</span><span class="STRN">'@'</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="COMM">//メールアドレスっぽいので＠から前をハンドルにする</span><span class="WHIT">
<span class='line'>373</span> </span><span class="WHIT">            </span><span class="NAME">this.email</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nameDescription</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>374</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>375</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>376</span> </span><span class="COMM">//セパレータあり</span><span class="WHIT">
<span class='line'>377</span> </span><span class="WHIT">         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">infoArray</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nameDescription.split</span><span class="PUNC">(</span><span class="STRN">':'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>378</span> </span><span class="WHIT">        </span><span class="NAME">this.handle</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">infoArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>379</span> </span><span class="WHIT">        </span><span class="NAME">this.email</span><span class="WHIT">      </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">infoArray</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>380</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>381</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">this.email</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/\s/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">this.email.replace</span><span class="PUNC">(</span><span class="REGX">/\s/g</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>382</span> </span><span class="COMM">//追加プロパティを引数として与える場合は、第二引数をオブエジェクトで {props:value}</span><span class="WHIT">
<span class='line'>383</span> </span><span class="COMM">//パーサが受け取ったプロパティは、コンストラクターに渡す前に分離して引数で与えること</span><span class="WHIT">
<span class='line'>384</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>385</span> </span><span class="COMM">//console.log(String(nas.Pm.users.token));</span><span class="WHIT">
<span class='line'>386</span> </span><span class="COMM">//console.log(this.toString('JSON'));</span><span class="WHIT">
<span class='line'>387</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">prop</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>388</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>389</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>390</span> </span><span class="COMM">/**
<span class='line'>391</span>  * @params {String} opt
<span class='line'>392</span>  *    出力フォーマット指定オプション&lt;br />
<span class='line'>393</span>  * キーワード"JSON" または  プロパティ名"handle"|"email"&lt;br />
<span class='line'>394</span>  * opt未指定の場合は、標準のユーザ記述文字列を戻す
<span class='line'>395</span>  *  @returns {String}
<span class='line'>396</span>  */</span><span class="WHIT">
<span class='line'>397</span> </span><span class="NAME">nas.UserInfo.prototype.toString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">opt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>398</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">opt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">opt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>399</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">opt</span><span class="PUNC">==</span><span class="STRN">'JSON'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>400</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">JSON.stringify</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>401</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">opt</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>402</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">opt</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>403</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>404</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">additionalOpt</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>405</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">additionalCount</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>406</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">prp</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>407</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">prp</span><span class="PUNC">==</span><span class="STRN">'handle'</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">prp</span><span class="PUNC">==</span><span class="STRN">'email'</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">prp</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Function</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>408</span> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">prp</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>409</span> </span><span class="WHIT">        </span><span class="NAME">additionalOpt</span><span class="PUNC">[</span><span class="NAME">prp</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">prp</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>410</span> </span><span class="WHIT">        </span><span class="NAME">additionalCount</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>411</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>412</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">additionalCount</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">this.handle</span><span class="PUNC">,</span><span class="NAME">this.email</span><span class="PUNC">,</span><span class="NAME">JSON.stringify</span><span class="PUNC">(</span><span class="NAME">additionalOpt</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">':'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>413</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">this.handle</span><span class="PUNC">,</span><span class="NAME">this.email</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">':'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>414</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>415</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>416</span> </span><span class="COMM">/**
<span class='line'>417</span>  *    ユーザ情報の同値判定
<span class='line'>418</span>  *  @params {Object nas.UserInfo|String} myName
<span class='line'>419</span>  *  比較用のユーザオブジェクト　または　ユーザ記述文字列
<span class='line'>420</span>  *    e-mailがある場合はハンドルが異なっていても同じアカウントとする
<span class='line'>421</span>  *    e-mailのない場合はハンドルのみで同値判断をする
<span class='line'>422</span>  *  @returns {boolean}
<span class='line'>423</span>  */</span><span class="WHIT">
<span class='line'>424</span> </span><span class="NAME">nas.UserInfo.prototype.sameAs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myName</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>425</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">myName</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.UserInfo</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">myName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UserInfo</span><span class="PUNC">(</span><span class="NAME">myName</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>426</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">this.handle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>427</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>428</span> </span><span class="WHIT">        </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.email</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">myName.email</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.email</span><span class="PUNC">==</span><span class="NAME">myName.email</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>429</span> </span><span class="WHIT">        </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">this.email</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">myName.email</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.handle</span><span class="PUNC">==</span><span class="NAME">myName.handle</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>430</span> </span><span class="WHIT">    </span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>431</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>432</span> </span><span class="COMM">/*test
<span class='line'>433</span>     A=new nas.UserInfo("123:");
<span class='line'>434</span>     B=new nas.UserInfo("123:123@99123.com");
<span class='line'>435</span>     A.sameAs(B);
<span class='line'>436</span> */</span><span class="WHIT">
<span class='line'>437</span> </span><span class="COMM">/**
<span class='line'>438</span>  *    nas.UserInfo　オブジェクトコレクション
<span class='line'>439</span>  *  @constractor
<span class='line'>440</span>  *  @class
<span class='line'>441</span>  *    コレクションする要素は、nas.UserInfoオブジェクト
<span class='line'>442</span>  *    引数にオブジェクトまたはユーザ記述文字列の配列を与えて初期化可能
<span class='line'>443</span>  *    直接操作する場合は必ずオブジェクトで与えること
<span class='line'>444</span>  *    不正メンバーはコレクション対象外
<span class='line'>445</span>  *    空コレクションをつくる際は引数で空配列を渡すこと
<span class='line'>446</span>  *  @params {Array of nas.UserInfo} users
<span class='line'>447</span>  */</span><span class="WHIT">
<span class='line'>448</span> </span><span class="NAME">nas.UserInfoCollection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">users</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>449</span> </span><span class="WHIT">    </span><span class="NAME">this.members</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>450</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">users</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>451</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NAME">users.length</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>452</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">users</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.UserInfo</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>453</span> </span><span class="WHIT">                </span><span class="NAME">users</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UserInfo</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">users</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>454</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>455</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">users</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">handle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.members.push</span><span class="PUNC">(</span><span class="NAME">users</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>456</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>457</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>458</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>459</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>460</span>      *    コレクションメンバーをユーザ記述文字列の配列に変換
<span class='line'>461</span>      *  @returns　{Array of String}
<span class='line'>462</span>      */</span><span class="WHIT">
<span class='line'>463</span> </span><span class="WHIT">    </span><span class="NAME">nas.UserInfoCollection.prototype.convertStringArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>464</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resultArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>465</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">this.members.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="NAME">this.members</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>466</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">resultArray</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>467</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>468</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>469</span>      *   コレクションメンバーを検索してインデックスを返す
<span class='line'>470</span>      *   発見できなかった場合は -1
<span class='line'>471</span>      *   引数がハンドルのみであった場合もハンドルの一致でインデックスを返す
<span class='line'>472</span>      *   その場合先に一致したハンドルが返されるので希望のデータではない可能性があるので注意
<span class='line'>473</span>      *  @params {Object nas.UserInfo|String} searchUser
<span class='line'>474</span>      */</span><span class="WHIT">
<span class='line'>475</span> </span><span class="WHIT">    </span><span class="NAME">nas.UserInfoCollection.prototype.userIndexOf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">searchUser</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>476</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.members.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>477</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">this.members.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>478</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.members</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sameAs</span><span class="PUNC">(</span><span class="NAME">searchUser</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>479</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>480</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>481</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>482</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>483</span>      *   コレクションにメンバーを追加する。既存のメンバーは追加されない。戻り値はメンバーのインデックス
<span class='line'>484</span>      *   配列引数渡しNG
<span class='line'>485</span>      *   不正メンバーは追加されない。その場合の戻り値は -1
<span class='line'>486</span>      *  @params {Object nas.UserInfo|String} newMember
<span class='line'>487</span>      */</span><span class="WHIT">
<span class='line'>488</span> </span><span class="WHIT">    </span><span class="NAME">nas.UserInfoCollection.prototype.addMember</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">newMember</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>489</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">newMember</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.UserInfo</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>490</span> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">newMember</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>491</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">newMember.match</span><span class="PUNC">(</span><span class="REGX">/^(.+)\:(\{[^\{\}]+\}$)/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>492</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">additionalOpt</span><span class="PUNC">=</span><span class="NAME">JSON.parse</span><span class="PUNC">(</span><span class="NAME">RegExp.$2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>493</span> </span><span class="WHIT">               </span><span class="COMM">// for(prp in additionalOpt) newMember[prp] = additionalOpt[prp];</span><span class="WHIT">
<span class='line'>494</span> </span><span class="WHIT">                </span><span class="NAME">newMember</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UserInfo</span><span class="PUNC">(</span><span class="NAME">RegExp.$1</span><span class="PUNC">,</span><span class="NAME">additionalOpt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>495</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>496</span> </span><span class="WHIT">                </span><span class="NAME">newMember</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UserInfo</span><span class="PUNC">(</span><span class="NAME">newMember</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>497</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>498</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>499</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">newMember.handle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>500</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">iX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.userIndexOf</span><span class="PUNC">(</span><span class="NAME">newMember</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>501</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">iX</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">this.members.push</span><span class="PUNC">(</span><span class="NAME">newMember</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.members.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">iX</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>502</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>503</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>504</span>      *   userストリームをtext出力
<span class='line'>505</span>      *   @params {String} form
<span class='line'>506</span>      *   出力形式指定文字列 "full"|"dump"|"plain"|"text"|"JSON"
<span class='line'>507</span>      *   引数無しでカンマ区切りリスト("csv")
<span class='line'>508</span>      *   @returns {String} 
<span class='line'>509</span>      */</span><span class="WHIT">
<span class='line'>510</span> </span><span class="WHIT">    </span><span class="NAME">nas.UserInfoCollection.prototype.dump</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>511</span> </span><span class="WHIT">        </span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>512</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">'JSON'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>513</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">JSON.stringify</span><span class="PUNC">(</span><span class="NAME">this.members</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>514</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">'full-dump'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>515</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">'full'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>516</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">'dump'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>517</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resultArray</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>518</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ix</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ix</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.members.length</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="NAME">ix</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="NAME">this.members</span><span class="PUNC">[</span><span class="NAME">ix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>519</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">JSON.stringify</span><span class="PUNC">(</span><span class="NAME">resultArray</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>520</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">'plain-text'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>521</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">'plain'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>522</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">'text'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>523</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.members.join</span><span class="PUNC">(</span><span class="STRN">'\n'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>524</span> </span><span class="WHIT">        </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>525</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.members.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>526</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>527</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>528</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>529</span>      *   userストリームを引数にしてCollectionの内容をすべて入れ替える
<span class='line'>530</span>      *   ストリームの形式は "plain-text" または "full-dump" または  "JSON"を自動判別
<span class='line'>531</span>      *   引数が空の場合は、何も操作せずに戻る
<span class='line'>532</span>      *  @params {String} dataStream
<span class='line'>533</span>      */</span><span class="WHIT">
<span class='line'>534</span> </span><span class="WHIT">    </span><span class="NAME">nas.UserInfoCollection.prototype.parseConfig</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dataStream</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>535</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dataStream.length</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>536</span> </span><span class="WHIT">        </span><span class="NAME">this.members.length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>537</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">form</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'plain-text'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>538</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dataStream.match</span><span class="PUNC">(</span><span class="REGX">/^\s*\[\s*\{/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>539</span> </span><span class="WHIT">            </span><span class="NAME">form</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'JSON'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>540</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dataStream.match</span><span class="PUNC">(</span><span class="REGX">/\[[^\[\]]+\]/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>541</span> </span><span class="WHIT">            </span><span class="NAME">form</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'full-dump'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>542</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>543</span> </span><span class="WHIT">        </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>544</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'JSON'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>545</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tempData</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">JSON.parse</span><span class="PUNC">(</span><span class="NAME">dataStream</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>546</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">ix</span><span class="PUNC">&lt;</span><span class="NAME">tempData.length</span><span class="PUNC">;</span><span class="NAME">ix</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>547</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">optProp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hasOpt</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>548</span> </span><span class="WHIT">                    </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">prp</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">tempData</span><span class="PUNC">[</span><span class="NAME">ix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>549</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">prp</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'handle'</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">prp</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'email'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>550</span> </span><span class="WHIT">                        </span><span class="NAME">hasOpt</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>551</span> </span><span class="WHIT">                        </span><span class="NAME">optProp</span><span class="PUNC">[</span><span class="NAME">prp</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tempData</span><span class="PUNC">[</span><span class="NAME">ix</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">prp</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>552</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>553</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">hasOpt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>554</span> </span><span class="WHIT">                        </span><span class="NAME">this.addMember</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UserInfo</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">tempData</span><span class="PUNC">[</span><span class="NAME">ix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">handle</span><span class="PUNC">,</span><span class="NAME">tempData</span><span class="PUNC">[</span><span class="NAME">ix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">email</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">':'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">optProp</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>555</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>556</span> </span><span class="WHIT">                        </span><span class="NAME">this.addMember</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UserInfo</span><span class="PUNC">(</span><span class="NAME">tempData</span><span class="PUNC">[</span><span class="NAME">ix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">handle</span><span class="PUNC">+</span><span class="STRN">':'</span><span class="PUNC">+</span><span class="NAME">tempData</span><span class="PUNC">[</span><span class="NAME">ix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">email</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>557</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>558</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>559</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>560</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'full-dump'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>561</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tempData</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">JSON.parse</span><span class="PUNC">(</span><span class="NAME">dataStream</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>562</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">ix</span><span class="PUNC">&lt;</span><span class="NAME">tempData.length</span><span class="PUNC">;</span><span class="NAME">ix</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>563</span> </span><span class="WHIT">                     </span><span class="NAME">this.addMember</span><span class="PUNC">(</span><span class="NAME">tempData</span><span class="PUNC">[</span><span class="NAME">ix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>564</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>565</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>566</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'plain-text'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>567</span> </span><span class="WHIT">            </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>568</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tempData</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dataStream.split</span><span class="PUNC">(</span><span class="STRN">'\n'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>569</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">ix</span><span class="PUNC">&lt;</span><span class="NAME">tempData.length</span><span class="PUNC">;</span><span class="NAME">ix</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>570</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">tempData</span><span class="PUNC">[</span><span class="NAME">ix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="STRN">"#"</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">tempData</span><span class="PUNC">[</span><span class="NAME">ix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="COMM">//コメント/空行スキップ</span><span class="WHIT">
<span class='line'>571</span> </span><span class="WHIT">                    </span><span class="NAME">this.addMember</span><span class="PUNC">(</span><span class="NAME">tempData</span><span class="PUNC">[</span><span class="NAME">ix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>572</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>573</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>574</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>575</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>576</span> 
<span class='line'>577</span> </span><span class="COMM">/*test
<span class='line'>578</span> A = new nas.UserInfo("A123:123@23456");
<span class='line'>579</span> B = new nas.UserInfo("B123@4567");
<span class='line'>580</span> C = new nas.UserInfo("C123");
<span class='line'>581</span> D = new nas.UserInfo("D123:123@23456");
<span class='line'>582</span> E=new nas.UserInfoCollection([A,B,C,"kiyo@nekomataya.info"]);
<span class='line'>583</span> 
<span class='line'>584</span> E.add(D);
<span class='line'>585</span> console.log(E.add(D));
<span class='line'>586</span> console.log(E.add(new nas.UserInfo()));
<span class='line'>587</span> 
<span class='line'>588</span> console.log(E);
<span class='line'>589</span> */</span><span class="WHIT">
<span class='line'>590</span> 
<span class='line'>591</span> </span><span class="COMM">//UnitValuで利用可能な単位 px/pixels を与えるとその時点での基底解像度で処理してpointに換算、pxとしての保存は行わない</span><span class="WHIT">
<span class='line'>592</span> </span><span class="NAME">nas.UNITRegex</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">'^(in|inches|mm|millimeters|cm|centimeters|pt|picas|points|mp|millipoints)$'</span><span class="PUNC">,</span><span class="STRN">'i'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>593</span> 
<span class='line'>594</span> </span><span class="COMM">/*=============================================================================================再利用メソッド*/</span><span class="WHIT">
<span class='line'>595</span> </span><span class="COMM">//不正単位系の処理を追加  07-04 2016</span><span class="WHIT">
<span class='line'>596</span> </span><span class="COMM">/**
<span class='line'>597</span> 	common method
<span class='line'>598</span> */</span><span class="WHIT">
<span class='line'>599</span> </span><span class="NAME">nas.UNITString</span><span class="WHIT">	</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">this.value</span><span class="PUNC">,</span><span class="NAME">this.type</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">' '</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>600</span> </span><span class="NAME">nas.UNITValue</span><span class="WHIT">	</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.value</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>601</span> </span><span class="NAME">nas.UNITAs</span><span class="WHIT">	</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myUnit</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">nas.decodeUnit</span><span class="PUNC">(</span><span class="NAME">this.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">myUnit</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>602</span> </span><span class="NAME">nas.UNITConvert</span><span class="WHIT">	</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myUnit</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.value</span><span class="PUNC">=</span><span class="NAME">nas.decodeUnit</span><span class="PUNC">(</span><span class="NAME">this.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">myUnit</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.type</span><span class="PUNC">=</span><span class="NAME">myUnit</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>603</span> 
<span class='line'>604</span> </span><span class="NAME">nas.ANGLEAs</span><span class="WHIT">	</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myUnit</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>605</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">targetUnit</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">myUnit.match</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="REGX">/^(r|rad|radians)$/i</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">"radians"</span><span class="PUNC">:</span><span class="STRN">"degrees"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>606</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">targetUnit</span><span class="PUNC">==</span><span class="NAME">this.type</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>607</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.value</span><span class="WHIT">
<span class='line'>608</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>609</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetUnit</span><span class="PUNC">==</span><span class="STRN">"degrees"</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">radiansToDegrees</span><span class="PUNC">(</span><span class="NAME">this.value</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">degreesToRadians</span><span class="PUNC">(</span><span class="NAME">this.value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>610</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>611</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>612</span> </span><span class="NAME">nas.ANGLEConvert</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myUnit</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>613</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">targetUnit</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">myUnit.match</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="REGX">/^(r|rad|radians)$/i</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">"radians"</span><span class="PUNC">:</span><span class="STRN">"degrees"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>614</span> </span><span class="WHIT">		</span><span class="NAME">this.value</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">targetUnit</span><span class="PUNC">==</span><span class="STRN">"degrees"</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">radiansToDegrees</span><span class="PUNC">(</span><span class="NAME">this.value</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">degreesToRadians</span><span class="PUNC">(</span><span class="NAME">this.value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>615</span> </span><span class="WHIT">		</span><span class="NAME">this.type</span><span class="PUNC">=</span><span class="NAME">targetUnit</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>616</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>617</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>618</span> </span><span class="NAME">nas.RESOLUTIONAs</span><span class="WHIT">	</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myUnit</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>619</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">targetUnit</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">myUnit.match</span><span class="PUNC">(</span><span class="REGX">/^(dpi|ppi|lpi|dpc|ppc|lpc)$/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="PUNC">:</span><span class="STRN">'dpi'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>620</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">targetUnit.slice</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NAME">this.type.slice</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>621</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.value</span><span class="WHIT">
<span class='line'>622</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>623</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetUnit.indexOf</span><span class="PUNC">(</span><span class="STRN">'pc'</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this.value</span><span class="PUNC">*</span><span class="NUMB">2.540</span><span class="PUNC">:</span><span class="NAME">this.value</span><span class="PUNC">/</span><span class="NUMB">2.540</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>624</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>625</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>626</span> </span><span class="NAME">nas.RESOLUTIONConvert</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myUnit</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>627</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">targetUnit</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">myUnit.match</span><span class="PUNC">(</span><span class="REGX">/^(dpi|ppi|lpi|dpc|ppc|lpc)$/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="PUNC">:</span><span class="STRN">'dpi'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>628</span> </span><span class="WHIT">		</span><span class="NAME">this.value</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">targetUnit.indexOf</span><span class="PUNC">(</span><span class="STRN">'pc'</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this.value</span><span class="PUNC">*</span><span class="NUMB">2.540</span><span class="PUNC">:</span><span class="NAME">this.value</span><span class="PUNC">/</span><span class="NUMB">2.540</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>629</span> </span><span class="WHIT">		</span><span class="NAME">this.type</span><span class="PUNC">=</span><span class="NAME">targetUnit</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>630</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>631</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>632</span> </span><span class="NAME">nas._LISTString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myUnit</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>633</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">myUnit</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"unidefined"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">myUnit</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>634</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>635</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myDim</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">myDim</span><span class="PUNC">&lt;</span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="NAME">myDim</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>636</span> </span><span class="WHIT">		  </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myUnit</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>637</span> </span><span class="WHIT">			</span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">this.props</span><span class="PUNC">[</span><span class="NAME">myDim</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">as</span><span class="PUNC">(</span><span class="NAME">myUnit</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>638</span> </span><span class="WHIT">		  </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>639</span> </span><span class="WHIT">			</span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">this.props</span><span class="PUNC">[</span><span class="NAME">myDim</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>640</span> </span><span class="WHIT">		  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>641</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>642</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult.join</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//リスト文字列で</span><span class="WHIT">
<span class='line'>643</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>644</span> </span><span class="NAME">nas._ARRAYValue</span><span class="WHIT">	</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myUnit</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>645</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">myUnit</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"unidefined"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">myUnit</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>646</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>647</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myDim</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">myDim</span><span class="PUNC">&lt;</span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="NAME">myDim</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>648</span> </span><span class="WHIT">		  </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myUnit</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>649</span> </span><span class="WHIT">			</span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">this.props</span><span class="PUNC">[</span><span class="NAME">myDim</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">as</span><span class="PUNC">(</span><span class="NAME">myUnit</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>650</span> </span><span class="WHIT">		  </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>651</span> </span><span class="WHIT">			</span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">this.props</span><span class="PUNC">[</span><span class="NAME">myDim</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>652</span> </span><span class="WHIT">		  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>653</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>654</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="COMM">//配列で</span><span class="WHIT">
<span class='line'>655</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>656</span> </span><span class="COMM">/**
<span class='line'>657</span>  *  単位つきの長さを統一的に扱うクラス　単位間のコンバート機能を内包している&lt;br />
<span class='line'>658</span>  * Adobe ESTK 互換&lt;br />
<span class='line'>659</span>  *
<span class='line'>660</span>  * @class
<span class='line'>661</span>  * Adobe Extend Script の UnitValue クラスとメソッド互換の単位つき長さオブジェクト&lt;br />
<span class='line'>662</span>  * 第二引数で単位が指定されない場合は第一引数の単位を使用する&lt;br />
<span class='line'>663</span>  * 引数間で単位が異なる場合は第一引数の指定値を第二引数の単位へ変換してオブジェクト化する&lt;br />
<span class='line'>664</span>  * どちらも無効な場合は、第一引数の数値部分をpointで換算&lt;br />
<span class='line'>665</span>  * 未知の単位が与えられた場合は単位系を無効のまま数値のみで初期化して要求はptで代用する＜estk互換＞&lt;br />
<span class='line'>666</span>  * 無効な値で初期化された場合は値を0に設定する。＜estk互換＞&lt;br />
<span class='line'>667</span>  * 有効な単位は	in,inches,mm,millimeters,cm,centimeters,pt,picas,points,mp,millipoints
<span class='line'>668</span>  *
<span class='line'>669</span>  * 	@params {Number or String} numberString
<span class='line'>670</span>  *  数値、単位つき数値文字列 or 数値文字列
<span class='line'>671</span>  * 	@params {String} unitString
<span class='line'>672</span>  *  単位 String 単位を文字列で  省略可
<span class='line'>673</span>  * 
<span class='line'>674</span>  * @example
<span class='line'>675</span>  * 	A = new nas.UnitValue("123","mm")    ;//
<span class='line'>676</span>  * 	B = new nas.UnitValue("-72pt","in")  ;//
<span class='line'>677</span>  * 	C = new nas.UnitValue(25.4,"cm")     ;//
<span class='line'>678</span>  * 	D = new nas.UnitValue("うさぎ",'カメ') ;// {value: 0, type: "pt"}
<span class='line'>679</span>  * 	E = new nas.UnitValue('125 degree')  ;// {value: 0, type: "pt"}
<span class='line'>680</span>  * 	F = new nas.UnitValue(A)             ;// {value: 123, type: "mm"}
<span class='line'>681</span>  * 
<span class='line'>682</span>  */</span><span class="WHIT">
<span class='line'>683</span> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">numberString</span><span class="PUNC">,</span><span class="NAME">unitString</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>684</span> </span><span class="WHIT">    </span><span class="NAME">this.value</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>685</span> </span><span class="WHIT">    </span><span class="NAME">this.type</span><span class="WHIT">  </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>686</span> </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>687</span> </span><span class="WHIT">    </span><span class="NAME">this.setValue</span><span class="PUNC">(</span><span class="NAME">numberString</span><span class="PUNC">,</span><span class="NAME">unitString</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>688</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>689</span> </span><span class="COMM">/**
<span class='line'>690</span>  * 引数をパースしてUnitValueのプロパティを設定するメソッド&lt;br />
<span class='line'>691</span>  * 初期化の際にもコールされる&lt;br />
<span class='line'>692</span>  * 	@params {Number or String} myNumberString 数値、単位つき数値文字列 or 数値文字列
<span class='line'>693</span>  * 	@params {String} myUnitString 単位 String 単位を文字列で  省略可
<span class='line'>694</span>  *  @returns {nas.UnitValue} 値をセットされた nas.UnitValue 本体
<span class='line'>695</span>  */</span><span class="WHIT">
<span class='line'>696</span> </span><span class="NAME">nas.UnitValue.prototype.setValue</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myNumberString</span><span class="PUNC">,</span><span class="NAME">myUnitString</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>697</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myNumberString</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>698</span> </span><span class="WHIT">        </span><span class="NAME">myNumberString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myNumberString.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>699</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>700</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">myNumberString</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"string"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>701</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myNumberUnit</span><span class="PUNC">=</span><span class="NAME">myNumberString.replace</span><span class="PUNC">(</span><span class="REGX">/[\+\-\.\s0-9]/g</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>702</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>703</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myNumberUnit</span><span class="PUNC">=</span><span class="STRN">''</span><span class="PUNC">;</span><span class="COMM">//第一引数が文字列以外</span><span class="WHIT">
<span class='line'>704</span> </span><span class="WHIT">		</span><span class="NAME">myNumberString</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">myNumberString</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>705</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>706</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">&lt;</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">myUnitString</span><span class="PUNC">=</span><span class="NAME">myNumberUnit</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>707</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myUnitString</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">myUnitString.match</span><span class="PUNC">(</span><span class="NAME">nas.UNITRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myUnitString</span><span class="PUNC">=</span><span class="STRN">"pt"</span><span class="PUNC">;</span><span class="COMM">// </span><span class="WHIT">
<span class='line'>708</span> </span><span class="WHIT">	</span><span class="NAME">this.value</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">myNumberUnit</span><span class="PUNC">==</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">myNumberString</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">nas.decodeUnit</span><span class="PUNC">(</span><span class="NAME">myNumberString</span><span class="PUNC">,</span><span class="NAME">myUnitString</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>709</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">this.value</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">this.value</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.value</span><span class="PUNC">=</span><span class="NUMB">0.000000</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>710</span> </span><span class="WHIT">	</span><span class="NAME">this.type</span><span class="PUNC">=</span><span class="NAME">myUnitString</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>711</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>712</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>713</span> </span><span class="COMM">/**
<span class='line'>714</span>  *  指定された単位文字列に変換した数値を返す
<span class='line'>715</span>  *
<span class='line'>716</span>  *  @params {String} 単位文字列
<span class='line'>717</span>  *  @returns {Number} 指定単位系における値
<span class='line'>718</span>  */</span><span class="WHIT">
<span class='line'>719</span> </span><span class="NAME">nas.UnitValue.prototype.as</span><span class="WHIT">	</span><span class="PUNC">=</span><span class="NAME">nas.UNITAs</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>720</span> </span><span class="COMM">/**
<span class='line'>721</span>  *  指定された単位文字列にオブジェクトを変換する
<span class='line'>722</span>  * 
<span class='line'>723</span>  *  @params {String} 単位文字列
<span class='line'>724</span>  *  @returns {String} 変換後の単位付き数値文字列
<span class='line'>725</span>  */</span><span class="WHIT">
<span class='line'>726</span> </span><span class="NAME">nas.UnitValue.prototype.convert</span><span class="WHIT">	</span><span class="PUNC">=</span><span class="NAME">nas.UNITConvert</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>727</span> </span><span class="COMM">/**
<span class='line'>728</span>  *  現在の単位文字列を付記した数値文字列を返す
<span class='line'>729</span>  * 
<span class='line'>730</span>  *  @params {String} 単位文字列
<span class='line'>731</span>  *  @returns {String} 単位付き数値文字列
<span class='line'>732</span>  */</span><span class="WHIT">
<span class='line'>733</span> </span><span class="NAME">nas.UnitValue.prototype.toString</span><span class="PUNC">=</span><span class="NAME">nas.UNITString</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>734</span> </span><span class="COMM">/**
<span class='line'>735</span>  *  現在の単位系の値を返す　Object.valueに同じ
<span class='line'>736</span>  *  
<span class='line'>737</span>  *  @returns {Number} 値
<span class='line'>738</span>  */</span><span class="WHIT">
<span class='line'>739</span> </span><span class="NAME">nas.UnitValue.prototype.valueOf</span><span class="WHIT">	</span><span class="PUNC">=</span><span class="NAME">nas.UNITValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>740</span> 
<span class='line'>741</span> </span><span class="COMM">/*	test
<span class='line'>742</span>  *	A=new nas.UnitValue("125","mm");//2引数初期化
<span class='line'>743</span>  *	B=new nas.UnitValue("125mm","cm");//2引数初期化
<span class='line'>744</span>  *	C=new nas.UnitValue("5in");//1引数初期化
<span class='line'>745</span>  *	D=new nas.UnitValue(-123,"mm");//数値初期化
<span class='line'>746</span>  *	E=new nas.UnitValue("たぬきさん","mm");//不正値初期化
<span class='line'>747</span>  *	console.log(A);
<span class='line'>748</span>  *	console.log(B);
<span class='line'>749</span>  *	console.log(C);
<span class='line'>750</span>  *	console.log(D);
<span class='line'>751</span>  *	console.log(E);
<span class='line'>752</span>  *	console.log("A+B = ",A+B);
<span class='line'>753</span>  *	//これは誤った答えが戻る。が、使い方を誤っているのでそれで正常
<span class='line'>754</span>  *	console.log(A.as("mm")+B.as("mm"));
<span class='line'>755</span>  *	//確実な値が必要な場合は .as(単位)で値を求める
<span class='line'>756</span>  *	//直接演算でUnitValeが戻ることは無い
<span class='line'>757</span>  *	
<span class='line'>758</span>  */</span><span class="WHIT">
<span class='line'>759</span> </span><span class="COMM">/**	nas.UnitAngle
<span class='line'>760</span> コンストラクタ	nas.UnitAngle("値"[,"単位"])
<span class='line'>761</span> 引数:
<span class='line'>762</span> 	値	Number or String 単位付き数値または数値
<span class='line'>763</span> 	単位	 String 単位文字列省略可能
<span class='line'>764</span> 
<span class='line'>765</span> 使用可能な値は  /^(d|degrees|°|度|r|rad|radians)$/)
<span class='line'>766</span> 指定値以外または単位なしで初期化された場合は degrees
<span class='line'>767</span> 単位変換機能付き
<span class='line'>768</span> 例:	A=new nas.UnitAngle("180 degrees","radians");//	180度相当の値がラディアンで格納される
<span class='line'>769</span> 	A=new nas.UnitAngle(1);//1 deg
<span class='line'>770</span> 	A=new nas.UnitAngle("27.4 d");//27.4 degrees  として格納
<span class='line'>771</span> 
<span class='line'>772</span> オブジェクトメソッド:
<span class='line'>773</span> nas.UnitAngle.as("単位文字列")	指定された単位文字列に変換した数値を返す
<span class='line'>774</span> nas.UnitAngle.convert("単位文字列")	指定された単位文字列にオブジェクトを変換する 変換後の単位付き数値文字列を返す
<span class='line'>775</span> */</span><span class="WHIT">
<span class='line'>776</span> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myNumberString</span><span class="PUNC">,</span><span class="NAME">myUnitString</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>777</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myNumberUnit</span><span class="PUNC">=</span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>778</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">myUnitString</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myUnitString</span><span class="PUNC">=</span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>779</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myNumberString</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">myNumberString</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/(d|deg|degrees|°|度)|(r|rad|radians)/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>780</span> </span><span class="WHIT">		</span><span class="NAME">myNumberUnit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">RegExp.$2</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"radians"</span><span class="PUNC">:</span><span class="STRN">"degrees"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>781</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>782</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myUnitString</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">myUnitString</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/(d|deg|degrees|°|度)|(r|rad|radians)/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>783</span> </span><span class="WHIT">	    </span><span class="NAME">myUnitString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">RegExp.$2</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"radians"</span><span class="PUNC">:</span><span class="STRN">"degrees"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>784</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>785</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myUnitString</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">''</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>786</span> </span><span class="WHIT">	    </span><span class="NAME">myUnitString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">myNumberUnit</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">''</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">'degrees'</span><span class="PUNC">:</span><span class="NAME">myNumberUnit</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>787</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>788</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">myNumberUnit</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">''</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myNumberUnit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myUnitString</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>789</span> </span><span class="WHIT">	</span><span class="NAME">this.type</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myUnitString</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>790</span> </span><span class="WHIT">	</span><span class="NAME">this.value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myUnitString</span><span class="PUNC">==</span><span class="NAME">myNumberUnit</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">myNumberString</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>791</span> </span><span class="WHIT">	    </span><span class="PUNC">(</span><span class="NAME">myUnitString</span><span class="PUNC">==</span><span class="STRN">"degrees"</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT">
<span class='line'>792</span> </span><span class="WHIT">	        </span><span class="NAME">nas.radiansToDegrees</span><span class="PUNC">(</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">myNumberString</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>793</span> </span><span class="WHIT">	        </span><span class="NAME">nas.degreesToRadians</span><span class="PUNC">(</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">myNumberString</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>794</span> </span><span class="WHIT">	    </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>795</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">this.value</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.value</span><span class="PUNC">=</span><span class="NUMB">0.000000</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>796</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>797</span> </span><span class="NAME">nas.UnitAngle.prototype.as</span><span class="WHIT">	</span><span class="PUNC">=</span><span class="NAME">nas.ANGLEAs</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>798</span> </span><span class="NAME">nas.UnitAngle.prototype.convert</span><span class="WHIT">	</span><span class="PUNC">=</span><span class="NAME">nas.ANGLEConvert</span><span class="WHIT">
<span class='line'>799</span> </span><span class="NAME">nas.UnitAngle.prototype.toString</span><span class="PUNC">=</span><span class="NAME">nas.UNITString</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>800</span> </span><span class="NAME">nas.UnitAngle.prototype.valueOf</span><span class="WHIT">	</span><span class="PUNC">=</span><span class="NAME">nas.UNITValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>801</span> </span><span class="COMM">/*
<span class='line'>802</span> 	nas.UnitResolution Object
<span class='line'>803</span> コンストラクタ  単位付き解像度オブジェクト
<span class='line'>804</span> 	new nas.UnitResolution("解像度"[,"単位"])
<span class='line'>805</span> 
<span class='line'>806</span> 引数:	解像度  String or Number 単位付き文字列または数値
<span class='line'>807</span> 	単位	String	単位を文字列で
<span class='line'>808</span> 	双方が異なっていれば指定単位に換算
<span class='line'>809</span> 	指定可能な単位は (/dpi|ppi|lpi|dpc|ppc|lpc/i)  実質は2種  デフォルトは dpc
<span class='line'>810</span> 	無効値で初期化された場合は  72dpi相当の密度に設定する(nas標準値か？)
<span class='line'>811</span> 	値0はどの単位系でも発散が起きるのでダメ  これも値を矯正する
<span class='line'>812</span> 
<span class='line'>813</span> 例:	new Resolution('120dpi','dpc');
<span class='line'>814</span> 	new Resolution( 50,'dpc');
<span class='line'>815</span> 	new Resolution('200 dpi');
<span class='line'>816</span> 
<span class='line'>817</span> オブジェクトメソッド:
<span class='line'>818</span> nas.UnitResolution.as("単位文字列")	指定された単位文字列に変換した数値を返す
<span class='line'>819</span> nas.UnitResolution.convert("単位文字列")	指定された単位文字列にオブジェクトを変換する 変換後の単位付き数値文字列を返す
<span class='line'>820</span> 
<span class='line'>821</span> */</span><span class="WHIT">
<span class='line'>822</span> </span><span class="NAME">nas.UnitResolution</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myNumberString</span><span class="PUNC">,</span><span class="NAME">myUnitString</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>823</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myNumberUnit</span><span class="PUNC">=</span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>824</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myNumberString</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">myNumberString</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/([dpl]p[ci])/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>825</span> </span><span class="WHIT">		</span><span class="NAME">myNumberUnit</span><span class="PUNC">=</span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>826</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>827</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myUnitString</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">myUnitString</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/([dpl]p[ci])/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>828</span> </span><span class="WHIT">	    </span><span class="NAME">myUnitString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>829</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>830</span> </span><span class="WHIT">	    </span><span class="NAME">myUnitString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>831</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>832</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myUnitString</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">''</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>833</span> </span><span class="WHIT">	    </span><span class="NAME">myUnitString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">myNumberUnit</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">''</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">'dpc'</span><span class="PUNC">:</span><span class="NAME">myNumberUnit</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>834</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>835</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">myNumberUnit</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">''</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myNumberUnit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myUnitString</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>836</span> </span><span class="WHIT">	</span><span class="NAME">this.type</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myUnitString</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>837</span> </span><span class="WHIT">	</span><span class="NAME">this.value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myUnitString</span><span class="PUNC">==</span><span class="NAME">myNumberUnit</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT">
<span class='line'>838</span> </span><span class="WHIT">	    </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">myNumberString</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="WHIT">	    </span><span class="WHIT">
<span class='line'>839</span> </span><span class="WHIT">	    </span><span class="PUNC">(</span><span class="NAME">myUnitString.indexOf</span><span class="PUNC">(</span><span class="STRN">'pc'</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT">
<span class='line'>840</span> </span><span class="WHIT">	        </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">myNumberString</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">2.540</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>841</span> </span><span class="WHIT">	        </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">myNumberString</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2.540</span><span class="WHIT">
<span class='line'>842</span> </span><span class="WHIT">	    </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>843</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">this.value</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">this.value</span><span class="PUNC">&lt;=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.value</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">myUnitString.indexOf</span><span class="PUNC">(</span><span class="STRN">'pc'</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">nas.RESOLUTION</span><span class="PUNC">*</span><span class="NUMB">2.540</span><span class="PUNC">:</span><span class="NAME">nas.RESOLUTION</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>844</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>845</span> </span><span class="NAME">nas.UnitResolution.prototype.as</span><span class="WHIT">		</span><span class="PUNC">=</span><span class="NAME">nas.RESOLUTIONAs</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>846</span> </span><span class="NAME">nas.UnitResolution.prototype.convert</span><span class="WHIT">	</span><span class="PUNC">=</span><span class="NAME">nas.RESOLUTIONConvert</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>847</span> </span><span class="NAME">nas.UnitResolution.prototype.toString</span><span class="WHIT">	</span><span class="PUNC">=</span><span class="NAME">nas.UNITString</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>848</span> </span><span class="NAME">nas.UnitResolution.prototype.valueOf</span><span class="WHIT">	</span><span class="PUNC">=</span><span class="NAME">nas.UNITValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>849</span> </span><span class="COMM">/*================================  以下は単位付き数値オブジェクトを要素に持つ複合オブジェクト===============*/</span><span class="WHIT">
<span class='line'>850</span> </span><span class="COMM">/** 解像度トレーラ
<span class='line'>851</span> ３次元までの解像度を保持する解像度オブジェクト
<span class='line'>852</span> コンストラクタ
<span class='line'>853</span> 	new nas.Resolution(x[,y[,z]])
<span class='line'>854</span> 引数は
<span class='line'>855</span> 	UnitResolution	/	x,y,z-resokution
<span class='line'>856</span> 
<span class='line'>857</span> 
<span class='line'>858</span> 	TimingCurve	/	timing	
<span class='line'>859</span> 引数がない場合は単位"ppc"で 72ppi相当の 1次元のオブジェクトを初期化
<span class='line'>860</span> 
<span class='line'>861</span> コンストラクタでタイミングカーブを初期化する必要は無い
<span class='line'>862</span> また、タイミングカーブを扱う局面は少ない。
<span class='line'>863</span> 
<span class='line'>864</span> Resolution オブジェクトはUnitResolutionを中核データとしたデータ密度を扱うオブジェクト
<span class='line'>865</span> 単一の値で初期化された場合はすべてのプロパティを同じ値で初期化する
<span class='line'>866</span> lunegthの値に従って文字列、配列の出力は変化するが
<span class='line'>867</span> 個別プロパティを請求した場合は、x,y,zのそれぞれで値を得ることができる
<span class='line'>868</span> 
<span class='line'>869</span> 
<span class='line'>870</span> Resolution
<span class='line'>871</span> 	.x(x-resolution)
<span class='line'>872</span> 	.y(y-resolution)
<span class='line'>873</span> 	.z(z-resolution)
<span class='line'>874</span> Resolution Object出力書式
<span class='line'>875</span> form1:
<span class='line'>876</span>     dim1
<span class='line'>877</span>         144ppi
<span class='line'>878</span>     dim1
<span class='line'>879</span>         144ppi,144dpi
<span class='line'>880</span>     dim1
<span class='line'>881</span>         144ppi,144dpi,144dpi
<span class='line'>882</span> form2:
<span class='line'>883</span>     dim1
<span class='line'>884</span>         resolution = 144ppi
<span class='line'>885</span>     dim2
<span class='line'>886</span>         resolution.X = 144ppi
<span class='line'>887</span>         resolution.Y = 144ppi
<span class='line'>888</span>     dim3
<span class='line'>889</span>         resolution.X = 144ppi
<span class='line'>890</span>         resolution.Y = 144ppi
<span class='line'>891</span>         resolution.Z = 144ppi
<span class='line'>892</span> */</span><span class="WHIT">
<span class='line'>893</span> </span><span class="NAME">nas.Resolution</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>894</span> </span><span class="COMM">/*
<span class='line'>895</span> 	this.props = ['x','y','z',];
<span class='line'>896</span> 	this.x = new nas.UnitResolution('72ppi');
<span class='line'>897</span> 	this.y = new nas.UnitResolution('72ppi');
<span class='line'>898</span> 	this.z;
<span class='line'>899</span> 	this.length = 1;
<span class='line'>900</span> 	this.type="dpc";
<span class='line'>901</span> */</span><span class="WHIT">
<span class='line'>902</span> </span><span class="COMM">//---------------------------------------------------------------</span><span class="WHIT">
<span class='line'>903</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>904</span> </span><span class="WHIT">		</span><span class="NAME">arguments</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitResolution</span><span class="PUNC">(</span><span class="STRN">"72 ppi"</span><span class="PUNC">,</span><span class="STRN">"dpc"</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>905</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>906</span> </span><span class="WHIT">	</span><span class="NAME">this.props</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="STRN">"x"</span><span class="PUNC">,</span><span class="STRN">"y"</span><span class="PUNC">,</span><span class="STRN">"z"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>907</span> </span><span class="WHIT">	</span><span class="NAME">this.length</span><span class="PUNC">=</span><span class="NAME">arguments.length</span><span class="PUNC">;</span><span class="COMM">//DimensionLength 1~3</span><span class="WHIT">
<span class='line'>908</span> </span><span class="WHIT">	</span><span class="NAME">this.x</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitResolution</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>909</span> 
<span class='line'>910</span> </span><span class="WHIT">    </span><span class="NAME">this.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.x.type</span><span class="PUNC">;</span><span class="COMM">//第一引数の単位で統一</span><span class="WHIT">
<span class='line'>911</span> 
<span class='line'>912</span> </span><span class="WHIT">	</span><span class="NAME">this.y</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitResolution</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">this.type</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">this.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>913</span> </span><span class="WHIT">	</span><span class="NAME">this.z</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitResolution</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">this.type</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">this.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>914</span> 
<span class='line'>915</span> </span><span class="WHIT">	</span><span class="NAME">this.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">opt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>916</span> </span><span class="WHIT">    		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>917</span> </span><span class="WHIT">	    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">opt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>918</span> </span><span class="WHIT">	        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.length</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.x.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>919</span> </span><span class="WHIT">	    	</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myDim</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">myDim</span><span class="PUNC">&lt;</span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="NAME">myDim</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>920</span> </span><span class="WHIT">		        </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">this.props</span><span class="PUNC">[</span><span class="NAME">myDim</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>921</span> </span><span class="WHIT">		    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>922</span> </span><span class="WHIT">		    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult.join</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>923</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>924</span> </span><span class="WHIT">		    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.length</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"\tresolution = "</span><span class="PUNC">+</span><span class="NAME">this.x.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>925</span> </span><span class="WHIT">	    	</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myDim</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">myDim</span><span class="PUNC">&lt;</span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="NAME">myDim</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>926</span> </span><span class="WHIT">		        </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="STRN">"\tresolution."</span><span class="PUNC">+</span><span class="NAME">this.props</span><span class="PUNC">[</span><span class="NAME">myDim</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="STRN">" = "</span><span class="PUNC">+</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">this.props</span><span class="PUNC">[</span><span class="NAME">myDim</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>927</span> </span><span class="WHIT">		    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>928</span> </span><span class="WHIT">		    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult.join</span><span class="PUNC">(</span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>929</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>930</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>931</span> </span><span class="WHIT">	</span><span class="NAME">this.valueOf</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">asUnit</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>932</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">asUnit</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">asUnit</span><span class="PUNC">=</span><span class="NAME">this.type</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>933</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.length</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.x.as</span><span class="PUNC">(</span><span class="NAME">asUnit</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>934</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>935</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myDim</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">myDim</span><span class="PUNC">&lt;</span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="NAME">myDim</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">this.props</span><span class="PUNC">[</span><span class="NAME">myDim</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">as</span><span class="PUNC">(</span><span class="NAME">asUnit</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>936</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>937</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>938</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>939</span> </span><span class="COMM">/*
<span class='line'>940</span> 	座標オブジェクト
<span class='line'>941</span> コンストラクタ:
<span class='line'>942</span> 	new nas.Point(x[,y[,z]])
<span class='line'>943</span> 1次元、2次元、3次元の値が初期化可能
<span class='line'>944</span> 引数は UnitValueまたは文字列で
<span class='line'>945</span> 
<span class='line'>946</span> 第一引数の持つ単位を、代表単位として保存するが、オブジェクトの生成後に他の単位を設定することが可能
<span class='line'>947</span> 
<span class='line'>948</span> または
<span class='line'>949</span> 	new nas.Point(nas.Point)
<span class='line'>950</span> 第一引数がnas.Point  オブジェクトだった場合は、そのオブジェクトの複製を初期化する
<span class='line'>951</span> 
<span class='line'>952</span> または
<span class='line'>953</span> 	new nas.Point(値リスト/配列[,単位])
<span class='line'>954</span> 値リストでの初期化も可能  多くの実装で配列形式の座標を扱うので互換をもたせるものとする
<span class='line'>955</span>   myPoint=new nas.Point([myX,myY]);
<span class='line'>956</span>   myPoint=new nas.Point([0,128,255],"pt");
<span class='line'>957</span> 
<span class='line'>958</span> Point.length  で次数が取得できる
<span class='line'>959</span> 
<span class='line'>960</span> プロパティはUnitValue または　文字列で初期化
<span class='line'>961</span> 引数が数値ならばptとして初期化する
<span class='line'>962</span> 与えられない次数の値を0として扱うことが可能
<span class='line'>963</span> 引数なしの場合は2次元 ["0pt","0pt"] で初期化される
<span class='line'>964</span> 
<span class='line'>965</span> 	プロパティ
<span class='line'>966</span> nas.Point.length	Int  整数  保持している値の次数
<span class='line'>967</span> nas.Point.x	UnitValue x座標値
<span class='line'>968</span> nas.Point.y	UnitValue y座標値
<span class='line'>969</span> nas.Point.z	UnitValue z座標値
<span class='line'>970</span> nas.Point.type String 単位
<span class='line'>971</span> 
<span class='line'>972</span> 数値で値を得る場合は各プロパティのas()メソッドを使用のこと
<span class='line'>973</span> 
<span class='line'>974</span> 例： [myPoint.x.as('pt'),myPoint.y.as('pt')]
<span class='line'>975</span> 
<span class='line'>976</span> オブジェクトメソッド:
<span class='line'>977</span> nas.Point.toString([指定単位])	;指定単位に揃えてリストで返す
<span class='line'>978</span> nas.Point.valueOf([指定単位])	;指定単位にそろえて配列を戻す
<span class='line'>979</span> 単位指定がない場合は、登録された単位で返す
<span class='line'>980</span> 
<span class='line'>981</span> nas.Position は古いので  nas.Pointを使えやゴルァ
<span class='line'>982</span> コンストラクタと初期化クラスメソッドを割ったほうが良いかも？
<span class='line'>983</span> 
<span class='line'>984</span> */</span><span class="WHIT">
<span class='line'>985</span> </span><span class="COMM">/**
<span class='line'>986</span>     二項または三項のnas.UnitValueをまとめて、座標点として扱う
<span class='line'>987</span>     
<span class='line'>988</span>     @param {UnitValue or String} x
<span class='line'>989</span>     @param {UnitValue or String} y
<span class='line'>990</span>     @param {UnitValue or String} z
<span class='line'>991</span>     @example
<span class='line'>992</span>      A = new nas.Point(new nas.UnitValue('12.356 mm'),new nas.UnitValue('0.0 mm'));
<span class='line'>993</span>      B = new nas.Point("12.356mm, 0.0mm");
<span class='line'>994</span>  */</span><span class="WHIT">
<span class='line'>995</span> </span><span class="NAME">nas.Point</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>996</span> </span><span class="WHIT">	</span><span class="NAME">this.props</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">'x'</span><span class="PUNC">,</span><span class="STRN">'y'</span><span class="PUNC">,</span><span class="STRN">'z'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>997</span> </span><span class="WHIT">	</span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">(</span><span class="STRN">'0 pt'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>998</span> </span><span class="WHIT">	</span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">(</span><span class="STRN">'0 pt'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>999</span> </span><span class="WHIT">	</span><span class="NAME">this.z</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1000</span> </span><span class="WHIT">	</span><span class="NAME">this.length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1001</span> </span><span class="WHIT">	</span><span class="NAME">this.type</span><span class="PUNC">=</span><span class="STRN">'pt'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1002</span> </span><span class="COMM">// 引数をパーサで処理する</span><span class="WHIT">
<span class='line'>1003</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1004</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">props</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1005</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">arguments.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">props</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1006</span> </span><span class="WHIT">         </span><span class="NAME">this.setValue</span><span class="PUNC">(</span><span class="NAME">props</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1007</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1008</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1009</span> </span><span class="NAME">nas.Point.prototype.toString</span><span class="PUNC">=</span><span class="NAME">nas._LISTString</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1010</span> </span><span class="NAME">nas.Point.prototype.valueOf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="NAME">nas._ARRAYValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1011</span> </span><span class="COMM">/*
<span class='line'>1012</span>     表記方法のゆらぎを吸収してポイントオブジェクトを返す関数
<span class='line'>1013</span>     
<span class='line'>1014</span> */</span><span class="WHIT">
<span class='line'>1015</span> </span><span class="NAME">nas.Point.prototype.setValue</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1016</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1017</span> </span><span class="WHIT">    </span><span class="COMM">//引数が存在しない場合は、NOP</span><span class="WHIT">
<span class='line'>1018</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1019</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1020</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myParams</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.Point</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1021</span> </span><span class="WHIT">	</span><span class="COMM">//第一引数がポイントオブジェクトであれば、値を複製</span><span class="WHIT">
<span class='line'>1022</span> </span><span class="WHIT">	    </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">(</span><span class="NAME">myParams</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1023</span> </span><span class="WHIT">	    </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">(</span><span class="NAME">myParams</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1024</span> </span><span class="WHIT">	    </span><span class="NAME">this.z</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">(</span><span class="NAME">myParams</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">z</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1025</span> </span><span class="WHIT">	    </span><span class="NAME">this.length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myParams</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1026</span> </span><span class="WHIT">	    </span><span class="NAME">this.type</span><span class="PUNC">=</span><span class="NAME">this.x.type</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1027</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1028</span> </span><span class="WHIT">	    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myParams</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1029</span> </span><span class="WHIT">	        </span><span class="NAME">myParams</span><span class="PUNC">=</span><span class="NAME">myParams</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="COMM">//第一引数が配列の場合は、操作対象を当該の配列に設定</span><span class="WHIT">
<span class='line'>1030</span> </span><span class="WHIT">	    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">myParams</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/,/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1031</span> </span><span class="WHIT">	        </span><span class="NAME">myParams</span><span class="PUNC">=</span><span class="NAME">myParams</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//コンマ分離可能な文字列なら配列化</span><span class="WHIT">
<span class='line'>1032</span> </span><span class="WHIT">	    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1033</span> </span><span class="WHIT">	</span><span class="COMM">//引数の要素が２に満たない場合のみ"0pt"を一つ補う。</span><span class="WHIT">
<span class='line'>1034</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myParams.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myParams.push</span><span class="PUNC">(</span><span class="STRN">"0 pt"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1035</span> 
<span class='line'>1036</span> </span><span class="COMM">// 以下引数の初期化処理</span><span class="WHIT">
<span class='line'>1037</span> </span><span class="WHIT">        </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">(</span><span class="NAME">myParams</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1038</span> </span><span class="WHIT">        </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">(</span><span class="NAME">myParams</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1039</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myParams</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1040</span> </span><span class="WHIT">        </span><span class="NAME">this.z</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">(</span><span class="NAME">myParams</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1041</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1042</span> </span><span class="WHIT">		</span><span class="NAME">this.length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myParams.length</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1043</span> </span><span class="WHIT">        </span><span class="NAME">this.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.x.type</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1044</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1045</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1046</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1047</span> </span><span class="COMM">/** test
<span class='line'>1048</span> 	A= new nas.Point();//原点初期化
<span class='line'>1049</span> 
<span class='line'>1050</span> 	myX= new nas.UnitValue("12mm");
<span class='line'>1051</span> 	myY= new nas.UnitValue("25.4mm");
<span class='line'>1052</span> 	myZ= new nas.UnitValue("-36mm");
<span class='line'>1053</span> 	
<span class='line'>1054</span> 	B= nas.newPoint(A);
<span class='line'>1055</span> 	C= nas.newPoint(myX,myY,myZ);
<span class='line'>1056</span> 	D= nas.newPoint([myX,myY,myZ]);
<span class='line'>1057</span> 	E= nas.newPoint([myX,myY],'in');
<span class='line'>1058</span> 	F= nas.newPoint('12cm','2.54cm','30mm');
<span class='line'>1059</span> 	G= nas.newPoint(['12cm','2.54cm','30mm']);
<span class='line'>1060</span> 	H= nas.newPoint(['12cm','2.54cm','30mm'],'in');
<span class='line'>1061</span> 
<span class='line'>1062</span> 	I= nas.newPoint(['12cm']);
<span class='line'>1063</span> 
<span class='line'>1064</span> 	console.log (A.toString());
<span class='line'>1065</span> 	console.log (B.toString());
<span class='line'>1066</span> 	console.log (C.toString());
<span class='line'>1067</span> 	console.log (D.toString());
<span class='line'>1068</span> 	console.log (E.toString());
<span class='line'>1069</span> 	console.log (F.toString());
<span class='line'>1070</span> 	console.log (G.toString());
<span class='line'>1071</span> 	console.log (H.toString());
<span class='line'>1072</span> 	console.log (I.toString());
<span class='line'>1073</span> 
<span class='line'>1074</span>  */</span><span class="WHIT">
<span class='line'>1075</span> </span><span class="COMM">/**
<span class='line'>1076</span>  * 	位置オブジェクト
<span class='line'>1077</span>  * 	
<span class='line'>1078</span>  * 位置オブジェクトは、座標オブジェクトを主たるデータとして位置プロパティを保持する複合オブジェクト
<span class='line'>1079</span>  * 
<span class='line'>1080</span>  * コンストラクタ:
<span class='line'>1081</span>  * 	new nas.Position(x,y[,z])
<span class='line'>1082</span>  * 2次元、3次元の値が初期化可能
<span class='line'>1083</span>  * 引数は UnitValueまたは文字列、Pointオブジェクトの初期化に準ずる
<span class='line'>1084</span>  * Pointオブジェクトを与えて初期化することも可能？
<span class='line'>1085</span>  * 
<span class='line'>1086</span>  * Position.point.length  で次数が取得できる
<span class='line'>1087</span>  * 
<span class='line'>1088</span>  * プロパティはUnitValue
<span class='line'>1089</span>  * 引数が数値ならばptとして初期化する
<span class='line'>1090</span>  * 与えられない次数のプロパティは0として扱うことが可能
<span class='line'>1091</span>  * 引数なしの場合は2次元["0pt","0pt"]で初期化される
<span class='line'>1092</span>  * 
<span class='line'>1093</span>  * 	プロパティ
<span class='line'>1094</span>  * nas.Position.point	Object nas.Point  保持している座標の値
<span class='line'>1095</span>  * nas.Position.x	UnitValue   x座標値 this.point.x
<span class='line'>1096</span>  * nas.Position.y	UnitValue   y座標値 this.point.y
<span class='line'>1097</span>  * nas.Position.z	UnitValue   z座標値 this.point.z
<span class='line'>1098</span>  * nas.Position.c	arcCurve    初期値 undefined 
<span class='line'>1099</span>  * nas.Position.t	timingCurve 初期値 undefined
<span class='line'>1100</span>  * 
<span class='line'>1101</span>  * プロパティc,tは 各座標のプロパティとして付帯することも可能
<span class='line'>1102</span>  * 
<span class='line'>1103</span>  * nas.Position.toString([指定単位])  ;指定単位に揃えてリストで返す
<span class='line'>1104</span>  * nas.Position.valueOf([指定単位])   ;指定単位にそろえて配列を戻す
<span class='line'>1105</span>  * 単位指定がない場合は、登録された単位で返す
<span class='line'>1106</span>  * 
<span class='line'>1107</span>  * 引数なしの初期化を廃して、コードを整理したほうが良いかも？
<span class='line'>1108</span>  * 
<span class='line'>1109</span>  */</span><span class="WHIT">
<span class='line'>1110</span> </span><span class="NAME">nas.Position</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1111</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1112</span> </span><span class="WHIT">		</span><span class="NAME">arguments</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">(</span><span class="STRN">'0 pt'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">(</span><span class="STRN">'0 pt'</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1113</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1114</span> </span><span class="WHIT">	</span><span class="NAME">this.point</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Point</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1115</span> </span><span class="WHIT">    </span><span class="NAME">this.length</span><span class="PUNC">=</span><span class="NAME">this.point.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1116</span> </span><span class="WHIT">	</span><span class="NAME">this.props</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="STRN">'x'</span><span class="PUNC">,</span><span class="STRN">'y'</span><span class="PUNC">,</span><span class="STRN">'z'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1117</span> </span><span class="WHIT">	</span><span class="NAME">this.x</span><span class="PUNC">=</span><span class="NAME">this.point.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1118</span> </span><span class="WHIT">	</span><span class="NAME">this.y</span><span class="PUNC">=</span><span class="NAME">this.point.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1119</span> </span><span class="WHIT">	</span><span class="NAME">this.z</span><span class="PUNC">=</span><span class="NAME">this.point.z</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1120</span> </span><span class="COMM">/*
<span class='line'>1121</span> 	for(var myDim=0;myDim&lt;this.length;myDim++){
<span class='line'>1122</span> //		alert(myDim +":"+arguments[myDim]);
<span class='line'>1123</span> 	  if(arguments[myDim] instanceof nas.UnitValue){
<span class='line'>1124</span> 	  	alert(this.props[myDim]);
<span class='line'>1125</span> 	    this[this.props[myDim]]  = arguments[myDim];
<span class='line'>1126</span> 	  }else{
<span class='line'>1127</span> 	    this[this.props[myDim]]  =new nas.UnitValue(arguments[myDim]);
<span class='line'>1128</span> 	  }
<span class='line'>1129</span> 	}
<span class='line'>1130</span> */</span><span class="WHIT">
<span class='line'>1131</span> </span><span class="WHIT">	</span><span class="NAME">this.type</span><span class="PUNC">=</span><span class="NAME">this.x.type</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1132</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1133</span> </span><span class="COMM">/**
<span class='line'>1134</span> リスト戻し  カンマ区切り 123mm,234mm
<span class='line'>1135</span> 値単独指定
<span class='line'>1136</span> 全プロパティ
<span class='line'>1137</span>     x=123mm
<span class='line'>1138</span>     y=234mm
<span class='line'>1139</span>     
<span class='line'>1140</span> */</span><span class="WHIT">
<span class='line'>1141</span> </span><span class="NAME">nas.Position.prototype.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1142</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">unit</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1143</span> </span><span class="WHIT">    </span><span class="NAME">this.point.toString</span><span class="PUNC">(</span><span class="NAME">unit</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1144</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1145</span> </span><span class="NAME">nas.Position.prototype.listString</span><span class="PUNC">=</span><span class="NAME">nas._LISTString</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1146</span> </span><span class="NAME">nas.Position.prototype.valueOf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="NAME">nas._ARRAYValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1147</span> 
<span class='line'>1148</span> </span><span class="COMM">//nas.Position objectはPointオブジェクトに換装</span><span class="WHIT">
<span class='line'>1149</span> 
<span class='line'>1150</span> </span><span class="COMM">/*
<span class='line'>1151</span> 	 オフセットオブジェクト
<span class='line'>1152</span> オフセットを利用するための複合オブジェクト
<span class='line'>1153</span> positionとorientationを組み合わせたもの
<span class='line'>1154</span> 初期化の引数は位置オブジェクトと方向オブジェクトで
<span class='line'>1155</span> 
<span class='line'>1156</span> 引数なしの場合は  0,0,0d で初期化
<span class='line'>1157</span> */</span><span class="WHIT">
<span class='line'>1158</span> </span><span class="NAME">nas.Offset</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myPos</span><span class="PUNC">,</span><span class="NAME">myOrt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1159</span> </span><span class="WHIT">	</span><span class="NAME">this.position</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">myPos</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.Point</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">myPos</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Point</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1160</span> </span><span class="WHIT">	</span><span class="NAME">this.orientation</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">myOrt</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.Orientation</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">myOrt</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Orientation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1161</span> </span><span class="WHIT">	</span><span class="NAME">this.x</span><span class="PUNC">=</span><span class="NAME">this.position.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1162</span> </span><span class="WHIT">	</span><span class="NAME">this.y</span><span class="PUNC">=</span><span class="NAME">this.position.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1163</span> </span><span class="WHIT">	</span><span class="NAME">this.r</span><span class="PUNC">=</span><span class="NAME">this.orientation.z</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1164</span> 
<span class='line'>1165</span> </span><span class="WHIT">	</span><span class="NAME">this.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">opt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1166</span> </span><span class="WHIT">    		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1167</span> </span><span class="WHIT">	    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">opt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1168</span> </span><span class="WHIT">                </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="NAME">this.position.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1169</span> </span><span class="WHIT">                </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="NAME">this.orientation.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1170</span> </span><span class="WHIT">		    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult.join</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1171</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1172</span> </span><span class="WHIT">		        </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="STRN">"\toffset.x = "</span><span class="PUNC">+</span><span class="NAME">this.position.x.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1173</span> </span><span class="WHIT">		        </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="STRN">"\toffset.x = "</span><span class="PUNC">+</span><span class="NAME">this.position.x.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1174</span> </span><span class="WHIT">		        </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="STRN">"\toffset.r = "</span><span class="PUNC">+</span><span class="NAME">this.orientation.z.toString</span><span class="PUNC">(</span><span class="STRN">"degrees"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1175</span> </span><span class="WHIT">		    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult.join</span><span class="PUNC">(</span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1176</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1177</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1178</span> </span><span class="WHIT">	</span><span class="NAME">this.valueOf</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">asUnit</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1179</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">asUnit</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">asUnit</span><span class="PUNC">=</span><span class="NAME">this.type</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1180</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1181</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myDim</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">myDim</span><span class="PUNC">&lt;</span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="NAME">myDim</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">this.props</span><span class="PUNC">[</span><span class="NAME">myDim</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">as</span><span class="PUNC">(</span><span class="NAME">asUnit</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1182</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1183</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1184</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1185</span> </span><span class="COMM">/*test
<span class='line'>1186</span> A= new nas.Offset();
<span class='line'>1187</span> B= new nas.Offset(new nas.Point("12mm","10mm"),new nas.Orientation("0d"));
<span class='line'>1188</span> 
<span class='line'>1189</span> */</span><span class="WHIT">
<span class='line'>1190</span> </span><span class="COMM">/*
<span class='line'>1191</span> 	ベクトルオブジェクト
<span class='line'>1192</span> コンストラクタ:
<span class='line'>1193</span> 	new nas.Vector(終点[,始点][,単位])
<span class='line'>1194</span> 1次元、2次元、3次元の値が初期化可能
<span class='line'>1195</span> 引数
<span class='line'>1196</span> 	終点・始点  /nas.Point
<span class='line'>1197</span> 	単位文字列
<span class='line'>1198</span> 
<span class='line'>1199</span> 引数の次元のうち次数の高い方に合わせたVectorを初期化する
<span class='line'>1200</span> Vector.dimension  で次数が取得できる
<span class='line'>1201</span> 単位文字列が指定されなかった場合は、第一引数の単位を使用する
<span class='line'>1202</span> 
<span class='line'>1203</span> プロパティは  nas.Point
<span class='line'>1204</span> 与えられない次数のプロパティは0として扱う
<span class='line'>1205</span> 
<span class='line'>1206</span> 引数なしの場合はデフォルトの単位値で原点を始点とする２次元の単位ベクトルを戻す
<span class='line'>1207</span> 
<span class='line'>1208</span> 	プロパティ
<span class='line'>1209</span> 
<span class='line'>1210</span> nas.Vector.dimension	Int  整数  保持している値の次数1～3
<span class='line'>1211</span> nas.Vector.origin	Point 始点座標
<span class='line'>1212</span> nas.Vector.value	Point ベクトル値(=終点座標-始点座標)
<span class='line'>1213</span> nas.Vector.type	String  単位文字列
<span class='line'>1214</span> 
<span class='line'>1215</span> 始点を省略した場合は、原点を始点に置く
<span class='line'>1216</span> オブジェクトメソッド:
<span class='line'>1217</span> nas.Vector.toString([指定単位])	;指定単位に揃えて数値をコンマ区切りリストで返す
<span class='line'>1218</span> nas.Vector.valueOf([指定単位])	;指定単位にそろえて数値配列を戻す
<span class='line'>1219</span> 
<span class='line'>1220</span> */</span><span class="WHIT">
<span class='line'>1221</span> </span><span class="NAME">nas.Vector</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">endPoint</span><span class="PUNC">,</span><span class="NAME">startPoint</span><span class="PUNC">,</span><span class="NAME">myUnit</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1222</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1223</span> </span><span class="WHIT">		</span><span class="NAME">this.dimension</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1224</span> </span><span class="WHIT">		</span><span class="NAME">this.origin</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Point</span><span class="PUNC">(</span><span class="STRN">'0 pt'</span><span class="PUNC">,</span><span class="STRN">'0 pt'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1225</span> </span><span class="WHIT">		</span><span class="NAME">this.value</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Point</span><span class="PUNC">(</span><span class="STRN">'1 pt'</span><span class="PUNC">,</span><span class="STRN">'1 pt'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1226</span> </span><span class="WHIT">		</span><span class="NAME">this.type</span><span class="PUNC">=</span><span class="STRN">"pt"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1227</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1228</span> </span><span class="WHIT">		</span><span class="NAME">this.type</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">></span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">myUnit</span><span class="PUNC">:</span><span class="NAME">endPoint.type</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1229</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1230</span> </span><span class="WHIT">			</span><span class="NAME">this.dimension</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">startPoint.dimension</span><span class="PUNC">></span><span class="NAME">endPoint.dimension</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">startPoint.dimension</span><span class="PUNC">:</span><span class="NAME">endPoint.dimension</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1231</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1232</span> </span><span class="WHIT">			</span><span class="NAME">this.dimension</span><span class="PUNC">=</span><span class="NAME">endPoint.dimension</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1233</span> </span><span class="WHIT">			</span><span class="NAME">startPoint</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Point</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">slice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">this.dimension</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1234</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1235</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.dimension</span><span class="PUNC">></span><span class="NAME">startPoint.dimension</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1236</span> </span><span class="WHIT">			</span><span class="NAME">this.origin</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Point</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">startPoint.toString</span><span class="PUNC">(</span><span class="NAME">this.type</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">',0,0'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">slice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">this.dimension</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1237</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1238</span> </span><span class="WHIT">			</span><span class="NAME">this.origin</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Point</span><span class="PUNC">(</span><span class="NAME">startPoint.valueOf</span><span class="PUNC">(</span><span class="NAME">this.type</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1239</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1240</span> </span><span class="WHIT">		</span><span class="NAME">this.value</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Point</span><span class="PUNC">(</span><span class="NAME">nas.sub</span><span class="PUNC">(</span><span class="NAME">endPoint.valueOf</span><span class="PUNC">(</span><span class="NAME">this.type</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.origin.valueOf</span><span class="PUNC">(</span><span class="NAME">this.type</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1241</span> 
<span class='line'>1242</span> </span><span class="WHIT">		</span><span class="NAME">this.props</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="STRN">'origin'</span><span class="PUNC">,</span><span class="STRN">'value'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1243</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1244</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1245</span> </span><span class="NAME">nas.Vector.prototype.toString</span><span class="PUNC">=</span><span class="NAME">nas._LISTString</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1246</span> </span><span class="NAME">nas.Vector.prototype.valueOf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="NAME">nas._ARRAYValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1247</span> </span><span class="COMM">/**
<span class='line'>1248</span> 	回転オブジェクト
<span class='line'>1249</span> 	次元数を保存する
<span class='line'>1250</span> 	引数が正負の数値のみ、またはbool値で指定された場合は、一次元(true,false,-1,1,0  等  0は負方向)
<span class='line'>1251</span> 	引数がなし、または  一つの角度文字列またはUnitAngleで初期化された場合は、二次元でｚ軸指定  （"10d"等）
<span class='line'>1252</span> 	それ以外の場合は三次元（3軸指定）となる
<span class='line'>1253</span> 	三次元回転の解決順は z-y-x
<span class='line'>1254</span> コンストラクタ
<span class='line'>1255</span> 	new nas.Rotation(bool)
<span class='line'>1256</span> 	new nas.Rotation([x,y,] z)
<span class='line'>1257</span> 引数は、bool,UnitAngleまたは文字列
<span class='line'>1258</span> 
<span class='line'>1259</span> */</span><span class="WHIT">
<span class='line'>1260</span> </span><span class="NAME">nas.Rotation</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1261</span> </span><span class="WHIT">    </span><span class="NAME">this.name</span><span class="PUNC">=</span><span class="STRN">'rotation'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1262</span> </span><span class="WHIT">    </span><span class="NAME">this.props</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="STRN">"w"</span><span class="PUNC">,</span><span class="STRN">"x"</span><span class="PUNC">,</span><span class="STRN">"y"</span><span class="PUNC">,</span><span class="STRN">"z"</span><span class="PUNC">,</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1263</span> </span><span class="WHIT">	</span><span class="NAME">this.dimension</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1264</span> </span><span class="WHIT">	</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1265</span> </span><span class="WHIT">    </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">isFinite</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">	 </span><span class="WHIT">
<span class='line'>1266</span> </span><span class="WHIT">    </span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">this.dimension</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1267</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1268</span> </span><span class="WHIT">        </span><span class="NAME">this.w</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1269</span> </span><span class="WHIT">    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1270</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1271</span> </span><span class="WHIT">	    </span><span class="NAME">this.z</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1272</span> </span><span class="WHIT">	    </span><span class="NAME">this.y</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">(</span><span class="STRN">'0 degrees'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1273</span> </span><span class="WHIT">	    </span><span class="NAME">this.x</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">(</span><span class="STRN">'0 degrees'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1274</span> </span><span class="WHIT">	</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1275</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1276</span> </span><span class="WHIT">	    </span><span class="NAME">this.x</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1277</span> </span><span class="WHIT">	    </span><span class="NAME">this.y</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1278</span> </span><span class="WHIT">	    </span><span class="NAME">this.z</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1279</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1280</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1281</span> </span><span class="NAME">nas.Rotation.prototype.toString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">exportForm</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1282</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">exportForm</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.listString</span><span class="PUNC">(</span><span class="STRN">'degrees'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1283</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1284</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myUnit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'degrees'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1285</span> </span><span class="WHIT">    </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.dimension</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1286</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1287</span> </span><span class="WHIT">        </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="STRN">"\t"</span><span class="PUNC">+</span><span class="NAME">this.name</span><span class="PUNC">+</span><span class="STRN">".w = "</span><span class="PUNC">+</span><span class="NAME">this.w</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1288</span> </span><span class="WHIT">    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1289</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1290</span> </span><span class="WHIT">        </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="STRN">"\t"</span><span class="PUNC">+</span><span class="NAME">this.name</span><span class="PUNC">+</span><span class="STRN">" = "</span><span class="PUNC">+</span><span class="NAME">this.z.as</span><span class="PUNC">(</span><span class="NAME">myUnit</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1291</span> </span><span class="WHIT">    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1292</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1293</span> </span><span class="WHIT">    </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1294</span> </span><span class="WHIT">        </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="STRN">"\t"</span><span class="PUNC">+</span><span class="NAME">this.name</span><span class="PUNC">+</span><span class="STRN">".x = "</span><span class="PUNC">+</span><span class="NAME">this.x.as</span><span class="PUNC">(</span><span class="NAME">myUnit</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1295</span> </span><span class="WHIT">        </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="STRN">"\t"</span><span class="PUNC">+</span><span class="NAME">this.name</span><span class="PUNC">+</span><span class="STRN">".y = "</span><span class="PUNC">+</span><span class="NAME">this.y.as</span><span class="PUNC">(</span><span class="NAME">myUnit</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1296</span> </span><span class="WHIT">        </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="STRN">"\t"</span><span class="PUNC">+</span><span class="NAME">this.name</span><span class="PUNC">+</span><span class="STRN">".z = "</span><span class="PUNC">+</span><span class="NAME">this.z.as</span><span class="PUNC">(</span><span class="NAME">myUnit</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1297</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1298</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult.join</span><span class="PUNC">(</span><span class="STRN">'\n'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//リスト文字列で</span><span class="WHIT">
<span class='line'>1299</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1300</span> </span><span class="NAME">nas.Rotation.prototype.listString</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myUnit</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1301</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">myUnit</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"unidefined"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">myUnit</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1302</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1303</span> </span><span class="WHIT">    </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.dimension</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1304</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1305</span> </span><span class="WHIT">        </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1306</span> </span><span class="WHIT">    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1307</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1308</span> </span><span class="WHIT">        </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="NAME">this.z.as</span><span class="PUNC">(</span><span class="NAME">myUnit</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1309</span> </span><span class="WHIT">    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1310</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1311</span> </span><span class="WHIT">    </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1312</span> </span><span class="WHIT">        </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="NAME">this.x.as</span><span class="PUNC">(</span><span class="NAME">myUnit</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1313</span> </span><span class="WHIT">        </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="NAME">this.y.as</span><span class="PUNC">(</span><span class="NAME">myUnit</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1314</span> </span><span class="WHIT">        </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="NAME">this.z.as</span><span class="PUNC">(</span><span class="NAME">myUnit</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1315</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1316</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult.join</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//リスト文字列で</span><span class="WHIT">
<span class='line'>1317</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1318</span> </span><span class="NAME">nas.Rotation.prototype.valueOf</span><span class="WHIT">      </span><span class="PUNC">=</span><span class="NAME">nas._ARRAYValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1319</span> 
<span class='line'>1320</span> </span><span class="COMM">/*
<span class='line'>1321</span> 	方向オブジェクト
<span class='line'>1322</span> 	次元数を保存する
<span class='line'>1323</span> 	引数が正負の数値のみで指定された場合は、一次元
<span class='line'>1324</span> 	引数がなし、または  一つの角度文字列またはUnitAngleで初期化された場合は、二次元でｚ軸指定
<span class='line'>1325</span> 	それ以外の場合は三次元（3軸指定）となる
<span class='line'>1326</span> 	三次元回転の解決順は z-y-x
<span class='line'>1327</span> コンストラクタ
<span class='line'>1328</span> 	new nas.Orientation(bool)
<span class='line'>1329</span> 	new nas.Orientation([x,y,] z)
<span class='line'>1330</span> 引数は、bool,UnitAngleまたは文字列
<span class='line'>1331</span> 
<span class='line'>1332</span> */</span><span class="WHIT">
<span class='line'>1333</span> </span><span class="NAME">nas.Orientation</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1334</span> </span><span class="WHIT">    </span><span class="NAME">this.name</span><span class="PUNC">=</span><span class="STRN">'orientation'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1335</span> </span><span class="WHIT">    </span><span class="NAME">this.props</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="STRN">"w"</span><span class="PUNC">,</span><span class="STRN">"x"</span><span class="PUNC">,</span><span class="STRN">"y"</span><span class="PUNC">,</span><span class="STRN">"z"</span><span class="PUNC">,</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1336</span> </span><span class="WHIT">	</span><span class="NAME">this.dimension</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1337</span> </span><span class="WHIT">	</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1338</span> </span><span class="WHIT">    </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">isFinite</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">	 </span><span class="WHIT">
<span class='line'>1339</span> </span><span class="WHIT">    </span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">this.dimension</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1340</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1341</span> </span><span class="WHIT">        </span><span class="NAME">this.w</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1342</span> </span><span class="WHIT">    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1343</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1344</span> </span><span class="WHIT">	    </span><span class="NAME">this.z</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1345</span> </span><span class="WHIT">	    </span><span class="NAME">this.y</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">(</span><span class="STRN">'0 degrees'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1346</span> </span><span class="WHIT">	    </span><span class="NAME">this.x</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">(</span><span class="STRN">'0 degrees'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1347</span> </span><span class="WHIT">	</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1348</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1349</span> </span><span class="WHIT">	    </span><span class="NAME">this.x</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1350</span> </span><span class="WHIT">	    </span><span class="NAME">this.y</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1351</span> </span><span class="WHIT">	    </span><span class="NAME">this.z</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1352</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1353</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1354</span> </span><span class="NAME">nas.Orientation.prototype</span><span class="PUNC">=</span><span class="NAME">nas.Rotation.prototype</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1355</span> </span><span class="COMM">/*
<span class='line'>1356</span> nas.Orientation=function(){
<span class='line'>1357</span> 	this.props=["w","x","y","z",];
<span class='line'>1358</span> 	this.dimension=(arguments.length == 0)? 2 : 
<span class='line'>1359</span> 	(arguments.length > 1)? 3 :
<span class='line'>1360</span>     ((! arguments[0] instanceof nas.UnitAngle)||isFinite(arguments[0]))? 1 : 2 ;	 
<span class='line'>1361</span>     switch(this.dimension){
<span class='line'>1362</span>     case 1:
<span class='line'>1363</span>         this.w = (arguments[0]);
<span class='line'>1364</span>     break;
<span class='line'>1365</span>     case 2:
<span class='line'>1366</span> 	    this.z=(arguments[0] instanceof nas.UnitAngle)? arguments[0]:new nas.UnitAngle(arguments[0]);
<span class='line'>1367</span> 	    this.y=new nas.UnitAngle('0 degrees');
<span class='line'>1368</span> 	    this.x=new nas.UnitAngle('0 degrees');
<span class='line'>1369</span> 	break;
<span class='line'>1370</span>     case 3:
<span class='line'>1371</span> 	    this.x=(arguments[0] instanceof nas.UnitAngle)? arguments[0]:new nas.UnitAngle(arguments[0]);
<span class='line'>1372</span> 	    this.y=(arguments[1] instanceof nas.UnitAngle)? arguments[1]:new nas.UnitAngle(arguments[1]);
<span class='line'>1373</span> 	    this.z=(arguments[2] instanceof nas.UnitAngle)? arguments[2]:new nas.UnitAngle(arguments[2]);
<span class='line'>1374</span>     }
<span class='line'>1375</span> }
<span class='line'>1376</span> nas.Orientation.prototype.toString = function(exportForm){
<span class='line'>1377</span>     if(!exportForm) return this.listString('degrees' );    
<span class='line'>1378</span>     var myResult=[];
<span class='line'>1379</span>     if(this.length==1){myResult.push(this.z.toString())}
<span class='line'>1380</span> }
<span class='line'>1381</span> 
<span class='line'>1382</span> nas.Orientation.prototype.listString=nas._LISTString;
<span class='line'>1383</span> nas.Orientation.prototype.valueOf =nas._ARRAYValue;
<span class='line'>1384</span> */</span><span class="WHIT">
<span class='line'>1385</span> </span><span class="COMM">/** レートオブジェクト　倍数比率を単位付きまたは単位係数無しで保持するオブジェクト
<span class='line'>1386</span> .value  倍数
<span class='line'>1387</span> .rate   係数
<span class='line'>1388</span> 
<span class='line'>1389</span> */</span><span class="WHIT">
<span class='line'>1390</span> </span><span class="NAME">nas.Rate</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myRate</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1391</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">myRate</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myRate</span><span class="PUNC">=</span><span class="STRN">"100%"</span><span class="WHIT">
<span class='line'>1392</span> </span><span class="WHIT">    </span><span class="NAME">this.value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1393</span> </span><span class="WHIT">    </span><span class="NAME">this.rate</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1394</span> </span><span class="WHIT">    </span><span class="NAME">this.parseRate</span><span class="PUNC">(</span><span class="NAME">myRate</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1395</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1396</span> 
<span class='line'>1397</span> </span><span class="NAME">nas.Rate.prototype.parseRate</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">rateString</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1398</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myRate</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1399</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myRateUnit</span><span class="PUNC">=</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">rateString</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/[\+\-\d\.]/g</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1400</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myValue</span><span class="PUNC">=</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">rateString</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1401</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">myValue</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myValue</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1402</span> </span><span class="WHIT">    </span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">myRateUnit</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1403</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT">  </span><span class="STRN">"%"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1404</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"％"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1405</span> </span><span class="WHIT">        </span><span class="NAME">myRate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1406</span> </span><span class="WHIT">    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1407</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"‰"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1408</span> </span><span class="WHIT">        </span><span class="NAME">myRate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1000</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1409</span> </span><span class="WHIT">    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1410</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1411</span> </span><span class="WHIT">    </span><span class="NAME">this.value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myValue</span><span class="PUNC">/</span><span class="NAME">myRate</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1412</span> </span><span class="WHIT">    </span><span class="NAME">this.rate</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myRate</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1413</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1414</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1415</span> </span><span class="NAME">nas.Rate.prototype.valueOf</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.value</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1416</span> </span><span class="NAME">nas.Rate.prototype.as</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">rate</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1417</span> </span><span class="WHIT">    </span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">rate</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1418</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT">  </span><span class="STRN">"%"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1419</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"％"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1420</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"percent"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1421</span> </span><span class="WHIT">        </span><span class="NAME">myRate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1422</span> </span><span class="WHIT">    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1423</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"‰"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1424</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"permill"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1425</span> </span><span class="WHIT">        </span><span class="NAME">myRate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1000</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1426</span> </span><span class="WHIT">    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1427</span> </span><span class="WHIT">    </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1428</span> </span><span class="WHIT">        </span><span class="NAME">myRate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT">
<span class='line'>1429</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1430</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">myRate</span><span class="PUNC">*</span><span class="NAME">this.value</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1431</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1432</span> </span><span class="NAME">nas.Rate.prototype.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1433</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">this.value</span><span class="PUNC">*</span><span class="NAME">this.rate</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">[</span><span class="STRN">""</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"%"</span><span class="PUNC">,</span><span class="STRN">"‰"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">Math.log10</span><span class="PUNC">(</span><span class="NAME">this.rate</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1434</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1435</span> </span><span class="COMM">/*  TEST
<span class='line'>1436</span> A = nas nas.Rate("1");
<span class='line'>1437</span> B = nas nas.Rate("96%");
<span class='line'>1438</span> C = nas nas.Rate("1234‰");
<span class='line'>1439</span> D = nas nas.Rate("1％");
<span class='line'>1440</span> D = nas nas.Rate("1％");
<span class='line'>1441</span> */</span><span class="WHIT">
<span class='line'>1442</span> </span><span class="COMM">/*	フレームレートオブジェクト
<span class='line'>1443</span> コンストラクタ
<span class='line'>1444</span> 	nas.newFramerate(rateString[,rate])?
<span class='line'>1445</span> 引数:
<span class='line'>1446</span> 	rateString String フレームレート文字列
<span class='line'>1447</span> 	rate Number 省略可能  実フレームレート
<span class='line'>1448</span> 	フレームレート文字列は任意
<span class='line'>1449</span> 	引数が  24FPS 25fps等の  /\dFPS/i の場合はその数値を利用
<span class='line'>1450</span> 	第一引数が  SMPTE,NTSC,DF を含む場合は、第二引数にかかわらず 30/1.001 で初期化する
<span class='line'>1451</span> 	その際引数に数値  60または59.94が含まれる場合 60/1.001 に更新する
<span class='line'>1452</span> 	その場合ドロップフレーム処理が行われる
<span class='line'>1453</span> 	
<span class='line'>1454</span> 	第一引数が  PAL,SECAM  を含む場合は、第二引数にかかわらず 25  で初期化を行う
<span class='line'>1455</span> 	その際引数に数値  50 が含まれる場合 50 に更新する
<span class='line'>1456</span> 
<span class='line'>1457</span>     第一引数が rateString(rate)  形式の場合は  括弧の中身を実フレームレートとして処理する
<span class='line'>1458</span> 
<span class='line'>1459</span> 	実時間とTCのズレが蓄積して広がるNDFはサポートしない。	
<span class='line'>1460</span> 	
<span class='line'>1461</span> 	フレームレート文字列に数値が含まれているかまたはキーワードの場合は、第二引数を省略可能（無視する）
<span class='line'>1462</span> 	不正な引数で初期化された場合は、クラスプロパティを使用する
<span class='line'>1463</span> 
<span class='line'>1464</span> 初期化メソッドは、以下の動作に変更
<span class='line'>1465</span> 	単一引数の場合
<span class='line'>1466</span> 引数文字列を数値パースしてフレームレートを取得して、文字列自体をnameに設定
<span class='line'>1467</span> 
<span class='line'>1468</span> 二つ以上の場合は、第一引数がname,第二引数がフレームレート
<span class='line'>1469</span> 第一引数が数値のみの場合は"FPS”を補うが、それ以外の場合は文字列全体をnameとする
<span class='line'>1470</span> 	
<span class='line'>1471</span> 名称とフレームレートに不整合があっても許容する
<span class='line'>1472</span> 名称にフレームレートの数値が含まれない場合は名称に"(数値)"を補って出力する
<span class='line'>1473</span> */</span><span class="WHIT">
<span class='line'>1474</span> </span><span class="COMM">//nas.Framerate={name:"24FPS",rate:24,opt:null};</span><span class="WHIT">
<span class='line'>1475</span> 
<span class='line'>1476</span> </span><span class="NAME">nas.Framerate</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">initString</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1477</span> </span><span class="WHIT">	</span><span class="NAME">this.name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"24FPS"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1478</span> </span><span class="WHIT">	</span><span class="NAME">this.rate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">24</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1479</span> </span><span class="WHIT">    </span><span class="NAME">this.opt</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1480</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">initString</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.parse</span><span class="PUNC">(</span><span class="NAME">initString</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1481</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1482</span> 
<span class='line'>1483</span> </span><span class="NAME">nas.Framerate.prototype.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this.name</span><span class="PUNC">:</span><span class="NAME">this.name</span><span class="PUNC">+</span><span class="STRN">"("</span><span class="PUNC">+</span><span class="NAME">this.rate</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1484</span> </span><span class="NAME">nas.Framerate.prototype.valueOf</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.rate</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1485</span> 
<span class='line'>1486</span> </span><span class="COMM">/**
<span class='line'>1487</span>     フレームレートオブジェクト初期化メソッド
<span class='line'>1488</span>     空引数で呼ばれた場合はデフォルト値のフレームレートを返す
<span class='line'>1489</span> */</span><span class="WHIT">
<span class='line'>1490</span> </span><span class="NAME">nas.Framerate.prototype.parse</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">rateString</span><span class="PUNC">,</span><span class="NAME">rate</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1491</span> 
<span class='line'>1492</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1493</span> </span><span class="WHIT">	  </span><span class="COMM">//第一引数がカッコつきでフレームレート指定された文字列ならば第二引数は無効(捨てる)</span><span class="WHIT">
<span class='line'>1494</span> </span><span class="WHIT">	  </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">rateString</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/(.*)\(([0-9]+(\.[0-9]*)?)\)/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1495</span> </span><span class="WHIT">	    </span><span class="NAME">this.name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1496</span> </span><span class="WHIT">	    </span><span class="NAME">this.rate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">RegExp.$2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1497</span> </span><span class="WHIT">	  </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1498</span> </span><span class="WHIT">	</span><span class="COMM">//引数が2つ設定されている</span><span class="WHIT">
<span class='line'>1499</span> </span><span class="WHIT">	    </span><span class="NAME">this.name</span><span class="PUNC">=</span><span class="NAME">rateString</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1500</span> </span><span class="WHIT">	    </span><span class="NAME">this.rate</span><span class="PUNC">=</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">rate</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1501</span> </span><span class="WHIT">	  </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">rateString</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1502</span> </span><span class="WHIT">	</span><span class="COMM">//引数が一つのみ</span><span class="WHIT">
<span class='line'>1503</span> </span><span class="WHIT">	    </span><span class="NAME">this.name</span><span class="PUNC">=</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">rateString</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1504</span> </span><span class="WHIT">	    </span><span class="NAME">this.rate</span><span class="PUNC">=</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">rateString</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/^[^-\d]+/</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//文字列先頭の数値以外のデータを捨てて数値化</span><span class="WHIT">
<span class='line'>1505</span> </span><span class="WHIT">	  </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1506</span> </span><span class="WHIT">	    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1507</span> </span><span class="WHIT">	  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1508</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1509</span> </span><span class="WHIT">	</span><span class="COMM">//引数がない場合は、デフォルト値を返す</span><span class="WHIT">
<span class='line'>1510</span> </span><span class="WHIT">	    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1511</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1512</span> </span><span class="WHIT">	</span><span class="COMM">//名前に特定の強制キーワードを含む</span><span class="WHIT">
<span class='line'>1513</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.name.match</span><span class="PUNC">(</span><span class="REGX">/PAL|SECAM/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1514</span> </span><span class="WHIT">	    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">this.rate</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.rate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">25</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1515</span> </span><span class="WHIT">	    </span><span class="NAME">this.rate</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.rate</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">37.5</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">25.0</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">50.0</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1516</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.name.match</span><span class="PUNC">(</span><span class="REGX">/SMPTE|NTSC|[^N]DF/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1517</span> </span><span class="WHIT">        </span><span class="NAME">this.opt</span><span class="PUNC">=</span><span class="STRN">'smpte'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1518</span> </span><span class="WHIT">	    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">isFinite</span><span class="PUNC">(</span><span class="NAME">this.rate</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.rate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">30</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1519</span> </span><span class="WHIT">	    </span><span class="NAME">this.rate</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.rate</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">45</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">59.94</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">29.97</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1520</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1521</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">isFinite</span><span class="PUNC">(</span><span class="NAME">this.rate</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1522</span> </span><span class="COMM">//  console.log (this.rate);</span><span class="WHIT">
<span class='line'>1523</span> </span><span class="WHIT">	    </span><span class="NAME">this.name</span><span class="PUNC">=</span><span class="NAME">nas.FRATE.name</span><span class="PUNC">;</span><span class="NAME">this.rate</span><span class="PUNC">=</span><span class="NAME">nas.FRATE.rate</span><span class="PUNC">;</span><span class="NAME">this.opt</span><span class="PUNC">=</span><span class="NAME">nas.FRATE.opt</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1524</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1525</span> </span><span class="COMM">//最終的に名前がなくなった場合はフレームレート＋"fps"を文字列としてもたせる</span><span class="WHIT">
<span class='line'>1526</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">this.name</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">this.name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.rate</span><span class="PUNC">+</span><span class="STRN">'fps'</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1527</span> 
<span class='line'>1528</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1529</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1530</span> </span><span class="COMM">/**
<span class='line'>1531</span>     同値判定メソッド
<span class='line'>1532</span>     フレームレートと、ドロップの有無を比較して同じフレームレートか否かを返す
<span class='line'>1533</span> */</span><span class="WHIT">
<span class='line'>1534</span> </span><span class="NAME">nas.Framerate.prototype.sameAs</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">compareTarget</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1535</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">compareTarget</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.Framerate</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1536</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.rate</span><span class="PUNC">==</span><span class="NAME">compareTarget.rate</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">this.opt</span><span class="PUNC">==</span><span class="NAME">compareTarget.opt</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1537</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1538</span> </span><span class="COMM">/**
<span class='line'>1539</span>     新規フレームレート作成メソッド
<span class='line'>1540</span>     空引数で呼ばれた場合はデフォルト値のフレームレートを返す
<span class='line'>1541</span> */</span><span class="WHIT">
<span class='line'>1542</span> </span><span class="NAME">nas.newFramerate</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">rateString</span><span class="PUNC">,</span><span class="NAME">rate</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1543</span> </span><span class="COMM">//	var newOne=Object.create(nas.Framerate);</span><span class="WHIT">
<span class='line'>1544</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newOne</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Framerate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1545</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1546</span> </span><span class="WHIT">	  </span><span class="COMM">//第一引数がカッコつきでフレームレート指定された文字列ならば第二引数は無効(捨てる)</span><span class="WHIT">
<span class='line'>1547</span> </span><span class="WHIT">	  </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">rateString</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/(.*)\(([0-9]+(\.[0-9]*)?)\)/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1548</span> </span><span class="WHIT">	    </span><span class="NAME">newOne.name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1549</span> </span><span class="WHIT">	    </span><span class="NAME">newOne.rate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">RegExp.$2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1550</span> </span><span class="WHIT">	  </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1551</span> </span><span class="WHIT">	</span><span class="COMM">//引数が2つ設定されている</span><span class="WHIT">
<span class='line'>1552</span> </span><span class="WHIT">	    </span><span class="NAME">newOne.name</span><span class="PUNC">=</span><span class="NAME">rateString</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1553</span> </span><span class="WHIT">	    </span><span class="NAME">newOne.rate</span><span class="PUNC">=</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">rate</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1554</span> </span><span class="WHIT">	  </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">rateString</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1555</span> </span><span class="WHIT">	</span><span class="COMM">//引数が一つのみ</span><span class="WHIT">
<span class='line'>1556</span> </span><span class="WHIT">	    </span><span class="NAME">newOne.name</span><span class="PUNC">=</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">rateString</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1557</span> </span><span class="WHIT">	    </span><span class="NAME">newOne.rate</span><span class="PUNC">=</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">rateString</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/^[^-\d]+/</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//文字列先頭の数値以外のデータを捨てて数値化</span><span class="WHIT">
<span class='line'>1558</span> </span><span class="WHIT">	  </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1559</span> </span><span class="WHIT">	    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">newOne</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1560</span> </span><span class="WHIT">	  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1561</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1562</span> </span><span class="WHIT">	</span><span class="COMM">//引数がない場合は、デフォルト値を返す</span><span class="WHIT">
<span class='line'>1563</span> </span><span class="WHIT">	    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">newOne</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1564</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1565</span> </span><span class="WHIT">	</span><span class="COMM">//名前に特定の強制キーワードを含む</span><span class="WHIT">
<span class='line'>1566</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">newOne.name.match</span><span class="PUNC">(</span><span class="REGX">/PAL|SECAM/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1567</span> </span><span class="WHIT">	    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">newOne.rate</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">newOne.rate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">25</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1568</span> </span><span class="WHIT">	    </span><span class="NAME">newOne.rate</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">newOne.rate</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">37.5</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">25.0</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">50.0</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1569</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">newOne.name.match</span><span class="PUNC">(</span><span class="REGX">/SMPTE|NTSC|[^N]DF/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1570</span> </span><span class="WHIT">        </span><span class="NAME">newOne.opt</span><span class="PUNC">=</span><span class="STRN">'smpte'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1571</span> </span><span class="WHIT">	    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">newOne.rate</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">newOne.rate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">30</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1572</span> </span><span class="WHIT">	    </span><span class="NAME">newOne.rate</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">newOne.rate</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">45</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">59.94</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">29.97</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1573</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1574</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">newOne.rate</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1575</span> </span><span class="COMM">//  console.log (newOne.rate);</span><span class="WHIT">
<span class='line'>1576</span> </span><span class="WHIT">	    </span><span class="NAME">newOne.name</span><span class="PUNC">=</span><span class="NAME">nas.FRATE.name</span><span class="PUNC">;</span><span class="NAME">newOne.rate</span><span class="PUNC">=</span><span class="NAME">nas.FRATE.rate</span><span class="PUNC">;</span><span class="NAME">newOne.opt</span><span class="PUNC">=</span><span class="NAME">nas.FRATE.opt</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1577</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1578</span> </span><span class="COMM">//最終的に名前がなくなった場合はフレームレート＋"fps"を文字列としてもたせる</span><span class="WHIT">
<span class='line'>1579</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">newOne.name</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">newOne.name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newOne.rate</span><span class="PUNC">+</span><span class="STRN">'fps'</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1580</span> 
<span class='line'>1581</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">newOne</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1582</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1583</span> </span><span class="COMM">/*TEST
<span class='line'>1584</span> nas.newFramerate("smpte60(59.4)").toString();
<span class='line'>1585</span> nas.newFramerate("PAL(50)").toString(true);
<span class='line'>1586</span> nas.newFramerate("SECAM",48);
<span class='line'>1587</span> nas.newFramerate("NDF30");
<span class='line'>1588</span> nas.newFramerate("FILM",24);
<span class='line'>1589</span> nas.newFramerate("IMAX",48);
<span class='line'>1590</span> 
<span class='line'>1591</span> var myRate=nas.newFramerate("SMPTE",60);
<span class='line'>1592</span> myRate*2;
<span class='line'>1593</span> 
<span class='line'>1594</span> */</span><span class="WHIT">
<span class='line'>1595</span> </span><span class="COMM">/**
<span class='line'>1596</span> 	サイズオブジェクト
<span class='line'>1597</span> コンストラクタ
<span class='line'>1598</span> 	new nas.Size(width,height[,depth])
<span class='line'>1599</span> 引数は
<span class='line'>1600</span> 	UnitValue	/	width,height,depth
<span class='line'>1601</span> 
<span class='line'>1602</span> 
<span class='line'>1603</span> 	TimingCurve	/	timing	
<span class='line'>1604</span> 引数がない場合は単位"pt"でサイズ 72x72  二次元のオブジェクトを初期化
<span class='line'>1605</span> 
<span class='line'>1606</span> コンストラクタでタイミングカーブを初期化する必要は無い
<span class='line'>1607</span> Size オブジェクトはPointを中核データとしたサイズを扱うオブジェクト
<span class='line'>1608</span> 
<span class='line'>1609</span> Size
<span class='line'>1610</span> 	.x(width)
<span class='line'>1611</span> 	.y(height)
<span class='line'>1612</span> 	.z(depth)
<span class='line'>1613</span> size Object出力書式
<span class='line'>1614</span> form1:
<span class='line'>1615</span>     125mm,254mm
<span class='line'>1616</span> form2:
<span class='line'>1617</span>     size.X = 125mm
<span class='line'>1618</span>     size.Y = 254mm
<span class='line'>1619</span> */</span><span class="WHIT">
<span class='line'>1620</span> </span><span class="NAME">nas.Size</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1621</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1622</span> </span><span class="WHIT">		</span><span class="NAME">arguments</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">(</span><span class="STRN">"72 pt"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">(</span><span class="STRN">"72 pt"</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1623</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1624</span> </span><span class="WHIT">	</span><span class="NAME">this.length</span><span class="PUNC">=</span><span class="NAME">arguments.length</span><span class="PUNC">;</span><span class="COMM">//DimensionLength</span><span class="WHIT">
<span class='line'>1625</span> </span><span class="WHIT">	</span><span class="NAME">this.props</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="STRN">"x"</span><span class="PUNC">,</span><span class="STRN">"y"</span><span class="PUNC">,</span><span class="STRN">"z"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1626</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myDim</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">myDim</span><span class="PUNC">&lt;</span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="NAME">myDim</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1627</span> </span><span class="WHIT">		 </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">this.props</span><span class="PUNC">[</span><span class="NAME">myDim</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NAME">myDim</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1628</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1629</span> 
<span class='line'>1630</span> </span><span class="WHIT">	</span><span class="NAME">this.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">opt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1631</span> </span><span class="WHIT">    		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1632</span> </span><span class="WHIT">	    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">opt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1633</span> </span><span class="WHIT">	    	</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myDim</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">myDim</span><span class="PUNC">&lt;</span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="NAME">myDim</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1634</span> </span><span class="WHIT">		        </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">this.props</span><span class="PUNC">[</span><span class="NAME">myDim</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1635</span> </span><span class="WHIT">		    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1636</span> </span><span class="WHIT">		    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult.join</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1637</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1638</span> </span><span class="WHIT">	    	</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myDim</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">myDim</span><span class="PUNC">&lt;</span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="NAME">myDim</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1639</span> </span><span class="WHIT">		        </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="STRN">"\tsize."</span><span class="PUNC">+</span><span class="NAME">this.props</span><span class="PUNC">[</span><span class="NAME">myDim</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="STRN">" = "</span><span class="PUNC">+</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">this.props</span><span class="PUNC">[</span><span class="NAME">myDim</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1640</span> </span><span class="WHIT">		    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1641</span> </span><span class="WHIT">		    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult.join</span><span class="PUNC">(</span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1642</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1643</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1644</span> </span><span class="WHIT">	</span><span class="NAME">this.valueOf</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">asUnit</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1645</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">asUnit</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">asUnit</span><span class="PUNC">=</span><span class="NAME">this.type</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1646</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1647</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myDim</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">myDim</span><span class="PUNC">&lt;</span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="NAME">myDim</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">this.props</span><span class="PUNC">[</span><span class="NAME">myDim</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">as</span><span class="PUNC">(</span><span class="NAME">asUnit</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1648</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1649</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1650</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1651</span> </span><span class="COMM">/**
<span class='line'>1652</span>     スケールオブジェクト
<span class='line'>1653</span> Scale.length
<span class='line'>1654</span> Scale.x
<span class='line'>1655</span> Scale.y
<span class='line'>1656</span> Scale.z
<span class='line'>1657</span> Scale.type='percent'
<span class='line'>1658</span> */</span><span class="WHIT">
<span class='line'>1659</span> </span><span class="NAME">nas.Scale</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1660</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1661</span> </span><span class="WHIT">		</span><span class="NAME">arguments</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="STRN">"100%"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1662</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1663</span> </span><span class="WHIT">	</span><span class="NAME">this.length</span><span class="PUNC">=</span><span class="NAME">arguments.length</span><span class="PUNC">;</span><span class="COMM">//DimensionLength</span><span class="WHIT">
<span class='line'>1664</span> </span><span class="WHIT">	</span><span class="NAME">this.props</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="STRN">"x"</span><span class="PUNC">,</span><span class="STRN">"y"</span><span class="PUNC">,</span><span class="STRN">"z"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1665</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myDim</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">myDim</span><span class="PUNC">&lt;</span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="NAME">myDim</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1666</span> </span><span class="WHIT">		 </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">this.props</span><span class="PUNC">[</span><span class="NAME">myDim</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Rate</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NAME">myDim</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1667</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1668</span> </span><span class="WHIT">	</span><span class="NAME">this.rate</span><span class="PUNC">=</span><span class="NAME">this.x.rate</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1669</span> 
<span class='line'>1670</span> </span><span class="WHIT">	</span><span class="NAME">this.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">opt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1671</span> </span><span class="WHIT">    		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1672</span> </span><span class="WHIT">    		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rateString</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="STRN">''</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">,</span><span class="STRN">'%'</span><span class="PUNC">,</span><span class="STRN">'‰'</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">Math.log10</span><span class="PUNC">(</span><span class="NAME">this.rate</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1673</span> </span><span class="WHIT">	    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">opt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1674</span> </span><span class="WHIT">	    	</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myDim</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">myDim</span><span class="PUNC">&lt;</span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="NAME">myDim</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1675</span> </span><span class="WHIT">		        </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">this.props</span><span class="PUNC">[</span><span class="NAME">myDim</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">as</span><span class="PUNC">(</span><span class="NAME">rateString</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">rateString</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1676</span> </span><span class="WHIT">		    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1677</span> </span><span class="WHIT">		    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult.join</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1678</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1679</span> </span><span class="WHIT">		    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.length</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1680</span> </span><span class="WHIT">		            </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="STRN">"\tscale = "</span><span class="PUNC">+</span><span class="NAME">this.x.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1681</span> </span><span class="WHIT">		    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1682</span> </span><span class="WHIT">	    	    </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myDim</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">myDim</span><span class="PUNC">&lt;</span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="NAME">myDim</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1683</span> </span><span class="WHIT">		            </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="STRN">"\tscale."</span><span class="PUNC">+</span><span class="NAME">this.props</span><span class="PUNC">[</span><span class="NAME">myDim</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="STRN">" = "</span><span class="PUNC">+</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">this.props</span><span class="PUNC">[</span><span class="NAME">myDim</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">as</span><span class="PUNC">(</span><span class="NAME">rateString</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">rateString</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1684</span> </span><span class="WHIT">		        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1685</span> </span><span class="WHIT">		    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1686</span> </span><span class="WHIT">		    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult.join</span><span class="PUNC">(</span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1687</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1688</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1689</span> </span><span class="WHIT">	</span><span class="NAME">this.valueOf</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">asRate</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1690</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">asRate</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">asRate</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1691</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1692</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myDim</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">myDim</span><span class="PUNC">&lt;</span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="NAME">myDim</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">this.props</span><span class="PUNC">[</span><span class="NAME">myDim</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">as</span><span class="PUNC">(</span><span class="NAME">asRate</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1693</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1694</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1695</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1696</span> </span><span class="COMM">/* 
<span class='line'>1697</span> Position（座標）クラス
<span class='line'>1698</span> Vectorオブジェクト
<span class='line'>1699</span> 
<span class='line'>1700</span> 
<span class='line'>1701</span> 1次元のVevtorはbool / 2次元のVectorは 1次元のOrientation（Z）/ 3次元のVeltorは 3次元のOrientation (XYZ)を持つ
<span class='line'>1702</span> プロパティで持たせるか、またはラムダ関数で導くか？  アクセス頻度？
<span class='line'>1703</span> 
<span class='line'>1704</span> */</span><span class="WHIT">
<span class='line'>1705</span> </span><span class="COMM">/*
<span class='line'>1706</span> Curve  Object
<span class='line'>1707</span> new nas.Curve(point1,point2,isAbs)
<span class='line'>1708</span> アークを指定するための複合Object
<span class='line'>1709</span> 座標系のObjectに持たせるcurveプロパティの値
<span class='line'>1710</span> 自分自身の座標を始点としてベジェの第一制御点と第二制御点を相対座標で持たせる
<span class='line'>1711</span> 終点はタイムシート上に次に出現する値
<span class='line'>1712</span> したがって次の区間に値が存在しない場合は、指定自体が意味を失う
<span class='line'>1713</span> 指定が絶対座標であった場合は、 親オブジェクト側で座標系の変換を行い相対座標にして格納する
<span class='line'>1714</span> カーブデータを必要とする区間は、直前の区間のカーブ値と直後の区間の値を参照する。
<span class='line'>1715</span> 値を持っていてもカーブプロパティを持たないエントリがあっても良い
<span class='line'>1716</span> その場合は、標準値で補う
<span class='line'>1717</span> C=new Curve( new Point(0,0),new Point(1,1))
<span class='line'>1718</span> */</span><span class="WHIT">
<span class='line'>1719</span> </span><span class="NAME">nas.Curve</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1720</span> </span><span class="WHIT">	</span><span class="NAME">this.parent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1721</span> </span><span class="WHIT">	</span><span class="NAME">this.ctlrpt1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1722</span> </span><span class="WHIT">	</span><span class="NAME">this.ctlrpt2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1723</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1724</span> </span><span class="COMM">/*
<span class='line'>1725</span>   TimingCurve  Object
<span class='line'>1726</span>   タイミング指定をするための配列ベースのObject
<span class='line'>1727</span> 値を持つObjectに全て持たせることが可能
<span class='line'>1728</span> 値は二次元に限定 / 値範囲は0-1に限定
<span class='line'>1729</span> 始点を[0,0] 終点を[1,1]と置いて第一制御点と第二制御点を少数値で与える
<span class='line'>1730</span> 
<span class='line'>1731</span> キーワード文字列で初期化された場合、ライブラリ内にキーワードに対応する値が存在するならテキストを値として実際の値はクラスライブラリを参照する。
<span class='line'>1732</span> タイミングを解決するのは、値を持ったObjectの直後の中間値補間区間
<span class='line'>1733</span> 
<span class='line'>1734</span> T=new TimingCurve("linear"); //	戻値[[0,0],[1,1]]
<span class='line'>1735</span> nas.TimingCurve=function(){
<span class='line'>1736</span> 	this.
<span class='line'>1737</span> }
<span class='line'>1738</span> .parent タイミングカーブが適用されるプロパティを与える
<span class='line'>1739</span> .ctlrPtは自身の配列要素を使用
<span class='line'>1740</span> 
<span class='line'>1741</span> */</span><span class="WHIT">
<span class='line'>1742</span> </span><span class="NAME">nas.TimingCurve</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1743</span> </span><span class="WHIT">	</span><span class="NAME">this.parent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1744</span> </span><span class="WHIT">	</span><span class="NAME">this.name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1745</span> </span><span class="WHIT">	</span><span class="NAME">this.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//デフォルトのlinearタイミング</span><span class="WHIT">
<span class='line'>1746</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1747</span> </span><span class="NAME">nas.TimingCurve.prototype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="NAME">Array.prototype</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1748</span> 
<span class='line'>1749</span> </span><span class="COMM">/**
<span class='line'>1750</span> デフォルトタイミングライブラリ
<span class='line'>1751</span> 
<span class='line'>1752</span> 	リニアタイミング（均等タイミング）	0	0	1	1
<span class='line'>1753</span> 	イーズ（両詰め）	0.5	0	0.5	1
<span class='line'>1754</span> 	イーズアウト（前詰め）	0.5	0	1	0.5
<span class='line'>1755</span> 	イーズイン（後詰め）	0	0.5	0.5	1
<span class='line'>1756</span> 	クイック（極端な両詰め）	1	0	0	1
<span class='line'>1757</span> 	クイックアウト（極端な前詰め）	1	0	1	0
<span class='line'>1758</span> 	クイックイン（極端な後詰め）	0	1	0	1
<span class='line'>1759</span> 	ステイ（中詰め）	0	0.5	1	0.5
<span class='line'>1760</span> 	ステイストロング(極端な中詰め)	0	1	1	0
<span class='line'>1761</span> */</span><span class="WHIT">
<span class='line'>1762</span> </span><span class="NAME">nas.Timing</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1763</span> </span><span class="WHIT">	</span><span class="STRN">"linear"</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">[</span><span class="WHIT">  </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="WHIT">  </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1764</span> </span><span class="WHIT">	</span><span class="STRN">"ease"</span><span class="WHIT">      </span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">[</span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1765</span> </span><span class="WHIT">	</span><span class="STRN">"easeOut"</span><span class="WHIT">   </span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">[</span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="WHIT">  </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0.5</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1766</span> </span><span class="WHIT">	</span><span class="STRN">"easeIn"</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">[</span><span class="WHIT">  </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0.5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1767</span> </span><span class="WHIT">	</span><span class="STRN">"quick"</span><span class="WHIT">     </span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">[</span><span class="WHIT">  </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="WHIT">  </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1768</span> </span><span class="WHIT">	</span><span class="STRN">"quickOut"</span><span class="WHIT">  </span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">[</span><span class="WHIT">  </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="WHIT">  </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1769</span> </span><span class="WHIT">	</span><span class="STRN">"quickIn"</span><span class="WHIT">   </span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">[</span><span class="WHIT">  </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="WHIT">  </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1770</span> </span><span class="WHIT">	</span><span class="STRN">"stay"</span><span class="WHIT">      </span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">[</span><span class="WHIT">  </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0.5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="WHIT">  </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0.5</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1771</span> </span><span class="WHIT">	</span><span class="STRN">"stayStrong"</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">[</span><span class="WHIT">  </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="WHIT">  </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>1772</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1773</span> 
<span class='line'>1774</span> 
<span class='line'>1775</span> </span><span class="COMM">/**
<span class='line'>1776</span>     合成モードオブジェクト
<span class='line'>1777</span> 
<span class='line'>1778</span> nas.BlendingMode.ADD
<span class='line'>1779</span> nas.BlendingMode.ALPHA_ADD
<span class='line'>1780</span> nas.BlendingMode.CLASSIC_COLOR_BURN
<span class='line'>1781</span> nas.BlendingMode.CLASSIC_COLOR_DODGE
<span class='line'>1782</span> nas.BlendingMode.CLASSIC_DIFFERENCE
<span class='line'>1783</span> nas.BlendingMode.COLOR
<span class='line'>1784</span> nas.BlendingMode.COLOR_BURN
<span class='line'>1785</span> nas.BlendingMode.COLOR_DODGE
<span class='line'>1786</span> nas.BlendingMode.DANCING_DISSOLVE
<span class='line'>1787</span> nas.BlendingMode.DARKEN
<span class='line'>1788</span> nas.BlendingMode.DIFFERENCE
<span class='line'>1789</span> nas.BlendingMode.DISSOLVE
<span class='line'>1790</span> nas.BlendingMode.EXCLUSION
<span class='line'>1791</span> nas.BlendingMode.HARD_LIGHT
<span class='line'>1792</span> nas.BlendingMode.HARD_MIX
<span class='line'>1793</span> nas.BlendingMode.HUE
<span class='line'>1794</span> nas.BlendingMode.LIGHTEN
<span class='line'>1795</span> nas.BlendingMode.LINEAR_BURN
<span class='line'>1796</span> nas.BlendingMode.LINEAR_DODGE
<span class='line'>1797</span> nas.BlendingMode.LINEAR_LIGHT
<span class='line'>1798</span> nas.BlendingMode.LUMINESCENT_PREMUL
<span class='line'>1799</span> nas.BlendingMode.LUMINOSITY
<span class='line'>1800</span> nas.BlendingMode.MULTIPLY
<span class='line'>1801</span> nas.BlendingMode.NORMAL
<span class='line'>1802</span> nas.BlendingMode.OVERLAY
<span class='line'>1803</span> nas.BlendingMode.PIN_LIGHT
<span class='line'>1804</span> nas.BlendingMode.SATURATION
<span class='line'>1805</span> nas.BlendingMode.SCREEN
<span class='line'>1806</span> nas.BlendingMode.SILHOUETE_ALPHA
<span class='line'>1807</span> nas.BlendingMode.SILHOUETTE_LUMA
<span class='line'>1808</span> nas.BlendingMode.SOFT_LIGHT
<span class='line'>1809</span> nas.BlendingMode.STENCIL_ALPHA
<span class='line'>1810</span> nas.BlendingMode.STENCIL_LUMA
<span class='line'>1811</span> nas.BlendingMode.VIVID_LIGHT
<span class='line'>1812</span> 
<span class='line'>1813</span> 現在の実装では実際の値は問題にならない
<span class='line'>1814</span> 列挙値として仮にAE互換の整数値を与えておく　
<span class='line'>1815</span> 
<span class='line'>1816</span> これは将来合成数式のキャリアとして再設定される…かも
<span class='line'>1817</span> */</span><span class="WHIT">
<span class='line'>1818</span> 
<span class='line'>1819</span> </span><span class="NAME">nas.BlendingMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1820</span> </span><span class="WHIT">	</span><span class="NAME">ADD</span><span class="PUNC">:</span><span class="NUMB">3620</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1821</span> </span><span class="WHIT">	</span><span class="NAME">ALPHA_ADD</span><span class="PUNC">:</span><span class="NUMB">3644</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1822</span> </span><span class="WHIT">	</span><span class="NAME">CLASSIC_COLOR_BURN</span><span class="PUNC">:</span><span class="NUMB">3619</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1823</span> </span><span class="WHIT">	</span><span class="NAME">CLASSIC_COLOR_DODGE</span><span class="PUNC">:</span><span class="NUMB">3625</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1824</span> </span><span class="WHIT">	</span><span class="NAME">CLASSIC_DIFFERENCE</span><span class="PUNC">:</span><span class="NUMB">3634</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1825</span> </span><span class="WHIT">	</span><span class="NAME">COLOR</span><span class="PUNC">:</span><span class="NUMB">3638</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1826</span> </span><span class="WHIT">	</span><span class="NAME">COLOR_BURN</span><span class="PUNC">:</span><span class="NUMB">3618</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1827</span> </span><span class="WHIT">	</span><span class="NAME">COLOR_DODGE</span><span class="PUNC">:</span><span class="NUMB">3624</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1828</span> </span><span class="WHIT">	</span><span class="NAME">DANCING_DISSOLVE</span><span class="PUNC">:</span><span class="NUMB">3614</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1829</span> </span><span class="WHIT">	</span><span class="NAME">DARKEN</span><span class="PUNC">:</span><span class="NUMB">3615</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1830</span> </span><span class="WHIT">	</span><span class="NAME">DIFFERENCE</span><span class="PUNC">:</span><span class="NUMB">3633</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1831</span> </span><span class="WHIT">	</span><span class="NAME">DISSOLVE</span><span class="PUNC">:</span><span class="NUMB">3613</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1832</span> </span><span class="WHIT">	</span><span class="NAME">EXCLUSION</span><span class="PUNC">:</span><span class="NUMB">3635</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1833</span> </span><span class="WHIT">	</span><span class="NAME">HARD_LIGHT</span><span class="PUNC">:</span><span class="NUMB">3628</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1834</span> </span><span class="WHIT">	</span><span class="NAME">HARD_MIX</span><span class="PUNC">:</span><span class="NUMB">3632</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1835</span> </span><span class="WHIT">	</span><span class="NAME">HUE</span><span class="PUNC">:</span><span class="NUMB">3636</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1836</span> </span><span class="WHIT">	</span><span class="NAME">LIGHTEN</span><span class="PUNC">:</span><span class="NUMB">3621</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1837</span> </span><span class="WHIT">	</span><span class="NAME">LINEAR_BURN</span><span class="PUNC">:</span><span class="NUMB">3617</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1838</span> </span><span class="WHIT">	</span><span class="NAME">LINEAR_DODGE</span><span class="PUNC">:</span><span class="NUMB">3623</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1839</span> </span><span class="WHIT">	</span><span class="NAME">LINEAR_LIGHT</span><span class="PUNC">:</span><span class="NUMB">3629</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1840</span> </span><span class="WHIT">	</span><span class="NAME">LUMINESCENT_PREMUL</span><span class="PUNC">:</span><span class="NUMB">3645</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1841</span> </span><span class="WHIT">	</span><span class="NAME">LUMINOSITY</span><span class="PUNC">:</span><span class="NUMB">3639</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1842</span> </span><span class="WHIT">	</span><span class="NAME">MULTIPLY</span><span class="PUNC">:</span><span class="NUMB">3616</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1843</span> </span><span class="WHIT">	</span><span class="NAME">NORMAL</span><span class="PUNC">:</span><span class="NUMB">3612</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1844</span> </span><span class="WHIT">	</span><span class="NAME">OVERLAY</span><span class="PUNC">:</span><span class="NUMB">3626</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1845</span> </span><span class="WHIT">	</span><span class="NAME">PIN_LIGHT</span><span class="PUNC">:</span><span class="NUMB">3631</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1846</span> </span><span class="WHIT">	</span><span class="NAME">SATURATION</span><span class="PUNC">:</span><span class="NUMB">3637</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1847</span> </span><span class="WHIT">	</span><span class="NAME">SCREEN</span><span class="PUNC">:</span><span class="NUMB">3622</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1848</span> </span><span class="WHIT">	</span><span class="NAME">SILHOUETE_ALPHA</span><span class="PUNC">:</span><span class="NUMB">3642</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1849</span> </span><span class="WHIT">	</span><span class="NAME">SILHOUETTE_LUMA</span><span class="PUNC">:</span><span class="NUMB">3643</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1850</span> </span><span class="WHIT">	</span><span class="NAME">SOFT_LIGHT</span><span class="PUNC">:</span><span class="NUMB">3627</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1851</span> </span><span class="WHIT">	</span><span class="NAME">STENCIL_ALPHA</span><span class="PUNC">:</span><span class="NUMB">3640</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1852</span> </span><span class="WHIT">	</span><span class="NAME">STENCIL_LUMA</span><span class="PUNC">:</span><span class="NUMB">3641</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1853</span> </span><span class="WHIT">	</span><span class="NAME">VIVID_LIGHT</span><span class="PUNC">:</span><span class="NUMB">3630</span><span class="WHIT">
<span class='line'>1854</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1855</span> </span><span class="COMM">/*
<span class='line'>1856</span> nas.AnimationPeg Object
<span class='line'>1857</span> nasペグシステムでサポートするペグオブジェクト
<span class='line'>1858</span> 
<span class='line'>1859</span> 以下のペグをサポートする
<span class='line'>1860</span> 0:表示のないペグ  角合せ及び中央合せ	中央合わせがデフォルト値
<span class='line'>1861</span> 	0:中央合せ
<span class='line'>1862</span> 	1:左下合せ(ステージ第一象限)
<span class='line'>1863</span> 	2:左上合せ(ステージ第二象限)
<span class='line'>1864</span> 	3:右上合せ(ステージ第三象限)
<span class='line'>1865</span> 	4:右下合せ(ステージ第四象限)
<span class='line'>1866</span> 	5:他任意の位置
<span class='line'>1867</span> 	プリセットで色々作る
<span class='line'>1868</span>   各ポイントは、ペグ（レジストレーション点）として扱う
<span class='line'>1869</span> 	可視、不可視の属性を持ち、外見プロパティを持たせることができる。
<span class='line'>1870</span> 	外見プロパティの登録がない場合簡易表示として、レジストリシンボルを使う
<span class='line'>1871</span>   エレメントグループ内部のみで角合わせを行うとレジストレーション点が画面中央で初期化されたりするが通常の動作である
<span class='line'>1872</span>   必要に従って、新たなタップを作成（ステージにタップ＝カメラワークフレームを設定＝設置）して其処にジオメトリネットワークを構築する
<span class='line'>1873</span>   実物線画台と異なり同じ位置に別のタップが置ける  干渉は無い
<span class='line'>1874</span> 
<span class='line'>1875</span> 外見プロパティは以下から選択できるように設定
<span class='line'>1876</span> 0:不可視、表示の際はシンボルで
<span class='line'>1877</span> 1:ACME	ACME があれば問題ないと思う
<span class='line'>1878</span> 2:丸あな2穴	穴径及び間隔は別に設定  またはシンボル
<span class='line'>1879</span> 3:丸あな3穴	タイプはASAのみ用意する  ほかはいらん
<span class='line'>1880</span> 
<span class='line'>1881</span> ペグ（レジストレーション）システムとして考えた場合  角合せも中央整列もペグの位置指定と同じ
<span class='line'>1882</span> フレームからのレジストレーション点オフセットのデータ書式は同じ  →  ケースわけしない
<span class='line'>1883</span> レジストレーション代表点は、ペグの場合各ペグの中心（ACMEならセンターホール中心）、０番系列はポイントそのもの
<span class='line'>1884</span> 向きはエレメントグループ内で揃っていれば同じ
<span class='line'>1885</span> データ上のオフセットは、レジストリ点のローカル座標とローテーション
<span class='line'>1886</span> pegオフセットは、フレーム中心からのペグ（レジストレーション点）のオフセットとローテーション
<span class='line'>1887</span> 
<span class='line'>1888</span> したがってフレーム中心のローカル座標は  sub(offset,pegOffset)となる。
<span class='line'>1889</span> 
<span class='line'>1890</span> 基本構成は同じだが、AnimationPegはオブジェクトでなく  AnimationFrameオブジェクトのプロパティとして実装してそのプロパティの一部としてPegFormを設定する。
<span class='line'>1891</span> これがペグの外形を保持するように実装
<span class='line'>1892</span> 
<span class='line'>1893</span> オフセットプロパティ群の関連は以下のリスト
<span class='line'>1894</span> 
<span class='line'>1895</span>  GeometryOffset  オブジェクト  基底クラスオブジェクト
<span class='line'>1896</span>  位置オフセット+回転（オリエンテーション）値で成立する  回転に際して正規化が発生する
<span class='line'>1897</span> 
<span class='line'>1898</span> offset
<span class='line'>1899</span> 	セルエレメントのローカル座標内のペグ位置オフセット
<span class='line'>1900</span> pegOffset
<span class='line'>1901</span> 	プロパティとしては親座標系内のペグ位置
<span class='line'>1902</span> 	デフォルトで使う限りは親がステージなのでワールド座標系での位置になる
<span class='line'>1903</span> 	ネットワーク構築時のネスト時の親に注意
<span class='line'>1904</span> 	乗り換え操作の際は、一旦ステージまでさかのぼってコンバートする方針で実装
<span class='line'>1905</span> frameOffset
<span class='line'>1906</span> 	ペグ位置に対するフレームのオフセット
<span class='line'>1907</span> 	エレメント（ローカル）座標系で記録する
<span class='line'>1908</span> */</span><span class="WHIT">
<span class='line'>1909</span> </span><span class="COMM">/*
<span class='line'>1910</span> myPeg =new nas.AnimationPegForm(pegForm)
<span class='line'>1911</span> 
<span class='line'>1912</span> */</span><span class="WHIT">
<span class='line'>1913</span> </span><span class="NAME">nas.AnimationPegForms</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1914</span> </span><span class="WHIT">	</span><span class="STRN">"invisible"</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1915</span> </span><span class="WHIT">	</span><span class="STRN">"ACME"</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1916</span> </span><span class="WHIT">	</span><span class="STRN">"jis2hales"</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1917</span> </span><span class="WHIT">	</span><span class="STRN">"us3hales"</span><span class="PUNC">:</span><span class="NUMB">3</span><span class="WHIT">
<span class='line'>1918</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1919</span> </span><span class="NAME">nas.AnimationPegForm</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">pegName</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1920</span> </span><span class="WHIT">	</span><span class="NAME">this.name</span><span class="PUNC">=</span><span class="NAME">pegName</span><span class="PUNC">;</span><span class="COMM">//"invisible","ACME","jis2hales","ansi3holes"</span><span class="WHIT">
<span class='line'>1921</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1922</span> </span><span class="NAME">nas.AnimationPegForm.prototype.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.name</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1923</span> </span><span class="NAME">nas.AnimationPegForm.prototype.valueOf</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">nas.AnimationPegForms</span><span class="PUNC">[</span><span class="NAME">this.name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1924</span> 
<span class='line'>1925</span> </span><span class="NAME">nas.GeometryOffset</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myPoint</span><span class="PUNC">,</span><span class="NAME">myRotation</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1926</span> </span><span class="WHIT">	</span><span class="NAME">this.position</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">myPoint</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.Point</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">myPoint</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Point</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1927</span> </span><span class="WHIT">	</span><span class="NAME">this.x</span><span class="PUNC">=</span><span class="NAME">this.position.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1928</span> </span><span class="WHIT">	</span><span class="NAME">this.y</span><span class="PUNC">=</span><span class="NAME">this.position.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1929</span> </span><span class="WHIT">	</span><span class="NAME">this.rotation</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">myRotation</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.Rotation</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">myRotation</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Rotation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1930</span> </span><span class="WHIT">	</span><span class="NAME">this.r</span><span class="PUNC">=</span><span class="NAME">this.rotation.rotationZ</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1931</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1932</span> </span><span class="COMM">/*
<span class='line'>1933</span> nas.AnimationField Object
<span class='line'>1934</span> 作画アニメーションフレームを保持するオブジェクト
<span class='line'>1935</span> クリッピングフレーム（カメラワークオブジェクト）の基底クラス
<span class='line'>1936</span> 10インチ標準フレームは、
<span class='line'>1937</span> 	new nas.AnimationField(
<span class='line'>1938</span> 		name = "10inSTD",
<span class='line'>1939</span> 		baseWidth=new nas.UnitValue("720 pt"),
<span class='line'>1940</span> 		frameAspect=16/9,
<span class='line'>1941</span> 		scale="100Fld",
<span class='line'>1942</span> 		peg=new nas.AnimationPegForm("ACME"),
<span class='line'>1943</span> 		pegOffset = nas.GeometryOffset(new nas.Position("0mm","105mm"),new nas.Rotation(0)),
<span class='line'>1944</span> 		type = "trad"
<span class='line'>1945</span> 	);
<span class='line'>1946</span> 
<span class='line'>1947</span>     フィールドタイプ：trad,retas,inch-field,5000center
<span class='line'>1948</span> */</span><span class="WHIT">
<span class='line'>1949</span> </span><span class="NAME">nas.AnimationField</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myName</span><span class="PUNC">,</span><span class="NAME">baseWidth</span><span class="PUNC">,</span><span class="NAME">frameAspect</span><span class="PUNC">,</span><span class="NAME">scale</span><span class="PUNC">,</span><span class="NAME">peg</span><span class="PUNC">,</span><span class="NAME">pegOffset</span><span class="PUNC">,</span><span class="NAME">fieldType</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1950</span> </span><span class="WHIT">	</span><span class="NAME">this.name</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">myName</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">myName</span><span class="PUNC">:</span><span class="STRN">"10in-HDTV"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1951</span> </span><span class="WHIT">	</span><span class="NAME">this.baseWidth</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">baseWidth</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">baseWidth</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">(</span><span class="STRN">"254 mm"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1952</span> </span><span class="WHIT">	</span><span class="NAME">this.frameAspect</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">frameAspect</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">frameAspect</span><span class="PUNC">:</span><span class="NUMB">16</span><span class="PUNC">/</span><span class="NUMB">9</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1953</span> </span><span class="WHIT">	</span><span class="NAME">this.frameScale</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">scale</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">scale</span><span class="PUNC">:</span><span class="NUMB">1.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1954</span> </span><span class="WHIT">	</span><span class="NAME">this.peg</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">peg</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">peg</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationPegForm</span><span class="PUNC">(</span><span class="STRN">"ACME"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1955</span> </span><span class="WHIT">	</span><span class="NAME">this.pegOffset</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">pegOffset</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">pegOffset</span><span class="PUNC">:</span><span class="NAME">nas.GeometryOffset</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Position</span><span class="PUNC">(</span><span class="STRN">"0 mm"</span><span class="PUNC">,</span><span class="STRN">"104.775 mm"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Rotation</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1956</span> </span><span class="WHIT">	</span><span class="NAME">this.type</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">fieldType</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">fieldType</span><span class="PUNC">:</span><span class="STRN">"trad"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1957</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1958</span> 
<span class='line'>1959</span> </span><span class="NAME">nas.AnimationField.prototype.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">exportForm</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1960</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">exportForm</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1961</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resultData</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>1962</span> </span><span class="WHIT">        </span><span class="STRN">'"'</span><span class="PUNC">+</span><span class="NAME">this.name</span><span class="PUNC">+</span><span class="STRN">'"'</span><span class="WHIT">
<span class='line'>1963</span> </span><span class="WHIT">      </span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1964</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1965</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resultData</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>1966</span> </span><span class="WHIT">        </span><span class="STRN">'"'</span><span class="PUNC">+</span><span class="NAME">this.name</span><span class="PUNC">+</span><span class="STRN">'"'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1967</span> </span><span class="WHIT">	    </span><span class="NAME">this.baseWidth</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1968</span> </span><span class="WHIT">	    </span><span class="NAME">this.frameAspect</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1969</span> </span><span class="WHIT">	    </span><span class="NAME">this.frameScale</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1970</span> </span><span class="WHIT">	    </span><span class="NAME">this.peg</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1971</span> </span><span class="WHIT">	    </span><span class="NAME">this.pegOffset</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1972</span> </span><span class="WHIT">	    </span><span class="NAME">this.type</span><span class="WHIT">
<span class='line'>1973</span> </span><span class="WHIT">	  </span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1974</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1975</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">resultData.join</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1976</span> 
<span class='line'>1977</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1978</span> 
<span class='line'>1979</span> 
<span class='line'>1980</span> </span><span class="COMM">/**
<span class='line'>1981</span>  * nas.AnimationElementSource Object
<span class='line'>1982</span>  * 各エレメントのソースファイルを統合して扱うオブジェクト
<span class='line'>1983</span>  * 初期化引数:ターゲット記述テキスト
<span class='line'>1984</span>  * .file ソースファイル object/File 又はパス文字列  初期値 null
<span class='line'>1985</span>  * .file.additionalLocation ソースファイルのサブロケーション  文字列  結合可能
<span class='line'>1986</span>  * .framerate ソースフレームレート 主に静止画、ムービーの際に利用  object / nas.Framerate
<span class='line'>1987</span>  * .duration ソース継続時間 主に静止画の際に利用  int/frames
<span class='line'>1988</span>  * .startOffset ソース継続時間に対するオフセット  int/frames
<span class='line'>1989</span>  * .type     ソースに与えられた役割を表す型式文字列
<span class='line'>1990</span>  
<span class='line'>1991</span> type属性は、静止画/動画/音声/Xpst と　ソース/プロキシ/リファレンス　の組み合わせ12種類
<span class='line'>1992</span> に加えて作業伝票としてのXPstを扱うことができる
<span class='line'>1993</span> xpst/still/movie/sound[-/src/prox/ref]
<span class='line'>1994</span> 
<span class='line'>1995</span>  */</span><span class="WHIT">
<span class='line'>1996</span> </span><span class="NAME">nas.AnimationElementSource</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">targetDescription</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1997</span> </span><span class="WHIT">    </span><span class="NAME">this.contentText</span><span class="PUNC">=</span><span class="NAME">targetDescription</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1998</span> </span><span class="WHIT">    </span><span class="NAME">this.file</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1999</span> </span><span class="WHIT">    </span><span class="NAME">this.subLocations</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2000</span> </span><span class="WHIT">	</span><span class="NAME">this.framerate</span><span class="PUNC">=</span><span class="NAME">nas.pmdb.activeTitle.framerate</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2001</span> </span><span class="WHIT">    </span><span class="NAME">this.duration</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2002</span> </span><span class="WHIT">    </span><span class="NAME">this.stratOffset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2003</span> </span><span class="WHIT">    </span><span class="NAME">this.type</span><span class="PUNC">=</span><span class="STRN">"still-src"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2004</span> 
<span class='line'>2005</span> </span><span class="WHIT">    </span><span class="NAME">this.parseContent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2006</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2007</span> </span><span class="COMM">/*
<span class='line'>2008</span>     ソースの書式は以下
<span class='line'>2009</span>     ["&lt;file.url>[///&lt;source-subLoacation>[,&lt;source-subLoacation>]...///&lt;propertyName>=&lt;propertyValue>[,&lt;propertyName>=&lt;propertyValue>]...]]
<span class='line'>2010</span>     urlは必須　サブロケーションがある場合は、ファイル記述規則に従って///三連スラッシュでurlに連続して記述
<span class='line'>2011</span>     urlがカラで他のプロパティを登録する場合は"(空文字列)"を使用して　以降のプロパティを記述する
<span class='line'>2012</span>     すべて単一の文字列で
<span class='line'>2013</span>     例
<span class='line'>2014</span> "./sample/KD/B001.png///ping///pong"
<span class='line'>2015</span> */</span><span class="WHIT">
<span class='line'>2016</span> </span><span class="NAME">nas.AnimationElementSource.prototype.parseContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">srcString</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2017</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">srcString</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">srcString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.contentText</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2018</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">srcData</span><span class="PUNC">=</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">srcString</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">'///'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2019</span> </span><span class="WHIT">    </span><span class="NAME">this.file</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">srcData</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">srcData</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2020</span> </span><span class="WHIT">    </span><span class="NAME">this.subLocations</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">srcData</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">srcData</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">srcData</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2021</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">srcData</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2022</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">props</span><span class="PUNC">=</span><span class="NAME">srcData</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2023</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pidx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="NAME">pidx</span><span class="PUNC">&lt;</span><span class="NAME">props.length</span><span class="PUNC">;</span><span class="NAME">pidx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2024</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">prop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">props</span><span class="PUNC">[</span><span class="NAME">pidx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">'='</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2025</span> </span><span class="WHIT">            </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">prop</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2026</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2027</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2028</span> </span><span class="WHIT">    </span><span class="NAME">this.contentText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2029</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.contentText</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2030</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2031</span> </span><span class="NAME">nas.AnimationElementSource.prototype.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">exportForm</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2032</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">exportForm</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2033</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.contentText</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2034</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2035</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2036</span> </span><span class="WHIT">        </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="NAME">this.file</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2037</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>2038</span> </span><span class="WHIT">            </span><span class="PUNC">(</span><span class="NAME">this.subLocations.length</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2039</span> </span><span class="WHIT">            </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>2040</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="NAME">this.duration</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2041</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="NAME">this.startOffset</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2042</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">this.framerate.sameAs</span><span class="PUNC">(</span><span class="NAME">nas.pmdb.activeTitle.framerate</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2043</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="NAME">this.type</span><span class="PUNC">!=</span><span class="STRN">"still-src"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2044</span> </span><span class="WHIT">            </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2045</span> </span><span class="WHIT">        </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2046</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.subLocations.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2047</span> </span><span class="WHIT">                </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="NAME">this.subLocations.join</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2048</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2049</span> </span><span class="WHIT">                </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2050</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2051</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">props</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2052</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.duration</span><span class="PUNC">)</span><span class="WHIT">           </span><span class="NAME">props.push</span><span class="PUNC">(</span><span class="STRN">"dutation="</span><span class="PUNC">+</span><span class="NAME">this.duration</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2053</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.startOffset</span><span class="PUNC">)</span><span class="WHIT">        </span><span class="NAME">props.push</span><span class="PUNC">(</span><span class="STRN">"startOffset="</span><span class="PUNC">+</span><span class="NAME">this.startOffset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2054</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">this.framerate.sameAs</span><span class="PUNC">(</span><span class="NAME">nas.pmdb.activeTitle.framerate</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2055</span> </span><span class="WHIT">                                        </span><span class="NAME">props.push</span><span class="PUNC">(</span><span class="STRN">"framerate="</span><span class="PUNC">+</span><span class="NAME">this.framerate.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2056</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.type</span><span class="PUNC">!=</span><span class="STRN">"still-src"</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="NAME">props.push</span><span class="PUNC">(</span><span class="STRN">"type="</span><span class="PUNC">+</span><span class="NAME">this.type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2057</span> </span><span class="WHIT">            </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="NAME">props.join</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2058</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2059</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult.join</span><span class="PUNC">(</span><span class="STRN">'///'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2060</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>2061</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2062</span> </span><span class="COMM">/*TEST
<span class='line'>2063</span> var testString='./test/Folder/kachi#00[pilot]__s-c004_s-c012/KD/kachi#00[pilot]__s-c004_s-c012///KD/A/001///'
<span class='line'>2064</span> A= new nas.AnimationElementSource(testString);
<span class='line'>2065</span> A
<span class='line'>2066</span> */</span><span class="WHIT">
<span class='line'>2067</span> 
<span class='line'>2068</span> </span><span class="COMM">//区間要素群のtoString()	メソッドの仕様</span><span class="WHIT">
<span class='line'>2069</span> 
<span class='line'>2070</span> </span><span class="COMM">/*
<span class='line'>2071</span> 	Obj.toString() 又は  Obj.toString(0 or false)
<span class='line'>2072</span> 	代表値を保存形式出力で
<span class='line'>2073</span> 	Obj.toString(出力キーワード) 又は  Obj.toString(1 or true)
<span class='line'>2074</span> 	先頭 \t フィールドデリミタ \n でフルスペック出力
<span class='line'>2075</span> 
<span class='line'>2076</span> 	Obj.toString([プロパティ名配列])
<span class='line'>2077</span> 	指定プロパティを先頭 \t フィールドデリミタ \n で列挙
<span class='line'>2078</span>         
<span class='line'>2079</span> 	
<span class='line'>2080</span> 実際の使用時は以下の例のように利用
<span class='line'>2081</span> 	xMapElement.content.toString("all");
<span class='line'>2082</span> 	xMapElement.toString() //内部的にcontent.toString()にアクセス
<span class='line'>2083</span> 	
<span class='line'>2084</span> メモ:
<span class='line'>2085</span> 関数仕様
<span class='line'>2086</span> エレメント又はその値のtoString()で xMap の出力を得る
<span class='line'>2087</span> 
<span class='line'>2088</span> toString():引数なし	標準型
<span class='line'>2089</span> toString("all"):true ? 全プロパティ出力
<span class='line'>2090</span> toString(propName):プロパティ名  単独プロパティ
<span class='line'>2091</span> toString([propNames]):プロパティ名配列  指定プロパティを改行で区切って連続で与える
<span class='line'>2092</span> 
<span class='line'>2093</span> 
<span class='line'>2094</span> 例(セル):
<span class='line'>2095</span> AnimationRreplacement.toString();
<span class='line'>2096</span> 
<span class='line'>2097</span> 戻値
<span class='line'>2098</span> 'A	A-1	"c:\myWorkshop\dataStore\work01\c001\A\0001.png",120 mm,360 mm '
<span class='line'>2099</span> 
<span class='line'>2100</span> AnimationRreplacement.toString(["size.x","size.y","size.t"]);
<span class='line'>2101</span> 
<span class='line'>2102</span> 戻値
<span class='line'>2103</span> '	size.x=120 mm
<span class='line'>2104</span> 	size.y=360 mm
<span class='line'>2105</span> 	size.t=linear
<span class='line'>2106</span> '
<span class='line'>2107</span> 
<span class='line'>2108</span> xMapElement.toString("all");
<span class='line'>2109</span> 戻値
<span class='line'>2110</span> 'A	A-1	"c:\myWorkshop\dataStore\work01\c001\A\0001.png"
<span class='line'>2111</span> 	size.x=120 mm
<span class='line'>2112</span> 	size.y=360 mm
<span class='line'>2113</span> 	size.t=linear
<span class='line'>2114</span> '
<span class='line'>2115</span> 
<span class='line'>2116</span> 例:
<span class='line'>2117</span> AnimationReplacement.toString()
<span class='line'>2118</span> 戻値
<span class='line'>2119</span> B	B-1	"c:\\\\Users\\Me\\Desktop\\Datas\\B_00001.png",640pt,480pt,
<span class='line'>2120</span> 
<span class='line'>2121</span> これらの値がグループの場合と要素の場合で共通に使える仕様とすること
<span class='line'>2122</span> 
<span class='line'>2123</span> 値に名前（ラベル）を与えるのは上位オブジェクトの役目なので上位オブジェクト側で、これらの値をラップした出力を得る
<span class='line'>2124</span> 	group
<span class='line'>2125</span> [A cell]
<span class='line'>2126</span> //最低限、名前  + 値タイプ  （これが最も多い）
<span class='line'>2127</span> [A	cell	720,405]
<span class='line'>2128</span> //標準形式、[label type basicProp comment]
<span class='line'>2129</span> //これ以上の情報が継承以外で保持されている場合geometryの追加情報を個別型式で出力
<span class='line'>2130</span> 
<span class='line'>2131</span> セルグループのプロパティ
<span class='line'>2132</span> 	セッションユニークID
<span class='line'>2133</span> 	名前
<span class='line'>2134</span> 	値	アニメーションフィールド
<span class='line'>2135</span> 
<span class='line'>2136</span> 	セッションユニークID
<span class='line'>2137</span> 	所属グループ
<span class='line'>2138</span> 	名前
<span class='line'>2139</span> 	値	アニメーションリプレースメントエレメント  ファイル実体とアニメーションフィールドを持つ複合オブジェクト
<span class='line'>2140</span> 
<span class='line'>2141</span> [A	CELL	254mm,142.875mm,]
<span class='line'>2142</span> 
<span class='line'>2143</span> 
<span class='line'>2144</span> 
<span class='line'>2145</span> */</span><span class="WHIT">
<span class='line'>2146</span> </span><span class="COMM">/*
<span class='line'>2147</span> 	区間の値としてのオブジェクトとxMapElementの値を同一オブジェクトとする
<span class='line'>2148</span> 
<span class='line'>2149</span> 	作成するオブジェクトのリスト＞＞トラックの種類だけ必要
<span class='line'>2150</span> nas.CameraworkDescription   単記述オブジェクト　下記を含むマルチパーパスオブジェクト
<span class='line'>2151</span> nas.AnimationDialog	        音響
<span class='line'>2152</span> nas.AnimationReaplacement   置きかえ（画像ーセル＊静止画と動画を双方含む）
<span class='line'>2153</span> nas.AnimationGeometry	    ジオメトリ（カメララーク）
<span class='line'>2154</span> nas.AnimationComposite	    合成（撮影効果）
<span class='line'>2155</span> 
<span class='line'>2156</span> システムグループのエントリは各オブジェクトをすべて含む可能性がある == システムのみグループのタイプと値のタイプが異なる
<span class='line'>2157</span> XPSグループのエントリは時間属性を持ったリプレースメントオブジェクトとして扱う
<span class='line'>2158</span> 
<span class='line'>2159</span> TEXTグループは、タイムシート上には配置されず区間の値となることは無い…と思う
<span class='line'>2160</span> 字幕等 の  AnimationDialogに準ずるAnimationTextオブジェクトは、そのうち必要かも  
<span class='line'>2161</span> 
<span class='line'>2162</span> これでOK？
<span class='line'>2163</span> 
<span class='line'>2164</span> */</span><span class="WHIT">
<span class='line'>2165</span> 
<span class='line'>2166</span> </span><span class="COMM">/**
<span class='line'>2167</span> 
<span class='line'>2168</span>     Xps
<span class='line'>2169</span>         .stage  *
<span class='line'>2170</span>         .map    *
<span class='line'>2171</span>         .opus
<span class='line'>2172</span>         .title
<span class='line'>2173</span>         .subtitle
<span class='line'>2174</span>         .create_time
<span class='line'>2175</span>         .create_user
<span class='line'>2176</span>         .cut
<span class='line'>2177</span>         .framerate
<span class='line'>2178</span>         .memo
<span class='line'>2179</span>         .rate
<span class='line'>2180</span>         .scene
<span class='line'>2181</span>         .trin
<span class='line'>2182</span>         .trout
<span class='line'>2183</span>         .update_time
<span class='line'>2184</span>         .update_user
<span class='line'>2185</span>         .xpsTracks(XpsTrackCollection)
<span class='line'>2186</span> 
<span class='line'>2187</span>         .duration()
<span class='line'>2188</span>         .deleteTL()
<span class='line'>2189</span>         .getIdentifier()
<span class='line'>2190</span>         .getMap()
<span class='line'>2191</span>         .getNormarizedStream()
<span class='line'>2192</span>         .getRange()
<span class='line'>2193</span>         .getTC()
<span class='line'>2194</span>         .init()
<span class='line'>2195</span>         .insertTL()
<span class='line'>2196</span>         .isSame()
<span class='line'>2197</span>         .newTracks()
<span class='line'>2198</span>         .parseXps()
<span class='line'>2199</span>         .put()
<span class='line'>2200</span>         .reInitBody()
<span class='line'>2201</span>         .readIN()
<span class='line'>2202</span>         .time()
<span class='line'>2203</span>         .timeLine()
<span class='line'>2204</span>         .toString()
<span class='line'>2205</span> 
<span class='line'>2206</span>     XpsTrackCollection
<span class='line'>2207</span>         .parentXps
<span class='line'>2208</span>         .jobIndex
<span class='line'>2209</span>         .length
<span class='line'>2210</span>         .duration
<span class='line'>2211</span>         .noteText
<span class='line'>2212</span> 
<span class='line'>2213</span>         .addSection()
<span class='line'>2214</span>         .duplicate()
<span class='line'>2215</span>         .getDuration()
<span class='line'>2216</span>         .insertTrack()
<span class='line'>2217</span>         .parseSoundTrack()?間違いなので削除
<span class='line'>2218</span>         .renumber()
<span class='line'>2219</span>         
<span class='line'>2220</span>     XpsTimelineTrack (track-collection member)
<span class='line'>2221</span>         .index
<span class='line'>2222</span>         .xParent
<span class='line'>2223</span>         .length
<span class='line'>2224</span>         .duration
<span class='line'>2225</span>         .id
<span class='line'>2226</span>         .option
<span class='line'>2227</span>         .sizeX
<span class='line'>2228</span>         .sizeY
<span class='line'>2229</span>         .aspect
<span class='line'>2230</span>         .lot
<span class='line'>2231</span>         .blmtd
<span class='line'>2232</span>         .blpos
<span class='line'>2233</span>         .link
<span class='line'>2234</span>         .parent
<span class='line'>2235</span>         .sections   (XpsTimelineSectionCollection)
<span class='line'>2236</span> 
<span class='line'>2237</span>         .getDefaultValue()
<span class='line'>2238</span>         .duplicate()
<span class='line'>2239</span>         .parseTm()          test
<span class='line'>2240</span>         .parseSoudTrack()   test
<span class='line'>2241</span> 
<span class='line'>2242</span>     XpsTimelineSectionCollection    セクションキャリア(配列ベース)
<span class='line'>2243</span>         .parent 親セクション又はトラック
<span class='line'>2244</span> 
<span class='line'>2245</span>         .addSection()   値を置いてセクションを追加する
<span class='line'>2246</span>         .getDuration()  セクションの値を合計して継続時間をフレーム数で戻す
<span class='line'>2247</span>         
<span class='line'>2248</span>     XpsTimelineSction   セクションメンバ
<span class='line'>2249</span>         .id             セクションの現行index  ==parent.sections[id]
<span class='line'>2250</span>         .parent         タイムライントラック  
<span class='line'>2251</span>         .duration       継続時間（フレーム数）
<span class='line'>2252</span>         .value          .this.mapElement.value  または同等の値オブジェクト
<span class='line'>2253</span>         .mapElement     nas.xMapElement  値へは.value経由でアクセスする
<span class='line'>2254</span>         .subSections    
<span class='line'>2255</span> 
<span class='line'>2256</span> 
<span class='line'>2257</span>     nas.xMapElemnet
<span class='line'>2258</span>         .id uniq-index/int
<span class='line'>2259</span>         .parent xMapGroup
<span class='line'>2260</span>         .link   PmJob
<span class='line'>2261</span>         .type   parent.type / erement-type
<span class='line'>2262</span>         .name   element label
<span class='line'>2263</span>         .content    タイプごとの値オブジェクト
<span class='line'>2264</span>         .comment    申し送りコメント
<span class='line'>2265</span> 
<span class='line'>2266</span>  */</span><span class="WHIT">
<span class='line'>2267</span> 
<span class='line'>2268</span> </span><span class="COMM">/**
<span class='line'>2269</span> 	複合形式記述群をパース
<span class='line'>2270</span> 	各値は、順不同ですべて基本的に単位ポストフィックス付きの文字列（推奨｜優先）とする
<span class='line'>2271</span> 	単位ポストフィックスなしの数値はUnitValue（pt）として扱う
<span class='line'>2272</span> 長さ
<span class='line'>2273</span> 	10mm,123.5cm,in,pt,q,ft....
<span class='line'>2274</span> 角度
<span class='line'>2275</span> 	1.13rad,176d
<span class='line'>2276</span> 解像度
<span class='line'>2277</span> 	144dpi,38dpc
<span class='line'>2278</span> 強度
<span class='line'>2279</span> 	120%
<span class='line'>2280</span> フレーム指定
<span class='line'>2281</span> 	120F,96fr
<span class='line'>2282</span> フィールド指定
<span class='line'>2283</span> 	12FLD3N1S12C
<span class='line'>2284</span> 	
<span class='line'>2285</span> unitValueは値の出現順に width,height,offset.X,offset.Y として解釈される
<span class='line'>2286</span> 	V
<span class='line'>2287</span> 		width	
<span class='line'>2288</span> 	V,V
<span class='line'>2289</span> 		width,height
<span class='line'>2290</span> 	V,V,V
<span class='line'>2291</span> 		width,height,X
<span class='line'>2292</span> 	V,V,V,V
<span class='line'>2293</span> 		width,height,X,Y
<span class='line'>2294</span> Replacement
<span class='line'>2295</span> 	source,[size.x,size.y,offset.x,offset.y,offset.r,resolution(X=Y)]
<span class='line'>2296</span> Geometry
<span class='line'>2297</span> 	source,[size.x,size.y,offset.x,offset.y,offset.r,scaleField||scale]
<span class='line'>2298</span> 	source,inchField
<span class='line'>2299</span> 	ジオメトリにインチフィールドが指定された場合は、他の指定は無視される
<span class='line'>2300</span> Composite
<span class='line'>2301</span> 	source,strength
<span class='line'>2302</span> 	コンポジットの指定はstrengthのみが有効 最初のnumeric|percentを使用
<span class='line'>2303</span> */</span><span class="WHIT">
<span class='line'>2304</span> </span><span class="NAME">nas.parseDataChank</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dataChank</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2305</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">dataChank</span><span class="PUNC">==</span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">dataChank</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2306</span> </span><span class="WHIT">	</span><span class="NAME">dataChank</span><span class="PUNC">=</span><span class="NAME">csvSimple.parse</span><span class="PUNC">(</span><span class="NAME">dataChank</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2307</span> </span><span class="COMM">//console.log(dataChank);</span><span class="WHIT">
<span class='line'>2308</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dataForms</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2309</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dix</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">dix</span><span class="PUNC">&lt;</span><span class="NAME">dataChank.length</span><span class="PUNC">;</span><span class="NAME">dix</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2310</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dataType</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="STRN">'source'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2311</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">target</span><span class="PUNC">=</span><span class="NAME">dataChank</span><span class="PUNC">[</span><span class="NAME">dix</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>2312</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">target.match</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="REGX">/^[+-]?\d+\.?\d*$/</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2313</span> </span><span class="WHIT">			</span><span class="NAME">dataType</span><span class="PUNC">=</span><span class="STRN">'numeric'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2314</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nas.BlendingMode</span><span class="PUNC">[</span><span class="NAME">target</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2315</span> </span><span class="WHIT">			</span><span class="NAME">dataType</span><span class="PUNC">=</span><span class="STRN">'blendingMode'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2316</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">target.match</span><span class="PUNC">(</span><span class="REGX">/^(\d+\.?\d*FLD)(\d+[NS])?(\d+[EW])?(\d+\.?\d*[CA]?)?$/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2317</span> </span><span class="WHIT">			</span><span class="NAME">dataType</span><span class="PUNC">=</span><span class="STRN">'inchField'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2318</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">target.match</span><span class="PUNC">(</span><span class="REGX">/^(\d+\.?\d*)(FR?L?)$/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2319</span> </span><span class="WHIT">			</span><span class="NAME">dataType</span><span class="PUNC">=</span><span class="STRN">'scaleField'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2320</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">target.match</span><span class="PUNC">(</span><span class="REGX">/^[+-]?\d+\.?\d*(\D+)$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2321</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">unitString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2322</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">unitString.match</span><span class="PUNC">(</span><span class="NAME">nas.UNITRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">dataType</span><span class="PUNC">=</span><span class="STRN">'unitValue'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2323</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">unitString.match</span><span class="PUNC">(</span><span class="REGX">/rad|d|degrees|°/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">dataType</span><span class="PUNC">=</span><span class="STRN">'unitAngle'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2324</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">unitString.match</span><span class="PUNC">(</span><span class="REGX">/dpi|dpc|ppi|ppc|lpi|lpc/i</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">dataType</span><span class="PUNC">=</span><span class="STRN">'unitResolutions'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2325</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">unitString</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'%'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">dataType</span><span class="PUNC">=</span><span class="STRN">'percent'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2326</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2327</span> </span><span class="WHIT">		</span><span class="NAME">dataForms.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">:</span><span class="NAME">dataType</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">:</span><span class="NAME">dataChank</span><span class="PUNC">[</span><span class="NAME">dix</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2328</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2329</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">dataForms</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2330</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2331</span> </span><span class="COMM">/*TEST
<span class='line'>2332</span> nas.parseDataChank('"files",12FLD2S3W12C,120dpi');
<span class='line'>2333</span> */</span><span class="WHIT">
<span class='line'>2334</span> 
<span class='line'>2335</span> </span><span class="NAME">nas.parseField</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">parseField</span><span class="PUNC">(</span><span class="NAME">FieldString</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2336</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">FieldString.match</span><span class="PUNC">(</span><span class="REGX">/^(\d+\.?\d*FLD)(\d+[NS])?(\d+[EW])?(\d+\.?\d*[CA]?)?$/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2337</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2338</span> </span><span class="WHIT">			</span><span class="NAME">FRM</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">RegExp.$1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2339</span> </span><span class="WHIT">			</span><span class="NAME">LEF</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">RegExp.$2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2340</span> </span><span class="WHIT">			</span><span class="NAME">TOP</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">RegExp.$3</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2341</span> </span><span class="WHIT">			</span><span class="NAME">ROT</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">RegExp.$4</span><span class="WHIT">
<span class='line'>2342</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2343</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2344</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2345</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2346</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2347</span> </span><span class="COMM">/*TEST
<span class='line'>2348</span> nas.parseField('12FLD3n12');
<span class='line'>2349</span> nas.parseField('120F');
<span class='line'>2350</span> 
<span class='line'>2351</span> */</span><span class="WHIT">
<span class='line'>2352</span> </span><span class="NAME">nas.parseFrame</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">parseFrame</span><span class="PUNC">(</span><span class="NAME">FrameString</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2353</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">FrameString.match</span><span class="PUNC">(</span><span class="REGX">/^(\d+\.?\d*)(FR?L?)$/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2354</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2355</span> </span><span class="WHIT">			</span><span class="NAME">TYP</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">RegExp.$2</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">'FR'</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"fr"</span><span class="PUNC">:</span><span class="STRN">"fl"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2356</span> </span><span class="WHIT">			</span><span class="NAME">VLU</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">RegExp.$1</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2357</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2358</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2359</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2360</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2361</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2362</span> </span><span class="COMM">/*TEST
<span class='line'>2363</span> nas.parseFrame('12FLD3n12');
<span class='line'>2364</span> nas.parseFrame('120F');
<span class='line'>2365</span> 
<span class='line'>2366</span> */</span><span class="WHIT">
<span class='line'>2367</span> 
<span class='line'>2368</span> 
<span class='line'>2369</span> 
<span class='line'>2370</span> </span><span class="COMM">/**
<span class='line'>2371</span>  *    @desc nas Object base property
<span class='line'>2372</span>  */</span><span class="WHIT">
<span class='line'>2373</span> </span><span class="COMM">/**
<span class='line'>2374</span>  * カレントユーザ文字列
<span class='line'>2375</span>  * ここで参照して、以降はグローバルを使用しないようにする2011/08/17
<span class='line'>2376</span>  */</span><span class="WHIT">
<span class='line'>2377</span> </span><span class="NAME">nas.CURRENTUSER</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2378</span> </span><span class="COMM">/**
<span class='line'>2379</span>  * 時間関連設定
<span class='line'>2380</span>  * @type {number}
<span class='line'>2381</span>  */</span><span class="WHIT">
<span class='line'>2382</span> </span><span class="NAME">nas.ccrate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1000</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="COMM">//最少計測単位(javascriptではミリ秒固定)</span><span class="WHIT">
<span class='line'>2383</span> </span><span class="NAME">nas.MODE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"clock"</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="COMM">//表示の初期モード(時計) ストップウオッチ用共用変数</span><span class="WHIT">
<span class='line'>2384</span> </span><span class="NAME">nas.ClockOption</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="COMM">//時計の初期モード (12時制) ストップウオッチ用共用変数</span><span class="WHIT">
<span class='line'>2385</span> </span><span class="NAME">nas.STATUS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"stop"</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="COMM">// ウオッチ用共用変数</span><span class="WHIT">
<span class='line'>2386</span> </span><span class="COMM">/**
<span class='line'>2387</span>  * フレームレート    ここの並びでループする 100fps 24FPS 30NDF 30DF 25FPS
<span class='line'>2388</span>  * @type {string[]}
<span class='line'>2389</span>  */</span><span class="WHIT">
<span class='line'>2390</span> </span><span class="NAME">nas.RATEs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">'100fps'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'24FPS'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'23.976FPS'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'30NDF'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'30DF'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'25FPS'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'48FPS'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2391</span> </span><span class="NAME">nas.RATE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'24FPS'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2392</span> 
<span class='line'>2393</span> </span><span class="COMM">//基準変数</span><span class="WHIT">
<span class='line'>2394</span> </span><span class="COMM">//名前付け規則は、以下に準ずる</span><span class="WHIT">
<span class='line'>2395</span> </span><span class="COMM">//スクリプト上の変数名は、大文字のみ</span><span class="WHIT">
<span class='line'>2396</span> </span><span class="COMM">//フォーム上の同名のエレメントは 小文字で綴り初めて 大文字で綴り終わる記法で</span><span class="WHIT">
<span class='line'>2397</span> </span><span class="COMM">//複合単語は、前置語を小文字、後置語を大文字</span><span class="WHIT">
<span class='line'>2398</span> 
<span class='line'>2399</span> </span><span class="COMM">/**
<span class='line'>2400</span>  * サンプル基準値
<span class='line'>2401</span>  * サンプルフレームレート(フレーム継続時間に置き換えるか一考)
<span class='line'>2402</span>  * @type {number}
<span class='line'>2403</span>  */</span><span class="WHIT">
<span class='line'>2404</span> </span><span class="COMM">// nas.FRATE = 24;</span><span class="WHIT">
<span class='line'>2405</span> </span><span class="NAME">nas.FRATE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.newFramerate</span><span class="PUNC">(</span><span class="NAME">nas.RATE</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2406</span> </span><span class="COMM">/**
<span class='line'>2407</span>  * サンプル解像度ppc(dpc)
<span class='line'>2408</span>  * @type {number}
<span class='line'>2409</span>  */</span><span class="WHIT">
<span class='line'>2410</span> </span><span class="COMM">//nas.RESOLUTION = 144. / 2.540;//dpc</span><span class="WHIT">
<span class='line'>2411</span> </span><span class="NAME">nas.RESOLUTION</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitResolution</span><span class="PUNC">(</span><span class="STRN">"144dpi"</span><span class="PUNC">,</span><span class="STRN">'dpc'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//nas関数が変動ユニットに未対応なので現在は'dpc'を指定のこと2019.01</span><span class="WHIT">
<span class='line'>2412</span> </span><span class="COMM">/**
<span class='line'>2413</span>  * サンプル基準寸法(mm)
<span class='line'>2414</span>  * @type {number}
<span class='line'>2415</span>  */</span><span class="WHIT">
<span class='line'>2416</span> </span><span class="NAME">nas.LENGTH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">225.</span><span class="PUNC">;</span><span class="COMM">//nas.LENGTH = new nas.UnitValue("254mm") ;//フレーム基準寸法(横幅)</span><span class="WHIT">
<span class='line'>2417</span> </span><span class="COMM">/**
<span class='line'>2418</span>  * フレームアスペクト（参考値 横／縦）
<span class='line'>2419</span>  * @type {number}
<span class='line'>2420</span>  */</span><span class="WHIT">
<span class='line'>2421</span> </span><span class="NAME">nas.ASPECT</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">16</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">9</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2422</span> </span><span class="COMM">/**
<span class='line'>2423</span>  * ピクセルアスペクト（参考値 横／縦）
<span class='line'>2424</span>  * @type {number}
<span class='line'>2425</span>  */</span><span class="WHIT">
<span class='line'>2426</span> </span><span class="NAME">nas.PIXELASPECT</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2427</span> </span><span class="COMM">/**
<span class='line'>2428</span>  * サンプル基準フレーム(fl)
<span class='line'>2429</span>  * @type {number}
<span class='line'>2430</span>  */</span><span class="WHIT">
<span class='line'>2431</span> </span><span class="NAME">nas.FRAME_L</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2432</span> 
<span class='line'>2433</span> </span><span class="COMM">/**
<span class='line'>2434</span>  * FCTインターフェース関連
<span class='line'>2435</span>  * タイムシート継続時間 秒/枚
<span class='line'>2436</span>  */</span><span class="WHIT">
<span class='line'>2437</span> </span><span class="NAME">nas.SheetLength</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SheetLength</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2438</span> 
<span class='line'>2439</span> </span><span class="COMM">/**
<span class='line'>2440</span>  * @desc FCTインターフェースをドロップフレーム対応とする
<span class='line'>2441</span>  *
<span class='line'>2442</span>  * 基本的なドロップメソッドはカウント母数を Math.ceil(nas.FRATE)として
<span class='line'>2443</span>  * 誤差が蓄積次第秒の末尾フレームをドロップカウントする事で行う。
<span class='line'>2444</span>  * nas.SheetLengthは実際の消化フレームととらえると枚数ごとの不定値となるので
<span class='line'>2445</span>  * 秒数で置いて一定値を得ることにする(仕様変更)
<span class='line'>2446</span>  */</span><span class="WHIT">
<span class='line'>2447</span> 
<span class='line'>2448</span> 
<span class='line'>2449</span> </span><span class="COMM">/**
<span class='line'>2450</span>  * fl : Fields アニメーション撮影フレーム(traditional)
<span class='line'>2451</span>  * 基準値は計算レタスフレームを基準にしたほうが計算回数がいくらか減りそう?
<span class='line'>2452</span>  * @type {number}
<span class='line'>2453</span>  */</span><span class="WHIT">
<span class='line'>2454</span> </span><span class="NAME">nas.SCALE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="COMM">//サンプル拡大比率(実数)</span><span class="WHIT">
<span class='line'>2455</span> 
<span class='line'>2456</span> </span><span class="COMM">/**
<span class='line'>2457</span>  * @desc for AEkey
<span class='line'>2458</span>  */</span><span class="WHIT">
<span class='line'>2459</span> 
<span class='line'>2460</span> </span><span class="COMM">/**
<span class='line'>2461</span>  * @desc コンポ情報
<span class='line'>2462</span>  * 計算に必要な情報は、コンポを切り換えるタイミングで再初期化する?
<span class='line'>2463</span>  * または、手動で初期化トリガを打つか?
<span class='line'>2464</span>  */</span><span class="WHIT">
<span class='line'>2465</span> 
<span class='line'>2466</span> </span><span class="COMM">/**
<span class='line'>2467</span>  * コンポジション３Ｄカメラ情報 > オブジェクト化すること
<span class='line'>2468</span>  * @type {number}
<span class='line'>2469</span>  */</span><span class="WHIT">
<span class='line'>2470</span> </span><span class="NAME">nas.FOCUS_D</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">50</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//レンズ焦点距離 (mm)</span><span class="WHIT">
<span class='line'>2471</span> </span><span class="NAME">nas.FILM_W</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">36</span><span class="PUNC">;</span><span class="COMM">//FILM Width (mm)</span><span class="WHIT">
<span class='line'>2472</span> </span><span class="NAME">nas.FILM_H</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">24</span><span class="PUNC">;</span><span class="COMM">//FILM Height(mm)</span><span class="WHIT">
<span class='line'>2473</span> </span><span class="COMM">/**
<span class='line'>2474</span>  * イメージサークル直径(mm)
<span class='line'>2475</span>  * @returns {number}
<span class='line'>2476</span>  * @constructor
<span class='line'>2477</span>  */</span><span class="WHIT">
<span class='line'>2478</span> </span><span class="NAME">nas.IMAGE_CR</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2479</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">this.FILM_W</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">this.FILM_H</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2480</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2481</span> 
<span class='line'>2482</span> 
<span class='line'>2483</span> </span><span class="COMM">/**
<span class='line'>2484</span>  * コンポジション設定 > オブジェクト化すること
<span class='line'>2485</span>  * @type {number}
<span class='line'>2486</span>  */</span><span class="WHIT">
<span class='line'>2487</span> </span><span class="NAME">nas.COMP_W</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">720</span><span class="PUNC">;</span><span class="COMM">//comp Width (px);</span><span class="WHIT">
<span class='line'>2488</span> </span><span class="NAME">nas.COMP_H</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">486</span><span class="PUNC">;</span><span class="COMM">//comp Height(px);</span><span class="WHIT">
<span class='line'>2489</span> </span><span class="NAME">nas.COMP_A</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.9</span><span class="PUNC">;</span><span class="COMM">//comp Aspect(W/H);</span><span class="WHIT">
<span class='line'>2490</span> 
<span class='line'>2491</span> </span><span class="COMM">/**
<span class='line'>2492</span>  * @returns {number}
<span class='line'>2493</span>  */</span><span class="WHIT">
<span class='line'>2494</span> </span><span class="NAME">nas.COMP_D</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2495</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">this.COMP_W</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">this.COMP_A</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">this.COMP_H</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2496</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2497</span> 
<span class='line'>2498</span> </span><span class="COMM">/**
<span class='line'>2499</span>  * @returns {number}
<span class='line'>2500</span>  */</span><span class="WHIT">
<span class='line'>2501</span> </span><span class="NAME">nas.CAMERA_D</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2502</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.COMP_D</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">this.FOCUS_D</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">this.IMAGE_CR</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2503</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2504</span> 
<span class='line'>2505</span> 
<span class='line'>2506</span> </span><span class="COMM">/**
<span class='line'>2507</span>  * レイヤ・フッテージ設定
<span class='line'>2508</span>  * 今のところキーに添付するだけの値(変換には無関係)
<span class='line'>2509</span>  * @type {number}
<span class='line'>2510</span>  */</span><span class="WHIT">
<span class='line'>2511</span> </span><span class="NAME">nas.SRC_W</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">720</span><span class="PUNC">;</span><span class="COMM">//source Width (px);</span><span class="WHIT">
<span class='line'>2512</span> </span><span class="NAME">nas.SRC_H</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">486</span><span class="PUNC">;</span><span class="COMM">//source Height(px);</span><span class="WHIT">
<span class='line'>2513</span> </span><span class="NAME">nas.SRC_A</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.9</span><span class="PUNC">;</span><span class="COMM">//source Aspect(W/H);</span><span class="WHIT">
<span class='line'>2514</span> </span><span class="COMM">/**
<span class='line'>2515</span>  * AE-Key data 出力関連の変数(初期値)
<span class='line'>2516</span>  * @type {string}
<span class='line'>2517</span>  */</span><span class="WHIT">
<span class='line'>2518</span> </span><span class="NAME">nas.AE_Ver</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"8.0"</span><span class="PUNC">;</span><span class="COMM">// 4.0/5.0/6.0/6.5/7.0/8.0 AE CS3</span><span class="WHIT">
<span class='line'>2519</span> </span><span class="NAME">nas.KEY_STYLE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"withTime"</span><span class="PUNC">;</span><span class="COMM">//or "valueOnly"</span><span class="WHIT">
<span class='line'>2520</span> </span><span class="NAME">nas.KEY_TYPE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Scale"</span><span class="PUNC">;</span><span class="COMM">// or "Position"</span><span class="WHIT">
<span class='line'>2521</span> 
<span class='line'>2522</span> </span><span class="COMM">/**
<span class='line'>2523</span>  * @desc 子変数 親変数から導かれる表示データ(または派生データ)
<span class='line'>2524</span>  * 変数名は、大文字ではじまり 後ろは小文字のみ
<span class='line'>2525</span>  * フォーム上の同名のinputは極力大文字のみで表記
<span class='line'>2526</span>  */</span><span class="WHIT">
<span class='line'>2527</span> 
<span class='line'>2528</span> </span><span class="COMM">/**
<span class='line'>2529</span>  * Resolution objectを作成してそちらへ移行
<span class='line'>2530</span>  *
<span class='line'>2531</span>  * nas.Resolution
<span class='line'>2532</span>  * nas.Resolution.dpc
<span class='line'>2533</span>  * nas.Resolution.dpi
<span class='line'>2534</span>  */</span><span class="WHIT">
<span class='line'>2535</span> 
<span class='line'>2536</span> </span><span class="COMM">/**
<span class='line'>2537</span>  * RESOLUTION 派生変数 ラムダ関数試験
<span class='line'>2538</span>  * @returns {number}
<span class='line'>2539</span>  */</span><span class="WHIT">
<span class='line'>2540</span> </span><span class="NAME">nas.Dpi</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2541</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.RESOLUTION</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2.540</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2542</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2543</span> </span><span class="COMM">//	nas.Dpi = function(){return this.RESOLUTION.as('dpi');} ;</span><span class="WHIT">
<span class='line'>2544</span> </span><span class="COMM">/**
<span class='line'>2545</span>  *
<span class='line'>2546</span>  * @returns {number|*}
<span class='line'>2547</span>  * @constructor
<span class='line'>2548</span>  */</span><span class="WHIT">
<span class='line'>2549</span> </span><span class="NAME">nas.Dpc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2550</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.RESOLUTION</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2551</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2552</span> </span><span class="COMM">//	nas.Dpc = function(){return this.RESOLUTION.as('dpc');} ;</span><span class="WHIT">
<span class='line'>2553</span> 
<span class='line'>2554</span> </span><span class="COMM">/**
<span class='line'>2555</span>  * nas.ClipingFrame objectを作成してそちらへ移行
<span class='line'>2556</span>  * nas.ClipingFrame.size    :nas.Geometry
<span class='line'>2557</span>  * nas.ClipingFrame.height
<span class='line'>2558</span>  * nas.ClipingFrame.scale
<span class='line'>2559</span>  * nas.ClipingFrame.offset
<span class='line'>2560</span>  * nas.ClipingFrame.rotation
<span class='line'>2561</span>  * nas.ClipingFrame.traditionalFrames
<span class='line'>2562</span>  * nas.ClipingFrame.retasFrames
<span class='line'>2563</span>  * nas.ProductSpeckに統合？
<span class='line'>2564</span>  */</span><span class="WHIT">
<span class='line'>2565</span> 
<span class='line'>2566</span> </span><span class="COMM">/**
<span class='line'>2567</span>  * FRAME_L 派生変数
<span class='line'>2568</span>  * nas.FRAMEl = function () {
<span class='line'>2569</span>  *            this.FRAME_L;
<span class='line'>2570</span>  *        };
<span class='line'>2571</span>  * nas.FRAMEr = function () {
<span class='line'>2572</span>  *            this.fl2fr(this.FRAME_L);
<span class='line'>2573</span>  *        };
<span class='line'>2574</span>  * ここまではプロパティ
<span class='line'>2575</span>  */</span><span class="WHIT">
<span class='line'>2576</span> 
<span class='line'>2577</span> </span><span class="COMM">/**
<span class='line'>2578</span>  * DateオブジェクトにtoNASString形式処理を乗せる
<span class='line'>2579</span>  * @returns {string}
<span class='line'>2580</span>  */</span><span class="WHIT">
<span class='line'>2581</span> </span><span class="NAME">Date.prototype.toNASString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2582</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getHours</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2583</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getMinutes</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2584</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getSeconds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2585</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">yy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getFullYear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2586</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mm</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getMonth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2587</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2588</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">yy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"/"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">mm</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"/"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dd</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\ "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\:"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\:"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2589</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Result</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2590</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2591</span> 
<span class='line'>2592</span> </span><span class="COMM">/**
<span class='line'>2593</span>  * @param nasString
<span class='line'>2594</span>  * @returns {Date}
<span class='line'>2595</span>  */</span><span class="WHIT">
<span class='line'>2596</span> </span><span class="NAME">Date.prototype.setNASString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nasString</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2597</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">yy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nasString.split</span><span class="PUNC">(</span><span class="STRN">"\ "</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">"/"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2598</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mm</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nasString.split</span><span class="PUNC">(</span><span class="STRN">"\ "</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">"/"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2599</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nasString.split</span><span class="PUNC">(</span><span class="STRN">"\ "</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">"/"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2600</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nasString.split</span><span class="PUNC">(</span><span class="STRN">"\ "</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2601</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nasString.split</span><span class="PUNC">(</span><span class="STRN">"\ "</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2602</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nasString.split</span><span class="PUNC">(</span><span class="STRN">"\ "</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2603</span> </span><span class="WHIT">    </span><span class="NAME">this.setYear</span><span class="PUNC">(</span><span class="NAME">yy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2604</span> </span><span class="WHIT">    </span><span class="NAME">this.setMonth</span><span class="PUNC">(</span><span class="NAME">mm</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2605</span> </span><span class="WHIT">    </span><span class="NAME">this.setDate</span><span class="PUNC">(</span><span class="NAME">dd</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2606</span> </span><span class="WHIT">    </span><span class="NAME">this.setHours</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2607</span> </span><span class="WHIT">    </span><span class="NAME">this.setMinutes</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2608</span> </span><span class="WHIT">    </span><span class="NAME">this.setSeconds</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2609</span> 
<span class='line'>2610</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2611</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2612</span> </span><span class="COMM">/*
<span class='line'>2613</span>  String.camelize()
<span class='line'>2614</span>  */</span><span class="WHIT">
<span class='line'>2615</span> 
<span class='line'>2616</span> </span><span class="COMM">/**
<span class='line'>2617</span>  * @returns {string}
<span class='line'>2618</span>  */</span><span class="WHIT">
<span class='line'>2619</span> </span><span class="NAME">String.prototype.camelize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2620</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.replace</span><span class="PUNC">(</span><span class="REGX">/(?:[-_])(\w)/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2621</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">c.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2622</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2623</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2624</span> 
<span class='line'>2625</span> </span><span class="COMM">/**
<span class='line'>2626</span>  * z距離>比率換算&lt;br />
<span class='line'>2627</span>  * &lt;br/>
<span class='line'>2628</span>  * 比率1(100%)を距離0に置いた場合の 任意のレイヤプロパティｚ軸値(AE互換)から比率
<span class='line'>2629</span>  * を求める関数
<span class='line'>2630</span>  *  nas.CAMARA_Dプロパティに依存
<span class='line'>2631</span>  *
<span class='line'>2632</span>  * @param {Number} dt 距離(pixel)
<span class='line'>2633</span>  * @returns {number} z軸位置に相当する拡縮比率
<span class='line'>2634</span>  */</span><span class="WHIT">
<span class='line'>2635</span> </span><span class="NAME">nas.dt2sc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2636</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.CAMERA_D</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">dt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.CAMERA_D</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2637</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2638</span> </span><span class="COMM">/**
<span class='line'>2639</span>  * 比率>z距離換算&lt;br />
<span class='line'>2640</span>  * &lt;br />
<span class='line'>2641</span>  * 比率1(100%)を距離0に置いた場合の 任意の比率となるレイヤプロパティｚ軸値
<span class='line'>2642</span>  * （AE互換）を求める関数
<span class='line'>2643</span>  *  nas.CAMARA_Dプロパティに依存
<span class='line'>2644</span>  * @param {Number} sc 拡縮比率
<span class='line'>2645</span>  * @returns {Number} 比率に相当するAEのZ軸位置(pixel)
<span class='line'>2646</span>  */</span><span class="WHIT">
<span class='line'>2647</span> </span><span class="NAME">nas.sc2dt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2648</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.CAMERA_D</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">sc</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.CAMERA_D</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2649</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2650</span> 
<span class='line'>2651</span> </span><span class="COMM">/**
<span class='line'>2652</span>  * @desc フレーム関連換算関数
<span class='line'>2653</span>  * 一々書いても間違えそうなのでまとめておく。
<span class='line'>2654</span>  *
<span class='line'>2655</span>  * fl は、旧来のアニメーション撮影フレーム（field）・スタンダード値100：比例値
<span class='line'>2656</span>  * fr は、レタス撮影フレーム(要検証)・同スタンダード値100：比例値
<span class='line'>2657</span>  * sc は、倍率
<span class='line'>2658</span>  * FRAME_Lは、基礎情報として基準フレーム数をfl値で与えること
<span class='line'>2659</span>  *
<span class='line'>2660</span>  * @param fl
<span class='line'>2661</span>  * @returns {number}
<span class='line'>2662</span>  */</span><span class="WHIT">
<span class='line'>2663</span> </span><span class="NAME">nas.fl2fr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fl</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2664</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">fl</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">60</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">1.60</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2665</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2666</span> </span><span class="COMM">/**
<span class='line'>2667</span>  * @param fr
<span class='line'>2668</span>  * @returns {number}
<span class='line'>2669</span>  */</span><span class="WHIT">
<span class='line'>2670</span> </span><span class="NAME">nas.fr2fl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2671</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">fr</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1.60</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">60</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2672</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2673</span> 
<span class='line'>2674</span> </span><span class="COMM">/**
<span class='line'>2675</span>  * @param fl
<span class='line'>2676</span>  * @returns {number}
<span class='line'>2677</span>  */</span><span class="WHIT">
<span class='line'>2678</span> </span><span class="NAME">nas.fl2sc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fl</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2679</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NUMB">160</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.FRAME_L</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">60</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">160</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">fl</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">60</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2680</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2681</span> </span><span class="COMM">/**
<span class='line'>2682</span>  * @param fr
<span class='line'>2683</span>  * @returns {number}
<span class='line'>2684</span>  */</span><span class="WHIT">
<span class='line'>2685</span> </span><span class="NAME">nas.fr2sc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2686</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.fl2sc</span><span class="PUNC">(</span><span class="NAME">this.fr2fl</span><span class="PUNC">(</span><span class="NAME">fr</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2687</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2688</span> </span><span class="COMM">/**
<span class='line'>2689</span>  * @param sc
<span class='line'>2690</span>  * @returns {number}
<span class='line'>2691</span>  */</span><span class="WHIT">
<span class='line'>2692</span> </span><span class="NAME">nas.sc2fl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2693</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NUMB">160</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.FRAME_L</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">60</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sc</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">160</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">60</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2694</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2695</span> </span><span class="COMM">/**
<span class='line'>2696</span>  * @param sc
<span class='line'>2697</span>  * @returns {number}
<span class='line'>2698</span>  */</span><span class="WHIT">
<span class='line'>2699</span> </span><span class="NAME">nas.sc2fr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2700</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.fl2fr</span><span class="PUNC">(</span><span class="NAME">this.sc2fl</span><span class="PUNC">(</span><span class="NAME">sc</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2701</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2702</span> 
<span class='line'>2703</span> </span><span class="COMM">/**
<span class='line'>2704</span>  * 拡大率変換関数
<span class='line'>2705</span>  * kac(基準量,目標量,助変数)
<span class='line'>2706</span>  * 戻り値は 序変数に対応する寸法
<span class='line'>2707</span>  *
<span class='line'>2708</span>  * @param StartSize
<span class='line'>2709</span>  * @param EndSize
<span class='line'>2710</span>  * @param timingValue
<span class='line'>2711</span>  * @returns {*}
<span class='line'>2712</span>  */</span><span class="WHIT">
<span class='line'>2713</span> </span><span class="NAME">nas.kac</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">StartSize</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">EndSize</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timingValue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2714</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">timingValue</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">timingValue</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2715</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">timingValue</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2716</span> </span><span class="WHIT">            </span><span class="NAME">resultS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">StartSize</span><span class="WHIT">
<span class='line'>2717</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2718</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">timingValue</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2719</span> </span><span class="WHIT">            </span><span class="NAME">resultS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">EndSize</span><span class="WHIT">
<span class='line'>2720</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2721</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2722</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>2723</span>          * 求める寸法は
<span class='line'>2724</span>          *
<span class='line'>2725</span>          * まず開始寸法を1として終了寸法の開始寸法に対する比率を求める
<span class='line'>2726</span>          * EndSize/StartSize
<span class='line'>2727</span>          * 距離評価係数として 比の逆数を開始点と終了点で求める。
<span class='line'>2728</span>          * 開始点距離評価係数 1/1 = 1
<span class='line'>2729</span>          * 終了点距離評価係数 1/(EndSize/StartSize) = StartSize/EndSize
<span class='line'>2730</span>          *
<span class='line'>2731</span>          * 与えられた助変数に対応する距離評価係数を求める。
<span class='line'>2732</span>          * ((終了点距離評価係数 - 開始点距離評価係数) * 序変数) + 開始点距離評価係数
<span class='line'>2733</span>          * = (((StartSize/EndSize) - 1) * timingValue) + 1
<span class='line'>2734</span>          * 評価係数の逆数をとって比率を得る
<span class='line'>2735</span>          * 比率を開始寸法に掛ける
<span class='line'>2736</span>          * 開始寸法 * 距離評価係数
<span class='line'>2737</span>          * = StartSize / ((((Startsize/EndSize) - 1) * timingValue) + 1)
<span class='line'>2738</span>          */</span><span class="WHIT">
<span class='line'>2739</span> </span><span class="COMM">//	resultS = (1-(timingValue)*(1-(StartSize/EndSize)));</span><span class="WHIT">
<span class='line'>2740</span> </span><span class="WHIT">        </span><span class="NAME">resultS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">StartSize</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">StartSize</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">EndSize</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">timingValue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2741</span> 
<span class='line'>2742</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2743</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">resultS</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2744</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2745</span> 
<span class='line'>2746</span> </span><span class="COMM">/**
<span class='line'>2747</span>  * kacの逆関数
<span class='line'>2748</span>  * cak(基準量,目標量,任意寸法)
<span class='line'>2749</span>  * 戻り値は助変数を最大精度で
<span class='line'>2750</span>  *
<span class='line'>2751</span>  * @param StartSize
<span class='line'>2752</span>  * @param EndSize
<span class='line'>2753</span>  * @param TargetSize
<span class='line'>2754</span>  * @returns {number}
<span class='line'>2755</span>  */</span><span class="WHIT">
<span class='line'>2756</span> </span><span class="NAME">nas.cak</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">StartSize</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">EndSize</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">TargetSize</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2757</span> </span><span class="WHIT">    </span><span class="COMM">/*
<span class='line'>2758</span>      まだ書いてないよ('o')
<span class='line'>2759</span>      */</span><span class="WHIT">
<span class='line'>2760</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resultT</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2761</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">TargetSize</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">StartSize</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2762</span> </span><span class="WHIT">        </span><span class="NAME">resultT</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>2763</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2764</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">TargetSize</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">EndSize</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2765</span> </span><span class="WHIT">            </span><span class="NAME">resultT</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT">
<span class='line'>2766</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2767</span> </span><span class="WHIT">            </span><span class="NAME">resultT</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">TargetSize</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">StartSize</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">EndSize</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">StartSize</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2768</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2769</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2770</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">resultT</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2771</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2772</span> 
<span class='line'>2773</span> 
<span class='line'>2774</span> </span><span class="COMM">/**
<span class='line'>2775</span>  * ゼロ埋め ZERROfilling
<span class='line'>2776</span>  * @param N
<span class='line'>2777</span>  * @param f
<span class='line'>2778</span>  * @returns {string}
<span class='line'>2779</span>  * @constructor
<span class='line'>2780</span> 数値を指定桁数の０で埋めて桁合わせして戻す
<span class='line'>2781</span> 数値以外の文字が胡内されていたばあい、文字列は捨てられる
<span class='line'>2782</span> 指定桁数がない場合は引数をそのまま戻す
<span class='line'>2783</span> 指定桁数が引数の桁よりも少ない場合は何も操作されない
<span class='line'>2784</span> 数値が小数部を含む場合は、整数部を指定桁数に揃える
<span class='line'>2785</span> 数字以外の文字が前置されていた場合はNaNを戻す
<span class='line'>2786</span> 今回の修正で以下の変更が行われるため要注意  2017.10.18
<span class='line'>2787</span> 引数 旧戻値  新戻値
<span class='line'>2788</span> "0123",0 "0123" "123"
<span class='line'>2789</span> "0123A",0 "0123A" "123"
<span class='line'>2790</span>  */</span><span class="WHIT">
<span class='line'>2791</span> </span><span class="NAME">nas.Zf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">N</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2792</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2793</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>2794</span> </span><span class="WHIT">    </span><span class="NAME">N</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">N</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2795</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">N</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">N</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2796</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">N</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2797</span> </span><span class="WHIT">        </span><span class="NAME">N</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">N</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2798</span> </span><span class="WHIT">        </span><span class="NAME">prefix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"-"</span><span class="WHIT">
<span class='line'>2799</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2800</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">N</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2801</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">'000000000000000000000000000000000000000000000000'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">N</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">slice</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">N</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">48</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">N</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">48</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2802</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2803</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">N</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2804</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2805</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2806</span> </span><span class="COMM">/*test
<span class='line'>2807</span> console.log(nas.Zf("123",4));//0123
<span class='line'>2808</span> 
<span class='line'>2809</span> */</span><span class="WHIT">
<span class='line'>2810</span> </span><span class="COMM">/**
<span class='line'>2811</span>  * 前後文字列つきゼロ埋め(動画番号正規化)
<span class='line'>2812</span>  *
<span class='line'>2813</span>  * @param myName
<span class='line'>2814</span>  * @param num
<span class='line'>2815</span>  * @returns {*}
<span class='line'>2816</span>  * @constructor
<span class='line'>2817</span>  */</span><span class="WHIT">
<span class='line'>2818</span> </span><span class="NAME">nas.RZf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">num</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2819</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">num</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">num</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2820</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">myName</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/([^\d]*)([\d]+)([^\d]?.*)/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2821</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nas.Zf</span><span class="PUNC">(</span><span class="NAME">RegExp.$2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">num</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">RegExp.$3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2822</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2823</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2824</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2825</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2826</span> 
<span class='line'>2827</span> </span><span class="COMM">/**
<span class='line'>2828</span>  * 時間フレーム変換
<span class='line'>2829</span>  * @param ms
<span class='line'>2830</span>  * @returns {number}
<span class='line'>2831</span>  */</span><span class="WHIT">
<span class='line'>2832</span> </span><span class="NAME">nas.ms2fr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ms</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2833</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">this.FRATE</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ms</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">1000</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2834</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="COMM">//ミリ秒からフレーム数 実時間切捨て整数フレーム</span><span class="WHIT">
<span class='line'>2835</span> 
<span class='line'>2836</span> </span><span class="COMM">/**
<span class='line'>2837</span>  * @param frm
<span class='line'>2838</span>  * @returns {number}
<span class='line'>2839</span>  */</span><span class="WHIT">
<span class='line'>2840</span> </span><span class="NAME">nas.fr2ms</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">frm</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2841</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1000</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">frm</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">this.FRATE</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2842</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="COMM">//フレームからミリ秒 浮動少数</span><span class="WHIT">
<span class='line'>2843</span> 
<span class='line'>2844</span> </span><span class="COMM">/**
<span class='line'>2845</span>  * @param ms
<span class='line'>2846</span>  * @param type
<span class='line'>2847</span>  * @param ostF
<span class='line'>2848</span>  * @param fpsC Object nas.Framerate
<span class='line'>2849</span>  */</span><span class="WHIT">
<span class='line'>2850</span> </span><span class="NAME">nas.ms2FCT</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ms</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ostF</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fpsC</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2851</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">type</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2852</span> </span><span class="WHIT">        </span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>2853</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2854</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ostF</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2855</span> </span><span class="WHIT">        </span><span class="NAME">ostF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>2856</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2857</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">fpsC</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2858</span> </span><span class="WHIT">        </span><span class="NAME">fpsC</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.FRATE</span><span class="WHIT">
<span class='line'>2859</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2860</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2861</span> </span><span class="WHIT">        </span><span class="NAME">fpsC</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">29.97</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2862</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2863</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2864</span>      * type 6 7の時にフレームレート強制
<span class='line'>2865</span>      * @type {number}
<span class='line'>2866</span>      */</span><span class="WHIT">
<span class='line'>2867</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myFrms</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">ms</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">fpsC</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">1000</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2868</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.Frm2FCT</span><span class="PUNC">(</span><span class="NAME">myFrms</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ostF</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fpsC</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2869</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2870</span> 
<span class='line'>2871</span> </span><span class="COMM">/**
<span class='line'>2872</span>  * @param fct
<span class='line'>2873</span>  * @returns {number}
<span class='line'>2874</span>  * @constructor
<span class='line'>2875</span>  */</span><span class="WHIT">
<span class='line'>2876</span> </span><span class="NAME">nas.FCT2ms</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fct</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2877</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1000</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.FCT2Frm</span><span class="PUNC">(</span><span class="NAME">fct</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">this.FRATE</span><span class="WHIT">
<span class='line'>2878</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2879</span> 
<span class='line'>2880</span> 
<span class='line'>2881</span> </span><span class="COMM">/**
<span class='line'>2882</span>  * カウンタ文字列生成
<span class='line'>2883</span>  * ドロップ対応版 2010/11/04
<span class='line'>2884</span>  * SMPTE ドロップ30対応 2010/11/05
<span class='line'>2885</span>  * モード指定 type6
<span class='line'>2886</span>  *
<span class='line'>2887</span>  * 30DF 60DF のみをサポートの予定 どちらのモードも0オリジン
<span class='line'>2888</span>  * 指定モードとしてtype6(30df)/7(60df)を与える
<span class='line'>2889</span>  * type7は30DF互換なので30DFと同じタイミングで4フレームドロップカウントする
<span class='line'>2890</span>  *
<span class='line'>2891</span>  * @param frames Int /time value
<span class='line'>2892</span>  * @param type Int 0 - 7/TC type
<span class='line'>2893</span>  * @param ostF Int or bool/count origination
<span class='line'>2894</span>  * @param fpsC Number or Object nas.Framerate/ framerate of value
<span class='line'>2895</span>  * @returns {*}
<span class='line'>2896</span>  * @constructor
<span class='line'>2897</span>  */</span><span class="WHIT">
<span class='line'>2898</span> </span><span class="NAME">nas.Frm2FCT</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">frames</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ostF</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fpsC</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2899</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">type</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2900</span> </span><span class="WHIT">        </span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>2901</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2902</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">fpsC</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2903</span> </span><span class="WHIT">        </span><span class="NAME">fpsC</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.FRATE</span><span class="WHIT">
<span class='line'>2904</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2905</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">7</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2906</span> </span><span class="WHIT">        </span><span class="COMM">/*	SMPTE 30DF/type6 60DF/type7*/</span><span class="WHIT">
<span class='line'>2907</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2589408</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2908</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">107892</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2909</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dmF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">17982</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2910</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lmFd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1798</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2911</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lmFc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1800</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2912</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">30</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2913</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dropF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2914</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">7</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2915</span> </span><span class="WHIT">            </span><span class="NAME">dF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dF</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2916</span> </span><span class="WHIT">            </span><span class="NAME">hF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">hF</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2917</span> </span><span class="WHIT">            </span><span class="NAME">dmF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dmF</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2918</span> </span><span class="WHIT">            </span><span class="NAME">lmFd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">lmFd</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2919</span> </span><span class="WHIT">            </span><span class="NAME">lmFc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">lmFc</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2920</span> </span><span class="WHIT">            </span><span class="NAME">sF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sF</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2921</span> </span><span class="WHIT">            </span><span class="NAME">dropF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dropF</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2922</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2923</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>2924</span>          * 負数は24hの補数化して解決
<span class='line'>2925</span>          * @type {number}
<span class='line'>2926</span>          */</span><span class="WHIT">
<span class='line'>2927</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">FR</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">frames</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">dF</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">frames</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NAME">dF</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">frames</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2928</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2929</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2930</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2931</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2932</span> </span><span class="WHIT">        </span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">FR</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">hF</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NUMB">24</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//SMPTE TCは24時ループ</span><span class="WHIT">
<span class='line'>2933</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>2934</span>          * mを10分単位でクリップすると計算が単純化される
<span class='line'>2935</span>          * @type {number}
<span class='line'>2936</span>          */</span><span class="WHIT">
<span class='line'>2937</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fRh</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">FR</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NAME">hF</span><span class="PUNC">;</span><span class="COMM">//未処理フレーム</span><span class="WHIT">
<span class='line'>2938</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">md</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">fRh</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">dmF</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//10分単位</span><span class="WHIT">
<span class='line'>2939</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mu</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">fRh</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NAME">dmF</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">lmFc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">fRh</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NAME">dmF</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">lmFc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">lmFd</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="COMM">//10分以下の分数</span><span class="WHIT">
<span class='line'>2940</span> </span><span class="WHIT">        </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">md</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">mu</span><span class="PUNC">;</span><span class="COMM">//加算して分数</span><span class="WHIT">
<span class='line'>2941</span> </span><span class="WHIT">        </span><span class="NAME">fRm</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fRh</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dmF</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">md</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lmFd</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">mu</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//</span><span class="WHIT">
<span class='line'>2942</span> </span><span class="WHIT">        </span><span class="NAME">fRm</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mu</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">dropF</span><span class="PUNC">;</span><span class="COMM">//正分まで処理を終えた残フレーム</span><span class="WHIT">
<span class='line'>2943</span> </span><span class="WHIT">        </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mu</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">fRm</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">sF</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">fRm</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dropF</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">sF</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//秒数・例外を除きドロップ2フレ補償</span><span class="WHIT">
<span class='line'>2944</span> </span><span class="WHIT">        </span><span class="NAME">fRs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">mu</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">fRm</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">sF</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">fRm</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">sF</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dropF</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2945</span> </span><span class="WHIT">        </span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">mu</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">fRs</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">fRs</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dropF</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2946</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">nas.Zf</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NUMB">24</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">":"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nas.Zf</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">":"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nas.Zf</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">";"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nas.Zf</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2947</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2948</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>2949</span>          *  通常のTCを作成
<span class='line'>2950</span>          */</span><span class="WHIT">
<span class='line'>2951</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">negative_flag</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2952</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">frames</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2953</span> </span><span class="WHIT">            </span><span class="NAME">frames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">frames</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2954</span> </span><span class="WHIT">            </span><span class="NAME">negative_flag</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2955</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2956</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ostF</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2957</span> </span><span class="WHIT">            </span><span class="NAME">PostFix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">' _'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2958</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2959</span> </span><span class="WHIT">            </span><span class="NAME">ostF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2960</span> </span><span class="WHIT">            </span><span class="NAME">PostFix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">' .'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2961</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2962</span> </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>2963</span> </span><span class="COMM">//	default	00000</span><span class="WHIT">
<span class='line'>2964</span> </span><span class="COMM">//	type 2	0:00:00</span><span class="WHIT">
<span class='line'>2965</span> </span><span class="COMM">//	type 3	000 + 00</span><span class="WHIT">
<span class='line'>2966</span> </span><span class="COMM">//	type 4	p 0 / 0 + 00</span><span class="WHIT">
<span class='line'>2967</span> </span><span class="COMM">//	type 5	p 0 / + 000</span><span class="WHIT">
<span class='line'>2968</span> </span><span class="COMM">//		type 6	00:00:00;00</span><span class="WHIT">
<span class='line'>2969</span> </span><span class="COMM">//		type 7	00:00:00;00</span><span class="WHIT">
<span class='line'>2970</span> </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>2971</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">frames</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">ostF</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fpsC</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">60</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2972</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">frames</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">ostF</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">fpsC</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2973</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">SrM</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NUMB">60</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2974</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">this.SheetLength</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="COMM">//SheetLength秒数で計算</span><span class="WHIT">
<span class='line'>2975</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">FrS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">frames</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">fpsC</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">ostF</span><span class="PUNC">;</span><span class="COMM">//秒単位端数フレーム</span><span class="WHIT">
<span class='line'>2976</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">FrP</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">frames</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">this.SheetLength</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">fpsC</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">ostF</span><span class="PUNC">;</span><span class="COMM">//ページ</span><span class="WHIT">
<span class='line'>2977</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">SrP</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">this.SheetLength</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//ページ単位端数 秒</span><span class="WHIT">
<span class='line'>2978</span> 
<span class='line'>2979</span> </span><span class="WHIT">        </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2980</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2981</span> </span><span class="WHIT">                </span><span class="NAME">Counter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'p '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.Zf</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">' / + '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.Zf</span><span class="PUNC">(</span><span class="NAME">FrP</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">PostFix</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2982</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2983</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2984</span> </span><span class="WHIT">                </span><span class="NAME">Counter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'p '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.Zf</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">' / '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">SrP</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">' + '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.Zf</span><span class="PUNC">(</span><span class="NAME">FrS</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">PostFix</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2985</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2986</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2987</span> </span><span class="WHIT">                </span><span class="NAME">Counter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.Zf</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">' + '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.Zf</span><span class="PUNC">(</span><span class="NAME">FrS</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">PostFix</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2988</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2989</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2990</span> </span><span class="WHIT">                </span><span class="NAME">Counter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.Zf</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">':'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.Zf</span><span class="PUNC">(</span><span class="NAME">SrM</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">':'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.Zf</span><span class="PUNC">(</span><span class="NAME">FrS</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">PostFix</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2991</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2992</span> </span><span class="WHIT">            </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2993</span> </span><span class="WHIT">                </span><span class="NAME">Counter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.Zf</span><span class="PUNC">(</span><span class="NAME">frames</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">ostF</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">PostFix</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2994</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2995</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">negative_flag</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2996</span> </span><span class="WHIT">            </span><span class="NAME">Counter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"-( "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Counter</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" )"</span><span class="WHIT">
<span class='line'>2997</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2998</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Counter</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2999</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3000</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3001</span> 
<span class='line'>3002</span> </span><span class="COMM">/**
<span class='line'>3003</span>  * nas.FCT2Frm(Fct,fpsC,check)
<span class='line'>3004</span>  * 引数 :タイムカウンタ文字列[,カウンタフレームレート][,タイプ判定オプション]
<span class='line'>3005</span>  * 戻値 :フレーム数  または  TCタイプ判別オブジェクト プロパティを下げたNumberオブジェクトで
<span class='line'>3006</span>  *
<span class='line'>3007</span>  * カウンタ文字から0スタートのフレーム値を返す
<span class='line'>3008</span>  * カウンタ文字列と認識できなかった場合は'元の文字列'を返す[仕様変更]
<span class='line'>3009</span>  * ドロップフレームが指定された場合はフレームを戻さず上記に準ずる
<span class='line'>3010</span>  *
<span class='line'>3011</span>  * タイムカウンタ文字列はFrm2FCT()の文字列を全て認識して解決する
<span class='line'>3012</span>  * 負数対応
<span class='line'>3013</span>  * フレームレートの指定が可能なように拡張(2010/11/06)
<span class='line'>3014</span>  * 指定がない場合 nas.FRATE を参照する
<span class='line'>3015</span> 
<span class='line'>3016</span>  * カウンタ文字列にページ指定がある場合は nas.SheetLength を参照する
<span class='line'>3017</span>  * この変数の一時指定はできないので、システムプロパティを直接書き直す必要がある
<span class='line'>3018</span>  *
<span class='line'>3019</span>  * SMPTEドロップを拡張(2010.11.05)
<span class='line'>3020</span>  * 最終セパレータが";"であるか否か
<span class='line'>3021</span>  * 文字列末尾のオリジネーション指定はあってもよいが無効（全て0オリジン）
<span class='line'>3022</span>  * フレームレートは30DF 60DFでは強制指定が行われたものとする。
<span class='line'>3023</span>  * 中間の45fpsを閾値としてnas.FRATEがそれ以下の場合は30DF
<span class='line'>3024</span>  * それ以上の場合は60DFのフレーム数を返す
<span class='line'>3025</span>  * 本来60DFはSMPTEの規格外なので扱いに注意すること
<span class='line'>3026</span>  * 
<span class='line'>3027</span> 近来  23.8 (ドロップ互換24fps)が広範に利用されているのでそろそろ考慮必要？
<span class='line'>3028</span> TCタイプを判定する関数が必要だが、このメソッドを拡張するのが良さそう
<span class='line'>3029</span> 23.98fps は、SMPTEドロップの規定を使用しない方向で運用されているので、ナチュラルドロップカウントを適用
<span class='line'>3030</span>  
<span class='line'>3031</span>  * TC文字列判定機能増設 キーは第三引数に何かあれば  判定オブジェクトを返す
<span class='line'>3032</span>  判定オブジェクトは  Number にして計算可能  プロパティが付加される
<span class='line'>3033</span>     Number.type     TCタイプ
<span class='line'>3034</span>     Number.offset   オリジネーション
<span class='line'>3035</span>  
<span class='line'>3036</span>  * @param Fct
<span class='line'>3037</span>  * @param fpsC
<span class='line'>3038</span>  * @returns {*}
<span class='line'>3039</span>  * @constructor
<span class='line'>3040</span>  */</span><span class="WHIT">
<span class='line'>3041</span> </span><span class="NAME">nas.FCT2Frm</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Fct</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fpsC</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3042</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">Fct</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3043</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">fpsC</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3044</span> </span><span class="WHIT">        </span><span class="NAME">fpsC</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Number</span><span class="PUNC">(</span><span class="NAME">this.FRATE</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3045</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3046</span> </span><span class="WHIT">    </span><span class="NAME">fct</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Fct.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3047</span> 
<span class='line'>3048</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">negative_flag</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3049</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myFrames</span><span class="PUNC">;</span><span class="COMM">//</span><span class="WHIT">
<span class='line'>3050</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ostF</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3051</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">PostFix</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3052</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">TCtype</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3053</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3054</span>      * 負数表示がある場合ネガティブモードに遷移
<span class='line'>3055</span>      */</span><span class="WHIT">
<span class='line'>3056</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fct.match</span><span class="PUNC">(</span><span class="REGX">/^\-\(([^\(\)]*)\)$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3057</span> </span><span class="WHIT">        </span><span class="NAME">fct</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3058</span> </span><span class="WHIT">        </span><span class="NAME">negative_flag</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3059</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3060</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3061</span>      * 空白を全削除
<span class='line'>3062</span>      * @type {string}
<span class='line'>3063</span>      */</span><span class="WHIT">
<span class='line'>3064</span> </span><span class="WHIT">    </span><span class="NAME">fct</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fct.replace</span><span class="PUNC">(</span><span class="REGX">/\s/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3065</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3066</span>      * 文字列の最期の文字を評価してオリジネーションを取得
<span class='line'>3067</span>      */</span><span class="WHIT">
<span class='line'>3068</span> </span><span class="WHIT">    </span><span class="NAME">ostF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fct.charAt</span><span class="PUNC">(</span><span class="NAME">fct.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'_'</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3069</span> </span><span class="WHIT">    </span><span class="NAME">PostFix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">'.'</span><span class="PUNC">,</span><span class="STRN">'_'</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">ostF</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3070</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3071</span>      * 文字列の最期の文字がポストフィックスなら切り捨て
<span class='line'>3072</span>      */</span><span class="WHIT">
<span class='line'>3073</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fct.charAt</span><span class="PUNC">(</span><span class="NAME">fct.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">PostFix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">fct</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fct.slice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3074</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3075</span>      * 初期判定で SMPTE-DFを分離
<span class='line'>3076</span>      * TCtype 6 or 7
<span class='line'>3077</span>      */</span><span class="WHIT">
<span class='line'>3078</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fct.match</span><span class="PUNC">(</span><span class="REGX">/^([0-9]+:){0,2}[0-9]+;[0-9]+$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3079</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3080</span>     * SMPTE hh:mm:ss;ff
<span class='line'>3081</span>     * ポストフィックス判定を一旦破棄して  ostF = 0; にセットする  
<span class='line'>3082</span>     * @type {string}
<span class='line'>3083</span>     */</span><span class="WHIT">
<span class='line'>3084</span> </span><span class="WHIT">        </span><span class="NAME">fct</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fct.replace</span><span class="PUNC">(</span><span class="REGX">/;/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">":"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//セミコロンを置換</span><span class="WHIT">
<span class='line'>3085</span> </span><span class="WHIT">        </span><span class="NAME">fpsC</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fpsC</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">45</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">29.97</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">59.94</span><span class="PUNC">;</span><span class="COMM">//SMPTEドロップが指定されたので強制的にフレームレート調整</span><span class="WHIT">
<span class='line'>3086</span> </span><span class="WHIT">        </span><span class="NAME">ostF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3087</span> </span><span class="WHIT">        </span><span class="NAME">PostFix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3088</span> </span><span class="WHIT">        </span><span class="NAME">TCtype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fpsC</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">45</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT">  </span><span class="NUMB">6</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">7</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3089</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3090</span>          * 一時係数設定
<span class='line'>3091</span>          * @type {number}
<span class='line'>3092</span>          */</span><span class="WHIT">
<span class='line'>3093</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2589408</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3094</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">107892</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3095</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dmF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">17982</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3096</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lmFd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1798</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3097</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lmFc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1800</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3098</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">30</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3099</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dropF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3100</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fpsC</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">45</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3101</span> </span><span class="WHIT">            </span><span class="NAME">dF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dF</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3102</span> </span><span class="WHIT">            </span><span class="NAME">hF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">hF</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3103</span> </span><span class="WHIT">            </span><span class="NAME">dmF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dmF</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3104</span> </span><span class="WHIT">            </span><span class="NAME">lmFd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">lmFd</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3105</span> </span><span class="WHIT">            </span><span class="NAME">lmFc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">lmFc</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3106</span> </span><span class="WHIT">            </span><span class="NAME">sF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sF</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3107</span> </span><span class="WHIT">            </span><span class="NAME">dropF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3108</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3109</span> </span><span class="WHIT">        </span><span class="COMM">//60DF</span><span class="WHIT">
<span class='line'>3110</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3111</span>          * TCをスプリットして配列に入れる
<span class='line'>3112</span>          * @type {Array}
<span class='line'>3113</span>          */</span><span class="WHIT">
<span class='line'>3114</span> </span><span class="WHIT">        </span><span class="NAME">tmpTC</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3115</span> </span><span class="WHIT">        </span><span class="NAME">tmpTC</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fct.split</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3116</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3117</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3118</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3119</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3120</span> 
<span class='line'>3121</span> </span><span class="WHIT">        </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tmpTC.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3122</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3123</span> </span><span class="WHIT">                </span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tmpTC</span><span class="PUNC">[</span><span class="NAME">tmpTC.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3124</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3125</span> </span><span class="WHIT">                </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tmpTC</span><span class="PUNC">[</span><span class="NAME">tmpTC.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3126</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3127</span> </span><span class="WHIT">                </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tmpTC</span><span class="PUNC">[</span><span class="NAME">tmpTC.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3128</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3129</span> </span><span class="WHIT">                </span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tmpTC</span><span class="PUNC">[</span><span class="NAME">tmpTC.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3130</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3131</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3132</span>          * フレームドロップ判定
<span class='line'>3133</span>          */</span><span class="WHIT">
<span class='line'>3134</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">dropF</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3135</span> </span><span class="WHIT"> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'SMPTEドロップフレーム不正 : '</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">fct</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3136</span> </span><span class="WHIT">           </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT">
<span class='line'>3137</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3138</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3139</span>          * ドロップフレームはヌル戻し
<span class='line'>3140</span>          * @type {number}
<span class='line'>3141</span>          */</span><span class="WHIT">
<span class='line'>3142</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">FR</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">hF</span><span class="PUNC">;</span><span class="COMM">//時</span><span class="WHIT">
<span class='line'>3143</span> </span><span class="WHIT">        </span><span class="NAME">FR</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">dmF</span><span class="PUNC">;</span><span class="COMM">//＋10分単位で加算</span><span class="WHIT">
<span class='line'>3144</span> </span><span class="WHIT">        </span><span class="NAME">FR</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">lmFd</span><span class="PUNC">;</span><span class="COMM">//ひとけた分乗算</span><span class="WHIT">
<span class='line'>3145</span> </span><span class="WHIT">        </span><span class="NAME">FR</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">dropF</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//1分以上なら読み飛ばさなかったフレームを加算</span><span class="WHIT">
<span class='line'>3146</span> </span><span class="WHIT">        </span><span class="NAME">FR</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">sF</span><span class="PUNC">;</span><span class="COMM">//秒数乗算</span><span class="WHIT">
<span class='line'>3147</span> </span><span class="WHIT">        </span><span class="NAME">FR</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">dropF</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//00 10 20 30 40 50 分の例外フレームを減算して解決</span><span class="WHIT">
<span class='line'>3148</span> </span><span class="WHIT">        </span><span class="NAME">FR</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">;</span><span class="COMM">//フレームを加算</span><span class="WHIT">
<span class='line'>3149</span> </span><span class="WHIT">        </span><span class="NAME">FR</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">dropF</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">dropF</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//例外ドロップフレームを減算</span><span class="WHIT">
<span class='line'>3150</span> </span><span class="COMM">//ここで存在しないはずの ドロップされたフレームは減算対象外にして後ろに送る</span><span class="WHIT">
<span class='line'>3151</span> </span><span class="WHIT">        </span><span class="NAME">myFrames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">FR</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">negative_flag</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3152</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3153</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3154</span>          * 標準処理(ドロップ含む)
<span class='line'>3155</span>          */</span><span class="WHIT">
<span class='line'>3156</span> </span><span class="COMM">//	if (fct.match(/[0-9\:\p\/\+]/)) {return fct}</span><span class="WHIT">
<span class='line'>3157</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3158</span>          * ローカル変数初期化
<span class='line'>3159</span>          * @type {number}
<span class='line'>3160</span>          */</span><span class="WHIT">
<span class='line'>3161</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3162</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3163</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3164</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3165</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3166</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3167</span>          * type 1    00000 ドロップは存在しない FR
<span class='line'>3168</span>          */</span><span class="WHIT">
<span class='line'>3169</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fct.match</span><span class="PUNC">(</span><span class="REGX">/^[0-9]+$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3170</span> </span><span class="WHIT">            </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fct</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3171</span> </span><span class="WHIT">            </span><span class="NAME">TCtype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3172</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3173</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>3174</span>              * type 2    0:00:00 少数フレームレートの際にドロップ発生  TC
<span class='line'>3175</span>              */</span><span class="WHIT">
<span class='line'>3176</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fct.match</span><span class="PUNC">(</span><span class="REGX">/^([0-9]+:){1,3}[0-9]+$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3177</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>3178</span>                  * TCなのでスプリットして配列に入れる
<span class='line'>3179</span>                  * @type {Array}
<span class='line'>3180</span>                  */</span><span class="WHIT">
<span class='line'>3181</span> </span><span class="WHIT">                </span><span class="NAME">tmpTC</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3182</span> </span><span class="WHIT">                </span><span class="NAME">tmpTC</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fct.split</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3183</span> </span><span class="WHIT">                </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tmpTC.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3184</span> </span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3185</span> </span><span class="WHIT">                        </span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tmpTC</span><span class="PUNC">[</span><span class="NAME">tmpTC.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3186</span> </span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3187</span> </span><span class="WHIT">                        </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tmpTC</span><span class="PUNC">[</span><span class="NAME">tmpTC.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3188</span> </span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3189</span> </span><span class="WHIT">                        </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tmpTC</span><span class="PUNC">[</span><span class="NAME">tmpTC.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3190</span> </span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3191</span> </span><span class="WHIT">                        </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tmpTC</span><span class="PUNC">[</span><span class="NAME">tmpTC.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3192</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3193</span> </span><span class="WHIT">                </span><span class="NAME">TCtype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3194</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3195</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>3196</span>                  * type 3    000 + 00   trad-JA
<span class='line'>3197</span>                  */</span><span class="WHIT">
<span class='line'>3198</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fct.match</span><span class="PUNC">(</span><span class="REGX">/^[0-9]+\+[0-9]+$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3199</span> </span><span class="WHIT">                    </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fct.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fct.search</span><span class="PUNC">(</span><span class="REGX">/\+/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3200</span> </span><span class="WHIT">                    </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fct.substr</span><span class="PUNC">(</span><span class="NAME">fct.search</span><span class="PUNC">(</span><span class="REGX">/\+/</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3201</span> </span><span class="WHIT">                    </span><span class="NAME">TCtype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3202</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3203</span> </span><span class="WHIT">                    </span><span class="COMM">/**
<span class='line'>3204</span>                      * type 4    p 0 / 0 + 00 page-SK
<span class='line'>3205</span>                      */</span><span class="WHIT">
<span class='line'>3206</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fct.match</span><span class="PUNC">(</span><span class="REGX">/^p[0-9]+\/[0-9]+\+[0-9]+$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3207</span> </span><span class="WHIT">                        </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fct.slice</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fct.search</span><span class="PUNC">(</span><span class="REGX">/\x2F/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3208</span> </span><span class="WHIT">                        </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fct.substring</span><span class="PUNC">(</span><span class="NAME">fct.search</span><span class="PUNC">(</span><span class="REGX">/\x2F/</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fct.search</span><span class="PUNC">(</span><span class="REGX">/\+/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3209</span> </span><span class="WHIT">                        </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fct.substr</span><span class="PUNC">(</span><span class="NAME">fct.search</span><span class="PUNC">(</span><span class="REGX">/\+/</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3210</span> </span><span class="WHIT">                        </span><span class="NAME">TCtype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3211</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3212</span> </span><span class="WHIT">                        </span><span class="COMM">/**
<span class='line'>3213</span>                          * type 5    p 0 / + 000 page-K
<span class='line'>3214</span>                          */</span><span class="WHIT">
<span class='line'>3215</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fct.match</span><span class="PUNC">(</span><span class="REGX">/^p[0-9]+\/\+[0-9]+$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3216</span> </span><span class="WHIT">                            </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fct.slice</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fct.search</span><span class="PUNC">(</span><span class="REGX">/\x2F/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3217</span> </span><span class="WHIT">                            </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fct.substr</span><span class="PUNC">(</span><span class="NAME">fct.search</span><span class="PUNC">(</span><span class="REGX">/\+/</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3218</span> </span><span class="WHIT">                            </span><span class="NAME">TCtype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3219</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3220</span> </span><span class="WHIT">                            </span><span class="COMM">/**
<span class='line'>3221</span>                              * ダメダメ
<span class='line'>3222</span>                              */</span><span class="WHIT">
<span class='line'>3223</span> </span><span class="WHIT">                            </span><span class="NAME">TCtype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3224</span> </span><span class="WHIT">                            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3225</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3226</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3227</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3228</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3229</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3230</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3231</span>          * 数値化して全加算
<span class='line'>3232</span>          * @type {Number}
<span class='line'>3233</span>          */</span><span class="WHIT">
<span class='line'>3234</span> </span><span class="WHIT">        </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3235</span> </span><span class="WHIT">        </span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3236</span> </span><span class="WHIT">        </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3237</span> </span><span class="WHIT">        </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3238</span> </span><span class="WHIT">        </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">k</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3239</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3240</span>          * 指定フレームがフレームレートを超える場合場合にかぎり桁上りを行って
<span class='line'>3241</span>          * 不規TCを正規化する
<span class='line'>3242</span>          */</span><span class="WHIT">
<span class='line'>3243</span> </span><span class="WHIT">         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">Math.ceil</span><span class="PUNC">(</span><span class="NAME">fpsC</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3244</span> </span><span class="WHIT">            </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">fpsC</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3245</span> </span><span class="WHIT">            </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NAME">Math.ceil</span><span class="PUNC">(</span><span class="NAME">fpsC</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3246</span> </span><span class="WHIT">         </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3247</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3248</span>          * タイムコード的にはすべて整数であることが必須
<span class='line'>3249</span>          * フレームレートが少数点以下の値を含む場合はすべて切り上げてフレームを得る
<span class='line'>3250</span>          * → (1+10.5)は(1+11)にあたる
<span class='line'>3251</span>          */</span><span class="WHIT">
<span class='line'>3252</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Seconds</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">this.SheetLength</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">60</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">60</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">60</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3253</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Frames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.ceil</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">Seconds</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">fpsC</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">ostF</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3254</span> 
<span class='line'>3255</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3256</span>          * ナチュラルドロップフレームの判定 フレーム継続時間の末尾が秒境界をまたがった場合をドロップカウントする
<span class='line'>3257</span>          * 連続してフレームがドロップすることはありえないのでこのように判定
<span class='line'>3258</span>          * 整数フレームレート時に実行されていたので、トラップする 2012 0205
<span class='line'>3259</span>          * TCtype==1の際(フレームドロップが存在しないケース)に実行されていたので修正  20180718
<span class='line'>3260</span>          */</span><span class="WHIT">
<span class='line'>3261</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">TCtype</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">fpsC</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">Frames</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">fpsC</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Seconds</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3262</span> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'TC不正 : '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">fct</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3263</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT">
<span class='line'>3264</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3265</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3266</span>          * この判定のため電卓の計算式に使用するときのトラップが発生するので注意(2010/11/06)
<span class='line'>3267</span>          */</span><span class="WHIT">
<span class='line'>3268</span> </span><span class="WHIT">            </span><span class="NAME">myFrames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Frames</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">negative_flag</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3269</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3270</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3271</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Number</span><span class="PUNC">(</span><span class="NAME">myFrames</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3272</span> </span><span class="WHIT">            </span><span class="NAME">myResult.type</span><span class="PUNC">=</span><span class="NAME">TCtype</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3273</span> </span><span class="WHIT">            </span><span class="NAME">myResult.origin</span><span class="PUNC">=</span><span class="NAME">ostF</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3274</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="WHIT">
<span class='line'>3275</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3276</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myFrames</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3277</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3278</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3279</span> </span><span class="COMM">/*  TEST
<span class='line'>3280</span> console.log(nas.FCT2Frm("timecode",24,true));
<span class='line'>3281</span> console.log(nas.FCT2Frm("000 .",24,true));
<span class='line'>3282</span> console.log(nas.FCT2Frm("1+12 _",12,true));
<span class='line'>3283</span> console.log(nas.FCT2Frm("01:01:01;01.",24,true));
<span class='line'>3284</span> console.log(nas.FCT2Frm("p12/3+0",24,true));
<span class='line'>3285</span> console.log(nas.FCT2Frm("00:01:00;00"));
<span class='line'>3286</span> console.log(nas.FCT2Frm("00:01:04:9",10.2));
<span class='line'>3287</span> console.log(nas.FCT2Frm("00:01:04:10",10.2));
<span class='line'>3288</span> console.log(nas.FCT2Frm("00:01:04:11",10.2));
<span class='line'>3289</span> 
<span class='line'>3290</span> */</span><span class="WHIT">
<span class='line'>3291</span> </span><span class="COMM">/**
<span class='line'>3292</span>  * お道具箱汎用データ操作関数群
<span class='line'>3293</span>  * お道具箱汎用データ操作関数群オワリ
<span class='line'>3294</span>  */</span><span class="WHIT">
<span class='line'>3295</span> 
<span class='line'>3296</span> </span><span class="COMM">/**
<span class='line'>3297</span>  * ベクトル演算関数群
<span class='line'>3298</span>  */</span><span class="WHIT">
<span class='line'>3299</span> 
<span class='line'>3300</span> 
<span class='line'>3301</span> </span><span class="COMM">/**
<span class='line'>3302</span>  * nas.preformvector(vec1,vec2)
<span class='line'>3303</span>  * 引数:    ベクトル（配列）２つ
<span class='line'>3304</span>  * 戻値:    次数の揃ったベクトル（配列）２つ
<span class='line'>3305</span>  * ベクトル演算事前処理
<span class='line'>3306</span>  * 与えられたベクトルの次数を多いものに揃えて不足分に0を加えて返す
<span class='line'>3307</span>  * 内部使なのでエイリアスは不要
<span class='line'>3308</span>  *
<span class='line'>3309</span>  * @param vec1
<span class='line'>3310</span>  * @param vec2
<span class='line'>3311</span>  * @returns {*[]}
<span class='line'>3312</span>  */</span><span class="WHIT">
<span class='line'>3313</span> </span><span class="NAME">nas.preformvector</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vec1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vec2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3314</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3315</span>      * 単項スカラだった場合、要素数1の配列に変換しておく。
<span class='line'>3316</span>      */</span><span class="WHIT">
<span class='line'>3317</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">vec1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"number"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3318</span> </span><span class="WHIT">        </span><span class="NAME">vec1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">vec1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3319</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3320</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">vec2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"number"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3321</span> </span><span class="WHIT">        </span><span class="NAME">vec2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">vec2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3322</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3323</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3324</span>      * ベクトルの次数を求める 二次元か三次元か四次元か
<span class='line'>3325</span>      * @type {number}
<span class='line'>3326</span>      */</span><span class="WHIT">
<span class='line'>3327</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">difD</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vec1.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vec2.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3328</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vecD</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vec1.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">vec2.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">vec1.length</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">vec2.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3329</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3330</span>      * 要素数の多い方をとって不足する要素は0で補う
<span class='line'>3331</span>      */</span><span class="WHIT">
<span class='line'>3332</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">difD</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3333</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">difD</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3334</span> </span><span class="WHIT">            </span><span class="NAME">vec2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vec2.concat</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3335</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3336</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3337</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">difD</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3338</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">difD</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3339</span> </span><span class="WHIT">                </span><span class="NAME">vec1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vec1.concat</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3340</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3341</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3342</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3343</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">vec1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vec2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vecD</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3344</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3345</span> 
<span class='line'>3346</span> </span><span class="COMM">/**
<span class='line'>3347</span>  * nas.add(vec1,vec2)
<span class='line'>3348</span>  * 引数:ベクトル配列1 ベクトル配列2
<span class='line'>3349</span>  * 戻値:各項を加算したベクトル
<span class='line'>3350</span>  * ベクトル和を返す。
<span class='line'>3351</span>  *
<span class='line'>3352</span>  * @param vec1
<span class='line'>3353</span>  * @param vec2
<span class='line'>3354</span>  * @returns {Array}
<span class='line'>3355</span>  */</span><span class="WHIT">
<span class='line'>3356</span> </span><span class="NAME">nas.add</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vec1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vec2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3357</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">preformedVec</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.preformvector</span><span class="PUNC">(</span><span class="NAME">vec1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vec2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3358</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vec3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">preformedVec</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3359</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3360</span>      * 和を求めて返す。
<span class='line'>3361</span>      */</span><span class="WHIT">
<span class='line'>3362</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">vec3.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3363</span> </span><span class="WHIT">        </span><span class="NAME">vec3</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">preformedVec</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">preformedVec</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>3364</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3365</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vec3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3366</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3367</span> 
<span class='line'>3368</span> </span><span class="COMM">/**
<span class='line'>3369</span>  * nas.sub(vec1,vec2)
<span class='line'>3370</span>  * 引数:ベクトル配列1 ベクトル配列2
<span class='line'>3371</span>  * 戻値:各項を減算したベクトル
<span class='line'>3372</span>  * ベクトル差を返す
<span class='line'>3373</span>  *
<span class='line'>3374</span>  * @param vec1
<span class='line'>3375</span>  * @param vec2
<span class='line'>3376</span>  * @returns {Array}
<span class='line'>3377</span>  */</span><span class="WHIT">
<span class='line'>3378</span> </span><span class="NAME">nas.sub</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vec1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vec2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3379</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">preformedVec</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.preformvector</span><span class="PUNC">(</span><span class="NAME">vec1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vec2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3380</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vec3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">preformedVec</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3381</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3382</span>      * 差を求めて返す。
<span class='line'>3383</span>      */</span><span class="WHIT">
<span class='line'>3384</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">vec3.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3385</span> </span><span class="WHIT">        </span><span class="NAME">vec3</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">preformedVec</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">preformedVec</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>3386</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3387</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vec3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3388</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3389</span> 
<span class='line'>3390</span> </span><span class="COMM">/**
<span class='line'>3391</span>  * nas.mul(vec,amount)
<span class='line'>3392</span>  * 引数:ベクトル配列 乗数
<span class='line'>3393</span>  * 戻値:各項に乗数を積算したベクトル
<span class='line'>3394</span>  * ベクトル積を返す
<span class='line'>3395</span>  * @param vec
<span class='line'>3396</span>  * @param amount
<span class='line'>3397</span>  * @returns {Array}
<span class='line'>3398</span>  */</span><span class="WHIT">
<span class='line'>3399</span> </span><span class="NAME">nas.mul</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">amount</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3400</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"number"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">vec</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">vec</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3401</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3402</span>      * ベクトルの次数を求める 二次元か三次元か四次元か
<span class='line'>3403</span>      */</span><span class="WHIT">
<span class='line'>3404</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vecD</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vec.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3405</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vecNew</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">vecD</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3406</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3407</span>      * 積を求めて返す。
<span class='line'>3408</span>      */</span><span class="WHIT">
<span class='line'>3409</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">vecD</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3410</span> </span><span class="WHIT">        </span><span class="NAME">vecNew</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">amount</span><span class="WHIT">
<span class='line'>3411</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3412</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vecNew</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3413</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3414</span> 
<span class='line'>3415</span> </span><span class="COMM">/**
<span class='line'>3416</span>  * nas.div(vec,amount)
<span class='line'>3417</span>  * 引数:ベクトル配列 商数
<span class='line'>3418</span>  * 戻値:各項を商数で割ったベクトル
<span class='line'>3419</span>  * ベクトル商を返す
<span class='line'>3420</span>  * @param vec
<span class='line'>3421</span>  * @param amount
<span class='line'>3422</span>  * @returns {Array}
<span class='line'>3423</span>  */</span><span class="WHIT">
<span class='line'>3424</span> </span><span class="NAME">nas.div</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">amount</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3425</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"number"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3426</span> </span><span class="WHIT">        </span><span class="NAME">vec</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">vec</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3427</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3428</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3429</span>      * ベクトルの次数を求める 二次元か三次元か四次元か
<span class='line'>3430</span>      */</span><span class="WHIT">
<span class='line'>3431</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vecD</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vec.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3432</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vecNew</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">vecD</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3433</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3434</span>      * 商を求めて返す。
<span class='line'>3435</span>      */</span><span class="WHIT">
<span class='line'>3436</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">vecD</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3437</span> </span><span class="WHIT">        </span><span class="NAME">vecNew</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">amount</span><span class="WHIT">
<span class='line'>3438</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3439</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vecNew</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3440</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3441</span> 
<span class='line'>3442</span> </span><span class="COMM">/**
<span class='line'>3443</span>  * nas.clamp(vec, limit1, limit2)
<span class='line'>3444</span>  * 引数:ベクトル配列 制限値１ 制限値２
<span class='line'>3445</span>  * 戻値:制限値の範囲内にクランプされたベクトル
<span class='line'>3446</span>  * ベクトルを制限値でクランプする
<span class='line'>3447</span>  * @param vec
<span class='line'>3448</span>  * @param limit1
<span class='line'>3449</span>  * @param limit2
<span class='line'>3450</span>  * @returns {Array}
<span class='line'>3451</span>  */</span><span class="WHIT">
<span class='line'>3452</span> </span><span class="NAME">nas.clamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">limit1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">limit2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3453</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">max</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">limit1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3454</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">min</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">limit2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3455</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">limit1</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">limit2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3456</span> </span><span class="WHIT">        </span><span class="NAME">max</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">limit2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3457</span> </span><span class="WHIT">        </span><span class="NAME">min</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">limit1</span><span class="WHIT">
<span class='line'>3458</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3459</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"number"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3460</span> </span><span class="WHIT">        </span><span class="NAME">vec</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">vec</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3461</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3462</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3463</span>      * ベクトルの次数を求める 二次元か三次元か四次元か
<span class='line'>3464</span>      */</span><span class="WHIT">
<span class='line'>3465</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vecD</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vec.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3466</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vecNew</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">vecD</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3467</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3468</span>      * 要素ごとに値をクランプして返す。
<span class='line'>3469</span>      */</span><span class="WHIT">
<span class='line'>3470</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">vecD</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3471</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">min</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">max</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3472</span> </span><span class="WHIT">            </span><span class="NAME">vecNew</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3473</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3474</span> </span><span class="WHIT">            </span><span class="NAME">vecNew</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">min</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">vecNew.concat</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">max</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">vecNew</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vecNew.concat</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">min</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3475</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3476</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3477</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vecNew</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3478</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3479</span> 
<span class='line'>3480</span> </span><span class="COMM">/**
<span class='line'>3481</span>  * nas.dot(vec1,vec2)
<span class='line'>3482</span>  * 引数:ベクトル配列1 ベクトル配列2
<span class='line'>3483</span>  * 戻値:ベクトル要素の内積
<span class='line'>3484</span>  * ベクトル内積
<span class='line'>3485</span>  * @param vec1
<span class='line'>3486</span>  * @param vec2
<span class='line'>3487</span>  * @returns {number}
<span class='line'>3488</span>  */</span><span class="WHIT">
<span class='line'>3489</span> </span><span class="NAME">nas.dot</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vec1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vec2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3490</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3491</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3492</span>      * 要素ごとに積算。
<span class='line'>3493</span>      */</span><span class="WHIT">
<span class='line'>3494</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">preformedVec</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3495</span> </span><span class="WHIT">        </span><span class="NAME">Result</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">preformedVec</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">preformedVec</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3496</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3497</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Result</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3498</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3499</span> 
<span class='line'>3500</span> </span><span class="COMM">/**
<span class='line'>3501</span>  * nas.cross(vec1, vec2)
<span class='line'>3502</span>  * 引数:ベクトル配列1 ベクトル配列2
<span class='line'>3503</span>  * 戻値:ベクトル要素の外積
<span class='line'>3504</span>  * AEの仕様に合わせて2次元と3次元の値のみを計算する
<span class='line'>3505</span>  * @param vec1
<span class='line'>3506</span>  * @param vec2
<span class='line'>3507</span>  * @returns {number}
<span class='line'>3508</span>  */</span><span class="WHIT">
<span class='line'>3509</span> </span><span class="NAME">nas.cross</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vec1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vec2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3510</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">preformedVec</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.preformvector</span><span class="PUNC">(</span><span class="NAME">vec1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vec2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3511</span> </span><span class="WHIT">    </span><span class="NAME">vec1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">preformedVec</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3512</span> </span><span class="WHIT">    </span><span class="NAME">vec2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">preformedVec</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3513</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vecD</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">preformedVec</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3514</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3515</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3516</span>      * 2次元か3次元で分岐
<span class='line'>3517</span>      */</span><span class="WHIT">
<span class='line'>3518</span> </span><span class="WHIT">    </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vecD</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3519</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3520</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>3521</span>              * 2次元の時は外積を求めるためz座標値に0を補ってやる。(breakなし)
<span class='line'>3522</span>              * @type {Array.&lt;T>|string}
<span class='line'>3523</span>              */</span><span class="WHIT">
<span class='line'>3524</span> </span><span class="WHIT">            </span><span class="NAME">vec1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vec1.concat</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3525</span> </span><span class="WHIT">            </span><span class="NAME">vec2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vec2.concat</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3526</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3527</span> </span><span class="WHIT">            </span><span class="NAME">Result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">vec1</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">vec2</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vec1</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">vec2</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3528</span> </span><span class="WHIT">                </span><span class="NAME">vec1</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">vec2</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vec1</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">vec2</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3529</span> </span><span class="WHIT">                </span><span class="NAME">vec1</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">vec2</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vec1</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">vec2</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3530</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3531</span> </span><span class="WHIT">        </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3532</span> </span><span class="WHIT">            </span><span class="NAME">Result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"2次元か3次元の値である必要があります。"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3533</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3534</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Result</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3535</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3536</span> 
<span class='line'>3537</span> </span><span class="COMM">/**
<span class='line'>3538</span>  * nas.length(vec)
<span class='line'>3539</span>  * 引数:ベクトル配列
<span class='line'>3540</span>  * 戻値:ベクトル長
<span class='line'>3541</span>  * ベクトルの長さを求める
<span class='line'>3542</span>  * @param vec
<span class='line'>3543</span>  * @returns {*}
<span class='line'>3544</span>  */</span><span class="WHIT">
<span class='line'>3545</span> </span><span class="NAME">nas.length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3546</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3547</span>      * 引数がいくつかを求める
<span class='line'>3548</span>      */</span><span class="WHIT">
<span class='line'>3549</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3550</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"number"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>3551</span> </span><span class="WHIT">            </span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"number"</span><span class="WHIT">
<span class='line'>3552</span> </span><span class="WHIT">        </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3553</span> </span><span class="WHIT">            </span><span class="NAME">vec</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">argments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3554</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3555</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"number"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>3556</span> </span><span class="WHIT">                </span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"number"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>3557</span> </span><span class="WHIT">                </span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"number"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>3558</span> </span><span class="WHIT">                </span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"number"</span><span class="WHIT">
<span class='line'>3559</span> </span><span class="WHIT">            </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3560</span> </span><span class="WHIT">                </span><span class="NAME">vec</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.sub</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3561</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3562</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"配列を入力しましょう"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3563</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3564</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3565</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3566</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3567</span>      * ベクトルの次数を求める 二次元か三次元か四次元か
<span class='line'>3568</span>      */</span><span class="WHIT">
<span class='line'>3569</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vecD</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vec.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3570</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">vecD</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3571</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT">
<span class='line'>3572</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3573</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3574</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3575</span>      * 長さを求める
<span class='line'>3576</span>      */</span><span class="WHIT">
<span class='line'>3577</span> </span><span class="WHIT">    </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vecD</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3578</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3579</span> </span><span class="WHIT">            </span><span class="NAME">Length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3580</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3581</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3582</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3583</span> </span><span class="WHIT">            </span><span class="NAME">Length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">.</span><span class="NUMB">5</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3584</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vecD</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3585</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">vecD</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3586</span> </span><span class="WHIT">                    </span><span class="NAME">Length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">Length</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">.</span><span class="NUMB">5</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3587</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3588</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3589</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3590</span> </span><span class="WHIT">        </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3591</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"2次元または3次元の値を入力しましょう"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3592</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3593</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3594</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3595</span> 
<span class='line'>3596</span> </span><span class="COMM">/**
<span class='line'>3597</span>  * nas.normalize(vec)
<span class='line'>3598</span>  * 引数:ベクトル配列
<span class='line'>3599</span>  * 戻値:単位長ベクトル
<span class='line'>3600</span>  * 方向が同じで長さ１のベクトル
<span class='line'>3601</span>  * @param vec
<span class='line'>3602</span>  * @returns {Array}
<span class='line'>3603</span>  */</span><span class="WHIT">
<span class='line'>3604</span> </span><span class="NAME">nas.normalize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3605</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.div</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.length</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3606</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3607</span> 
<span class='line'>3608</span> </span><span class="COMM">/**
<span class='line'>3609</span>  * @desc ベクトル演算関数おしまい
<span class='line'>3610</span>  */</span><span class="WHIT">
<span class='line'>3611</span> 
<span class='line'>3612</span> </span><span class="COMM">/**
<span class='line'>3613</span>  * AE ExpressionOtherMath 互換 角度&lt;>ラジアン変換関数
<span class='line'>3614</span>  * 桁切らないほうが良いかも、運用してみて判断しましょう 2006/06/23
<span class='line'>3615</span>  * @param degrees
<span class='line'>3616</span>  * @returns {number}
<span class='line'>3617</span>  */</span><span class="WHIT">
<span class='line'>3618</span> </span><span class="NAME">nas.degreesToRadians</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">degrees</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3619</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">degrees</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">180.</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">100000000</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">100000000</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3620</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3621</span> </span><span class="COMM">/**
<span class='line'>3622</span>  * @param radians
<span class='line'>3623</span>  * @returns {number}
<span class='line'>3624</span>  */</span><span class="WHIT">
<span class='line'>3625</span> </span><span class="NAME">nas.radiansToDegrees</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">radians</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3626</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NUMB">180.</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">radians</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">100000</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">100000</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3627</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3628</span> 
<span class='line'>3629</span> </span><span class="COMM">/**
<span class='line'>3630</span>  * @desc 互換のためエイリアスを設定する
<span class='line'>3631</span>  */</span><span class="WHIT">
<span class='line'>3632</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">preformvector</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">preformvector</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.preformvector</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3633</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">add</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">add</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.add</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3634</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sub</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sub</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.sub</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3635</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mul</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mul</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.mul</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3636</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">div</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">div</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.div</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3637</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">clamp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.clamp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3638</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dot</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dot</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.dot</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3639</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cross</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cross</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.cross</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3640</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3641</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">normalize</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">normalize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.normalize</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3642</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">degreesToRadians</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">degreesToRadians</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.degreesToRadians</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3643</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">radiansToDegrees</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">radiansToDegrees</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.radiansToDegrees</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3644</span> </span><span class="COMM">/*
<span class='line'>3645</span>  * 以前のコードを洗ってエイリアスが不要なら削除のこと AEエクスプレッション準互換ベクター/数学関数
<span class='line'>3646</span>     他にfakeAE のオブエクトを利用する
<span class='line'>3647</span> */</span><span class="WHIT">
<span class='line'>3648</span> 
<span class='line'>3649</span> </span><span class="COMM">/**
<span class='line'>3650</span>  * ベジェの一次式
<span class='line'>3651</span>  * corveto関連の関数
<span class='line'>3652</span>  * なんかまだつらそうだがとりあえず設定しておく
<span class='line'>3653</span>  *
<span class='line'>3654</span>  * @param {Number} SP
<span class='line'>3655</span>  *  開始点
<span class='line'>3656</span>  * @param {Number} CP1
<span class='line'>3657</span>  *  制御点1
<span class='line'>3658</span>  * @param {Number} CP2
<span class='line'>3659</span>  *  制御点2
<span class='line'>3660</span>  * @param {Number} EP
<span class='line'>3661</span>  *  終了点
<span class='line'>3662</span>  * @param {Number} T
<span class='line'>3663</span>  *  作用助変数
<span class='line'>3664</span>  * @returns {Number}
<span class='line'>3665</span>  * この式はベジェの定義どおりの式 単項の値を戻す
<span class='line'>3666</span>  */</span><span class="WHIT">
<span class='line'>3667</span> </span><span class="NAME">nas.bezier</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SP</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">EP</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">T</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3668</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Ax</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">EP</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">SP</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">CP2</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">CP1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3669</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Bx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">CP2</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">CP1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">SP</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3670</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Cx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">CP1</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">SP</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3671</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Ax</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">T</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Bx</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">T</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Cx</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">T</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">SP</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3672</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3673</span> 
<span class='line'>3674</span> </span><span class="COMM">/**
<span class='line'>3675</span>  * 一次ベジェの逆関数 係数と値から助変数tをもとめる
<span class='line'>3676</span>  * この関数は範囲を限定してタイミングを求める関数の一部として生かし
<span class='line'>3677</span>  * SP=0 , EP=1 に固定
<span class='line'>3678</span>  *
<span class='line'>3679</span>  * @param {Number} CP1
<span class='line'>3680</span>  *  制御点1
<span class='line'>3681</span>  * @param {Number} CP2
<span class='line'>3682</span>  *  制御点2
<span class='line'>3683</span>  * @param {Number} Vl
<span class='line'>3684</span>  *  助変数探索を行う値
<span class='line'>3685</span>  * @returns {Number}
<span class='line'>3686</span>  * 制御点の範囲を0-1に限定して値の増加傾向を維持することで、値に対する助変数を決定する関数
<span class='line'>3687</span>  * 一般値を求める関数ではない
<span class='line'>3688</span>  */</span><span class="WHIT">
<span class='line'>3689</span> </span><span class="NAME">nas.bezierA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">CP1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vl</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3690</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3691</span>      */</span><span class="WHIT">
<span class='line'>3692</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Vl</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">CP1</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">CP2</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">Vl</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">CP1</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">CP2</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3693</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"rangeover"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3694</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3695</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Ck</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3696</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Vl</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3697</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>3698</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3699</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Vl</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3700</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT">
<span class='line'>3701</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3702</span> </span><span class="WHIT">            </span><span class="COMM">/*
<span class='line'>3703</span>              * 初期化
<span class='line'>3704</span>              * 助変数の初期値を値にとる
<span class='line'>3705</span>              * テスト用仮値
<span class='line'>3706</span>              */</span><span class="WHIT">
<span class='line'>3707</span> </span><span class="WHIT">            </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vl</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3708</span> </span><span class="WHIT">            </span><span class="COMM">/*
<span class='line'>3709</span>              * 求めた助変数でテスト値をとる
<span class='line'>3710</span>              * 助変数が
<span class='line'>3711</span>              */</span><span class="WHIT">
<span class='line'>3712</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">TESTv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.bezier</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">t</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//初期テスト値</span><span class="WHIT">
<span class='line'>3713</span> </span><span class="WHIT">            </span><span class="COMM">/*
<span class='line'>3714</span>              * 上限値
<span class='line'>3715</span>              */</span><span class="WHIT">
<span class='line'>3716</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">UPv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3717</span> </span><span class="WHIT">            </span><span class="COMM">/*
<span class='line'>3718</span>              * 下限値
<span class='line'>3719</span>              */</span><span class="WHIT">
<span class='line'>3720</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">DOWNv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3721</span> </span><span class="WHIT">            </span><span class="KEYW">do</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3722</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">TESTv</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">Vl</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3723</span> </span><span class="WHIT">                    </span><span class="NAME">DOWNv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT">
<span class='line'>3724</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3725</span> </span><span class="WHIT">                    </span><span class="NAME">UPv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT">
<span class='line'>3726</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3727</span> </span><span class="WHIT">                </span><span class="COMM">/*
<span class='line'>3728</span>                  * テスト値によって上限または下限を入れ換え
<span class='line'>3729</span>                  * @type {number}
<span class='line'>3730</span>                  */</span><span class="WHIT">
<span class='line'>3731</span> </span><span class="WHIT">                </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">DOWNv</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">UPv</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3732</span> </span><span class="WHIT">                </span><span class="COMM">/*
<span class='line'>3733</span>                  * チェック回数(デバック用)
<span class='line'>3734</span>                  * @type {number}
<span class='line'>3735</span>                  */</span><span class="WHIT">
<span class='line'>3736</span> </span><span class="WHIT">                </span><span class="NAME">Ck</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Ck</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3737</span> </span><span class="WHIT">                </span><span class="NAME">TESTv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.bezier</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">t</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3738</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">TESTv</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">Vl</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0.999999999</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">TESTv</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">Vl</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1.0000000001</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3739</span> </span><span class="WHIT">            </span><span class="COMM">/*
<span class='line'>3740</span>              * テスト値が目標値にたいして十分な精度になるまでループ(精度調整待ち 05/01)
<span class='line'>3741</span>              */</span><span class="WHIT">
<span class='line'>3742</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3743</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3744</span> </span><span class="WHIT">    </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">100000000</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">100000000</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3745</span> 
<span class='line'>3746</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dbg</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">dbg_info.notice</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"loop-count is "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Ct</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3747</span> </span><span class="WHIT">    </span><span class="COMM">/*
<span class='line'>3748</span>      * デバッグメモにカウンタの値を入れる
<span class='line'>3749</span>      * 助変数
<span class='line'>3750</span>      */</span><span class="WHIT">
<span class='line'>3751</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">t</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3752</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Result</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3753</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3754</span> 
<span class='line'>3755</span> </span><span class="COMM">/**
<span class='line'>3756</span>  * 一般式 ﾍﾞｼﾞｪの弧の長さを求める
<span class='line'>3757</span>  * &lt;br />
<span class='line'>3758</span>  * bezierL(開始値,制御点1,制御点2,終了値[[,開始助変数,終了助変数],分割数])
<span class='line'>3759</span>  * 分割数が省略された場合は    10
<span class='line'>3760</span>  * 開始・終了助変数が省略された場合は    0-1
<span class='line'>3761</span>  *
<span class='line'>3762</span>  * @param {Number or Array} SP
<span class='line'>3763</span>  *  開始点
<span class='line'>3764</span>  * @param {Number or Array} CP1
<span class='line'>3765</span>  *  制御点1
<span class='line'>3766</span>  * @param {Number or Array} CP2
<span class='line'>3767</span>  *  制御点2
<span class='line'>3768</span>  * @param {Number or Array} EP
<span class='line'>3769</span>  *  終了点
<span class='line'>3770</span>  * @param {Number} sT
<span class='line'>3771</span>  *  開始助変数
<span class='line'>3772</span>  * @param {Number} eT
<span class='line'>3773</span>  *  終了助変数
<span class='line'>3774</span>  * @param {Number} Slice
<span class='line'>3775</span>  *  分割数
<span class='line'>3776</span>  * @returns {Number}
<span class='line'>3777</span>  *  戻り値の制度は分割数に依存するので注意
<span class='line'>3778</span>  */</span><span class="WHIT">
<span class='line'>3779</span> </span><span class="NAME">nas.bezierL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SP</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">EP</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sT</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">eT</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Slice</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3780</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">SP</span><span class="PUNC">)</span><span class="WHIT">    </span><span class="NAME">SP</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3781</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">EP</span><span class="PUNC">)</span><span class="WHIT">    </span><span class="NAME">EP</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3782</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">CP1</span><span class="PUNC">)</span><span class="WHIT">    </span><span class="NAME">CP1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3783</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">CP2</span><span class="PUNC">)</span><span class="WHIT">    </span><span class="NAME">CP2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3784</span> 
<span class='line'>3785</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">Slice</span><span class="PUNC">)</span><span class="WHIT">    </span><span class="NAME">Slice</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3786</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">sT</span><span class="PUNC">)</span><span class="WHIT">    </span><span class="NAME">sT</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3787</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">eT</span><span class="PUNC">)</span><span class="WHIT">    </span><span class="NAME">eT</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3788</span> 
<span class='line'>3789</span> </span><span class="WHIT">    </span><span class="COMM">/*
<span class='line'>3790</span>      * AEの仕様に合わせて 単項、2次元3次元のみを扱う
<span class='line'>3791</span>      * 引数の次元を取得
<span class='line'>3792</span>      * nas.Point Position等を与える場合は valueOfで配列化すること
<span class='line'>3793</span>      */</span><span class="WHIT">
<span class='line'>3794</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Dim</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">SP</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"number"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">SP.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3795</span> 
<span class='line'>3796</span> </span><span class="WHIT">    </span><span class="COMM">/*
<span class='line'>3797</span>      * 分割長テーブルを作る
<span class='line'>3798</span>      */</span><span class="WHIT">
<span class='line'>3799</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Ltable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">Slice</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3800</span> 
<span class='line'>3801</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">Slice</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3802</span> </span><span class="WHIT">        </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Dim</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3803</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3804</span> </span><span class="WHIT">                </span><span class="NAME">Ltable</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>3805</span> </span><span class="WHIT">                    </span><span class="NAME">this.bezier</span><span class="PUNC">(</span><span class="NAME">SP</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">EP</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sT</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">eT</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sT</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">Slice</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT">
<span class='line'>3806</span> </span><span class="WHIT">                    </span><span class="NAME">this.bezier</span><span class="PUNC">(</span><span class="NAME">SP</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">EP</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sT</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">eT</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sT</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">Slice</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3807</span> </span><span class="WHIT">                </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3808</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3809</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3810</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p1x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.bezier</span><span class="PUNC">(</span><span class="NAME">SP</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP1</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP2</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">EP</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sT</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">eT</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sT</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">Slice</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3811</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p1y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.bezier</span><span class="PUNC">(</span><span class="NAME">SP</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP1</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP2</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">EP</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sT</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">eT</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sT</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">Slice</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3812</span> 
<span class='line'>3813</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p2x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.bezier</span><span class="PUNC">(</span><span class="NAME">SP</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP1</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP2</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">EP</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sT</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">eT</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sT</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">Slice</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3814</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p2y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.bezier</span><span class="PUNC">(</span><span class="NAME">SP</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP1</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP2</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">EP</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sT</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">eT</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sT</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">Slice</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3815</span> </span><span class="COMM">// alert([p1x,p1y],[p2x,p2y]);</span><span class="WHIT">
<span class='line'>3816</span> 
<span class='line'>3817</span> </span><span class="WHIT">                </span><span class="NAME">Ltable</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.length</span><span class="PUNC">(</span><span class="NAME">this.sub</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">p1x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p1y</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">p2x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2y</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3818</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3819</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="NUMB">3</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3820</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p1x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.bezier</span><span class="PUNC">(</span><span class="NAME">SP</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP1</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP2</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">EP</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sT</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">eT</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sT</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">Slice</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3821</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p1y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.bezier</span><span class="PUNC">(</span><span class="NAME">SP</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP1</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP2</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">EP</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sT</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">eT</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sT</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">Slice</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3822</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p1z</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.bezier</span><span class="PUNC">(</span><span class="NAME">SP</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP1</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP2</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">EP</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sT</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">eT</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sT</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">Slice</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3823</span> 
<span class='line'>3824</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p2x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.bezier</span><span class="PUNC">(</span><span class="NAME">SP</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP1</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP2</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">EP</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sT</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">eT</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sT</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">Slice</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3825</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p2y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.bezier</span><span class="PUNC">(</span><span class="NAME">SP</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP1</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP2</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">EP</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sT</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">eT</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sT</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">Slice</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3826</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p2z</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.bezier</span><span class="PUNC">(</span><span class="NAME">SP</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP1</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CP2</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">EP</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sT</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">eT</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sT</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">Slice</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3827</span> </span><span class="WHIT">                </span><span class="NAME">Ltable</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.length</span><span class="PUNC">(</span><span class="NAME">this.sub</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">p1x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p1y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p1z</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">p2x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2z</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3828</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3829</span> </span><span class="WHIT">            </span><span class="KEYW">default</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3830</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3831</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3832</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3833</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">T</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3834</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">n</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">Ltable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3835</span> </span><span class="WHIT">        </span><span class="NAME">T</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Ltable</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>3836</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3837</span> 
<span class='line'>3838</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">T</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3839</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3840</span> 
<span class='line'>3841</span> </span><span class="COMM">/**
<span class='line'>3842</span>  * 暫定色彩関連関数
<span class='line'>3843</span>  * @param colorString
<span class='line'>3844</span>  * @returns {*}
<span class='line'>3845</span>  */</span><span class="WHIT">
<span class='line'>3846</span> </span><span class="NAME">nas.colorStr2Ary</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">colorString</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3847</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Cr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">.</span><span class="NUMB">5</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3848</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Cg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">.</span><span class="NUMB">5</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3849</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Cb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">.</span><span class="NUMB">5</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3850</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">colorString.match</span><span class="PUNC">(</span><span class="REGX">/^\#[0-9abcdef]+/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3851</span> </span><span class="WHIT">        </span><span class="NAME">Cr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">eval</span><span class="PUNC">(</span><span class="STRN">"0x"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">colorString.substr</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" /255"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3852</span> </span><span class="WHIT">        </span><span class="NAME">Cg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">eval</span><span class="PUNC">(</span><span class="STRN">"0x"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">colorString.substr</span><span class="PUNC">(</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" /255"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3853</span> </span><span class="WHIT">        </span><span class="NAME">Cb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">eval</span><span class="PUNC">(</span><span class="STRN">"0x"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">colorString.substr</span><span class="PUNC">(</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" /255"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3854</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">Cr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Cg</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Cb</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3855</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3856</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">colorString.match</span><span class="PUNC">(</span><span class="REGX">/^rgb\([\d]*\%?[\s\,]+[\d]*\%?[\s\,]+[\d]*\%?\)$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3857</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">eval</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>3858</span> </span><span class="WHIT">            </span><span class="NAME">colorString.replace</span><span class="PUNC">(</span><span class="REGX">/rgb\(/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"\["</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\)/ig</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"\]"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\%/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"\*2.55"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3859</span> </span><span class="WHIT">        </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3860</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.div</span><span class="PUNC">(</span><span class="NAME">myColor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">255</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3861</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3862</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">Cr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Cg</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Cb</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3863</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3864</span> 
<span class='line'>3865</span> </span><span class="COMM">/**
<span class='line'>3866</span>  * WEB色指定用の文字列を3次元の配列にして返す
<span class='line'>3867</span>  * @param colorArray
<span class='line'>3868</span>  * @returns {string}
<span class='line'>3869</span>  */</span><span class="WHIT">
<span class='line'>3870</span> </span><span class="NAME">nas.colorAry2Str</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">colorArray</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3871</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Sr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">colorArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">255</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">16</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT">
<span class='line'>3872</span> </span><span class="WHIT">        </span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">colorArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">255</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="NUMB">16</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3873</span> </span><span class="WHIT">    </span><span class="STRN">"0"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">colorArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">255</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="NUMB">16</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3874</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Sg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">colorArray</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">255</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">16</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT">
<span class='line'>3875</span> </span><span class="WHIT">        </span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">colorArray</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">255</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="NUMB">16</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3876</span> </span><span class="WHIT">    </span><span class="STRN">"0"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">colorArray</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">255</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="NUMB">16</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3877</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Sb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">colorArray</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">255</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">16</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT">
<span class='line'>3878</span> </span><span class="WHIT">        </span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">colorArray</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">255</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="NUMB">16</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3879</span> </span><span class="WHIT">    </span><span class="STRN">"0"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">colorArray</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">255</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="NUMB">16</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3880</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"#"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Sr</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Sg</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Sb</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3881</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3882</span> 
<span class='line'>3883</span> 
<span class='line'>3884</span> </span><span class="COMM">/**
<span class='line'>3885</span>  * 配列形式のカラーデータを16進文字列で返す
<span class='line'>3886</span>  */</span><span class="WHIT">
<span class='line'>3887</span> 
<span class='line'>3888</span> </span><span class="COMM">/**
<span class='line'>3889</span>  * 行列計算関数群
<span class='line'>3890</span>  * 原型となったtcl 処理系との互換のため引数はリスト文字列または1次元の配列で与える必要があるので注意
<span class='line'>3891</span>  */</span><span class="WHIT">
<span class='line'>3892</span> 
<span class='line'>3893</span> </span><span class="COMM">/**
<span class='line'>3894</span>  * 行列表示(特設デバッグ表示)
<span class='line'>3895</span>  * @param Name
<span class='line'>3896</span>  * @param Matrix
<span class='line'>3897</span>  * @param L
<span class='line'>3898</span>  * @param C
<span class='line'>3899</span>  */</span><span class="WHIT">
<span class='line'>3900</span> </span><span class="NAME">nas.showMatrix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Matrix</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">L</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">C</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3901</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">Matrix</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">Matrix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Matrix.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3902</span> </span><span class="WHIT">    </span><span class="NAME">Matrix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Matrix.split</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3903</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3904</span>      * 表示名 行列リスト 行数 列数
<span class='line'>3905</span>      * @type {string}
<span class='line'>3906</span>      */</span><span class="WHIT">
<span class='line'>3907</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">":\n"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3908</span> 
<span class='line'>3909</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">L</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3910</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">C</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3911</span> </span><span class="COMM">//	puts -nonewline [format \t%\ 4.4f [lindex ${Matrix} [expr ${i} * ${C} + ${j}]]]</span><span class="WHIT">
<span class='line'>3912</span> </span><span class="WHIT">            </span><span class="NAME">Result</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\t "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Matrix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">C</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3913</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3914</span> </span><span class="WHIT">        </span><span class="NAME">Result</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\n"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3915</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3916</span> </span><span class="WHIT">    </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="NAME">Result</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3917</span> 
<span class='line'>3918</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3919</span> </span><span class="COMM">/**
<span class='line'>3920</span>  *  @desc 行列表示終わり
<span class='line'>3921</span>  */</span><span class="WHIT">
<span class='line'>3922</span> 
<span class='line'>3923</span> </span><span class="COMM">/**
<span class='line'>3924</span>  * 行列式計算(2または3,4 の正方行列のみ)
<span class='line'>3925</span>  * @param myMatrix
<span class='line'>3926</span>  * @returns {*}
<span class='line'>3927</span>  */</span><span class="WHIT">
<span class='line'>3928</span> </span><span class="NAME">nas.mDeterminant</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myMatrix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3929</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myMatrix</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3930</span> </span><span class="WHIT">        </span><span class="NAME">myMatrix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myMatrix.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3931</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3932</span> </span><span class="WHIT">        </span><span class="NAME">myMatrix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myMatrix.split</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3933</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3934</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myMatrix.length</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">myMatrix.length</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">9</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">myMatrix.length</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">16</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3935</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3936</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="COMM">//ひとまずヌル返す？</span><span class="WHIT">
<span class='line'>3937</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myMatrix.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3938</span> </span><span class="COMM">//var Result [expr [lindex ${Matrix} 0] * [lindex ${Matrix} 3] - [lindex ${Matrix} 1] * [lindex ${Matrix} 2]]</span><span class="WHIT">
<span class='line'>3939</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>3940</span>          * 2×2の正方行列式
<span class='line'>3941</span>          * @type {number}
<span class='line'>3942</span>          */</span><span class="WHIT">
<span class='line'>3943</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myMatrix</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">myMatrix</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">myMatrix</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">myMatrix</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3944</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3945</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myMatrix.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">9</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3946</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>3947</span>              * 3×3の正方行列
<span class='line'>3948</span>              * @type {number}
<span class='line'>3949</span>              */</span><span class="WHIT">
<span class='line'>3950</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3951</span> </span><span class="WHIT">            </span><span class="NAME">Result</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">myMatrix</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">myMatrix</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">myMatrix</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3952</span> </span><span class="WHIT">            </span><span class="NAME">Result</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">myMatrix</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">myMatrix</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">myMatrix</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3953</span> </span><span class="WHIT">            </span><span class="NAME">Result</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">myMatrix</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">myMatrix</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">myMatrix</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3954</span> </span><span class="WHIT">            </span><span class="NAME">Result</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">myMatrix</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">myMatrix</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">myMatrix</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3955</span> </span><span class="WHIT">            </span><span class="NAME">Result</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">myMatrix</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">myMatrix</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">myMatrix</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3956</span> </span><span class="WHIT">            </span><span class="NAME">Result</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">myMatrix</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">myMatrix</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">myMatrix</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3957</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3958</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>3959</span>              * 正方行列 4x4
<span class='line'>3960</span>              * @type {*[]}
<span class='line'>3961</span>              */</span><span class="WHIT">
<span class='line'>3962</span> </span><span class="WHIT">            </span><span class="NAME">myMatrix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">myMatrix.slice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myMatrix.slice</span><span class="PUNC">(</span><span class="NUMB">4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">8</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myMatrix.slice</span><span class="PUNC">(</span><span class="NUMB">8</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myMatrix.slice</span><span class="PUNC">(</span><span class="NUMB">12</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3963</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3964</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">buf</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3965</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">//配列の次数</span><span class="WHIT">
<span class='line'>3966</span> 
<span class='line'>3967</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>3968</span>              * 三角行列を作成
<span class='line'>3969</span>              */</span><span class="WHIT">
<span class='line'>3970</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3971</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3972</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3973</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">buf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myMatrix</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">myMatrix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3974</span> </span><span class="WHIT">                        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3975</span> </span><span class="WHIT">                            </span><span class="NAME">myMatrix</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myMatrix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">buf</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3976</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3977</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3978</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3979</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3980</span> 
<span class='line'>3981</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>3982</span>              * 対角部分の積
<span class='line'>3983</span>              */</span><span class="WHIT">
<span class='line'>3984</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3985</span> </span><span class="WHIT">                </span><span class="NAME">Result</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myMatrix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>3986</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3987</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3988</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3989</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Result</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3990</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3991</span> </span><span class="COMM">/**
<span class='line'>3992</span>  * @desc 行列式計算終わり
<span class='line'>3993</span>  */</span><span class="WHIT">
<span class='line'>3994</span> 
<span class='line'>3995</span> </span><span class="COMM">/**
<span class='line'>3996</span>  * 行列の積算
<span class='line'>3997</span>  * @param M1
<span class='line'>3998</span>  * @param M2
<span class='line'>3999</span>  * @returns {*}
<span class='line'>4000</span>  */</span><span class="WHIT">
<span class='line'>4001</span> </span><span class="NAME">nas.multiMatrix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">M1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">M2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4002</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">M1</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4003</span> </span><span class="WHIT">        </span><span class="NAME">M1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">M1.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4004</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4005</span> </span><span class="WHIT">        </span><span class="NAME">M1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">M1.split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4006</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4007</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">M2</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4008</span> </span><span class="WHIT">        </span><span class="NAME">M2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">M2.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4009</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4010</span> </span><span class="WHIT">        </span><span class="NAME">M2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">M2.split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4011</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4012</span> 
<span class='line'>4013</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4014</span>      * M1 は、3×3の行列 M2は、3×? の行列でなくてはならない
<span class='line'>4015</span>      * それ以外の場合は、3×3 の単位行列を返す
<span class='line'>4016</span>      */</span><span class="WHIT">
<span class='line'>4017</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">M1.length</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">9</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">M2.length</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4018</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"1,0,0,0,1,0,0,0,1"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4019</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4020</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4021</span>      *  応答行列初期化
<span class='line'>4022</span>      * @type {Array}
<span class='line'>4023</span>      */</span><span class="WHIT">
<span class='line'>4024</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">multiprideMatrix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4025</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4026</span>      * 行列の次数を設定
<span class='line'>4027</span>      * @type {number}
<span class='line'>4028</span>      */</span><span class="WHIT">
<span class='line'>4029</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">D1C</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4030</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">D1L</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4031</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">D2C</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">M2.length</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">D1L</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4032</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">D2L</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">D1C</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4033</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Mi</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">Mi</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">D1L</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">Mi</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4034</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Mj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">Mj</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">D2C</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">Mj</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4035</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">X</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4036</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">D1C</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">count</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4037</span> </span><span class="WHIT">                </span><span class="NAME">X</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">X</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">M1</span><span class="PUNC">[</span><span class="NAME">Mi</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">D1C</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">count</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">M2</span><span class="PUNC">[</span><span class="NAME">Mj</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NAME">D2C</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">D2C</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">count</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4038</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4039</span> </span><span class="WHIT">            </span><span class="NAME">multiprideMatrix.push</span><span class="PUNC">(</span><span class="NAME">X</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4040</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4041</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4042</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">multiprideMatrix.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4043</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4044</span> </span><span class="COMM">/**
<span class='line'>4045</span>  * @desc 行列の積算終わり
<span class='line'>4046</span>  */</span><span class="WHIT">
<span class='line'>4047</span> 
<span class='line'>4048</span> 
<span class='line'>4049</span> </span><span class="COMM">/**
<span class='line'>4050</span>  * 逆行列生成
<span class='line'>4051</span>  * 2次または3次/4次の正方行列である必要があります。
<span class='line'>4052</span>  * @param Matrix
<span class='line'>4053</span>  * @returns {*}
<span class='line'>4054</span>  */</span><span class="WHIT">
<span class='line'>4055</span> </span><span class="NAME">nas.mInverse</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Matrix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4056</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Matrix</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4057</span> </span><span class="WHIT">        </span><span class="NAME">Matrix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Matrix.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4058</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4059</span> </span><span class="WHIT">        </span><span class="NAME">Matrix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Matrix.split</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4060</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4061</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Matrix.length</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">Matrix.length</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">9</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">Matrix.length</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">16</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4062</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4063</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4064</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4065</span>      * 逆行列初期化
<span class='line'>4066</span>      * @type {Array}
<span class='line'>4067</span>      */</span><span class="WHIT">
<span class='line'>4068</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">InversedMatrix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4069</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4070</span>      * 行列の次数を取得
<span class='line'>4071</span>      * @type {number}
<span class='line'>4072</span>      */</span><span class="WHIT">
<span class='line'>4073</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">D</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">Matrix.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">// expr int(sqrt ([llength ${Matrix}]))]</span><span class="WHIT">
<span class='line'>4074</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4075</span>      * 余因数生成
<span class='line'>4076</span>      */</span><span class="WHIT">
<span class='line'>4077</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">D</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4078</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">D</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4079</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Cm</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4080</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Cj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">Cj</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">D</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">Cj</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4081</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Ci</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">Ci</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">D</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">Ci</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4082</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">Cj</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4083</span> 
<span class='line'>4084</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4085</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">Ci</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4086</span> 
<span class='line'>4087</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4088</span> </span><span class="WHIT">                            </span><span class="NAME">Cm.push</span><span class="PUNC">(</span><span class="NAME">Matrix</span><span class="PUNC">[</span><span class="NAME">Cj</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">D</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Ci</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4089</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4090</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4091</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4092</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4093</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Mx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.mDeterminant</span><span class="PUNC">(</span><span class="NAME">Matrix</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4094</span> </span><span class="WHIT">            </span><span class="NAME">InversedMatrix.push</span><span class="PUNC">(</span><span class="NAME">this.mDeterminant</span><span class="PUNC">(</span><span class="NAME">Cm</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">Mx</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4095</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4096</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4097</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.transMatrix</span><span class="PUNC">(</span><span class="NAME">InversedMatrix</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4098</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4099</span> </span><span class="COMM">/**
<span class='line'>4100</span>  * @desc 逆行列生成終わり
<span class='line'>4101</span>  */</span><span class="WHIT">
<span class='line'>4102</span> 
<span class='line'>4103</span> 
<span class='line'>4104</span> </span><span class="COMM">/**
<span class='line'>4105</span>  * 行列の転置
<span class='line'>4106</span>  * @param Matrix
<span class='line'>4107</span>  * @returns {*}
<span class='line'>4108</span>  
<span class='line'>4109</span>     引数は以下の型式を受け入れる
<span class='line'>4110</span>     '1,0,0,1','1,0,0,0,1,0,0,0,1' ,'1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1'
<span class='line'>4111</span> コンマ区切り文字列リストただしコンマ区切りの要素数が4,9,16(それぞれ2,3,4次の正方行列)のみ
<span class='line'>4112</span>     ['1,0','0,1'],['1,0,0','0,1,0','0,0,1'],['1,0,0,0','0,1,0,0','0,0,1,0','0,0,0,1']
<span class='line'>4113</span> コンマ区切りリスト文字列を要素とする１次配列  同上それぞれ2,3,4次の正方行列のみ
<span class='line'>4114</span>     [[1,2,3],[4,5,6],[7,8,9],[10,11,12]]
<span class='line'>4115</span> ２次元配列  要素数は自由  引数配列の要素すべてが配列でなければならない  次数は自由
<span class='line'>4116</span> 内包要素の次数はすべて揃っている必要がある。
<span class='line'>4117</span> 戻り値は配列に変更
<span class='line'>4118</span> 
<span class='line'>4119</span> */</span><span class="WHIT">
<span class='line'>4120</span> </span><span class="NAME">nas.transMatrix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Matrix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4121</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4122</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Matrix</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4123</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Matrix</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4124</span> </span><span class="WHIT">            </span><span class="NAME">dy</span><span class="PUNC">=</span><span class="NAME">Matrix.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4125</span> </span><span class="WHIT">            </span><span class="NAME">dx</span><span class="PUNC">=</span><span class="NAME">Matrix</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4126</span> </span><span class="WHIT">            </span><span class="COMM">//２次元配列なら要素数を検査して不整合があればリジェクト</span><span class="WHIT">
<span class='line'>4127</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">idx</span><span class="PUNC">&lt;</span><span class="NAME">dy</span><span class="PUNC">;</span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4128</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Matrix</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4129</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4130</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4131</span> </span><span class="WHIT">        </span><span class="NAME">Matrix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Matrix.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4132</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4133</span> </span><span class="WHIT">        </span><span class="NAME">Matrix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Matrix.split</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4134</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4135</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">dx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dy</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>4136</span> </span><span class="WHIT">    </span><span class="PUNC">(</span><span class="NAME">Matrix.length</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">Matrix.length</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">9</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">Matrix.length</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">16</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4137</span> </span><span class="WHIT">    </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4138</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4139</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4140</span> </span><span class="WHIT">            </span><span class="COMM">/**
<span class='line'>4141</span>      * 行列の次数を取得
<span class='line'>4142</span>      * @type {number}
<span class='line'>4143</span>      */</span><span class="WHIT">
<span class='line'>4144</span> </span><span class="WHIT">        </span><span class="NAME">dx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">Matrix.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4145</span> </span><span class="WHIT">        </span><span class="NAME">dy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4146</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4147</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4148</span>      * 転置配列の初期化
<span class='line'>4149</span>      * @type {Array}
<span class='line'>4150</span>      */</span><span class="WHIT">
<span class='line'>4151</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tranposedMatrix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4152</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4153</span>      * 転置
<span class='line'>4154</span>      */</span><span class="WHIT">
<span class='line'>4155</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4156</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4157</span> </span><span class="WHIT">            </span><span class="NAME">tranposedMatrix.push</span><span class="PUNC">(</span><span class="NAME">Matrix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4158</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4159</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4160</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">tranposedMatrix</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4161</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4162</span> </span><span class="COMM">// nas.transMatrix([[1,2,3],[4,5,6],[7,8,9]]);</span><span class="WHIT">
<span class='line'>4163</span> </span><span class="COMM">/**
<span class='line'>4164</span>  * 行列の転置終わり
<span class='line'>4165</span>  * 行列関数群終わり
<span class='line'>4166</span>  */</span><span class="WHIT">
<span class='line'>4167</span> 
<span class='line'>4168</span> </span><span class="COMM">/**
<span class='line'>4169</span>  * 回転角関連
<span class='line'>4170</span>  * azimuth（アジマス）は地図・海図等で使用する方位角。
<span class='line'>4171</span>  * ここでは時計の12時方向(北=N)を0度として時計回り方向に 1周360°の単位系とします。
<span class='line'>4172</span>  * 方位角の概念は AEには存在しない
<span class='line'>4173</span>  * @param degrees
<span class='line'>4174</span>  * @returns {number}
<span class='line'>4175</span>  */</span><span class="WHIT">
<span class='line'>4176</span> </span><span class="NAME">nas.deg2azi</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">degrees</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="COMM">//傾斜角から方位へ</span><span class="WHIT">
<span class='line'>4177</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">degrees</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">90</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4178</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4179</span> </span><span class="NAME">nas.azi2deg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">azimuth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="COMM">//方位から傾斜角へ</span><span class="WHIT">
<span class='line'>4180</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">azimuth</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">90</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4181</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4182</span> 
<span class='line'>4183</span> </span><span class="COMM">/**
<span class='line'>4184</span>  * 2次元のベクトルを与えて方位角を求める。長さを加えるべきか？
<span class='line'>4185</span>  * 引数formは戻し値の形式を指定。デフォルトは方位角
<span class='line'>4186</span>  * @param Vector
<span class='line'>4187</span>  * @param form
<span class='line'>4188</span>  * @returns {*}
<span class='line'>4189</span>  */</span><span class="WHIT">
<span class='line'>4190</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">vec2deg</span><span class="PUNC">(</span><span class="NAME">Vector</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">form</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4191</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Vector.length</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4192</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>4193</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4194</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">form</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4195</span> </span><span class="WHIT">        </span><span class="NAME">form</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"degrees"</span><span class="WHIT">
<span class='line'>4196</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4197</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4198</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4199</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myRadians</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">Math.atan</span><span class="PUNC">(</span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4200</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4201</span> </span><span class="WHIT">        </span><span class="NAME">myRadians</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="WHIT">
<span class='line'>4202</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4203</span> </span><span class="WHIT">    </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4204</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">        </span><span class="STRN">"redians"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4205</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myRadians</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4206</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4207</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">        </span><span class="STRN">"degrees"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4208</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NUMB">180.</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myRadians</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">10000</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">10000</span><span class="PUNC">;</span><span class="COMM">//degrees;</span><span class="WHIT">
<span class='line'>4209</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4210</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">        </span><span class="STRN">"azimuth"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4211</span> </span><span class="WHIT">        </span><span class="KEYW">default</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4212</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.deg2azi</span><span class="PUNC">(</span><span class="NAME">radiansToDegrees</span><span class="PUNC">(</span><span class="NAME">myRadians</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4213</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4214</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4215</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4216</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4217</span> </span><span class="COMM">/**
<span class='line'>4218</span>  * 暫定文字列操作メソッド
<span class='line'>4219</span>  * バイト数を返す。
<span class='line'>4220</span>  * 実装によっては内部コードが違うのでマルチバイト部分のバイト数は同じとは限らない。
<span class='line'>4221</span>  * @param myString
<span class='line'>4222</span>  * @returns {number}
<span class='line'>4223</span>  */</span><span class="WHIT">
<span class='line'>4224</span> </span><span class="NAME">nas.biteCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myString</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4225</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myString</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4226</span> </span><span class="WHIT">        </span><span class="NAME">myString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4227</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4228</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">btCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4229</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">cid</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myString.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">cid</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4230</span> </span><span class="WHIT">        </span><span class="NAME">cXV</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myString.charCodeAt</span><span class="PUNC">(</span><span class="NAME">cid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4231</span> </span><span class="WHIT">        </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cXV</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4232</span> </span><span class="WHIT">            </span><span class="NAME">btCount</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4233</span> </span><span class="WHIT">            </span><span class="NAME">cXV</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">cXV</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">256</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4234</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4235</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4236</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">btCount</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4237</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4238</span> 
<span class='line'>4239</span> 
<span class='line'>4240</span> </span><span class="COMM">/**
<span class='line'>4241</span>  * 文字列のバイト数を勘定して、指定バイト以下の文字列に区切って返す。
<span class='line'>4242</span>  * AEのラベル31バイト制限用なので、デフォルトは 31
<span class='line'>4243</span>  * @param myString
<span class='line'>4244</span>  * @param count
<span class='line'>4245</span>  * @returns {*}
<span class='line'>4246</span>  */</span><span class="WHIT">
<span class='line'>4247</span> </span><span class="NAME">nas.biteClip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myString</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">count</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4248</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myString</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4249</span> </span><span class="WHIT">        </span><span class="NAME">myString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4250</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4251</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">count</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4252</span> </span><span class="WHIT">        </span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">31</span><span class="WHIT">
<span class='line'>4253</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4254</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">btCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4255</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">cid</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myString.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">cid</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4256</span> </span><span class="WHIT">        </span><span class="NAME">cXV</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myString.charCodeAt</span><span class="PUNC">(</span><span class="NAME">cid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4257</span> </span><span class="WHIT">        </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cXV</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4258</span> </span><span class="WHIT">            </span><span class="NAME">btCount</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4259</span> </span><span class="WHIT">            </span><span class="NAME">cXV</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">cXV</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">256</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4260</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4261</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">btCount</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">count</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4262</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myString.slice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4263</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4264</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4265</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myString</span><span class="PUNC">;</span><span class="COMM">//抜けたら全部返す</span><span class="WHIT">
<span class='line'>4266</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4267</span> 
<span class='line'>4268</span> </span><span class="COMM">/**
<span class='line'>4269</span>  * 前後の空白を払う
<span class='line'>4270</span>  * @param myString
<span class='line'>4271</span>  * @returns {XML|string}
<span class='line'>4272</span>  */</span><span class="WHIT">
<span class='line'>4273</span> </span><span class="NAME">nas.chopString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myString</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4274</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myString.replace</span><span class="PUNC">(</span><span class="REGX">/^\s+/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\s+$/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4275</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4276</span> 
<span class='line'>4277</span> </span><span class="COMM">/**
<span class='line'>4278</span>  * nas.incrStr(myString,Step,Opt)
<span class='line'>4279</span>  * 引数  任意文字列
<span class='line'>4280</span>  * 戻値	文字列の末尾の番号部分をステップ数くり上げて返す
<span class='line'>4281</span>  * ステップに負の数を与えると減算 戻り値が0負の数の場合は元の文字列を戻す
<span class='line'>4282</span>  * １０進数値のみサポート
<span class='line'>4283</span>  * 数字の末尾にサブバージョン表記として[a-z]の
<span class='line'>4284</span>  * postfixがあってもそれを切り捨てて評価するのでちょっとだけ便利
<span class='line'>4285</span>  * 番号がなければそのまま戻す
<span class='line'>4286</span>  * オプションでpostfixを付けて戻す
<span class='line'>4287</span>  *
<span class='line'>4288</span>  * @param myString
<span class='line'>4289</span>  * @param myStep
<span class='line'>4290</span>  * @param myOpt
<span class='line'>4291</span>  * @returns {*}
<span class='line'>4292</span>  */</span><span class="WHIT">
<span class='line'>4293</span> </span><span class="NAME">nas.incrStr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myString</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myStep</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myOpt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4294</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">myOpt</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4295</span> </span><span class="WHIT">        </span><span class="NAME">myOpt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>4296</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4297</span> </span><span class="WHIT">    </span><span class="COMM">//if true with postFix</span><span class="WHIT">
<span class='line'>4298</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">myStep</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4299</span> </span><span class="WHIT">        </span><span class="NAME">myStep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT">
<span class='line'>4300</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4301</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myString.match</span><span class="PUNC">(</span><span class="REGX">/^(.*[^\d])?(\d+)([^0-9]*)$/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4302</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myPreFix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4303</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myNumber</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4304</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myPstFix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myOpt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">RegExp.$3</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4305</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newNum</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">myNumber</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myStep</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">nas.Zf</span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">myNumber</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myStep</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myNumber.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">myNumber</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4306</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myPreFix</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">newNum</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myPstFix</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4307</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4308</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myString</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4309</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4310</span> 
<span class='line'>4311</span> </span><span class="COMM">/**
<span class='line'>4312</span>  * nas.propCount(myObject,option)
<span class='line'>4313</span>  * 引数:	任意のオブジェクト,リストスイッチ
<span class='line'>4314</span>  * 戻値	オブジェクトのもつプロパティの数
<span class='line'>4315</span>  *
<span class='line'>4316</span>  * 単純にオブジェクトの総数を返す
<span class='line'>4317</span>  * 削除されたが参照が残っているために無効になったオブジェクトを検査するために作成
<span class='line'>4318</span>  * ただしそれ以外の用途で使用できないわけではない
<span class='line'>4319</span>  * リストスイッチを入れるとプロパティを配列で返す
<span class='line'>4320</span>  *
<span class='line'>4321</span>  * @param myObject
<span class='line'>4322</span>  * @param myOption
<span class='line'>4323</span>  * @returns {*}
<span class='line'>4324</span>  */</span><span class="WHIT">
<span class='line'>4325</span> </span><span class="NAME">nas.propCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myObject</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myOption</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4326</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myObject</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4327</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4328</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4329</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myOption</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4330</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resultArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4331</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4332</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4333</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">prp</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">myObject</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4334</span> </span><span class="WHIT">        </span><span class="NAME">myResult</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4335</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myOption</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4336</span> </span><span class="WHIT">            </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="NAME">prp</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4337</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4338</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4339</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myOption</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4340</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">resultArray</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4341</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4342</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4343</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4344</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4345</span> 
<span class='line'>4346</span> 
<span class='line'>4347</span> </span><span class="COMM">/**
<span class='line'>4348</span>  * 単位つきの文字列値を数値にして返すメソッド
<span class='line'>4349</span>  *
<span class='line'>4350</span>  * nas.decodeUnit(入力値,変換単位)
<span class='line'>4351</span>  *
<span class='line'>4352</span>  * 解釈できる単位は millimeters mm centimeters cm points picas pt pixels px inches in
<span class='line'>4353</span>  * 戻し値の単位も同じく
<span class='line'>4354</span>  * デフォルトの単位は入りも戻しも pt
<span class='line'>4355</span>  * 不明な単位は ptとして扱う
<span class='line'>4356</span>  *
<span class='line'>4357</span>  * @param myValue
<span class='line'>4358</span>  * @param resultUnit
<span class='line'>4359</span>  * @returns {*}
<span class='line'>4360</span>  */</span><span class="WHIT">
<span class='line'>4361</span> </span><span class="NAME">nas.decodeUnit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myValue</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">resultUnit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4362</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myValue</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myValue.match</span><span class="PUNC">(</span><span class="REGX">/^([0-9]+.?[0-9]*)\s?(millimeters|mm|centimeters|cm|points|picas|pt|pixels|px|inches|in)?$/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4363</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">baseValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">myValue</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4364</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myUnit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4365</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4366</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4367</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4368</span> </span><span class="COMM">//console.log(resultUnit);</span><span class="WHIT">
<span class='line'>4369</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">resultUnit</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">resultUnit</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^(millimeters|mm|centimeters|cm|points|picas|pt|pixels|px|inches|in)?$/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4370</span> </span><span class="WHIT">        </span><span class="NAME">resultUnit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"pt"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4371</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4372</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myUnit</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">resultUnit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4373</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">baseValue</span><span class="WHIT">
<span class='line'>4374</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4375</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4376</span>      * 入出力単位が一致した場合はコンバート不要
<span class='line'>4377</span>      * すべてptに変換 (ここに誤差が乗る原因あり)
<span class='line'>4378</span>      */</span><span class="WHIT">
<span class='line'>4379</span> </span><span class="WHIT">    </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myUnit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4380</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"inches"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4381</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"in"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4382</span> </span><span class="WHIT">            </span><span class="NAME">myValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">72.</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">baseValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4383</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4384</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"pixels"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4385</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"px"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4386</span> </span><span class="WHIT">            </span><span class="NAME">myValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">72.</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">baseValue</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">this.Dpi</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4387</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4388</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"centimeters"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4389</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"cm"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4390</span> </span><span class="WHIT">            </span><span class="NAME">myValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">72.</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">baseValue</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2.54</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4391</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4392</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"millimeters"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4393</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"mm"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4394</span> </span><span class="WHIT">            </span><span class="NAME">myValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">72.</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">baseValue</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">25.4</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4395</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4396</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"millipoints"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4397</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"mp"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4398</span> </span><span class="WHIT">            </span><span class="NAME">myValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">baseValue</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">1000.</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4399</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4400</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"points"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4401</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"paicas"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4402</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"pt"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4403</span> </span><span class="WHIT">        </span><span class="KEYW">default</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4404</span> </span><span class="WHIT">            </span><span class="NAME">myValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">baseValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4405</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4406</span> </span><span class="WHIT">    </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">resultUnit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4407</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"inches"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4408</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"in"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4409</span> </span><span class="WHIT">            </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myValue</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">72.</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4410</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4411</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"pixels"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4412</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"px"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4413</span> </span><span class="WHIT">            </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.Dpi</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">myValue</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">72.</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4414</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4415</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"centimeters"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4416</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"cm"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4417</span> </span><span class="WHIT">            </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2.54</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myValue</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">72.</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4418</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4419</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"millimeters"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4420</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"mm"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4421</span> </span><span class="WHIT">            </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">25.4</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myValue</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">72.</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4422</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4423</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"millipoints"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4424</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"mp"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4425</span> </span><span class="WHIT">            </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myValue</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1000.</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4426</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4427</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"points"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4428</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"paicas"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4429</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"pt"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4430</span> </span><span class="WHIT">        </span><span class="KEYW">default</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4431</span> </span><span class="WHIT">            </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4432</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4433</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4434</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4435</span> 
<span class='line'>4436</span> 
<span class='line'>4437</span> </span><span class="COMM">/**
<span class='line'>4438</span>  * nas.labelNormalization(myString,mySep,)
<span class='line'>4439</span>  * 引数：ラベル文字列 ,新規セパレータ
<span class='line'>4440</span>  * 戻値:正規化されたラベル文字列
<span class='line'>4441</span>  * ラベル文字列を正規化する
<span class='line'>4442</span>  * セパレータを払って プレフィックス,12桁あわせ整数,ポストフィックス を指定セパレータで結合したものを返す
<span class='line'>4443</span>  * セパレータが指定されない場合は"-(ハイフンマイナス)"
<span class='line'>4444</span>  * 主にAE上でのファイル/レイヤー/アイテムの並べ替え関数で使用
<span class='line'>4445</span>  * 文字列の数字に先行する部分をラベル(=prefix)
<span class='line'>4446</span>  * 最初に現れる数値連続部分を整数値
<span class='line'>4447</span>  * 残りを後置情報とする。
<span class='line'>4448</span>  * この関数はラベル、後置文字列の意味は問わない  
<span class='line'>4449</span>  * @param myString
<span class='line'>4450</span>  * @param mySep
<span class='line'>4451</span>  * @returns {*}
<span class='line'>4452</span>  */</span><span class="WHIT">
<span class='line'>4453</span> </span><span class="NAME">nas.labelNormalization</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myString</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">mySep</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4454</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">myString</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4455</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>4456</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4457</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">mySep</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4458</span> </span><span class="WHIT">        </span><span class="NAME">mySep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"-"</span><span class="WHIT">
<span class='line'>4459</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4460</span> </span><span class="WHIT">    </span><span class="COMM">/*
<span class='line'>4461</span>     var myCell=(myString instanceof nas.CellDescription )? myString :new nas.CellDescription(myString);
<span class='line'>4462</span>     return [myCell.prefix,nas.Zf(nas.parseNumber(myCell.body),12),myCell.postfix].join(mySep);
<span class='line'>4463</span>     */</span><span class="WHIT">
<span class='line'>4464</span> </span><span class="WHIT">    </span><span class="NAME">myString</span><span class="PUNC">=</span><span class="NAME">nas.normalizeStr</span><span class="PUNC">(</span><span class="NAME">myString</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4465</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">myString</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/([^\s\._\-0-9]*)[\s\._\-]?([0-9]+[\s\._\-]?)([^0-9]?.*)/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4466</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">RegExp.$1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nas.Zf</span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">RegExp.$2</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">RegExp.$3</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="NAME">mySep</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4467</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4468</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myString.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4469</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4470</span> 
<span class='line'>4471</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">myString</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/([^\s\._\-0-9]*)[\s\._\-]?([0-9]+)[\s\._\-]?([^0-9]?.*)/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4472</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myPrefix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4473</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myBodyNum</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">RegExp.$2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4474</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myPostfix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4475</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">myPrefix</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nas.Zf</span><span class="PUNC">(</span><span class="NAME">myBodyNum</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myPostfix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="NAME">mySep</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4476</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4477</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myString.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4478</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4479</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4480</span> 
<span class='line'>4481</span> </span><span class="COMM">/*test
<span class='line'>4482</span> console.log(nas.labelNormalization("a 012a下"));
<span class='line'>4483</span> console.log(nas.labelNormalization("01223 Ax",""));
<span class='line'>4484</span> console.log(nas.labelNormalization("A01223","_"));
<span class='line'>4485</span> console.log(nas.labelNormalization("B-01223雨森Ax","."));
<span class='line'>4486</span> console.log(nas.labelNormalization("たぬき3"));
<span class='line'>4487</span> */</span><span class="WHIT">
<span class='line'>4488</span> </span><span class="COMM">//比較補助関数</span><span class="WHIT">
<span class='line'>4489</span> </span><span class="COMM">/** nas.normalizeStr(myString)
<span class='line'>4490</span>  * 
<span class='line'>4491</span>  *  myString.normalizeメソッドが存在すればnormalize("NFKC")をもどす
<span class='line'>4492</span>  */</span><span class="WHIT">
<span class='line'>4493</span> 
<span class='line'>4494</span> </span><span class="NAME">nas.normalizeStr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4495</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">str.normalize</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">str.normalize</span><span class="PUNC">(</span><span class="STRN">"NFKC"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4496</span> </span><span class="COMM">// ノーマライズが無い時は半角化のみ実行</span><span class="WHIT">
<span class='line'>4497</span> 
<span class='line'>4498</span> </span><span class="WHIT">  </span><span class="NAME">str</span><span class="PUNC">=</span><span class="NAME">str.replace</span><span class="PUNC">(</span><span class="REGX">/[！-～]/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4499</span> </span><span class="TOKN"> </span><span class="TOKN"> </span><span class="TOKN"> </span><span class="TOKN"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">String.fromCharCode</span><span class="PUNC">(</span><span class="NAME">s.charCodeAt</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">0xFEE0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//char-code shift</span><span class="WHIT">
<span class='line'>4500</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4501</span> </span><span class="WHIT">  </span><span class="COMM">// 文字コードシフトで対応できない文字の変換</span><span class="WHIT">
<span class='line'>4502</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">str.replace</span><span class="PUNC">(</span><span class="REGX">/”/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"\""</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4503</span> </span><span class="WHIT">    </span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/’/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"'"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4504</span> </span><span class="WHIT">    </span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/‘/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"`"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4505</span> </span><span class="WHIT">    </span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/￥/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"\\"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4506</span> </span><span class="WHIT">    </span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/  /g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4507</span> </span><span class="WHIT">    </span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/〜/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"~"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4508</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4509</span> 
<span class='line'>4510</span> 
<span class='line'>4511</span> </span><span class="COMM">/*test
<span class='line'>4512</span> console.log (nas.normalizeStr("安全ｶｸﾆﾝＢＡＮＤ（12３④５）"));
<span class='line'>4513</span> */</span><span class="WHIT">
<span class='line'>4514</span> 
<span class='line'>4515</span> </span><span class="COMM">/**
<span class='line'>4516</span>  * 文字列中に最初に現れる数値部分を整数化して返す関数
<span class='line'>4517</span>  * 正規化フィルタを通し
<span class='line'>4518</span>  * 最初の数値の前の数字以外の文字を払い１０進で整数化して返す
<span class='line'>4519</span>  * 数値部分が含まれない場合は NaN が戻る
<span class='line'>4520</span>  * この関数は  
<span class='line'>4521</span>  *   先行する数字以外をラベル
<span class='line'>4522</span>  *   数字の連続部分を数字部
<span class='line'>4523</span>  *   それ以降を後置部
<span class='line'>4524</span>  * と定義する
<span class='line'>4525</span>  * ＞小数点以下は後置部となる
<span class='line'>4526</span>  */</span><span class="WHIT">
<span class='line'>4527</span> </span><span class="NAME">nas.parseNumber</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4528</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">str</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">str</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4529</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">str.replace</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">str</span><span class="PUNC">=</span><span class="NAME">str.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4530</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.normalizeStr</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/^[^0-9]*/</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4531</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4532</span> </span><span class="COMM">/*
<span class='line'>4533</span> nas.parseNumber("A-125.3");
<span class='line'>4534</span> nas.parseNumber("１２３９３２");
<span class='line'>4535</span> nas.parseNumber("Final-A 123-under");
<span class='line'>4536</span> */</span><span class="WHIT">
<span class='line'>4537</span> 
<span class='line'>4538</span> </span><span class="COMM">/**
<span class='line'>4539</span>  *  タイムシートのセル記述を比較して同じセルの記述か否かを返す関数
<span class='line'>4540</span>  *
<span class='line'>4541</span>  *  空白はいずれのセル記述ともマッチしない
<span class='line'>4542</span>  *  カラセル記号、省略記号、等の機能記述記号はいずれのセル記述ともマッチしない
<span class='line'>4543</span>  *  原画記述の特定のセルを表さない中間値補間記号はいずれのセルともマッチしない
<span class='line'>4544</span>  *  記述はノーマライズして比較される
<span class='line'>4545</span>  *  同一トラック内の記述比較のみ正しい判定を行う(xMapエレメントの比較ではない )
<span class='line'>4546</span>  * 引数は、記述文字列または記述オブジェクト
<span class='line'>4547</span>  * 実際の判定はセル記述オブジェクトのメソッドを利用するので、
<span class='line'>4548</span>  * 比較するどちらかの要素がセル記述オブジェクトであることが明確なケースでは
<span class='line'>4549</span>  * この関数を使う必要は無い obj.compae(desc) を利用するように推奨
<span class='line'>4550</span>  */</span><span class="WHIT">
<span class='line'>4551</span> </span><span class="NAME">nas.compareCellIdf</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">tgt</span><span class="PUNC">,</span><span class="NAME">dst</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4552</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">tgt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">dst</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4553</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">tgt</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.CellDescription</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4554</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">target</span><span class="PUNC">=</span><span class="NAME">tgt</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4555</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4556</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">target</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.CellDescription</span><span class="PUNC">(</span><span class="NAME">tgt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4557</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4558</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">target.compare</span><span class="PUNC">(</span><span class="NAME">dst</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4559</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4560</span> 
<span class='line'>4561</span> </span><span class="COMM">/*TEST
<span class='line'>4562</span> console.log(nas.compareCellIdf(""," "));
<span class='line'>4563</span> console.log(nas.compareCellIdf("12","(12)"));
<span class='line'>4564</span> console.log(nas.compareCellIdf("１２","12-1"));
<span class='line'>4565</span> console.log(nas.compareCellIdf("X","X"));
<span class='line'>4566</span> console.log(nas.compareCellIdf("|","X"));
<span class='line'>4567</span> */</span><span class="WHIT">
<span class='line'>4568</span> </span><span class="COMM">/**
<span class='line'>4569</span> nas.CellDescription([cellPrefix,cellBody,cellPostfix,cellModifier])
<span class='line'>4570</span> nas.CellDescription(cellDescription,cellPrefix)
<span class='line'>4571</span> コンストラクタ基本形式
<span class='line'>4572</span> 狭義のセル（動画セル）を記述するオブジェクト
<span class='line'>4573</span> セル記述を与えて初期化するか、または必要な情報を配列で与えて初期化する。
<span class='line'>4574</span> 
<span class='line'>4575</span> myDescription      主記述・シートに記述する基本的なテキスト
<span class='line'>4576</span>     プレフィックス、ポストフィックス、モデファイヤを含んでいても良い
<span class='line'>4577</span>     特殊記述は内容で判別
<span class='line'>4578</span> 
<span class='line'>4579</span>     ブランク記述 カラセルを表す予約語
<span class='line'>4580</span>         配列nas.CellDescription.blankSignsに登録された文字列が単独で記述されたもの
<span class='line'>4581</span>     中間値補間記述  補間（動画）記号用予約語
<span class='line'>4582</span>         配列nas.CellDescription.interpolationSignsに登録された文字列が単独で記述されたもの
<span class='line'>4583</span>     省略記述 記述されたセルが直前のセルの値を継承する事を示す予約語
<span class='line'>4584</span>         配列nas.CellDescription.ellipsisSignsに登録された文字列で始まる記述、空文字列及び空白文字
<span class='line'>4585</span> 
<span class='line'>4586</span>     一般記述  上記の特殊記述以外の記述        
<span class='line'>4587</span>         記述が値を持つ場合は、システム上関連付けられた値を示す。
<span class='line'>4588</span>         値を持たない場合は省略記述と同様に直前のセルの値を継承する
<span class='line'>4589</span>         
<span class='line'>4590</span> myPrefix    プレフィックス部
<span class='line'>4591</span>     通常？はトラックラベル
<span class='line'>4592</span>     主記述に指定のある場合はそちらを優先する
<span class='line'>4593</span> myPostfix
<span class='line'>4594</span>     以下の文字列によるオーバレイまたはアンダーレイの指定を一種のみ
<span class='line'>4595</span>     +,修正,修,上,下,カブセ,u|under,o|over,overlay
<span class='line'>4596</span>     文字を重ねるかまたは直後に重ね数を付加して使用する
<span class='line'>4597</span>     例  "+","++","+3"
<span class='line'>4598</span>     主記述に指定のある場合はそちらを優先する
<span class='line'>4599</span>     ブランク記述の場合は意味を持たないが、記述規則上ポストフィックスが記述されることは無い
<span class='line'>4600</span>     ポストフィックスが与えられた場合、特殊記述でなく一般記述となる
<span class='line'>4601</span> myModifier
<span class='line'>4602</span>     丸囲い、三角囲い、四角囲い等の記述修飾を与える  
<span class='line'>4603</span>     "none","circle","trangle","brackets","red"
<span class='line'>4604</span>     主記述に指定のある場合はそちらを優先する
<span class='line'>4605</span>     特殊記述にはモデファイヤが付かない
<span class='line'>4606</span> type
<span class='line'>4607</span>     記述のタイプを示すプロパティ
<span class='line'>4608</span>     "nullstring","space","blank","interpolation","ellipsis"or"cell"
<span class='line'>4609</span>     それぞれ
<span class='line'>4610</span>     "ヌルストリング","空白","カラセル","中間値補間指定子","省略子"or"通常エントリ"
<span class='line'>4611</span>     を示す。
<span class='line'>4612</span>     マップの状況により同じ記述が必ずしも同じタイプとはならない
<span class='line'>4613</span>     
<span class='line'>4614</span> */</span><span class="WHIT">
<span class='line'>4615</span> </span><span class="NAME">nas.CellDescription</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">cellDescription</span><span class="PUNC">,</span><span class="NAME">cellPrefix</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4616</span> </span><span class="WHIT">    </span><span class="NAME">this.prefix</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4617</span> </span><span class="WHIT">    </span><span class="NAME">this.body</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4618</span> </span><span class="WHIT">    </span><span class="NAME">this.postfix</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4619</span> </span><span class="WHIT">    </span><span class="NAME">this.modifier</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4620</span> </span><span class="WHIT">    </span><span class="NAME">this.content</span><span class="WHIT">  </span><span class="PUNC">;</span><span class="COMM">//undefinedで初期化  ここに値があればtoStringで返す  キャッシュ扱い</span><span class="WHIT">
<span class='line'>4621</span> </span><span class="WHIT">    </span><span class="NAME">this.type</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"inherit"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4622</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">cellDescription</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4623</span> </span><span class="WHIT">    </span><span class="NAME">this.prefix</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cellDescription</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4624</span> </span><span class="WHIT">    </span><span class="NAME">this.body</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cellDescription</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4625</span> </span><span class="WHIT">    </span><span class="NAME">this.postfix</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cellDescription</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4626</span> </span><span class="WHIT">    </span><span class="NAME">this.modifier</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cellDescription</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4627</span> </span><span class="WHIT">    </span><span class="NAME">this.type</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.cellDescription.type</span><span class="PUNC">(</span><span class="NAME">this.body</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4628</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4629</span> </span><span class="WHIT">    </span><span class="NAME">this.parseContent</span><span class="PUNC">(</span><span class="NAME">cellDescription</span><span class="PUNC">,</span><span class="NAME">cellPrefix</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4630</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4631</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>4632</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4633</span> </span><span class="COMM">/*
<span class='line'>4634</span>  *セル記述クラスにクラスプロパティ（マスターデータ）としてとして
<span class='line'>4635</span>  *カラセル記号と省略記号等のデータをアタッチする
<span class='line'>4636</span>  */</span><span class="WHIT">
<span class='line'>4637</span> </span><span class="COMM">/*    EllipsisSign
<span class='line'>4638</span>  *    省略記号
<span class='line'>4639</span>  *　replacement トラックのみで使用される記述省略記号
<span class='line'>4640</span>  *　これらの記号はすべてセルの値が「未入力」として扱われる
<span class='line'>4641</span>  *　（タイムライントラックでは、未入力セルが記述省略＝最終記入値の複製であるため）
<span class='line'>4642</span>  */</span><span class="WHIT">
<span class='line'>4643</span> </span><span class="NAME">nas.CellDescription.ellipsisSigns</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"\|"</span><span class="PUNC">,</span><span class="STRN">":"</span><span class="PUNC">,</span><span class="STRN">";"</span><span class="PUNC">,</span><span class="STRN">"｜"</span><span class="PUNC">,</span><span class="STRN">"："</span><span class="PUNC">,</span><span class="STRN">"；"</span><span class="PUNC">,</span><span class="STRN">"‖"</span><span class="PUNC">,</span><span class="STRN">"↓"</span><span class="PUNC">,</span><span class="STRN">"↑"</span><span class="PUNC">,</span><span class="STRN">"⇓"</span><span class="PUNC">,</span><span class="STRN">"⇑"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4644</span> </span><span class="NAME">nas.CellDescription.ellipsisRegex</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"^["</span><span class="PUNC">+</span><span class="NAME">nas.CellDescription.ellipsisSigns.join</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"]$"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4645</span> </span><span class="COMM">/*    blankSign
<span class='line'>4646</span>  *    カラセル記号
<span class='line'>4647</span>  *　replacement トラックのみで使用されるカラセル記号
<span class='line'>4648</span>  *　これらの記号はすべてセルの値が「カラ(blank-cell)」として扱われる
<span class='line'>4649</span>  *　セクションパースの際にdissAppearance区間の開始を導く
<span class='line'>4650</span>  */</span><span class="WHIT">
<span class='line'>4651</span> </span><span class="NAME">nas.CellDescription.blankSigns</span><span class="WHIT">		</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"×"</span><span class="PUNC">,</span><span class="STRN">"0"</span><span class="PUNC">,</span><span class="STRN">"X"</span><span class="PUNC">,</span><span class="STRN">"x"</span><span class="PUNC">,</span><span class="STRN">"✕"</span><span class="PUNC">,</span><span class="STRN">"〆"</span><span class="PUNC">,</span><span class="STRN">"✖"</span><span class="PUNC">,</span><span class="STRN">"☓"</span><span class="PUNC">,</span><span class="STRN">"✗"</span><span class="PUNC">,</span><span class="STRN">"✘"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4652</span> </span><span class="NAME">nas.CellDescription.blankRegex</span><span class="WHIT">      </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"^["</span><span class="PUNC">+</span><span class="NAME">nas.CellDescription.blankSigns.join</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"]$"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4653</span> </span><span class="COMM">/*    interpolationSign
<span class='line'>4654</span>  *    中間値生成記号
<span class='line'>4655</span>  *　replacement トラックのみで使用される中間補完値生成記号
<span class='line'>4656</span>  *　これらの記号はすべてセルの値が「未生成のセル画像」として扱われる
<span class='line'>4657</span>  *　セクションパースの際に中間値補完区間の開始を導く
<span class='line'>4658</span>  *			//中間値生成予約（中割・動画）記号
<span class='line'>4659</span>  *			//前後に他の文字列データを含まない場合のみ機能を果たす
<span class='line'>4660</span>  *			//この他に&lt;.+>も補間記号として働く
<span class='line'>4661</span>  *		    //	詳細別紙
<span class='line'>4662</span>  */</span><span class="WHIT">
<span class='line'>4663</span> </span><span class="NAME">nas.CellDescription.interpolationSigns</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"-"</span><span class="PUNC">,</span><span class="STRN">"="</span><span class="PUNC">,</span><span class="STRN">"\*"</span><span class="PUNC">,</span><span class="STRN">"·"</span><span class="PUNC">,</span><span class="STRN">"・"</span><span class="PUNC">,</span><span class="STRN">"○"</span><span class="PUNC">,</span><span class="STRN">"●"</span><span class="PUNC">,</span><span class="STRN">"▫"</span><span class="PUNC">,</span><span class="STRN">"▪"</span><span class="PUNC">,</span><span class="STRN">"▴"</span><span class="PUNC">,</span><span class="STRN">"▵"</span><span class="PUNC">,</span><span class="STRN">"▾"</span><span class="PUNC">,</span><span class="STRN">"▿"</span><span class="PUNC">,</span><span class="STRN">"◈"</span><span class="PUNC">,</span><span class="STRN">"◉"</span><span class="PUNC">,</span><span class="STRN">"◦"</span><span class="PUNC">,</span><span class="STRN">"◦"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="COMM">// "-","·","・","○"</span><span class="WHIT">
<span class='line'>4664</span> </span><span class="NAME">nas.CellDescription.interpRegex</span><span class="WHIT">         </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"^["</span><span class="PUNC">+</span><span class="NAME">nas.CellDescription.interpolationSigns.join</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"]$"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4665</span> 
<span class='line'>4666</span> </span><span class="COMM">/**
<span class='line'>4667</span>     
<span class='line'>4668</span>  */</span><span class="WHIT">
<span class='line'>4669</span> 
<span class='line'>4670</span> </span><span class="COMM">/* TEST
<span class='line'>4671</span> console.log(new nas.CellDescription())     ;//
<span class='line'>4672</span> console.log(new nas.CellDescription(["A","12","修","triangle"]))     ;//triangle|修 |A|12
<span class='line'>4673</span> console.log(new nas.CellDescription("(1)"))     ;//circle|""|""|1
<span class='line'>4674</span> console.log(new nas.CellDescription("2"))     ;//none|""|""|2
<span class='line'>4675</span> console.log(new nas.CellDescription("&lt;A12>修"))     ;//triangle|修 |A|12
<span class='line'>4676</span> console.log(new nas.CellDescription("A-(12)+","B"))     ;//circle  |+  |B|A-12
<span class='line'>4677</span> console.log(new nas.CellDescription("A[12]修"))     ;//brackets|修 |A|12
<span class='line'>4678</span> console.log(new nas.CellDescription("B001"))        ;// none   |"" |B|1
<span class='line'>4679</span> console.log(new nas.CellDescription("B-01"))        ;// none   |"" |B|1
<span class='line'>4680</span> console.log(new nas.CellDescription("C-(1)++3"))    ;//circle  |++3|C|1
<span class='line'>4681</span> console.log(new nas.CellDescription("C-①","A"))     ;//circle  |"" |A|C1
<span class='line'>4682</span> console.log(new nas.CellDescription("&lt;あ>修","A")) ;//triangle|修 |A|あ
<span class='line'>4683</span> console.log(new nas.CellDescription("(1イ)修","A")) ;//circle|修 |A|1イ
<span class='line'>4684</span> console.log(new nas.CellDescription("B-ex修","b")) ;//none|修 |b|ex
<span class='line'>4685</span> console.log(new nas.CellDescription("C8-修q","b")) ;//none|"" |C|8-修q
<span class='line'>4686</span> */</span><span class="WHIT">
<span class='line'>4687</span> </span><span class="COMM">/**
<span class='line'>4688</span>     nas.CellDescription.prototype.setType()
<span class='line'>4689</span>     セル記述のタイプをセットするメソッド
<span class='line'>4690</span>     引数がなければ現在のタイプを返す
<span class='line'>4691</span> "normal"        一般記述
<span class='line'>4692</span> "inherit"       空文字列、空白、省略記号  等の先行の値を継承する記述
<span class='line'>4693</span> "blank"         カラ記述
<span class='line'>4694</span> "interpolation" 中間値補間記号
<span class='line'>4695</span> */</span><span class="WHIT">
<span class='line'>4696</span> </span><span class="NAME">nas.CellDescription.prototype.setType</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myType</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4697</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">myType</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.type</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4698</span> </span><span class="WHIT">        </span><span class="NAME">nas.CellDescription.type</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4699</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4700</span> </span><span class="WHIT">        </span><span class="NAME">this.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myType</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4701</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4702</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.type</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4703</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4704</span> </span><span class="COMM">/*test
<span class='line'>4705</span> 
<span class='line'>4706</span> */</span><span class="WHIT">
<span class='line'>4707</span> </span><span class="COMM">/**
<span class='line'>4708</span>     nas.CellDescription.toString(type)
<span class='line'>4709</span>     引数:  type 文字列化タイプ  "origin","normal","complete"
<span class='line'>4710</span>     "origin" ユーザ記述のままを返す    content
<span class='line'>4711</span>         contentに値がない場合は"normal"の値をcontentに設定して返す デフォルト
<span class='line'>4712</span>     "normal" 正規化済の文字列で返す    [body,postfix].join("")
<span class='line'>4713</span>     "complete" 完全な修飾子付きで返す  [prefix,body,postfix].join("-")
<span class='line'>4714</span> */</span><span class="WHIT">
<span class='line'>4715</span> </span><span class="NAME">nas.CellDescription.prototype.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4716</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'origin'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4717</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">==</span><span class="STRN">'origin'</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">this.content</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.content</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4718</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4719</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">brackets</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="PUNC">[</span><span class="STRN">""</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="STRN">"("</span><span class="PUNC">,</span><span class="STRN">")"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="STRN">"&lt;"</span><span class="PUNC">,</span><span class="STRN">">"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="STRN">"["</span><span class="PUNC">,</span><span class="STRN">"]"</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="PUNC">[</span><span class="STRN">"none"</span><span class="PUNC">,</span><span class="STRN">"circle"</span><span class="PUNC">,</span><span class="STRN">"triangle"</span><span class="PUNC">,</span><span class="STRN">"brackets"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="NAME">this.modifier</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4720</span> </span><span class="WHIT">    </span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4721</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"body"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4722</span> </span><span class="WHIT">        </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">brackets</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">this.body</span><span class="PUNC">,</span><span class="NAME">brackets</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4723</span> </span><span class="WHIT">    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4724</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"complete"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4725</span> </span><span class="WHIT">        </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>4726</span> </span><span class="WHIT">          </span><span class="NAME">this.prefix</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4727</span> </span><span class="WHIT">          </span><span class="PUNC">[</span><span class="NAME">brackets</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">this.body</span><span class="PUNC">,</span><span class="NAME">brackets</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4728</span> </span><span class="WHIT">          </span><span class="NAME">this.postfix</span><span class="WHIT">
<span class='line'>4729</span> </span><span class="WHIT">        </span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">"-"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4730</span> </span><span class="WHIT">    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4731</span> </span><span class="WHIT">    </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4732</span> </span><span class="WHIT">        </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">brackets</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">this.body</span><span class="PUNC">,</span><span class="NAME">brackets</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">this.postfix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4733</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"origin"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4734</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4735</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4736</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4737</span> </span><span class="COMM">/* test
<span class='line'>4738</span> var A=new nas.CellDescription(["A","12","修","triangle"]);
<span class='line'>4739</span> console.log(A.toString("complete"));
<span class='line'>4740</span> console.log(A.toString("normal"));
<span class='line'>4741</span> console.log(A.toString("origin"));
<span class='line'>4742</span> */</span><span class="WHIT">
<span class='line'>4743</span> </span><span class="COMM">/**
<span class='line'>4744</span> nas.CellDescription.prototype.parseContent(シート記述,ラベル)
<span class='line'>4745</span> 記述パーサ
<span class='line'>4746</span> セル記述を与えて記述オブジェクトを再定義する
<span class='line'>4747</span> 
<span class='line'>4748</span> シート記述:[前置部[セパレータ]]主記述[[セパレータ]後置部]
<span class='line'>4749</span> ラベル:トラックラベルを与える
<span class='line'>4750</span> 
<span class='line'>4751</span> トラックラベルはプレフィックスのデフォルト値として扱う
<span class='line'>4752</span> トラックラベルが指定されない場合は、かつ記述にラベルが含まれない場合無ラベルのセルを初期化する
<span class='line'>4753</span> 
<span class='line'>4754</span> 値を持たないセルの扱い
<span class='line'>4755</span> セル記述が値を持つか否かはxMapとのリンクと記述条件によるので、ここでは解決を行わない。
<span class='line'>4756</span> 解決は必要時に都度行われる
<span class='line'>4757</span> 
<span class='line'>4758</span> セパレータは /[_\-\s]?/
<span class='line'>4759</span> 前置部は。セルの所属するグループラベルとして機能する
<span class='line'>4760</span> シート記述に前置部を置かない場合はセパレータも省略するものとする。
<span class='line'>4761</span> 前置部に値のない場合セパレータは認識されず主記述の一部となる。
<span class='line'>4762</span> 前置部がない場合はセパレータが必須
<span class='line'>4763</span> 前置部分のない記述（これが通常）は、トラックラベルがプレフィックスとなる
<span class='line'>4764</span> 
<span class='line'>4765</span> 主記述と前置部を強調修飾することが可能
<span class='line'>4766</span> 強調修飾は
<span class='line'>4767</span>     (.+)  丸囲い
<span class='line'>4768</span>     &lt;.+>  三角囲い
<span class='line'>4769</span>     [.+]  四角囲い
<span class='line'>4770</span> の三種
<span class='line'>4771</span> いずれも前置部と主記述
<span class='line'>4772</span> または主記述のみを囲うことで表現できる  両者は同じ要素として扱う
<span class='line'>4773</span> 
<span class='line'>4774</span> 主記述は基本的に動画番号または原画番号である
<span class='line'>4775</span> 一般に正の整数値であるが、文字列も原画番号として許容される
<span class='line'>4776</span> 主記述の数値部分は、最初に現れる連続した数字部が整数として正規化される。
<span class='line'>4777</span> 文字列を用いる場合は、セパレータ以外の文字列を推奨
<span class='line'>4778</span> 幾つかの文字は機能文字として予約されているので使用時に注意が必要となる。
<span class='line'>4779</span> 
<span class='line'>4780</span> 
<span class='line'>4781</span>   後置部分は、同じセル記述に対するオーバレイ/アンダーレイを表す。
<span class='line'>4782</span>   予約語とその重なりで同一セル関連のオーバーレイを示す
<span class='line'>4783</span>   現在の予約語は以下
<span class='line'>4784</span>      +           :  オーバーレイ(簡略表記)
<span class='line'>4785</span>      o/overlay   :  オーバーレイ
<span class='line'>4786</span>      u/underlay  :  アンダーレイ
<span class='line'>4787</span>      修/修正     :  修正オーバーレイ
<span class='line'>4788</span>      カ/カブセ   :  日本語でオーバーレイの慣用表現
<span class='line'>4789</span>      上          :  漢字オーバーレイ
<span class='line'>4790</span>      下          :  漢字アンダーレイ
<span class='line'>4791</span> 
<span class='line'>4792</span>   後置部分の異なる同一名のセルは別々のセルではあるが強力な関連性を持つ
<span class='line'>4793</span>   ただしこの関連性は、同一ステージ内に限定される
<span class='line'>4794</span>   ステージが異なる場合の同名記述は基本的に弱い関連性しか持たない点に注意
<span class='line'>4795</span>   主記述とポストフィックス間のセパレータはあってもなくても良い
<span class='line'>4796</span> 
<span class='line'>4797</span>   例
<span class='line'>4798</span>   A-1
<span class='line'>4799</span>   A-1-修正
<span class='line'>4800</span>   
<span class='line'>4801</span>   この2つは異なるセルだが、A-1修は、A-1に関連付けられたオーバレイとして働く
<span class='line'>4802</span>   修正レベルによっては前バージョンの絵が残らない場合もある。
<span class='line'>4803</span>   
<span class='line'>4804</span>   修正オーバーレイは、必要に従って何層でも重ねることが可能であるその際は後置文字を重ねるか、またはオーバーレイの層数を数値でおく
<span class='line'>4805</span>   例
<span class='line'>4806</span>   +,++,+++,+4 等
<span class='line'>4807</span>   
<span class='line'>4808</span> 
<span class='line'>4809</span> パーサは与えられた記述をパースしてセル記述オブジェクトを返す
<span class='line'>4810</span> オブジェクトは以下のプロパティを持つ
<span class='line'>4811</span> 
<span class='line'>4812</span> .content    与えられた文字列をそのまま
<span class='line'>4813</span> .prefix     前置部文字列 セパレータは含まない または前置オブジェクト
<span class='line'>4814</span> .body       正規化された記述部本体文字列 または オブジェクト
<span class='line'>4815</span> .postfix    後置部文字列 セパレータは含まない またはオブジェクト
<span class='line'>4816</span> .modifier   記述修飾子  "none","circle","triangle","brackets"
<span class='line'>4817</span> .type       記述タイプ  "normal","inherit","blank","interpolation"
<span class='line'>4818</span> 
<span class='line'>4819</span> パーサに値が与えられなかった場合、既存のプロパティからdescription-contentの更新を行う
<span class='line'>4820</span> 丸数字は失われ標準表記の(丸括弧)に置換される  
<span class='line'>4821</span> */</span><span class="WHIT">
<span class='line'>4822</span> </span><span class="NAME">nas.CellDescription.prototype.parseContent</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">description</span><span class="PUNC">,</span><span class="NAME">prefixStr</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4823</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">description</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4824</span> </span><span class="WHIT">        </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">"rebuild content"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4825</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.body.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4826</span> </span><span class="WHIT">          </span><span class="NAME">this.content</span><span class="PUNC">=</span><span class="NAME">this.toString</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4827</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4828</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4829</span> </span><span class="WHIT">          </span><span class="NAME">description</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4830</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4831</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4832</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">prefixStr</span><span class="WHIT">   </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">prefixStr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4833</span> </span><span class="WHIT">    </span><span class="NAME">this.content</span><span class="PUNC">=</span><span class="NAME">description</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4834</span> </span><span class="WHIT">    </span><span class="COMM">//丸数字を一つだけ（）で囲む（正規化前に行う）</span><span class="WHIT">
<span class='line'>4835</span> </span><span class="WHIT">    </span><span class="NAME">description</span><span class="PUNC">=</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">description</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/[①-⑳㉑㉒-㉛㉜-㉟㊱-㊿]/</span><span class="PUNC">,</span><span class="STRN">"($&)"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4836</span> </span><span class="WHIT">    </span><span class="COMM">//正規化  丸数字は通常の数字に展開されて失われる</span><span class="WHIT">
<span class='line'>4837</span> </span><span class="WHIT">    </span><span class="NAME">description</span><span class="PUNC">=</span><span class="NAME">nas.normalizeStr</span><span class="PUNC">(</span><span class="NAME">description</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4838</span> </span><span class="WHIT">    </span><span class="COMM">//モデファイヤを判別して削除</span><span class="WHIT">
<span class='line'>4839</span> </span><span class="WHIT">    </span><span class="COMM">/*モデファイヤは一括して削除の方向で処理*/</span><span class="WHIT">
<span class='line'>4840</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">description.match</span><span class="PUNC">(</span><span class="REGX">/([^(]*)\(([^\(]+)\)(.*)/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4841</span> </span><span class="WHIT">        </span><span class="NAME">this.modifier</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"circle"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4842</span> </span><span class="WHIT">        </span><span class="NAME">description</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">description.replace</span><span class="PUNC">(</span><span class="REGX">/\(([^(]+)\)/g</span><span class="PUNC">,</span><span class="STRN">"$1"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4843</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">description.match</span><span class="PUNC">(</span><span class="REGX">/([^&lt;]*)\&lt;([^&lt;]+)\>(.*)/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4844</span> </span><span class="WHIT">        </span><span class="NAME">this.modifier</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"triangle"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4845</span> </span><span class="WHIT">        </span><span class="NAME">description</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">description.replace</span><span class="PUNC">(</span><span class="REGX">/&lt;([^&lt;]+)>/g</span><span class="PUNC">,</span><span class="STRN">"$1"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4846</span> 
<span class='line'>4847</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">description.match</span><span class="PUNC">(</span><span class="REGX">/([^\[]*)\[([^[]+)\](.*)/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4848</span> </span><span class="WHIT">        </span><span class="NAME">this.modifier</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"brackets"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4849</span> </span><span class="WHIT">        </span><span class="NAME">description</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">description.replace</span><span class="PUNC">(</span><span class="REGX">/\[([^\[]+)\]/g</span><span class="PUNC">,</span><span class="STRN">"$1"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4850</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4851</span> </span><span class="WHIT">        </span><span class="NAME">this.modifier</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4852</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4853</span> </span><span class="WHIT">    </span><span class="COMM">//ポストフィックスを判定して消去 標準表記は"+"</span><span class="WHIT">
<span class='line'>4854</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">description.match</span><span class="PUNC">(</span><span class="REGX">/([\-_\s]?((\+|修正?|カブセ|o|overlay|u|under|上|下)+(\d*)))$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4855</span> </span><span class="WHIT">        </span><span class="NAME">this.postfix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$2</span><span class="PUNC">;</span><span class="COMM">//暫定的に全部（あとで置きかえ）</span><span class="WHIT">
<span class='line'>4856</span> </span><span class="WHIT">        </span><span class="NAME">description</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">description.slice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">RegExp.$1.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4857</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4858</span> </span><span class="WHIT">        </span><span class="NAME">this.postfix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4859</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4860</span> </span><span class="WHIT">    </span><span class="COMM">//前置部分を分離</span><span class="WHIT">
<span class='line'>4861</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">description.match</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"^(("</span><span class="PUNC">+</span><span class="NAME">prefixStr</span><span class="PUNC">+</span><span class="STRN">"|[A-Z]?)[\-_\s]?)?(.+)$"</span><span class="PUNC">,</span><span class="STRN">"i"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4862</span> </span><span class="WHIT">        </span><span class="NAME">this.prefix</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">RegExp.$2</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">RegExp.$2</span><span class="PUNC">:</span><span class="NAME">prefixStr</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4863</span> </span><span class="WHIT">        </span><span class="NAME">this.body</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.normalizeStr</span><span class="PUNC">(</span><span class="NAME">RegExp.$3</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4864</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4865</span> </span><span class="WHIT">        </span><span class="NAME">this.prefix</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">prefixStr</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4866</span> </span><span class="WHIT">        </span><span class="NAME">this.body</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.normalizeStr</span><span class="PUNC">(</span><span class="NAME">description</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4867</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4868</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.body.match</span><span class="PUNC">(</span><span class="REGX">/([^\d]*)(\d+)(.*)/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4869</span> </span><span class="WHIT">            </span><span class="NAME">this.body</span><span class="PUNC">=</span><span class="NAME">RegExp.$1</span><span class="PUNC">+</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">RegExp.$2</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">RegExp.$3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4870</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4871</span> </span><span class="WHIT">    </span><span class="NAME">this.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.CellDescription.type</span><span class="PUNC">(</span><span class="NAME">this.body</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4872</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4873</span> </span><span class="COMM">/*test
<span class='line'>4874</span> A= new nas.CellDescription("");
<span class='line'>4875</span> A.parseContent("A-(12)-修");
<span class='line'>4876</span> comnsole.log(A)
<span class='line'>4877</span> */</span><span class="WHIT">
<span class='line'>4878</span> </span><span class="COMM">/**   nas.CellDescription.prototype.compare(description,lbl)
<span class='line'>4879</span> オブジェクトメソッド
<span class='line'>4880</span> 与えられた記述または記述オブジェクトと自身を対比して同じ記述か否かを判定
<span class='line'>4881</span>  引数:
<span class='line'>4882</span>     description  記述オブジェクト  または  記述文字列 ラベルを付加しても良い
<span class='line'>4883</span>  戻値:
<span class='line'>4884</span>     一致状況で返す  バイナリ
<span class='line'>4885</span>     00000
<span class='line'>4886</span>     11111
<span class='line'>4887</span>           0:no match
<span class='line'>4888</span>       1. +1:body match  記述内容が基本的に一致（空白でない）
<span class='line'>4889</span>       2. +2:body+postfix match  ポストフィックス一致（ポストフィックス空白は一致）
<span class='line'>4890</span>       3. +4:prefix+body+postfix match  プレフィックス一致（プレフィックス空白は一致）
<span class='line'>4891</span>       4. +8:and modifier match
<span class='line'>4892</span>       基本的にモデファイヤが異なっても同じ記述となるので、4.はあまり意味が無いが一応
<span class='line'>4893</span> 
<span class='line'>4894</span> 以下の条件に当てはまる場合はマッチが発生しない。（先に判定して抜ける）
<span class='line'>4895</span>     記述が  空文字列、空白、ブランク記号、中間値補間記号  または  省略記号
<span class='line'>4896</span>     等価条件  .type != "normal"
<span class='line'>4897</span> */</span><span class="WHIT">
<span class='line'>4898</span> </span><span class="NAME">nas.CellDescription.prototype.compare</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">desc</span><span class="PUNC">,</span><span class="NAME">lbl</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4899</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.type</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">"normal"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4900</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">desc</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.CellDescription</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">desc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.CellDescription.parse</span><span class="PUNC">(</span><span class="NAME">desc</span><span class="PUNC">,</span><span class="NAME">lbl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4901</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">desc.type</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">"normal"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4902</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4903</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.body</span><span class="WHIT">     </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">desc.body</span><span class="PUNC">)</span><span class="WHIT">     </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4904</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.postfix</span><span class="WHIT">  </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">desc.postfix</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4905</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.prefix</span><span class="WHIT">   </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">desc.prefix</span><span class="PUNC">)</span><span class="WHIT">   </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4906</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.modifier</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">desc.modifier</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">8</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4907</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4908</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4909</span> </span><span class="COMM">/*  test
<span class='line'>4910</span> A= new nas.CellDescription("");
<span class='line'>4911</span> A.parseContent("12");
<span class='line'>4912</span> console.log(A.compare("(12)"))
<span class='line'>4913</span> console.log(A)
<span class='line'>4914</span> */</span><span class="WHIT">
<span class='line'>4915</span> </span><span class="COMM">/**
<span class='line'>4916</span>     nas.CellDescription.type(desc,lbl,targetMap)
<span class='line'>4917</span>     セル記述のタイプを判定するクラスメソッド
<span class='line'>4918</span>     記述または、記述オブジェクトを渡す
<span class='line'>4919</span>     xMAPに該当するグループがあればそのエントリからタイプを得る
<span class='line'>4920</span>     なければ引数を判定してタイプの推測値を返す
<span class='line'>4921</span> "normal"        一般記述
<span class='line'>4922</span> "inherit"       空文字列、空白、省略記号  等の先行の値を継承する記述
<span class='line'>4923</span> "blank"         カラ記述
<span class='line'>4924</span> "interpolation" 中間値補間記号
<span class='line'>4925</span> */</span><span class="WHIT">
<span class='line'>4926</span> </span><span class="NAME">nas.CellDescription.type</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">desc</span><span class="PUNC">,</span><span class="NAME">lbl</span><span class="PUNC">,</span><span class="NAME">targetMap</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4927</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">desc</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.CellDescription</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4928</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">label</span><span class="WHIT">       </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">desc.prefix</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4929</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">description</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">desc.body</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4930</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4931</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">label</span><span class="WHIT">       </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">lbl</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4932</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">description</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">desc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4933</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4934</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"normal"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4935</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">targetMap</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4936</span> </span><span class="WHIT">    </span><span class="TOKN"> </span><span class="TOKN"> </span><span class="COMM">// xMapが指定された場合の処理はここに</span><span class="WHIT">
<span class='line'>4937</span> </span><span class="COMM">/*
<span class='line'>4938</span>     記述内容からの判定とxMap参照の差異は
<span class='line'>4939</span>     "normal"判定された記述のうちｘMapエントリの存在しないものが"inherit"になる点
<span class='line'>4940</span>     フォーマット上は、ｘMapエントリとして予約語を登録可能なので他種の記述が"normal"になる場合もあり  これは  タイプとして判断すべき内容か？
<span class='line'>4941</span>     xMapに問い合わせを行い  結果でtypeを設定する
<span class='line'>4942</span> */</span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>4943</span> </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4944</span> </span><span class="WHIT"> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>4945</span> </span><span class="WHIT"> 	     </span><span class="PUNC">(</span><span class="NAME">description.match</span><span class="PUNC">(</span><span class="REGX">/^\s*$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>4946</span> </span><span class="WHIT"> 	     </span><span class="PUNC">(</span><span class="NAME">description.match</span><span class="PUNC">(</span><span class="NAME">nas.CellDescription.ellipsisRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4947</span> </span><span class="WHIT"> 	</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4948</span> </span><span class="WHIT"> 	   </span><span class="NAME">type</span><span class="PUNC">=</span><span class="STRN">"inherit"</span><span class="PUNC">;</span><span class="COMM">//空白,ヌルストリングまたは明示された継承記述</span><span class="WHIT">
<span class='line'>4949</span> </span><span class="WHIT"> 	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">description.match</span><span class="PUNC">(</span><span class="NAME">nas.CellDescription.interpRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4950</span> </span><span class="WHIT"> 	   </span><span class="NAME">type</span><span class="PUNC">=</span><span class="STRN">"interpolation"</span><span class="PUNC">;</span><span class="COMM">//中間値補間記号</span><span class="WHIT">
<span class='line'>4951</span> 
<span class='line'>4952</span> </span><span class="WHIT"> 	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">description.match</span><span class="PUNC">(</span><span class="NAME">nas.CellDescription.blankRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4953</span> </span><span class="WHIT"> 	   </span><span class="NAME">type</span><span class="PUNC">=</span><span class="STRN">"blank"</span><span class="PUNC">;</span><span class="COMM">//カラセル</span><span class="WHIT">
<span class='line'>4954</span> </span><span class="WHIT"> 	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4955</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4956</span> </span><span class="COMM">//記述オブジェクトだった場合  オブジェクトのプロパティを更新する</span><span class="WHIT">
<span class='line'>4957</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">desc</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.CellDescription</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">desc.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4958</span> </span><span class="WHIT"> 	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4959</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4960</span> </span><span class="COMM">/** nas.CellDescription.parse(description,label)
<span class='line'>4961</span> 記述をパースしてセル記述オブジェクトを返すクラスメソッド
<span class='line'>4962</span> オブジェクトのラッパ関数
<span class='line'>4963</span> 引数:
<span class='line'>4964</span>     description     セル記述
<span class='line'>4965</span>     label           トラックラベル(省略可)
<span class='line'>4966</span> 
<span class='line'>4967</span>         または配列
<span class='line'>4968</span>     [trackID,frameID]  トラックIDとフレームIDの配列 ?
<span class='line'>4969</span>     これは良くない  クラスメソッドが別のオブジェクトに縛られることになるので却下
<span class='line'>4970</span>     逆にxUIのオブジェクトなら可
<span class='line'>4971</span> */</span><span class="WHIT">
<span class='line'>4972</span> </span><span class="NAME">nas.CellDescription.parse</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">desc</span><span class="PUNC">,</span><span class="NAME">lbl</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4973</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.CellDescription</span><span class="PUNC">(</span><span class="NAME">desc</span><span class="PUNC">,</span><span class="NAME">lbl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4974</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4975</span> 
<span class='line'>4976</span> </span><span class="COMM">/*
<span class='line'>4977</span> このシステムでは、キーフレームの概念を使用しない
<span class='line'>4978</span> 
<span class='line'>4979</span> それにかわる「セクション」の概念で処理が行われる。
<span class='line'>4980</span> 
<span class='line'>4981</span>     セクション
<span class='line'>4982</span> 
<span class='line'>4983</span> タイムライントラックはセクションによって分割される
<span class='line'>4984</span> 
<span class='line'>4985</span> セクションは、値を持つ「有値セクション」及び　有値セクション同士の間をつなぐ「中間値補完セクション」に分類される。
<span class='line'>4986</span> 
<span class='line'>4987</span> 中間値補完セクション自身は値を持たず、前方に位置する有値セクションに付属して後方のセクションへの中間値を導く役割をはたす。
<span class='line'>4988</span> 
<span class='line'>4989</span> 中間値補完セクションは、更にその区間内に更にサブセクションを持つ。
<span class='line'>4990</span> 
<span class='line'>4991</span> 有値セクションは、セクションの値として各タイムライントラックの種別ごとに固有のオブジェクトを値として持つ
<span class='line'>4992</span> 
<span class='line'>4993</span> 有値セクションの継続長が１フレームだけの場合、一般的なコンポジットソフトで実装されるキーフレームと同様のふるまいをするので相互の変換は可能である
<span class='line'>4994</span> */</span><span class="WHIT">
<span class='line'>4995</span> 
<span class='line'>4996</span> 
<span class='line'>4997</span> 
<span class='line'>4998</span> 
<span class='line'>4999</span> </span><span class="COMM">/*  
<span class='line'>5000</span>     中間値補完セクション開始記述
<span class='line'>5001</span> 
<span class='line'>5002</span> システムにより予め定義されたセクションの値を発生する記述及びタイムシートにリンクされたxMapデータ内で定義される記述以外の記述は、全て中間値発生シンボルとして機能する。
<span class='line'>5003</span> すなわち「タイムシートになにか書いてあるフレームは基本的に何らかの値を持つフレームとなる。」
<span class='line'>5004</span> 
<span class='line'>5005</span> 
<span class='line'>5006</span> 未記入、空白の記述は、セクションを維持する
<span class='line'>5007</span> 中間値発生記述は、有値区間を終了させて中間値補完区間を開始する
<span class='line'>5008</span> 中間値補完区間内では、中間値発生記述は先行するサブセクション終了して次のサブセクションを開始する
<span class='line'>5009</span> 値指定記述、または中間値終了シンボルが記述された場合、中間値補完区間が終了して値区間が開始される
<span class='line'>5010</span> 中間値終了シンボルで中間値補完区間が終了した場合　後続区間の値は保留される
<span class='line'>5011</span> 遅延解決が行われるまでは後続区間は中間値補完区間に先行する値区間の値をもっているものと解釈される
<span class='line'>5012</span> 
<span class='line'>5013</span> 遅延解決が行われた場合、その区間の値は新しく記述されたものとなる
<span class='line'>5014</span> 
<span class='line'>5015</span> 
<span class='line'>5016</span> グラフィックシンボル発生記述　画面表示のレイヤーで解釈されるシンボル発生記述を設ける
<span class='line'>5017</span> 
<span class='line'>5018</span> シンボルが、演出上の仮想のカメラに対するものかまたはステージ上のオペレーションに対するものかを識別する情報が必要
<span class='line'>5019</span> ただし（本来必須だが、これを曖昧にしたまま使用するユーザが多いので厳密にすると動作に以上をきたす可能性が高いため）必須ではない
<span class='line'>5020</span> 
<span class='line'>5021</span>     imaginalyCamera 想定カメラ
<span class='line'>5022</span> 演出上の想定キャメラを指す
<span class='line'>5023</span> ステージ上の素材収録用のカメラ及びクリッピング情報でなく、演出的に想定されるカメラに対する指示指定類にはこのフラグが付与される
<span class='line'>5024</span> FI,FO,PAN,TILT,TrackIn等のカメラワークはこれを含むことが可能
<span class='line'>5025</span> slide,
<span class='line'>5026</span> 
<span class='line'>5027</span> 
<span class='line'>5028</span> */</span><span class="WHIT">
<span class='line'>5029</span> </span><span class="COMM">/**
<span class='line'>5030</span> 
<span class='line'>5031</span> 例：
<span class='line'>5032</span> var A = new nas.CameraworkDescription()
<span class='line'>5033</span> 
<span class='line'>5034</span> */</span><span class="WHIT">
<span class='line'>5035</span> 
<span class='line'>5036</span> </span><span class="NAME">nas.CameraworkDescription</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">aliases</span><span class="PUNC">,</span><span class="NAME">nodeSigns</span><span class="PUNC">,</span><span class="NAME">noteText</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5037</span> </span><span class="WHIT">    </span><span class="NAME">this.name</span><span class="WHIT">          </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">name</span><span class="WHIT">       </span><span class="PUNC">;</span><span class="COMM">//識別キーワード</span><span class="WHIT">
<span class='line'>5038</span> </span><span class="WHIT">    </span><span class="NAME">this.type</span><span class="WHIT">          </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">type</span><span class="WHIT">       </span><span class="PUNC">;</span><span class="COMM">//タイプ文字列　symbol,composite,transition,geometry,effect,modefier,zigzag?</span><span class="WHIT">
<span class='line'>5039</span> </span><span class="WHIT">    </span><span class="NAME">this.aliases</span><span class="WHIT">       </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">aliases</span><span class="WHIT">    </span><span class="PUNC">;</span><span class="COMM">//別名配列</span><span class="WHIT">
<span class='line'>5040</span> </span><span class="WHIT">    </span><span class="NAME">this.nodeSigns</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nodeSigns</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="COMM">//[fillSymbol[,OpenNode[,CloseNode]]];//シート表記上の記号</span><span class="WHIT">
<span class='line'>5041</span> </span><span class="WHIT">    </span><span class="NAME">this.description</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">noteText</span><span class="WHIT">   </span><span class="PUNC">;</span><span class="COMM">//オプション　簡易的な説明</span><span class="WHIT">
<span class='line'>5042</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5043</span> </span><span class="COMM">/**
<span class='line'>5044</span> 引数:
<span class='line'>5045</span>     form 
<span class='line'>5046</span> */</span><span class="WHIT">
<span class='line'>5047</span> </span><span class="NAME">nas.CameraworkDescription.prototype.toString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5048</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5049</span> </span><span class="WHIT">    </span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5050</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'full-dump'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>5051</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'full'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>5052</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'dump'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>5053</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">JSON.stringify</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>5054</span> </span><span class="WHIT">            </span><span class="NAME">this.name</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5055</span> </span><span class="WHIT">            </span><span class="NAME">this.type</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5056</span> </span><span class="WHIT">            </span><span class="NAME">this.aliases</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5057</span> </span><span class="WHIT">            </span><span class="NAME">this.nodeSigns</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5058</span> </span><span class="WHIT">            </span><span class="NAME">this.description</span><span class="WHIT">
<span class='line'>5059</span> </span><span class="WHIT">        </span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5060</span> </span><span class="WHIT">    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5061</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">'plain-text'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>5062</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">'plain'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>5063</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">'text'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>5064</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>5065</span> </span><span class="WHIT">            </span><span class="NAME">this.name</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5066</span> </span><span class="WHIT">            </span><span class="STRN">"\tname:"</span><span class="PUNC">+</span><span class="NAME">this.name</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5067</span> </span><span class="WHIT">            </span><span class="STRN">"\ttype:"</span><span class="PUNC">+</span><span class="NAME">JSON.stringify</span><span class="PUNC">(</span><span class="NAME">this.type</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5068</span> </span><span class="WHIT">            </span><span class="STRN">"\taliases:"</span><span class="PUNC">+</span><span class="NAME">JSON.stringify</span><span class="PUNC">(</span><span class="NAME">this.aliases</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5069</span> </span><span class="WHIT">            </span><span class="STRN">"\tnodeSigns:"</span><span class="PUNC">+</span><span class="NAME">JSON.stringify</span><span class="PUNC">(</span><span class="NAME">this.nodeSigns</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5070</span> </span><span class="WHIT">            </span><span class="STRN">"\tdescription:"</span><span class="PUNC">+</span><span class="NAME">this.description</span><span class="WHIT">
<span class='line'>5071</span> </span><span class="WHIT">        </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5072</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result.join</span><span class="PUNC">(</span><span class="STRN">'\n'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5073</span> </span><span class="WHIT">    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5074</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">'JSON'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>5075</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">JSON.stringify</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5076</span> </span><span class="WHIT">    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5077</span> </span><span class="WHIT">    </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>5078</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">form</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5079</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">form</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>5080</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5081</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5082</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5083</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5084</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5085</span> 
<span class='line'>5086</span> </span><span class="COMM">/**
<span class='line'>5087</span>     与えられたキーワードに自身が合致するか否かを返すメソッド
<span class='line'>5088</span> 引数:
<span class='line'>5089</span>     nameString  必須 キーネーム及び別名を検索して一致した情報があった場合true
<span class='line'>5090</span>     typeString  オプション　指定がない場合は任意のタイプとマッチ　検索順序は　symbol/composite/geometry/effect
<span class='line'>5091</span>     imaginary   オプション  指定がない場合はすべての情報を検索
<span class='line'>5092</span> */</span><span class="WHIT">
<span class='line'>5093</span> </span><span class="NAME">nas.CameraworkDescription.prototype.isMatch</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nameString</span><span class="PUNC">,</span><span class="NAME">typeString</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5094</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">typeString</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.type</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">typeString</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5095</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nameString</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this.name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5096</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myRegex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">'^('</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="NAME">this.name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="STRN">'|'</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.aliases.join</span><span class="PUNC">(</span><span class="STRN">"|"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/([\]\[\.])/g</span><span class="PUNC">,</span><span class="STRN">'\\$1'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="STRN">')$'</span><span class="PUNC">,</span><span class="STRN">'i'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5097</span> </span><span class="COMM">//    var myRegex = new RegExp('^' + this.aliases.join("|")+'$','i');</span><span class="WHIT">
<span class='line'>5098</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nameString.match</span><span class="PUNC">(</span><span class="NAME">myRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5099</span> 
<span class='line'>5100</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>5101</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5102</span> 
<span class='line'>5103</span> </span><span class="COMM">/*
<span class='line'>5104</span> DBで解釈した文字列は
<span class='line'>5105</span> 
<span class='line'>5106</span> 自由文字列の場合は&lt;矢括弧>でシンボル記述とする
<span class='line'>5107</span> 
<span class='line'>5108</span> FI  ⇒   &lt;FI> ;//コンポジット系
<span class='line'>5109</span> SL  ⇒   &lt;SL> ;//ステージワーク系
<span class='line'>5110</span> 
<span class='line'>5111</span> 丸かっこをコメントエスケープにするか？
<span class='line'>5112</span> 
<span class='line'>5113</span> 　[start] != (start)
<span class='line'>5114</span> 
<span class='line'>5115</span> 
<span class='line'>5116</span> nodeSigns配列には、以下の情報が格納される
<span class='line'>5117</span> 
<span class='line'>5118</span> 第一要素    String.fillSymbol   :中間値補完区間を埋めるシンボルの既定値　他の文字列を使用することも可能だが指定のない限りこの文字列を使用する
<span class='line'>5119</span> 第二要素    String.openNode     :中間値補完区間を開くシンボルの既定値　オプション　この文字列が存在しない場合は、第一要素が優先で使用される
<span class='line'>5120</span> 第三要素    String.closeNode    :中間値補完区間を閉じるシンボルの既定値　オプション　この文字列が存在しない場合は、第二要素が使用される
<span class='line'>5121</span> 
<span class='line'>5122</span> 
<span class='line'>5123</span> カメラワークディスクリプションとしての解決を行う場合
<span class='line'>5124</span> トランジション系のエフェクトを除いて、値区間単体または先行する値区間と中間値補完区間のセットで解決が行われる
<span class='line'>5125</span> 中間値補完区間に後続する区間は、解決に使用されない。
<span class='line'>5126</span> */</span><span class="WHIT">
<span class='line'>5127</span> 
<span class='line'>5128</span> </span><span class="COMM">/*  参照用カメラワーク記述コレクション
<span class='line'>5129</span> */</span><span class="WHIT">
<span class='line'>5130</span> </span><span class="NAME">nas.cameraworkDescriptions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5131</span> </span><span class="WHIT">    </span><span class="NAME">members</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5132</span> </span><span class="WHIT">    </span><span class="NAME">singleRegex</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">'‖'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5133</span> </span><span class="WHIT">    </span><span class="NAME">barRegex</span><span class="WHIT">   </span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">'|'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5134</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5135</span> </span><span class="NAME">nas.cameraworkDescriptions.toString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5136</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">JSON.stringify</span><span class="PUNC">(</span><span class="NAME">this.members</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5137</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5138</span> 
<span class='line'>5139</span> </span><span class="NAME">nas.cameraworkDescriptions.add</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">member</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5140</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">member</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.CameraworkDescription</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5141</span> </span><span class="WHIT">        </span><span class="NAME">this.members</span><span class="PUNC">[</span><span class="NAME">member.name</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">member</span><span class="PUNC">;</span><span class="COMM">//上書き</span><span class="WHIT">
<span class='line'>5142</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.members</span><span class="PUNC">[</span><span class="NAME">member.name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5143</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5144</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5145</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5146</span> 
<span class='line'>5147</span> </span><span class="COMM">/**
<span class='line'>5148</span>  * 指定された条件のカメラワークオブジェクトを返す
<span class='line'>5149</span>  * 検索に失敗したらnull
<span class='line'>5150</span>  */</span><span class="WHIT">
<span class='line'>5151</span> </span><span class="NAME">nas.cameraworkDescriptions.get</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">keyword</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5152</span> </span><span class="COMM">//    if(keyword.match(/^&lt;([^\>]+)>$/)) keyword = RegExp.$1;</span><span class="WHIT">
<span class='line'>5153</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">prp</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.members</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5154</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.members</span><span class="PUNC">[</span><span class="NAME">prp</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">isMatch</span><span class="PUNC">(</span><span class="NAME">keyword</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.members</span><span class="PUNC">[</span><span class="NAME">prp</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5155</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5156</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5157</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5158</span> 
<span class='line'>5159</span> </span><span class="COMM">/**
<span class='line'>5160</span>  * テキストダンプ
<span class='line'>5161</span>  * 引数:
<span class='line'>5162</span>         form ;"JSON"/"palin-text"/"full-dump"
<span class='line'>5163</span>  */</span><span class="WHIT">
<span class='line'>5164</span> </span><span class="NAME">nas.cameraworkDescriptions.dump</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5165</span> </span><span class="WHIT">    </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5166</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"JSON"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>5167</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">JSON.stringify</span><span class="PUNC">(</span><span class="NAME">this.members</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5168</span> </span><span class="WHIT">        </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5169</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"full-dump"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>5170</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"full"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>5171</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"dump"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>5172</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5173</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">prp</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.members</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5174</span> </span><span class="WHIT">                </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'["'</span><span class="PUNC">+</span><span class="NAME">prp</span><span class="PUNC">+</span><span class="STRN">'",'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5175</span> </span><span class="WHIT">                </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.members</span><span class="PUNC">[</span><span class="NAME">prp</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dump</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this.members</span><span class="PUNC">[</span><span class="NAME">prp</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dump</span><span class="PUNC">(</span><span class="STRN">'full'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.members</span><span class="PUNC">[</span><span class="NAME">prp</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="STRN">'full'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5176</span> </span><span class="WHIT">                </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">']\n'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5177</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5178</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5179</span> </span><span class="WHIT">        </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5180</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'plain-text'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>5181</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'plain'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>5182</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'text'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>5183</span> </span><span class="WHIT">    </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>5184</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5185</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">prp</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.members</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5186</span> </span><span class="WHIT">                </span><span class="NAME">result.push</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.members</span><span class="PUNC">[</span><span class="NAME">prp</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dump</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this.members</span><span class="PUNC">[</span><span class="NAME">prp</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dump</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.members</span><span class="PUNC">[</span><span class="NAME">prp</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5187</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5188</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result.join</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">'\n'</span><span class="PUNC">:</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5189</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5190</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5191</span> </span><span class="COMM">/*設定パーサ
<span class='line'>5192</span> */</span><span class="WHIT">
<span class='line'>5193</span> </span><span class="NAME">nas.cameraworkDescriptions.parseConfig</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dataStream</span><span class="PUNC">,</span><span class="NAME">form</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5194</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">dataStream</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5195</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myMembers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5196</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">barSigns</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5197</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">singleNodes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5198</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">compSigns</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5199</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">geomSigns</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5200</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">doubleNodes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5201</span> </span><span class="WHIT">    </span><span class="COMM">// 形式が指定されない場合は、第一有効レコードで判定</span><span class="WHIT">
<span class='line'>5202</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">form</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5203</span> </span><span class="WHIT">        </span><span class="NAME">form</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'plain-text'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5204</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dataStream.match</span><span class="PUNC">(</span><span class="REGX">/\{[^\}]+\}/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5205</span> </span><span class="WHIT">            </span><span class="NAME">form</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'JSON'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5206</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dataStream.match</span><span class="PUNC">(</span><span class="REGX">/\[.+\,\[.+\]\]/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5207</span> </span><span class="WHIT">            </span><span class="NAME">form</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'full-dump'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5208</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5209</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5210</span> </span><span class="WHIT">    </span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5211</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">'JSON'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>5212</span> </span><span class="WHIT">         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tempObjects</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">JSON.parse</span><span class="PUNC">(</span><span class="NAME">dataStream</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5213</span> </span><span class="WHIT">         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">prp</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">tempObjects</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5214</span> </span><span class="WHIT">            </span><span class="NAME">myMembers</span><span class="PUNC">[</span><span class="NAME">prp</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.CameraworkDescription</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>5215</span> </span><span class="WHIT">                </span><span class="NAME">tempObjects</span><span class="PUNC">[</span><span class="NAME">prp</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5216</span> </span><span class="WHIT">                </span><span class="NAME">tempObjects</span><span class="PUNC">[</span><span class="NAME">prp</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5217</span> </span><span class="WHIT">                </span><span class="NAME">tempObjects</span><span class="PUNC">[</span><span class="NAME">prp</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">aliases</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5218</span> </span><span class="WHIT">                </span><span class="NAME">tempObjects</span><span class="PUNC">[</span><span class="NAME">prp</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">nodeSigns</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5219</span> </span><span class="WHIT">                </span><span class="NAME">tempObjects</span><span class="PUNC">[</span><span class="NAME">prp</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">description</span><span class="WHIT">
<span class='line'>5220</span> </span><span class="WHIT">            </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5221</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">tempObjects</span><span class="PUNC">[</span><span class="NAME">prp</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">nodeSigns.length</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5222</span> </span><span class="WHIT">                </span><span class="NAME">singleNodes.add</span><span class="PUNC">(</span><span class="NAME">tempObjects</span><span class="PUNC">[</span><span class="NAME">prp</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">nodeSigns</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5223</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5224</span> </span><span class="WHIT">                </span><span class="NAME">barSigns.add</span><span class="PUNC">(</span><span class="NAME">tempObjects</span><span class="PUNC">[</span><span class="NAME">prp</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">nodeSigns</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5225</span> </span><span class="WHIT">                </span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">tempObjects</span><span class="PUNC">[</span><span class="NAME">prp</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5226</span> </span><span class="WHIT">                </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'composite'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">compSigns.add</span><span class="PUNC">(</span><span class="NAME">tempObjects</span><span class="PUNC">[</span><span class="NAME">prp</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">nodeSigns</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5227</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5228</span> </span><span class="WHIT">                </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'geometry'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">geomSigns.add</span><span class="PUNC">(</span><span class="NAME">tempObjects</span><span class="PUNC">[</span><span class="NAME">prp</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">nodeSigns</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5229</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5230</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5231</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5232</span> </span><span class="WHIT">         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5233</span> </span><span class="WHIT">    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5234</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">'full-dump'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>5235</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">'full'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>5236</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">'dump'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>5237</span> </span><span class="WHIT">        </span><span class="NAME">dataStream</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">dataStream</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5238</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rix</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">rix</span><span class="PUNC">&lt;</span><span class="NAME">dataStream.length</span><span class="PUNC">;</span><span class="NAME">rix</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5239</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">dataStream</span><span class="PUNC">[</span><span class="NAME">rix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="STRN">'#'</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">dataStream</span><span class="PUNC">[</span><span class="NAME">rix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5240</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentRecord</span><span class="PUNC">=</span><span class="NAME">JSON.parse</span><span class="PUNC">(</span><span class="NAME">dataStream</span><span class="PUNC">[</span><span class="NAME">rix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5241</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentMember</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.CameraworkDescription</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>5242</span> </span><span class="WHIT">                </span><span class="NAME">currentRecord</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5243</span> </span><span class="WHIT">                 </span><span class="NAME">currentRecord</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5244</span> </span><span class="WHIT">                 </span><span class="NAME">currentRecord</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5245</span> </span><span class="WHIT">                 </span><span class="NAME">currentRecord</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5246</span> </span><span class="WHIT">                 </span><span class="NAME">currentRecord</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>5247</span> </span><span class="WHIT">            </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5248</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentMember</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myMembers</span><span class="PUNC">[</span><span class="NAME">currentRecord</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">currentMember</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5249</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentRecord</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5250</span> </span><span class="WHIT">                </span><span class="NAME">singleNodes.add</span><span class="PUNC">(</span><span class="NAME">currentRecord</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5251</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5252</span> </span><span class="WHIT">                </span><span class="NAME">barSigns.add</span><span class="PUNC">(</span><span class="NAME">currentRecord</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5253</span> </span><span class="WHIT">                </span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">currentRecord</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5254</span> </span><span class="WHIT">                </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'composite'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">compSigns.add</span><span class="PUNC">(</span><span class="NAME">currentRecord</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5255</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5256</span> </span><span class="WHIT">                </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'geometry'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">geomSigns.add</span><span class="PUNC">(</span><span class="NAME">currentRecord</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5257</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5258</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5259</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5260</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5261</span> </span><span class="WHIT">    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5262</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">'plain-text'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>5263</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">'plain'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>5264</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">'text'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>5265</span> </span><span class="WHIT">    </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>5266</span> </span><span class="WHIT">        </span><span class="NAME">dataStream</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">dataStream</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5267</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentMember</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5268</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rix</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">rix</span><span class="PUNC">&lt;</span><span class="NAME">dataStream.length</span><span class="PUNC">;</span><span class="NAME">rix</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5269</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">dataStream</span><span class="PUNC">[</span><span class="NAME">rix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="STRN">'#'</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">dataStream</span><span class="PUNC">[</span><span class="NAME">rix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5270</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentField</span><span class="PUNC">=</span><span class="NAME">dataStream</span><span class="PUNC">[</span><span class="NAME">rix</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5271</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">currentMember</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">currentField.match</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="REGX">/^\t([a-z]+)\:(.+)$/i</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5272</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">RegExp.$1</span><span class="PUNC">==</span><span class="STRN">'aliases'</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">RegExp.$1</span><span class="PUNC">==</span><span class="STRN">'nodeSigns'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5273</span> </span><span class="WHIT">                </span><span class="NAME">currentMember</span><span class="PUNC">[</span><span class="NAME">RegExp.$1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">JSON.parse</span><span class="PUNC">(</span><span class="NAME">RegExp.$2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5274</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5275</span> </span><span class="WHIT">        	    </span><span class="NAME">currentMember</span><span class="PUNC">[</span><span class="NAME">RegExp.$1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">RegExp.$2</span><span class="PUNC">;</span><span class="COMM">//追加プロパティ用</span><span class="WHIT">
<span class='line'>5276</span> </span><span class="WHIT">        	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5277</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentField.match</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="REGX">/^\S+$/i</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5278</span> </span><span class="WHIT">        	</span><span class="NAME">myMembers</span><span class="PUNC">[</span><span class="NAME">currentField</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.CameraworkDescription</span><span class="PUNC">(</span><span class="NAME">currentField</span><span class="PUNC">,</span><span class="STRN">"symbol"</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5279</span> </span><span class="WHIT">            </span><span class="NAME">currentMember</span><span class="PUNC">=</span><span class="NAME">myMembers</span><span class="PUNC">[</span><span class="NAME">currentField</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5280</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5281</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentMember.nodeSigns.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5282</span> </span><span class="WHIT">            </span><span class="NAME">singleNodes.add</span><span class="PUNC">(</span><span class="NAME">currentMember.nodeSigns</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5283</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5284</span> </span><span class="WHIT">            </span><span class="NAME">barSigns.add</span><span class="PUNC">(</span><span class="NAME">currentMember.nodeSigns</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5285</span> </span><span class="WHIT">            </span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">currentMember.type</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5286</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'composite'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">compSigns.add</span><span class="PUNC">(</span><span class="NAME">currentMember.nodeSigns</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5287</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5288</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'geometry'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">geomSigns.add</span><span class="PUNC">(</span><span class="NAME">currentMember.nodeSigns</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5289</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5290</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5291</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5292</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5293</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5294</span> </span><span class="WHIT">    </span><span class="NAME">this.members</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myMembers</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5295</span> </span><span class="COMM">//alert(singleNodes);</span><span class="WHIT">
<span class='line'>5296</span> </span><span class="WHIT">    </span><span class="NAME">this.singleRegex</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"^("</span><span class="PUNC">+</span><span class="NAME">singleNodes.join</span><span class="PUNC">(</span><span class="STRN">"|"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/[\[\]]/g</span><span class="PUNC">,</span><span class="STRN">'\\$&'</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">")$"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5297</span> </span><span class="WHIT">    </span><span class="NAME">this.barRegex</span><span class="WHIT">       </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"^["</span><span class="PUNC">+</span><span class="NAME">barSigns.join</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/[\|\.-]]/g</span><span class="PUNC">,</span><span class="STRN">'\\$&'</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"]$"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5298</span> </span><span class="COMM">//composite/geometry signs</span><span class="WHIT">
<span class='line'>5299</span> </span><span class="WHIT">    </span><span class="NAME">this.compositeRegex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"^("</span><span class="PUNC">+</span><span class="NAME">compSigns.join</span><span class="PUNC">(</span><span class="STRN">"|"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/[\|\.-]]/g</span><span class="PUNC">,</span><span class="STRN">'\\$&'</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">")$"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5300</span> </span><span class="WHIT">    </span><span class="NAME">this.geometryRegex</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"^("</span><span class="PUNC">+</span><span class="NAME">geomSigns.join</span><span class="PUNC">(</span><span class="STRN">"|"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/[\|\.-]]/g</span><span class="PUNC">,</span><span class="STRN">'\\$&'</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">")$"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5301</span> 
<span class='line'>5302</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.members</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5303</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5304</span> 
<span class='line'>5305</span> </span><span class="COMM">/* test
<span class='line'>5306</span> var A = new nas.CameraworkDescription(
<span class='line'>5307</span>     "fadeIn",
<span class='line'>5308</span>     "composite",
<span class='line'>5309</span>     ["FI","F.I","フェード・イン","フェードイン","fade-in","▲","溶明"],
<span class='line'>5310</span>     ["|","▲"],
<span class='line'>5311</span>     "暗転状態から徐々に明るくなる演出手法"
<span class='line'>5312</span> )
<span class='line'>5313</span> nas.cameraworkDescriptions.add(A);
<span class='line'>5314</span> nas.cameraworkDescriptions.dump();
<span class='line'>5315</span> 
<span class='line'>5316</span> JSON.Stringify(nas.cameraworkDescriptions.members);
<span class='line'>5317</span> 
<span class='line'>5318</span> 
<span class='line'>5319</span> */</span><span class="WHIT">
<span class='line'>5320</span> 
<span class='line'>5321</span> </span><span class="COMM">/**
<span class='line'>5322</span>  * 配列オブジェクト拡張メソッド&lt;br />
<span class='line'>5323</span>  * &lt;br />
<span class='line'>5324</span>  *  配列要素を検索して同値の要素が存在すればその要素idを、
<span class='line'>5325</span>  *  存在しない場合は引数を配列に追加してそのidを返す。&lt;br />
<span class='line'>5326</span>  *  戻り値は当該のアイテムid&lt;br />
<span class='line'>5327</span>  *  先入れ後出しにするため、リスト登録は配列の逆順登録にする
<span class='line'>5328</span>  *  単純な検索はindexOfで行うように&lt;br />
<span class='line'>5329</span>  * 
<span class='line'>5330</span>  * @param {any} itm
<span class='line'>5331</span>  * @returns {Number} element id of Array
<span class='line'>5332</span>  *  
<span class='line'>5333</span>  *  
<span class='line'>5334</span>  */</span><span class="WHIT">
<span class='line'>5335</span> </span><span class="NAME">Array.prototype.add</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">itm</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5336</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.indexOf</span><span class="PUNC">(</span><span class="NAME">itm</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5337</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5338</span> </span><span class="WHIT">        </span><span class="NAME">this.push</span><span class="PUNC">(</span><span class="NAME">itm</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5339</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5340</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5341</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5342</span> </span><span class="COMM">/* TEST
<span class='line'>5343</span>     var A = ["A","B","C","D","E","F","G","H"];
<span class='line'>5344</span>     console.log(A.add("A"));
<span class='line'>5345</span>     console.log(A.add("J"));
<span class='line'>5346</span>     console.log(A);
<span class='line'>5347</span> */</span><span class="WHIT">
<span class='line'>5348</span> </span><span class="COMM">/**
<span class='line'>5349</span>     特定文字のエスケープとアンエスケープ
<span class='line'>5350</span> 引数の指定された文字にエスケープ文字を前置して返す関数
<span class='line'>5351</span> エスケープ文字自体は必ず二重エスケープされるので
<span class='line'>5352</span> strings にエスケープ文字を含んではならない。
<span class='line'>5353</span> 含まれている場合は、多重処理防止の為エラー終了とする
<span class='line'>5354</span> 
<span class='line'>5355</span> nas.IdfEscape(sourceString,strings,escapeChar);
<span class='line'>5356</span> nas.IdfEscape("ABCDE%FG",'ABC','%');
<span class='line'>5357</span> result:"%A%B%CDE%%FG"
<span class='line'>5358</span> 逆関数あり  逆関数は対象文字列の指定は不要
<span class='line'>5359</span> */</span><span class="WHIT">
<span class='line'>5360</span> </span><span class="NAME">nas.IdfEscape</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sourceString</span><span class="PUNC">,</span><span class="NAME">strings</span><span class="PUNC">,</span><span class="NAME">escapeChar</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5361</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">sourceString</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">strings.length</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">sourceString</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5362</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">escapeChar</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">escapeChar</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'\\'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5363</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">sourceString.indexOf</span><span class="PUNC">(</span><span class="STRN">'\\'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">sourceString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourceString.replace</span><span class="PUNC">(</span><span class="REGX">/\\/</span><span class="PUNC">,</span><span class="STRN">'\\\\'</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5364</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">strings.indexOf</span><span class="PUNC">(</span><span class="NAME">escapeChar</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5365</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">sourceString</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">'['</span><span class="PUNC">+</span><span class="NAME">strings</span><span class="PUNC">+</span><span class="STRN">']'</span><span class="PUNC">,</span><span class="STRN">'g'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">escapeChar</span><span class="PUNC">+</span><span class="STRN">'$&'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5366</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5367</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">sourceString</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">'['</span><span class="PUNC">+</span><span class="NAME">strings</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'\\'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="NAME">escapeChar</span><span class="PUNC">+</span><span class="STRN">']'</span><span class="PUNC">,</span><span class="STRN">'g'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">escapeChar</span><span class="PUNC">+</span><span class="STRN">'$&'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5368</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5369</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5370</span> </span><span class="COMM">/**
<span class='line'>5371</span>     逆関数
<span class='line'>5372</span> エスケープ文字を渡す際に直接正規表現オブジェクトにわたされるので、メタ文字は\エスケープの要あり
<span class='line'>5373</span> NG:nas.IdfUnEscape("a23^^DCg",'^');
<span class='line'>5374</span> OK:nas.IdfUnEscape("a23^^DCg",'\\^');
<span class='line'>5375</span> 
<span class='line'>5376</span> */</span><span class="WHIT">
<span class='line'>5377</span> </span><span class="NAME">nas.IdfUnEscape</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sourceString</span><span class="PUNC">,</span><span class="NAME">escapeChar</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5378</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">sourceString</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">sourceString</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5379</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">escapeChar</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">escapeChar</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'\\'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5380</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">sourceString</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"\\"</span><span class="PUNC">+</span><span class="NAME">escapeChar</span><span class="PUNC">+</span><span class="STRN">'(.)'</span><span class="PUNC">,</span><span class="STRN">'g'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="STRN">'$1'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5381</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5382</span> </span><span class="COMM">//TEST</span><span class="WHIT">
<span class='line'>5383</span> </span><span class="COMM">/*
<span class='line'>5384</span> nas.IdfEscape('ASBCDEF\\G','AXC\','%');
<span class='line'>5385</span> nas.IdfUnEscape('%%A%BCDE%FG','%');
<span class='line'>5386</span> nas.IdfEscape('ASSDFGERtyusadhjgalll','AS','&');
<span class='line'>5387</span> */</span><span class="WHIT">
<span class='line'>5388</span> </span><span class="COMM">/**
<span class='line'>5389</span>     特定文字の%エンコーダ
<span class='line'>5390</span> 引数文字列の指定された文字を部分的にURIエンコード(%文字コード)して返す関数
<span class='line'>5391</span> 第一引数が与えられない場合は、空文字列として扱う（空文字列を返す）
<span class='line'>5392</span> 第二引数が与えられない場合は、encodeURIComponentの値を返す
<span class='line'>5393</span> 
<span class='line'>5394</span>     要素の文字列は識別子をファイル名等に利用する場合、ファイルシステムで使用できない文字が禁止されるが、この文字も併せて部分エンコードの対象となる。
<span class='line'>5395</span>     対象文字列は、Windowsの制限文字である  ¥\/:*?"&lt;>| に加えて . 及びエンコード前置文字の %
<span class='line'>5396</span> 
<span class='line'>5397</span> nas.IdfEncode(sourceString,strings);
<span class='line'>5398</span> nas.IdfEncode("ABCDE%FG",'ABC');
<span class='line'>5399</span> 
<span class='line'>5400</span> result:
<span class='line'>5401</span> 逆関数なし
<span class='line'>5402</span> デコードはdecodeURIもしくはdecodeURIComponent関数を使用
<span class='line'>5403</span> */</span><span class="WHIT">
<span class='line'>5404</span> </span><span class="NAME">nas.IdfEncode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sourceString</span><span class="PUNC">,</span><span class="NAME">strings</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5405</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">sourceString</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5406</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">strings</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">encodeURIComponent</span><span class="PUNC">(</span><span class="NAME">sourceString</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5407</span> </span><span class="WHIT">    </span><span class="NAME">strings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">strings</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\¥\\\\\\\/:\\\*\\\?\"&lt;>|\\\.%"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5408</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">sourceString</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">strings.length</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">encodeURIComponent</span><span class="PUNC">(</span><span class="NAME">sourceString</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5409</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">sourceString.indexOf</span><span class="PUNC">(</span><span class="STRN">'\\'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">sourceString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourceString.replace</span><span class="PUNC">(</span><span class="REGX">/\\/</span><span class="PUNC">,</span><span class="STRN">'\\\\'</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5410</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">sourceString</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">'['</span><span class="PUNC">+</span><span class="NAME">strings</span><span class="PUNC">+</span><span class="STRN">']'</span><span class="PUNC">,</span><span class="STRN">'g'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">match</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">offset</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">string</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5411</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myCode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">match</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">charCodeAt</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5412</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myCode</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">255</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5413</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"%"</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myCode.toString</span><span class="PUNC">(</span><span class="NUMB">16</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5414</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5415</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">encodeURIComponent</span><span class="PUNC">(</span><span class="NAME">match</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5416</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5417</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5418</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5419</span> </span><span class="COMM">//TEST</span><span class="WHIT">
<span class='line'>5420</span> </span><span class="COMM">/*
<span class='line'>5421</span> nas.IdfEncode('ASBCDEF\\G','AXC\');
<span class='line'>5422</span> decodeURIComponent(nas.IdfEncode('%%A%BCDE%FG','%'));
<span class='line'>5423</span> nas.IdfEncode('ASSDFGERtyusadhjgalll','AS');
<span class='line'>5424</span> 
<span class='line'>5425</span> */</span><span class="WHIT">
<span class='line'>5426</span> 
<span class='line'>5427</span> </span></pre></body></html>