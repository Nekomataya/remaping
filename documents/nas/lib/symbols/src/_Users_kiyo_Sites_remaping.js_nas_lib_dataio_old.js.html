<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="TOKN">﻿</span><span class="COMM">/** * @fileoverview XPS ファイルから オブジェクトの初期化 * AEKeyデータ読み込み * メソッドか?それとも関数か? * 2005/03/20 * * 結局は、XPSのメソッドがよかろうと思うのであったよ。 * でも、出力部分は分けないと汎用性が下がりそうだよね、と * AEKey 読み取り部分追加何とか動く 05/04/26 * AEKey イロイロ補正 おおかた大丈夫そう? 12/11 次は6.5対応だけどー… * AEKey bTimeLine 参照違い バグ修正 1/31 * AERemap/T-Sheet読み込み部分コーディング でも 泥縄 5/12 */</span><span class="WHIT"></span><span class="COMM">/** * ssUnit(UpS) * サブユニット長を自動設定して戻す * 引数 UpS は、Units Per Second・秒あたりのフレーム数 または キーワード * 戻り値は、フレームレートにしたがって自動設定されるサブユニットの長さ * サブセパレータの値とは別。 * * @param UpS * @returns {*} */</span><span class="WHIT"></span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">ssUnit</span><span class="PUNC">(</span><span class="NAME">UpS</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">UpS</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">UpS</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"NTSC"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"PAL"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"drop"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">default</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">UpS</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * ドロップフレーム系の処置・どのみち整数でないとイヤだけど、暫定で         * @type {number}         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">UpS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">UpS</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ssu</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ssu</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ssu</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">UpS</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NAME">ssu</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">UpS</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">ssu</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">UpS</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="COMM">//	4から1へ順に約数をあたる。マッチした時点で返す。</span><span class="WHIT"></span><span class="COMM">//	すべて失敗した場合は、元の数値を返す。</span><span class="WHIT"></span><span class="PUNC">}</span><span class="WHIT"></span><span class="COMM">/** * ckBlank(timeLine) * 制御レイヤ(現在カラセル制御のみ)の判定 * 判定するtimelineオブジェクトを与える。 * すべての値が 0 || 100    ならばカラセルレイヤであると判定 * * 現在はブーリアンで返しているが、要調整か? * @param timeLine * @returns {boolean} */</span><span class="WHIT"></span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">ckBlank</span><span class="PUNC">(</span><span class="NAME">timeLine</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">xid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">xid</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">timeLine.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">xid</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">timeLine</span><span class="PUNC">[</span><span class="NAME">xid</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"></span><span class="PUNC">}</span><span class="WHIT"></span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">thisComp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT"></span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">thisLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT"></span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">thisTimeLine</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT"></span><span class="COMM">/** * ちょっとポインタ */</span><span class="WHIT"></span><span class="COMM">/** * readIN_(datastream) * @param datastream * @returns {boolean} * @private */</span><span class="WHIT"></span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">readIN_</span><span class="PUNC">(</span><span class="NAME">datastream</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">    </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"Started Read IN Data"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">    </span><span class="COMM">/**     * ラインで分割して配列に取り込み     * @type {Array}     */</span><span class="WHIT"></span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">SrcData</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">    </span><span class="NAME">SrcData</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">datastream.split</span><span class="PUNC">(</span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">    </span><span class="COMM">/**     * AEKey read-formatTestFlag     * @type {boolean}     */</span><span class="WHIT"></span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">AEK</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">    </span><span class="COMM">/**     * データストリーム判別プロパティ     * @type {number}     */</span><span class="WHIT"></span><span class="WHIT">    </span><span class="NAME">SrcData.startLine</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//データ開始行</span><span class="WHIT"></span><span class="WHIT">    </span><span class="COMM">/**     * データ種別(XPS/AEKey/TSX/AERemap/TSheet/STS)     * @type {string}     */</span><span class="WHIT"></span><span class="WHIT">    </span><span class="NAME">SrcData.dataClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"XPS"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">    </span><span class="COMM">/**     * ソースデータのプロパティ     */</span><span class="WHIT"></span><span class="WHIT">    </span><span class="NAME">SrcData.layerHeader</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//レイヤヘッダ開始行</span><span class="WHIT"></span><span class="WHIT">    </span><span class="NAME">SrcData.layerProps</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//レイヤプロパティエントリ数</span><span class="WHIT"></span><span class="WHIT">    </span><span class="NAME">SrcData.layerCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//レイヤ数</span><span class="WHIT"></span><span class="WHIT">    </span><span class="NAME">SrcData.layers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="COMM">//レイヤ情報トレーラー</span><span class="WHIT"></span><span class="WHIT">    </span><span class="NAME">SrcData.layerBodyEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//レイヤ情報終了行</span><span class="WHIT"></span><span class="WHIT">    </span><span class="NAME">SrcData.frameCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//読み取りフレーム数</span><span class="WHIT"></span><span class="WHIT">    </span><span class="COMM">/**     * 第一パス     * 冒頭ラインが識別コードまたは空行でなかった場合は、さようなら御免ね     * IEのデータの検証もここでやっといたほうが良い?     */</span><span class="WHIT"></span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">SrcData.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^\s*$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">MSIE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">choped</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">charCodeAt</span><span class="PUNC">(</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">choped</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">32</span><span class="PUNC">)</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">slice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">//なぜだかナゾなぜに一文字多いのか?</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * @todo どうしましょったら、どーしましょ まだ思案中 シアンは赤の補色です。             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^nasTIME-SHEET\ 0\.[1-4]$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">SrcData.startLine</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">;</span><span class="COMM">//データ開始行</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^Adobe\ After\ Effects\x20([456]\.[05])\ Keyframe\ Data$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">SrcData.dataClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"AEKey"</span><span class="PUNC">;</span><span class="COMM">//データ種別</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">SrcData.startLine</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">;</span><span class="COMM">//データ開始行</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^#TimeSheetGrid\x20SheetData$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">SrcData.dataClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"AERemap"</span><span class="PUNC">;</span><span class="COMM">//データ種別(.ard)</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"look AERemep"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">SrcData.startLine</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">;</span><span class="COMM">//データ開始行</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^\x22([^\x09]+\x09){25}[^\x09]+$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">SrcData.dataClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"TSheet"</span><span class="PUNC">;</span><span class="COMM">//データ種別(.tsh)</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">SrcData.startLine</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//データ開始行</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">TSXEx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                                </span><span class="NAME">SrcData.dataClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"TSX"</span><span class="PUNC">;</span><span class="COMM">//データ種別</span><span class="WHIT"></span><span class="WHIT">                                </span><span class="NAME">SrcData.startLine</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//データ開始行(TSXは0固定)</span><span class="WHIT"></span><span class="WHIT">                                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                                </span><span class="COMM">//	alert("どうもすみません。このデータは読めないみたいダ\n"+SrcData[l]);</span><span class="WHIT"></span><span class="WHIT">                                </span><span class="NAME">this.ErorCord</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                                </span><span class="NAME">this.ErorMsg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"どうもすみません。このデータは読めないみたいダ\n"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">    </span><span class="COMM">/**     * 第一パスおしまい。なんにもデータが無かったらサヨナラ     */</span><span class="WHIT"></span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.startLine</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">SrcData.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">this.ErorCord</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">this.ErorMsg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"読み取るデータがないのです。"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="COMM">//		xUI.riseSW("data_");//子供オブジェクトに依存しとる ヨクナイ</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">    </span><span class="COMM">/**     * ##変数名とプロパティ名の対照テーブル     * @type {string[]}     */</span><span class="WHIT"></span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">varNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"></span><span class="WHIT">        </span><span class="STRN">"MAPPING_FILE"</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">        </span><span class="STRN">"TITLE"</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">        </span><span class="STRN">"SUB_TITLE"</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">        </span><span class="STRN">"OPUS"</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">        </span><span class="STRN">"SCENE"</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">        </span><span class="STRN">"CUT"</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">        </span><span class="STRN">"TIME"</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">        </span><span class="STRN">"TRIN"</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">        </span><span class="STRN">"TROUT"</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">        </span><span class="STRN">"FRAME_RATE"</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">        </span><span class="STRN">"CREATE_USER"</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">        </span><span class="STRN">"UPDATE_USER"</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">        </span><span class="STRN">"CREATE_TIME"</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">        </span><span class="STRN">"UPDATE_TIME"</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">    </span><span class="COMM">/**     * @type {string[]}     */</span><span class="WHIT"></span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">propNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"></span><span class="WHIT">        </span><span class="STRN">"mapfile"</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">        </span><span class="STRN">"title"</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">        </span><span class="STRN">"subtitle"</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">        </span><span class="STRN">"opus"</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">        </span><span class="STRN">"scene"</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">        </span><span class="STRN">"cut"</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">        </span><span class="STRN">"time"</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">        </span><span class="STRN">"trin"</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">        </span><span class="STRN">"trout"</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">        </span><span class="STRN">"framerate"</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">        </span><span class="STRN">"create_user"</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">        </span><span class="STRN">"update_user"</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">        </span><span class="STRN">"create_time"</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">        </span><span class="STRN">"update_time"</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">props</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">varNames.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">varNames.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">props</span><span class="PUNC">[</span><span class="NAME">varNames</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">propNames</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.dataClass</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"XPS"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * データ走査第二パス(XPS)         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData.startLine</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">SrcData.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">line</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">//前置部分を読み込みつつ、本体情報の確認</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">MSIE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">choped</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">charCodeAt</span><span class="PUNC">(</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">choped</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">32</span><span class="PUNC">)</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">slice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">//なぜだかナゾなぜに一文字多いのか?</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * シートプロパティにマッチ             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^\#\#([A-Z].*)=(.*)$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">nAme</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">vAlue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$2</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="COMM">/**                 * 時間関連プロパティを先行して評価。                 * 読み取ったフレーム数と指定時間の長いほうでシートを初期化する。                 * 時間プロパティ欠落時のために初期値設定                 */</span><span class="WHIT"></span><span class="WHIT">                </span><span class="COMM">/*                     SrcData.time	=thisComp.duration*thisComp.frameRate;//読み取り                 SrcData.trin	=[this.trin[0],this.trin[1]];                 SrcData.trout	=[this.trout[0],this.trout[1]];                 SrcData.time="6+0";                 */</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">SrcData.trin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">SrcData.trout</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nAme</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"TRIN"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="COMM">//トランシットイン</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"TROUT"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="COMM">//トランシットアウト</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tm</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.FCT2Frm</span><span class="PUNC">(</span><span class="NAME">vAlue.split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">tm</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">tm</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nm</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vAlue.split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">nm</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">nm</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">prpName</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">props</span><span class="PUNC">[</span><span class="NAME">nAme</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">tm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nm</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"TIME"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="COMM">//カット尺</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tm</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.FCT2Frm</span><span class="PUNC">(</span><span class="NAME">vAlue</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">tm</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">tm</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">props</span><span class="PUNC">[</span><span class="NAME">nAme</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tm</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="COMM">//時間関連以外</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">props</span><span class="PUNC">[</span><span class="NAME">nAme</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vAlue</span><span class="PUNC">;</span><span class="WHIT"></span><span class="COMM">//					判定した値をプロパティで控える</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * レイヤヘッダまたは終了識別にマッチ             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^\[(([a-zA-Z]+)\t?.*)\]$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="COMM">/**                 * シート終わっていたらメモを取り込んで終了                 */</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/\[END\]/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="COMM">/**                     * シートボディ終了ライン控え                     */</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">SrcData.layerBodyEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="STRN">"memo"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">li</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">li</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">SrcData.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">li</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="STRN">"memo"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">li</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\n"</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="COMM">/**                     * 各レイヤの情報を取得                     * レイヤヘッダの開始行を記録                     */</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.layerHeader</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">SrcData.layerHeader</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="COMM">/**                     *  ロットを記録(最大の行を採る)                     *  @type {number}                     */</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">LayerCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">"\t"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">SrcData.layerCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="PUNC">(</span><span class="NAME">SrcData.layerCount</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">LayerCount</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">LayerCount</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">SrcData.layerCount</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="COMM">/**                     * エントリ数を記録                     */</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">SrcData.layerProps</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="COMM">/**                 * シートデータ本体の行数を加算                 */</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^\#.*$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">SrcData.frameCount</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="COMM">//読み取りフレーム数</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">    </span><span class="COMM">/**     * データ走査第二パス(AEKey)     */</span><span class="WHIT"></span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.dataClass</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"AEKey"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * 仮にデータを取得するコンポを初期化         * @type {FakeComposition}         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">thisComp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">FakeComposition</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">thisComp.maxFrame</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//キーの最大時間を取得するプロパティを初期化</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">ly_id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//レイヤID初期化</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">tl_id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//タイムラインID初期化</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">kf_id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//キーフレームID初期化 いらないか?</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * 第二パス開始         * データをスキャンしてコンポ(オブジェクト)に格納         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData.startLine</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">SrcData.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">line</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * キーデータに含まれるレイヤ情報の取得             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">MSIE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">choped</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">charCodeAt</span><span class="PUNC">(</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">choped</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">32</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">slice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">//データ前処理・なぜだかナゾ、なぜに一文字多いのか?</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * 空白行のスキップ             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * 一番エントリの多いデータ行を最初に処理             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^\t.*/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="COMM">//if(dbg) dbgPut("\tDATALINEs\nLayer No."+ly_id+" TimeLineID :"+tl_id+ " "+line+":"+SrcData[line]);</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">SrcLine</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">"\t"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="COMM">/**                 * フィールドタイトル行スキップ                 */</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcLine</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"Frame"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="COMM">/**                 * レイヤ内で一度もタイムラインを処理していない。                 */</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tl_id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="COMM">//if(dbg) dbgPut(SrcLine);</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="COMM">/**                     * レイヤヘッダなのでレイヤのプロパティを検証してオブジェクトに登録                     */</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcLine</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"Units\ Per\ Second"</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="COMM">//コンポフレームレート</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">thisComp.frameRate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcLine</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="COMM">//この部分をこのまま放置するとコンポのフレームレートが、最後のレイヤで決定されるので注意。</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"Source\ Width"</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="COMM">//レイヤソース幅</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">thisLayer.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcLine</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"Source\ Height"</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="COMM">//レイヤソース高さ</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">thisLayer.height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcLine</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"Source\ Pixel\ Aspect\ Ratio"</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="COMM">//ソースの縦横比</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">thisLayer.pixelAspect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcLine</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"Comp\ Pixel\ Aspect\ Ratio"</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="COMM">//コンポの縦横比</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">thisComp.pixelAspect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcLine</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="COMM">//時間関連以外</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">thisLayer</span><span class="PUNC">[</span><span class="NAME">SrcLine</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcLine</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="COMM">//	判定した値をレイヤのプロパティに控える。</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="COMM">//タイムラインデータなのでアクティブなタイムラインに登録</span><span class="WHIT"></span><span class="COMM">//if(dbg) dbgPut("timelinedata line No."+line+":"+SrcData[line]);</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">frame</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcLine</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">frame</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">thisComp.maxFrame</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">thisComp.maxFrame</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">frame</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="COMM">//	キーフレームの最大時間を記録</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcLine.slice</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">SrcLine.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="COMM">//	value=SrcLine.slice(2);</span><span class="WHIT"></span><span class="COMM">//	タイムラインの最大値を控える 999999 は予約値なのでパス</span><span class="WHIT"></span><span class="COMM">//	実際問題ここで控えた方が良いのかこれは?</span><span class="WHIT"></span><span class="COMM">//	if (thisTimeLine.maxValue&lt;value && value &lt; 999999)</span><span class="WHIT"></span><span class="COMM">//	thisTimeLine.maxValue=value;</span><span class="WHIT"></span><span class="COMM">//result=thisTimeLine.push(new KeyFrame(frame,value));</span><span class="WHIT"></span><span class="COMM">//thisComp.layers[ly_id][tl_id][kf_id] = new KeyFrame(frame,value);</span><span class="WHIT"></span><span class="COMM">//kf_id ++;</span><span class="WHIT"></span><span class="COMM">//result=thisComp.layers[ly_id][tl_id].setKeyFrame(new KeyFrame(frame,value));</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">ly_id</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">tl_id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">KeyFrame</span><span class="PUNC">(</span><span class="NAME">frame</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">ly_id</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">tl_id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"></span><span class="COMM">//	if(dbg) dbgPut(">>set "+thisComp.layers[ly_id][tl_id].name+</span><span class="WHIT"></span><span class="COMM">//	" frame:"+frame+"  to value:"+value+"&lt;&lt;"+result+</span><span class="WHIT"></span><span class="COMM">//	"::and maxFrame is :" + thisComp.maxFrame);</span><span class="WHIT"></span><span class="COMM">//if(dbg) dbgPut(">>> "+ thisComp.layers[ly_id][tl_id][kf_id].frame +"&lt;&lt;&lt;");</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="COMM">//次の判定は、当然パスして次の行を処理</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="COMM">//レイヤ開始判定</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^Adobe\ After\ Effects\x20([456]\.[015])\ Keyframe\ Data$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="COMM">//if(dbg) dbgPut("\n\nNew Layer INIT "+l+":"+SrcData[line]);</span><span class="WHIT"></span><span class="WHIT">                </span><span class="COMM">//レイヤ作成</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">ly_id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">FakeLayer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="COMM">//		thisComp.layers[ly_id].init();</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">thisLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">ly_id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="COMM">//ポインタ設定</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="COMM">//		タイムライン開始判定または、レイヤ終了</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^[\S]/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="COMM">//　タイムライン終了処理があればここに</span><span class="WHIT"></span><span class="COMM">// レイヤ終了処理</span><span class="WHIT"></span><span class="COMM">//if(dbg)	dbgPut(line+" : "+SrcData[line]);</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^End\ of\ Keyframe\ Data$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="COMM">//			thisComp.setFrameDuration()</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">ly_id</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">tl_id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">kf_id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="COMM">//レイヤIDインクリメント・タイムラインID初期化</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="COMM">//	最上位階層はデータブロックのセパレータなので読み取り対象を切り換え	//	タイムラインを判定して作成</span><span class="WHIT"></span><span class="COMM">//	if(! SrcData[line].match(/^\s*$/)){}</span><span class="WHIT"></span><span class="COMM">//新規タイムライン設定</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">SrcLine</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">"\t"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcLine</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"Time\ Remap"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">tl_id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"timeRemap"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"Anchor\ Point"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">tl_id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"anchorPoint"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"Position"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">tl_id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"position"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"Scale"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">tl_id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"scale"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"Rotation"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">tl_id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"rotation"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"Opacity"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">tl_id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"opacity"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"変換終了"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">tl_id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"wipe"</span><span class="PUNC">;</span><span class="COMM">//AE 4.0-5.5 wipe/トランジション</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"スライダ"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">tl_id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"slider"</span><span class="PUNC">;</span><span class="COMM">//AE 4.0-5.5 スライダ制御</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">case</span><span class="WHIT">    </span><span class="STRN">"Effects"</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="COMM">//AE 6.5 (6.0? 要確認) エフェクトヘッダサブ判定が必要</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcLine</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">slice</span><span class="PUNC">(</span><span class="STRN">"\ "</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                                </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"変換終了"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                                    </span><span class="NAME">tl_id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"wipe"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                                </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"スライダ制御"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                                    </span><span class="NAME">tl_id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"slider"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="COMM">//	case "":	tl_id="";break;</span><span class="WHIT"></span><span class="COMM">//	case "":	tl_id="";break;</span><span class="WHIT"></span><span class="COMM">//	case "":	tl_id="";break;</span><span class="WHIT"></span><span class="WHIT">                                    </span><span class="NAME">tlid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcLine</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">tlid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcLine</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="COMM">//	if(! thisComp.layers[ly_id][tl_id]){thisComp.layers[ly_id][tl_id]= new TimeLine(tl_id)}else{if(dbg) dbgPut(tl_id)}</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">ly_id</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">tl_id</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">ly_id</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">tl_id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">ly_id</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">tl_id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">tl_id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">ly_id</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">tl_id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">maxValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">ly_id</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">tl_id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">valueAtTime</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">valueAtTime_</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="COMM">//else{	if(dbg) dbgPut(tl_id + " is exist")	}</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="COMM">/**                     * なければ作る＝すでにあるタイムラインならスキップ                     */</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">thisTimeLine</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">ly_id</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">tl_id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="COMM">//		if(dbg) dbgPut("set TIMELINE :"+ly_id+":"+tl_id);</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="COMM">//		all_AEfake();</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * キーの読み込みが終わったのでキーデータを解析         * キーの最後のフレームをみて、カットの継続時間を割り出す。         * @type {number}         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">thisComp.duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">nas.FCT2ms</span><span class="PUNC">(</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">ssUnit</span><span class="PUNC">(</span><span class="NAME">thisComp.frameRate</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">Math.ceil</span><span class="PUNC">(</span><span class="NAME">thisComp.maxFrame</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">ssUnit</span><span class="PUNC">(</span><span class="NAME">thisComp.frameRate</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">1000</span><span class="PUNC">;</span><span class="COMM">//最小単位はキリの良いところで設定</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * タイムラインをチェックしてタイミング情報を抽出         * レイヤでループ         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lyr</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">thisComp.layers</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * コンポジションのレイヤ情報を読んで、変換のパラメータを判定する             * 現在認識して読み取るタイムライン             * timeRemap    タイミング情報有り             * slider    タイミング情報の可能性有り             * opacity    タイミング情報の可能性有り             * wipe    タイミング情報の可能性有り             * カメラワーク判定は、現在なし 常にfalse             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * ソースデータ用情報トレーラ             * @type {{}}             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * 初期化             * @type {boolean}             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">haveTimingData</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">haveCameraWork</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * メソッド・位置をデフォルトに設定             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">blmtd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xUI.blmtd</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">blpos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xUI.blpos</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">blmtd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"wipe"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">blpos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"first"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lot</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"=AUTO="</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * 仮のブランクレイヤ             * @type {boolean}             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">bTimeLine</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tBlank</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * リマップはある?             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timeRemap</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">haveTimingData</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="COMM">/**                 * カラセル制御レイヤはあるか                 */</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ckBlank</span><span class="PUNC">(</span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">blmtd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"opacity"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">blpos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"end"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="COMM">/**                         * 仮のブランクレイヤ                         * @type {*|TimeLine}                         */</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">bTimeLine</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">opacity</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tBlank</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"></span><span class="COMM">//alert("hasBlankOpacity");</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">wipe</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ckBlank</span><span class="PUNC">(</span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">wipe</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">blmtd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"wipe"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">blpos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"end"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="COMM">//仮のブランクレイヤ</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">bTimeLine</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">wipe</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tBlank</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">;</span><span class="WHIT"></span><span class="COMM">//alert("hasBlankWipe");</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                </span><span class="COMM">/**                 * キーを全数検査                 * @type {boolean}                 */</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isExpression</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="COMM">//エクスプレッションフラグ</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">MaxValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//最大値を控える変数</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">blAP</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="COMM">//カラセル出現フラグ</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tmpBlank</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">blmtd</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"opacity"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">;</span><span class="COMM">//仮のブランク値</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">kid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">kid</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timeRemap.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">kid</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timeRemap</span><span class="PUNC">[</span><span class="NAME">kid</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">999999</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">isExpression</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">blAP</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="COMM">/**                     * これが最優先(最後に判定して上書き)                     * 最大値を取得                     */</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">MaxValue</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timeRemap</span><span class="PUNC">[</span><span class="NAME">kid</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timeRemap</span><span class="PUNC">[</span><span class="NAME">kid</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">999999</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">MaxValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timeRemap</span><span class="PUNC">[</span><span class="NAME">kid</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="COMM">/**                         * 最大値が更新されたらキーに対応するカラセル制御をチェック                         */</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">bTimeLine</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="COMM">/**                             * 制御ラインあるか                             * キーフレームの位置にブランク指定があれば、そこをブランク値に設定                             */</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">bTimeLine.valueAtTime</span><span class="PUNC">(</span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timeRemap</span><span class="PUNC">[</span><span class="NAME">kid</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tBlank</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                                </span><span class="NAME">blAP</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="COMM">//カラセル出現</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isExpression</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">blmtd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"expression2"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">blpos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"end"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">maxValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">MaxValue</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="COMM">/**                 * フレームレート取り出し                 */</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">FrameDuration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">frameDuration</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">frameDuration</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">thisComp.frameDuration</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="COMM">/**                 * セル枚数推定                 */</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">blpos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"end"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lot</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">blAP</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">MaxValue</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">FrameDuration</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">MaxValue</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">FrameDuration</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="COMM">//end</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isExpression</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">blAP</span><span class="PUNC">)</span><span class="WHIT">    </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lot</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT"></span><span class="COMM">//		SrcData.layers[lyr].hasBlank=blAP;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"first"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lot</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">MaxValue</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">FrameDuration</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//first</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"none"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT"></span><span class="COMM">//	SrcData.layers[lyr].lot="=AUTO=";//end && MaxValue==0</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="COMM">/**                 * スライダ制御はある?                 */</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">slider</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="COMM">/**                     * スライダ=エクスプレッションの可能性有り                     *                     * エクスプレッションだとするとexpression1なので、                     * 同一レイヤにタイムラインが二つ以上あってはならないものとする。                     * が、二つ目以降のスライダは、現在正常に読めない。混ざる                     * そのうち何とかする                     */</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="COMM">/**                     * キーを全検査する。                     * @type {number}                     */</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">MaxValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isTiming</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">kid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">kid</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">slider.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">kid</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="COMM">/**                         * 整数か                         */</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">slider</span><span class="PUNC">[</span><span class="NAME">kid</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">isTiming</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="COMM">/**                         * 最大値を取得                         */</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">MaxValue</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">slider</span><span class="PUNC">[</span><span class="NAME">kid</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">MaxValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">slider</span><span class="PUNC">[</span><span class="NAME">kid</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="COMM">/**                     * すべて整数値ならば一応エクスプレッションによるタイミングと認識                     */</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isTiming</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">haveTimingData</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">blmtd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"expression1"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">blpos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"first"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lot</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">MaxValue</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">maxValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">MaxValue</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * 両方の判定を抜けたならタイミング情報がないのでこのレイヤはただの空レイヤ             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * タイミングだと思われる場合はフラグ立てる。             * case    "slider":             * case    "timeRemap":    ;break;             * キーを全数検査する。             * 制御レイヤが付属していたらそちらを優先させる。             * 制御レイヤの値とリマップの値を比較してカラセルメソッドとポジションを出す             タイムリマップとスライダの時のみの判定             //値の最大量を控える             if(SrcData.layers[ly_id].maxValue&lt;value) SrcData.layers[ly_id].maxValue= value;             //スライダかつ整数以外の値があるときは削除フラグを立てる             if(tl_id=="slider" && value%1 != 0) SrcData.layers[ly_id].isExpression=false;             //タイムリマップでかつ値に"999999"がある場合はメソッドをexp2に             if(tlid=="timeRemap" && value==999999) SrcData.leyers[ly_id].blmtd="exp2";             */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * 解析したプロパティの転記         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">AEK</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * 暫定処理だけど現在のカットの情報で埋めることにする?             * @type {string}             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.mapfile</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"(no file)"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.title</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.title</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.subtitle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.subtitle</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.opus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.opus</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.scene</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.scene</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.cut</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.cut</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.create_user</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.create_user</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.update_user</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.update_user</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.create_time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.create_time</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.update_time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.update_time</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.framerate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">thisComp.frameRate</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.layerCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">thisComp.layers.length</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.memo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.memo</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">thisComp.duration</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">thisComp.frameRate</span><span class="PUNC">;</span><span class="COMM">//読み取り</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.trin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">this.trin</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.trin</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.trout</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">this.trout</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.trout</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.mapfile</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"(no file)"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.title</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.subtitle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.opus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.scene</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.cut</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.create_user</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.update_user</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.create_time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.update_time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.framerate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">thisComp.frameRate</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.layerCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">thisComp.layers.length</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.memo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">thisComp.duration</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">thisComp.frameRate</span><span class="PUNC">;</span><span class="COMM">//読み取り</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.trin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"trin"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.trout</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"trout"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="COMM">//キーフレームからは読まない(ユーザが後で指定)</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="COMM">//	SrcData.frameCount	=;</span><span class="WHIT"></span><span class="COMM">//	SrcData.	="";</span><span class="WHIT"></span><span class="COMM">//	SrcData.	="";</span><span class="WHIT"></span><span class="COMM">//	SrcData.	="";	</span><span class="WHIT"></span><span class="COMM">//	SrcData.	="";</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * タイムリマップとスライダ制御の両方がない場合は、         * レイヤは「camerawork」(保留)         * スライダ制御があって、かつデータエントリーがすべて整数の場合は、         * exp1 それ以外はスライダ制御を破棄         * スライダ制御とタイムリマップが両方ある場合はタイムリマップ優先         */</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">    </span><span class="COMM">/**     * データ走査第二パス(.ard)     */</span><span class="WHIT"></span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.dataClass</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"AERemap"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"AER"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * データ状態設定 Param > Names         * @type {string}         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dataStatus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//読み込みステータス</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">LayerCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">	 </span><span class="COMM">//レイヤ数え(確認用)</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData.startLine</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">SrcData.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">line</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * 前置部分を読み込みつつ、本体情報の確認             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">MSIE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">choped</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">charCodeAt</span><span class="PUNC">(</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">choped</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">32</span><span class="PUNC">)</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">slice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">//なぜだかナゾなぜに一文字多いのか?</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * シートプロパティにマッチ             * 空行スキップとステータス変更             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">continue</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myLineData</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">"\t"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myLineData</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"*CommentStart"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"*CommentEnd"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">dataStatus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Skip"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"*ParamStart"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">dataStatus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Param"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"*MapData"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"*MapNumber"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"*ChildLayer"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">dataStatus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Skip"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"*CellName"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">dataStatus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Names"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">SrcData.layerHeader</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"*CellDataStart"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"*Cell"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"*End"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">dataStatus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"end"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * 第二パス終了             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dataStatus</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"end"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * 読みとばしデータなのでスキップ             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dataStatus</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"Skip"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * データステータスがParamの処理             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dataStatus</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"Param"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="COMM">//	var ARDValue=SrcData[line].split[1];</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myLineData</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"LayerCount"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">SrcData.layerCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myLineData</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"FrameCount"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">SrcData.time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myLineData</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"CmpFps"</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">SrcData.framerate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myLineData</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"SrcWidth"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="COMM">//NOP</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"SrcHeight"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="COMM">//NOP</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"PageFrame"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="COMM">//NOP</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"SrcAspect"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="COMM">//NOP</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"EmptyCell"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="COMM">//NOP</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">default</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="COMM">//NOP</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * レイヤカウント確認             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dataStatus</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"Names"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">myLineData</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^[0-9]+$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">LayerCount</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">LayerCount</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">SrcData.layerCount</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">SrcData.layerCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">LayerCount</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                </span><span class="COMM">//レイヤ数確認</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * プロパティの設定         * @type {string}         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.mapfile</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"(no file)"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.title</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myTitle</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.subtitle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mySubTitle</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.opus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myOpus</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.scene</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.cut</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.create_user</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myName</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.update_user</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myName</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.create_time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.update_time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.memo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"AERemap convert"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="COMM">//SrcData.framerate	="";</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.trin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"trin"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.trout</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"trout"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="COMM">//	SrcData.frameCount	=;</span><span class="WHIT"></span><span class="COMM">//	SrcData.	="";</span><span class="WHIT"></span><span class="COMM">//	SrcData.	="";</span><span class="WHIT"></span><span class="COMM">//	SrcData.	="";	</span><span class="WHIT"></span><span class="COMM">//	SrcData.	="";</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">    </span><span class="COMM">/**     * データ走査第二パス(.tsh)     */</span><span class="WHIT"></span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.dataClass</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"TSheet"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * レイヤカウント最大値/フレーム総数 控える         * @type {number}         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">;</span><span class="COMM">//ラベル行チェック行終了行を削除</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">LayerCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">SrcData.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">line</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">col</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">"\t"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">col</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">col</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">"\t"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NAME">col</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">LayerCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">col</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">SrcData.layerCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">LayerCount</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">SrcData.layerCount</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">LayerCount</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">SrcData.layerCount</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * 何らかの手違いで全カラのシートを読み込んだ場合の処置         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">LayerCount</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">SrcData.layerCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SheetLayers</span><span class="PUNC">;</span><span class="COMM">//標準値で初期化</span><span class="WHIT"></span><span class="COMM">//	return false;エラー返して中止</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * プロパティの設定         * @type {string}         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.mapfile</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"(no file)"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.title</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myTitle</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.subtitle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mySubTitle</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.opus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myOpus</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.scene</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.cut</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.create_user</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myName</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.update_user</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myName</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.create_time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.update_time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.memo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"T-Sheet convert"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.framerate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">24</span><span class="PUNC">;</span><span class="COMM">//T-Sheetは24fps専用</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.trin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"trin"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.trout</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"trout"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="COMM">//	SrcData.frameCount	=;</span><span class="WHIT"></span><span class="COMM">//	SrcData.	="";</span><span class="WHIT"></span><span class="COMM">//	SrcData.	="";</span><span class="WHIT"></span><span class="COMM">//	SrcData.	="";	</span><span class="WHIT"></span><span class="COMM">//	SrcData.	="";</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">    </span><span class="COMM">/**     * データ走査第二パス(TSX)     */</span><span class="WHIT"></span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">TSXEx</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">SrcData.dataClass</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"TSX"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//初期化</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">LayerDuration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.layerCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//初期化</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">LayerCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData.startLine</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">SrcData.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">line</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * @desc 本体情報の確認             *             * レイヤカウント・各レイヤの継続時間カウント             * タイムシートの長さは最長のレイヤを使用             * シートの継続はサポート=(直後のレイヤと連結)             * 空白行はすべてフレームカウント             * 開始行および読み込み停止行の直後の行のみ情報行として使用             *    第二フィールドを             * 継続時間に加算されないデータ    /^[\/eE].*$/             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^[\/eE].*$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">LayerCount</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">SrcData.layerCount</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">LayerCount</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">LayerDuration</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">LayerDuration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">LayerCount</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                </span><span class="COMM">//記述終了・継続時間加算リセット・レイヤ加算</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="COMM">//if(!SrcData[line].match(/^[\/eE].*$/)){}</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">LayerCount</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">SrcData.layerCount</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">SrcData.layerCount</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">LayerCount</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">LayerCount</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">blmtd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"file"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">LayerCount</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">blpos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"first"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">LayerCount</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lot</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"=AUTO="</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">LayerDuration</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.time</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">LayerDuration</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">SrcData.time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">LayerDuration</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">//有効な動画番号データ(単独)	/^[1-9][0-9]*\s?.*$/</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">//有効な動画番号データ(繰返)	/^[+rR]?\[?[1-9][\,]\]?</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * プロパティの設定         * @type {string}         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.mapfile</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"(no file)"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.title</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myTitle</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.subtitle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mySubTitle</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.opus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myOpus</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.scene</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.cut</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.create_user</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myName</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.update_user</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myName</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.create_time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.update_time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.memo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"TSXreadTEST"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.framerate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.trin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"trin"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.trout</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"trout"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="COMM">//	SrcData.frameCount	=;</span><span class="WHIT"></span><span class="COMM">//	SrcData.	="";</span><span class="WHIT"></span><span class="COMM">//	SrcData.	="";</span><span class="WHIT"></span><span class="COMM">//	SrcData.	="";	</span><span class="WHIT"></span><span class="COMM">//	SrcData.	="";</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">    </span><span class="COMM">/**     * 第二パス終了・読み取った情報でXPSオブジェクトを再初期化(共通)     * @type {number}     */</span><span class="WHIT"></span><span class="WHIT">    </span><span class="NAME">SrcData.duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">Math.ceil</span><span class="PUNC">(</span><span class="NAME">SrcData.time</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.trin</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">SrcData.trout</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">    </span><span class="COMM">/**     * トランシット時間の処理は要再考。現状は切り上げ     * @type {number}     */</span><span class="WHIT"></span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">SheetDuration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.duration</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.frameCount</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.duration</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.frameCount</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//大きいほう</span><span class="WHIT"></span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/*	------ とりあえず、警告部分を削除 ----         *** 動作フラグでデータ種別だけ判定して返すオプションを付けても良いかも         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * ここから後戻り不可なので警告を出すべきかもね         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.dataClass.match</span><span class="PUNC">(</span><span class="REGX">/(XPS|AERemap|TSheet)/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * 読み込み確認(XPS)             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">confirm</span><span class="PUNC">(</span><span class="STRN">"タイムシートデータの読み込みを行います。\n読み込みを行うと以前の編集内容は消去されます。\nこの操作は、取り消しできません。\n\n----- よろしいですか?"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.dataClass</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"AEKey"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * 読み込み確認(AEKey)             * ここは、後からオプションセレクタに変更すること。             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">AEK</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"AEKeyデータの読み込みを行います。\nデータはカーソル位置に挿入されます。\n\n----- よろしいですか?"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"AEKeyデータの読み込みを行います。\n読み込みを行うと以前の編集内容は消去されます。\nこの操作は、取り消しできません。\n\n----- よろしいですか?"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">confirm</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="COMM">//	SrcData.blank_offset=0;// 0 or 1</span><span class="WHIT"></span><span class="COMM">//	SrcData.key_shift=false;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.dataClass</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"TSX"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * 読み込み確認(TSX)             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">confirm</span><span class="PUNC">(</span><span class="STRN">"TSXデータとして読み込みを行います。\n読み込みを行うと以前の編集内容は消去されます。\nこの操作は、取り消しできません。\n\n----- よろしいですか?"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="COMM">// ---- 暫定的にスキップ -----</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="COMM">//	///////////////////////</span><span class="WHIT"></span><span class="COMM">//	if(dbg) dbgPut("count/duration:"+SrcData.layerCount+":"+SheetDuration);</span><span class="WHIT"></span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.dataClass</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">"AEKey"</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">AEK</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.init</span><span class="PUNC">(</span><span class="NAME">SrcData.layerCount</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">SheetDuration</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//再初期化</span><span class="WHIT"></span><span class="COMM">//	///////////////////////</span><span class="WHIT"></span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.dataClass</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">"AEKey"</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">AEK</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * 第二パスで読み取ったプロパティをXPSに転記         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">propNames.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">prpName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">propNames</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">prpName</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">prpName</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">"time"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">prpName</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">prpName</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="COMM">//					タイム以外はそのまま転記</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * 読み取りデータを調べて得たキーメソッドとブランク位置を転記         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lyr</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">SrcData.layers</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">blmtd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">blmtd</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">blpos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">blpos</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lot</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">lyr</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lot</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="STRN">"memo"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="STRN">"memo"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="STRN">"memo"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="COMM">//memoがあれば転記</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">    </span><span class="COMM">/**     * 各エントリのレイヤプロパティとシート本体情報を取得(第三パス)     */</span><span class="WHIT"></span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.dataClass</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"XPS"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">frame_id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//読み取りフレーム初期化</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData.layerHeader</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">SrcData.layerBodyEnd</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">line</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * 角括弧で開始するデータはレイヤプロパティ             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^\[(([a-zA-Z]+)\t.*)\]$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layerProps</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$1.split</span><span class="PUNC">(</span><span class="STRN">"\t"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layerPropName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$2</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">layerPropName</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"CELL"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">layerPropName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"name"</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                </span><span class="COMM">/**                 * これ(CELL)だけシート表記とプロパティ名が一致していないので置換 一致が少ない場合はテーブルが必要になる                 */</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">SrcData.layerCount</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="STRN">"layers"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">layerPropName</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">layerProps</span><span class="PUNC">[</span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="COMM">/**                 * ほかコメント以外はすべてシートデータ                 */</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^\#.*$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">myLineAry</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/\t/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">"\t"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/[\;\:\,]/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"\t"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">"\t"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">col</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">col</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.layerCount</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">col</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="COMM">/**                         * シート本体データの取得                         */</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">this.xpsBody</span><span class="PUNC">[</span><span class="NAME">col</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">frame_id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="PUNC">(</span><span class="NAME">myLineAry</span><span class="PUNC">[</span><span class="NAME">col</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"></span><span class="WHIT">                                </span><span class="NAME">myLineAry</span><span class="PUNC">[</span><span class="NAME">col</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/(^\s*|\s*$)/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">frame_id</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.dataClass</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"AEKey"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * 読み出したAEオブジェクトから情報を再構成する         * @type {string}         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">preValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="COMM">//直前の値を控えておく変数</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">AEK</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * リザルト文字列の初期化             * @type {string}             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">AETransStream</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">AETransArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">SrcData.layerCount</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">layer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">SrcData.layerCount</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">AETransArray</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">layer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">SrcData.layerCount</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * レイヤ数回す             * @type {string}             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">timingTL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">blmtd</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"expression1"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"slider"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"timeRemap"</span><span class="PUNC">;</span><span class="COMM">//	タイミング保持タイムラインをblmtdで変更</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">BlankValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">blpos</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"first"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lot</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * レイヤごとのブランク値を出す。999999は、パス             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">kid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">kid</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">timingTL</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">kid</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="COMM">/**                 * タイミング保持タイムラインのキー数で転送                 */</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">preValue</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">timingTL</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">kid</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">frame</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">timingTL</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">kid</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">frame</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="COMM">/**                     * キーフレームの存在するコマのみ時間値からセル番号を取り出して転送                     */</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">xUI.timeShift</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">diffStep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">timingTL</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">kid</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NAME">thisComp.frameDuration</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">thisComp.frameDuration</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">timeShift</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">diffStep</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0.1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">thisComp.frameDuration</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">timeShift</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">blank_offset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">blpos</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"first"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="COMM">/**                     * あらかじめセル番号を計算                     */</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">cellNo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">timingTL</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"timeRemap"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">timingTL</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">kid</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">timeShift</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">thisComp.frameDuration</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">blank_offset</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">timingTL</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">kid</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">blpos</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"first"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cellNo</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">BlankValue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">cellNo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"X"</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cellNo</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">BlankValue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">cellNo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"X"</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="COMM">/**                     * 無条件ブランク                     */</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">timingTL</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">kid</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">999999</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">timingTL</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">kid</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">cellNo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"X"</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">bTimeLine</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">bTimeLine.valueAtTime</span><span class="PUNC">(</span><span class="NAME">frame</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">SrcData.layers</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tBlank</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">cellNo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"X"</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="COMM">//if(dbg) dbgPut(thisComp.layers[layer][timingTL][kid].value);</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">AEK</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">this.xpsBody</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">frame</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cellNo</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">AETransArray</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">cellNo.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">kid</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">timingTL</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentframe</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">timingTL</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">kid</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">frame</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nextframe</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">timingTL</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">kid</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">frame</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentframe</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">fr</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">nextframe</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">fr</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                                </span><span class="NAME">AETransArray</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">AETransArray</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">preValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">thisComp.layers</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">timingTL</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">kid</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">preValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="COMM">//1レイヤ終わったら再度初期化</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">AEK</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="COMM">//		xUI.put(AETransStream);</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * データ配列の数を比較して最も大きなものに合わせる             * @type {number}             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">MaxLength</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">layer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">SrcData.layerCount</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">MaxLength</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">MaxLength</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">AETransArray</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">AETransArray</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">MaxLength</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">layer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">SrcData.layerCount</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">AETransArray</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">MaxLength</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">AETransStream</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">AETransArray</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">layer</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">SrcData.layerCount</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="NAME">AETransStream</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\n"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="COMM">//	dbgPut(AETransStream);</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">xUI.Select</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">xUI.put</span><span class="PUNC">(</span><span class="NAME">AETransStream</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="COMM">//		return false;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">    </span><span class="COMM">/**     * AE-Remap     */</span><span class="WHIT"></span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.dataClass</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"AERemap"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * データ状態設定 Param > Names         * @type {string}         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dataStatus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="COMM">//読み込みステータス</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">LayerCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="COMM">//レイヤカウンタ</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData.startLine</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">SrcData.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">line</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * 空行スキップとステータス変更             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">continue</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myLineData</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">"\t"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myLineData</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"*ParamStart"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">dataStatus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Param"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"*CellName"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">dataStatus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Names"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">SrcData.layerHeader</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"*CellDataStart"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">dataStatus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"SheetBody"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"*Cell"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">LayerCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myLineData</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"*End"</span><span class="PUNC">:</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">dataStatus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"end"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * 第二パス終了             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dataStatus</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"end"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * データステータスがParamの処理             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dataStatus</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"Param"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="COMM">//skip</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * シートボディ取り込み             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dataStatus</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"SheetBody"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">myLineData</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^[0-9]+$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">this.xpsBody</span><span class="PUNC">[</span><span class="NAME">LayerCount</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">myLineData</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myLineData</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="STRN">"X"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">myLineData</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * レイヤラベル取得             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dataStatus</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"Names"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">myLineData</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^[0-9]+$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">this.xpsBody</span><span class="PUNC">[</span><span class="STRN">"layers"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">myLineData</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"name"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myLineData</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">    </span><span class="COMM">/**     * T-Sheet     */</span><span class="WHIT"></span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.dataClass</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"TSheet"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">frame_id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//読み取りフレーム初期化</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * 第一レコードからレイヤ名取得         * @type {Array.&lt;*>}         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">LayerLabels</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">"\t"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">slice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">SrcData.layerCount</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">LayerLabels</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">LayerLabels</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/^\x22/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">SrcData.layerCount</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">this.xpsBody</span><span class="PUNC">[</span><span class="STRN">"layers"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"name"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">LayerLabels</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * シートデータ読み取り         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">SrcData.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">line</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">/**             * すべてシートデータ             * @type {Array}             */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">myLineAry</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/\t/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">"\t"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/[\;\:\,]/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"\t"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">"\t"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">col</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">col</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">SrcData.layerCount</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">col</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="COMM">/**                 * シート本体データの取得(ダイアログフィールドはないのでトばして拾う)                 */</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">this.xpsBody</span><span class="PUNC">[</span><span class="NAME">col</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">frame_id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myLineAry</span><span class="PUNC">[</span><span class="NAME">col</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">myLineAry</span><span class="PUNC">[</span><span class="NAME">col</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/(^0$)/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"X"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">frame_id</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">    </span><span class="COMM">/**     * TSX     */</span><span class="WHIT"></span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">TSXEx</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">SrcData.dataClass</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"TSX"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * カウンタ初期化         * @type {number}         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//初期化</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">LayerTime</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">SrcData.layerCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//初期化</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">LayerCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">RepeatBuf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">repIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"></span><span class="COMM">//	var readCountLine	=	0;</span><span class="WHIT"></span><span class="COMM">//	var readCountLayer	=	0;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * 本体データ読み取り         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData.startLine</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">SrcData.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">line</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^[\/eE].*$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">LayerCount</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">SrcData.layerCount</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">LayerTime</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">LayerCount</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                </span><span class="COMM">/**                 * 記述終了・継続時間加算リセット・レイヤ加算                 */</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">LayerCount</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">SrcData.layerCount</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">RepeatBuf.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">RepeatBuf.length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">repIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">SrcData.layerCount</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">body_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SrcData</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/^([^\#]*)(\-\-|\#).*$/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"$1"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">body_data.match</span><span class="PUNC">(</span><span class="REGX">/^[1-9][0-9]*$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">RepeatBuf.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">RepeatBuf.length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">repIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">this.xpsBody</span><span class="PUNC">[</span><span class="NAME">LayerCount</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">LayerTime</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">body_data</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">body_data</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">RepeatBuf.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">this.xpsBody</span><span class="PUNC">[</span><span class="NAME">LayerCount</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">LayerTime</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RepeatBuf</span><span class="PUNC">[</span><span class="NAME">repIdx</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NAME">RepeatBuf.length</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">repIdx</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">this.xpsBody</span><span class="PUNC">[</span><span class="NAME">LayerCount</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">LayerTime</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">body_data</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">RepeatBuf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">TSX_expdList</span><span class="PUNC">(</span><span class="NAME">body_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">repIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">this.xpsBody</span><span class="PUNC">[</span><span class="NAME">LayerCount</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">LayerTime</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RepeatBuf</span><span class="PUNC">[</span><span class="NAME">repIdx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">repIdx</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">LayerTime</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SrcData.time</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">LayerDuration</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">SrcData.time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">LayerDuration</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">    </span><span class="COMM">/**     * @desc 読み取ったデータを検査する(データ検査は別のメソッドにしろ!??)     *     * マップファイルは、現在サポート無し     * サポート開始時期未定     * この情報は、他の情報以前に判定して、マップオブジェクトの生成が必要。     * マップ未設定状態では、代用マップを作成して使用。     * 代用マップは、デフォルトで存在。     *     * 現在は、代用MAPオブジェクトを先行して作成してあるが、     * 本来のマップが確定するのはこのタイミングなので、注意!     */</span><span class="WHIT"></span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">// MAPPING_FILE=(no file)//値は未設定時の予約値?nullで初期化すべきか?</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.mapfile</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.mapfile</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'(no file)'</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * マップファイルが未設定ならば、代用マップを使用         * この判定はあまりに雑なので後でなんとかすれ         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.mapfile</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'(no file)'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">MapObj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Map</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="COMM">//とりあえず既存のダミーマップを代入しておく。</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * マップファイルを読み込んでマップオブジェクトを初期化         * そのうちね、今はまだない         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * @desc 日付関連         * 制作日付と制作者が無い場合は、空白で初期化?無視したほうが良いかも         */</span><span class="WHIT"></span><span class="COMM">//CREATE_USER=''</span><span class="WHIT"></span><span class="COMM">//CREATE_TIME=''</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.create_time</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.create_time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.create_user</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.create_user</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * 最終更新日付と最終更新者が無い場合は、空白で初期化?         * (これは、どのみち保存時に現在のデータで上書き)         */</span><span class="WHIT"></span><span class="COMM">//UPDATE_USER=''</span><span class="WHIT"></span><span class="COMM">//UPDATE_TIME=''</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.update_time</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.update_time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.update_user</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.update_user</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT"></span><span class="COMM">//FRAME_RATE=24//</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * フレームレート読み取れてなければ、現在の値で初期化(組み込み注意)         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.framerate</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">this.framerate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.FRATE</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">nas.FRATE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.framerate</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * トランシット展開しておく         * TRIN=(時間文字列),(トランシット種別)         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.trin</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">this.trin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"trin"</span><span class="PUNC">]</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.FCT2Frm</span><span class="PUNC">(</span><span class="NAME">this.trin.split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">time</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.trin.split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this.trin.split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"trin"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">this.trin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">time</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * TROUT=(時間文字列),(トランシット種別)         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.trout</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">this.trout</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"trout"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.FCT2Frm</span><span class="PUNC">(</span><span class="NAME">this.trout.split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">time</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.trout.split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this.trout.split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"trout"</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">this.trout</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">time</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * TIMEも一応取り込んでおく。         * 実際のデータの継続時間とこの情報の「長いほう」を採る         * TIME=(時間文字列)         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">this.time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.FCT2Frm</span><span class="PUNC">(</span><span class="NAME">this.time</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">this.time</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">this.time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * @desc 作品データ         *         * 情報が無い場合は、空白で初期化。マップをみるようになったら。         * マップの情報を参照         * 最終作業情報(クッキー)を参照         * ユーザ設定によるデフォルトを参照 などから選択         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * TITLE=(未設定とかのほうが良いかも)         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.title</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.title</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">/**         * SUB_TITLE=(未設定とかのほうが良いかも)         */</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.subtitle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.subtitle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT"></span><span class="COMM">//OPUS=()</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.opus</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.opus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT"></span><span class="COMM">//SCENE=()</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.scene</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.scene</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT"></span><span class="COMM">//CUT=()</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.cut</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.cut</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT"></span><span class="COMM">//シーン?・カット番号は最終状態でもデフォルトは空白に。紛らわしいから。</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"></span><span class="COMM">//return this;</span><span class="WHIT"></span><span class="PUNC">}</span><span class="WHIT"></span><span class="COMM">//</span><span class="WHIT"></span><span class="COMM">//XPS.readIN	=	readIN_	;</span></pre></body></html>