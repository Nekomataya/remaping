<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="TOKN">﻿</span><span class="COMM">/*                      ------ new ValueConstractors.js
<span class='line'>  2</span> コーディング中なので、マージは保留   2016- 12.24
<span class='line'>  3</span>     xMap/Xpsで使用する値オブジェクト群
<span class='line'>  4</span> 
<span class='line'>  5</span>     新規のオブジェクトは、基本的に　new コンストラクタ() ではなく
<span class='line'>  6</span>     Object.create(親オブジェクト)又は、各クラスの　クラス.newオブジェクト()　メソッドで作成すること
<span class='line'>  7</span>     各々のValueオブジェクトはnas.xMapElementのcnontentプロパティとなる
<span class='line'>  8</span>     置きかえタイムラインの（区間）値としては参照を持つ
<span class='line'>  9</span>     タイムシート上は回数未定で同じ値が再利用される
<span class='line'> 10</span> 
<span class='line'> 11</span> このソースは、nasライブラリの基底オブジェクトを組み合わせて構成される
<span class='line'> 12</span> タイムライントラックの値（=xMapに登録されるelementの値）となるオブジェクト群
<span class='line'> 13</span> 
<span class='line'> 14</span> ライブラリを分割して　nas_AnimationValues.js　として　nas_common.jsの後　xpsio mapioの前に読み込むものとする
<span class='line'> 15</span> 
<span class='line'> 16</span>             nas.Animation&lt;Values>
<span class='line'> 17</span> 
<span class='line'> 18</span> xMapElementの値オブジェクト
<span class='line'> 19</span> xMapElementを介してXpsTimelineSectionの値となる
<span class='line'> 20</span> 
<span class='line'> 21</span> nas.AnimationCamerawork     抽象化された撮影指示を記述する値オブジェクト
<span class='line'> 22</span> nas.AnimationComposite      画像合成を記述する値オブジェクト
<span class='line'> 23</span> nas.AnimationDesctiption    注意点や特記内容を記述するオブジェクト
<span class='line'> 24</span> nas.AnimationGeopmetry      要素の配置を記述する値オブジェクト
<span class='line'> 25</span> nas.AnimationReplacement    画像データを保持してその置き換えを記述するオブジェクト
<span class='line'> 26</span> nas.AnimationSound          音響情報を記述するオブジェクト
<span class='line'> 27</span> nas.AnimationDialog         セリフ情報を記述するオブジェクト
<span class='line'> 28</span> 
<span class='line'> 29</span> */</span><span class="WHIT">
<span class='line'> 30</span> </span><span class="WHIT"> </span><span class="WHIT">
<span class='line'> 31</span> 
<span class='line'> 32</span> </span><span class="WHIT"> </span><span class="WHIT">
<span class='line'> 33</span> </span><span class="COMM">/**
<span class='line'> 34</span>  *  置きかえ（セル）タイムラインのパース
<span class='line'> 35</span>  *  
<span class='line'> 36</span>  contentTextはxMapの記述の該当部分を改行区切りテキストで与える
<span class='line'> 37</span>  
<span class='line'> 38</span>  データ型式は 第一、第二型式を自動判別
<span class='line'> 39</span> 
<span class='line'> 40</span>     第一型式
<span class='line'> 41</span> ^&lt;group>\t&lt;elementID>[\t&lt;optionString>[\t&lt;comment>]]$   
<span class='line'> 42</span> エントリーの定義を兼ねる
<span class='line'> 43</span>  
<span class='line'> 44</span>     第二型式
<span class='line'> 45</span> ^\t&lt;property> = &lt;value>$
<span class='line'> 46</span>  第二型式（プロパティ名＝値）型式の場合はそのまま使用
<span class='line'> 47</span> 
<span class='line'> 48</span> 
<span class='line'> 49</span>  第二型式に当てはまらない場合は、第一型式とし最大4フィールドのタブ区切りテキストとみなす
<span class='line'> 50</span>  =冒頭から３つまでのタブで分割する
<span class='line'> 51</span> 
<span class='line'> 52</span> 
<span class='line'> 53</span>  第一フィールドは、グループ名パース時点のみの情報
<span class='line'> 54</span>  第二フィールドは、エレメント名　エレメント名にグループ記述が欠けている場合はこれを補う？
<span class='line'> 55</span>  第三フィールドは、オプションプロパティ URI,width,height,offsetX,offsetY,offsetR
<span class='line'> 56</span>  第四フィールドは、エレメントに対するコメント
<span class='line'> 57</span>  
<span class='line'> 58</span>   csvパーサを通してプロパティに割り付けを行う
<span class='line'> 59</span> 第3フィールド以降、データ内のタブを含めすべての記述がエレメントに対するコメントプロパティとなる
<span class='line'> 60</span>  
<span class='line'> 61</span> 情報はすべて省略可能
<span class='line'> 62</span> 省略時は、各要素の親となるグループの持つプロパティを引き継ぐ
<span class='line'> 63</span> 
<span class='line'> 64</span> 以上、各エレメント共通
<span class='line'> 65</span> 
<span class='line'> 66</span> 
<span class='line'> 67</span> 以下種別ごとの第一型式情報並び(エレメントの配置)フォーマット
<span class='line'> 68</span> 
<span class='line'> 69</span>     置きかえタイムラインエレメント    
<span class='line'> 70</span> ["file","size.x","size.y","offset.x","offset.y","offset.r"]
<span class='line'> 71</span> 
<span class='line'> 72</span>     カメラワークタイムラインエレメント
<span class='line'> 73</span> [フィールドテキスト]     フィールド記述テキストは別定義のパーサに通す　16夏改装では保留
<span class='line'> 74</span> 
<span class='line'> 75</span>     エフェクトタイムラインエレメント
<span class='line'> 76</span> [エフェクトテキスト]     エフェクト記述テキストは別定義のパーサに通す　16夏改装では保留
<span class='line'> 77</span> 
<span class='line'> 78</span> xMapのパース時は、ドキュメントの記述を整形してそれを引数としてオブジェクトを初期化する
<span class='line'> 79</span> 
<span class='line'> 80</span> XPSのデータをパースする場合は、データ記述からキーワードを抽出して適合するｘMapエレメントを検索する
<span class='line'> 81</span> 検索に外れた場合は、デフォルトでオブジェクトを初期化
<span class='line'> 82</span> 都度値を与えてxMapに登録する
<span class='line'> 83</span> 
<span class='line'> 84</span> xMapがない場合（暫定コード）では、仮のｘMapデータにエントリを送り以降の再利用に供する
<span class='line'> 85</span> 
<span class='line'> 86</span> 
<span class='line'> 87</span> 以下　各値オブジェクトに共通
<span class='line'> 88</span> 
<span class='line'> 89</span> 親オブジェクト参照としてparentプロパティを置く
<span class='line'> 90</span> 基礎プロパティからの設定拡張のフラグとして extendedプロパティ
<span class='line'> 91</span> 
<span class='line'> 92</span> 一時的にセクションの値として初期化する場合は、第二引数が第一形式で与えられる
<span class='line'> 93</span> 
<span class='line'> 94</span>     new nas.AnimationReplacement(null,"GroupID\tElementName");
<span class='line'> 95</span>         または
<span class='line'> 96</span>     new nas.AnimationReplacement(Object xMapElmentGroup,"GroupID\tElementName");
<span class='line'> 97</span> 
<span class='line'> 98</span> parent　オブジェクトなしで初期化される場合があるので要注意
<span class='line'> 99</span> その場合は　可能な限りGroupを抽出してparentを設定して不能な場合はnullのままにしておく
<span class='line'>100</span> 
<span class='line'>101</span>  */</span><span class="WHIT">
<span class='line'>102</span> </span><span class="NAME">nas.AnimationReplacement</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myParent</span><span class="PUNC">,</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>103</span> </span><span class="WHIT">    </span><span class="NAME">this.parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myParent</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">myParent</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT">     </span><span class="PUNC">;</span><span class="COMM">//xMapElementGroup or null</span><span class="WHIT">
<span class='line'>104</span> </span><span class="WHIT">    </span><span class="NAME">this.contentText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'blank-cell'</span><span class="PUNC">;</span><span class="COMM">//xMap上のコンテントソースを保存する　自動で再構築が行なわれるタイミングがある</span><span class="WHIT">
<span class='line'>105</span> </span><span class="WHIT">                                                   </span><span class="COMM">//myContent undefined で初期化を行った場合の値は blank-cell</span><span class="WHIT">
<span class='line'>106</span> </span><span class="WHIT">    </span><span class="NAME">this.name</span><span class="WHIT">                                     </span><span class="PUNC">;</span><span class="COMM">//素材名（グループ名はあっても除かない）</span><span class="WHIT">
<span class='line'>107</span> </span><span class="WHIT">    </span><span class="NAME">this.source</span><span class="WHIT">                                   </span><span class="PUNC">;</span><span class="COMM">//nas.AnimationElementSource</span><span class="WHIT">
<span class='line'>108</span> </span><span class="WHIT">    </span><span class="NAME">this.comment</span><span class="WHIT">                                  </span><span class="PUNC">;</span><span class="COMM">//コメント文字列　エレメントの注釈プロパティ-xMap編集UIのみで確認できる</span><span class="WHIT">
<span class='line'>109</span> </span><span class="WHIT">    </span><span class="NAME">this.extended</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>110</span> 
<span class='line'>111</span> </span><span class="WHIT">    </span><span class="NAME">this.formGeometry</span><span class="WHIT">                             </span><span class="PUNC">;</span><span class="COMM">//nas.AnimationFieldオブジェクト</span><span class="WHIT">
<span class='line'>112</span> </span><span class="WHIT">    </span><span class="NAME">this.resolution</span><span class="WHIT">                               </span><span class="PUNC">;</span><span class="COMM">//要素の解像度   nas.Resolution()</span><span class="WHIT">
<span class='line'>113</span> </span><span class="WHIT">    </span><span class="NAME">this.size</span><span class="WHIT">                                     </span><span class="PUNC">;</span><span class="COMM">//要素のサイズ   nas.Size()</span><span class="WHIT">
<span class='line'>114</span> </span><span class="WHIT">    </span><span class="NAME">this.offset</span><span class="WHIT">                             </span><span class="PUNC">;</span><span class="COMM">//要素の原点オフセット   nas.Offset()</span><span class="WHIT">
<span class='line'>115</span> </span><span class="WHIT">    </span><span class="NAME">this.pegOffset</span><span class="WHIT">                          </span><span class="PUNC">;</span><span class="COMM">//要素のペグオフセット＊　これらはオブジェクトで統合？</span><span class="WHIT">
<span class='line'>116</span> </span><span class="WHIT">    </span><span class="NAME">this.overlay</span><span class="WHIT">                            </span><span class="PUNC">;</span><span class="COMM">//カブセの対象となるエレメントへの参照 　&lt; elementのプロパティへ移行が必要？</span><span class="WHIT">
<span class='line'>117</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>118</span> </span><span class="WHIT">    </span><span class="NAME">this.parseContent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>119</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>120</span> </span><span class="COMM">/**
<span class='line'>121</span>     //  引数なし　または引数が１つで文字列'basic'またはfalseと判断される場合は標準保存形式出力
<span class='line'>122</span>     標準保存形式(グループ名/エレメント名＋主要プロパティの１行出力)
<span class='line'>123</span> ^&lt;group>\t&lt;cellDescription>\t&lt; ここまではElementObjectの出力範囲
<span class='line'>124</span> &lt;proppertyValues>\t&lt;comment>
<span class='line'>125</span>     例
<span class='line'>126</span> "./stages/kd/kt#00[pilot]__s-c001_kd.psd///kd/A/0001+",254mm,142.875mm,127mm,71.4375mm	testOverlay
<span class='line'>127</span> 
<span class='line'>128</span> proppertyValuesは、comma区切りで以下の順のデータ
<span class='line'>129</span> ["&lt;source>"[,size.X,size.Y[,offset.X,offset.Y[,offset.R]]]]
<span class='line'>130</span> 末尾から順にすべて省略可能
<span class='line'>131</span> 各エントリに登録のない場合はデフォルトの値が使用される
<span class='line'>132</span> 
<span class='line'>133</span>     //  引数が 'extended'の場合は拡張保存形式で返す
<span class='line'>134</span>     拡張保存形式(グループ名,エレメント名を含まないタブを先頭にした複数行出力)
<span class='line'>135</span> ^\t&lt;propname> = &lt;proppertyValue>$\n
<span class='line'>136</span>     例
<span class='line'>137</span> 	file = "./stages/kd/kt#00[pilot]__s-c001_kd.psd///kd/A/0001+"
<span class='line'>138</span> 	
<span class='line'>139</span> 	
<span class='line'>140</span>     //  引数が一つ以上ある場合の処理
<span class='line'>141</span> 
<span class='line'>142</span> */</span><span class="WHIT">
<span class='line'>143</span> </span><span class="NAME">nas.AnimationReplacement.prototype.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">exportForm</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>144</span> </span><span class="COMM">//return this.contentText;//動作確認用ダミー行</span><span class="WHIT">
<span class='line'>145</span> 
<span class='line'>146</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">exportForm</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'extend'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>147</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resultArray</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>148</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.source</span><span class="PUNC">)</span><span class="WHIT">   </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="STRN">'\tfile = "'</span><span class="WHIT">    </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.source.toString</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">'"'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>149</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.size</span><span class="PUNC">)</span><span class="WHIT">     </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="STRN">'\tsize = '</span><span class="WHIT">     </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.size.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>150</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.offset</span><span class="PUNC">)</span><span class="WHIT">   </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="STRN">'\toffset = '</span><span class="WHIT">   </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.offset.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>151</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.rotation</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="STRN">'\trotation = '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.rotation.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>152</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.comment</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="STRN">'\tcomment = '</span><span class="WHIT">  </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.comment</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>153</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">resultArray.join</span><span class="PUNC">(</span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>154</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">exportForm</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'basic'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>155</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resultArray</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>156</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>157</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.source</span><span class="PUNC">)</span><span class="WHIT">   </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="STRN">'"'</span><span class="PUNC">+</span><span class="NAME">this.source.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">'"'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>158</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.size</span><span class="PUNC">)</span><span class="WHIT">     </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="NAME">this.size.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>159</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.offset</span><span class="PUNC">)</span><span class="WHIT">   </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="NAME">this.offset.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>160</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.rotation</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="NAME">this.rotation.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>161</span> </span><span class="WHIT">        </span><span class="NAME">resultArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">resultArray.join</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>162</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.comment</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="NAME">this.comment</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>163</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">this.parent.name</span><span class="PUNC">,</span><span class="NAME">this.name</span><span class="PUNC">,</span><span class="NAME">resultArray.join</span><span class="PUNC">(</span><span class="STRN">"\t"</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">'\t'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>164</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>165</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>166</span> </span><span class="COMM">//nas.AnimationReplacement.prototype.valueOf=function(){</span><span class="WHIT">
<span class='line'>167</span> </span><span class="COMM">//    return nas.parseNumber(nas.normalizeStr(this.name).replace(/^[^0-9]*/,""))</span><span class="WHIT">
<span class='line'>168</span> </span><span class="COMM">//valueOfの設定自体にあまり意味が無いのでやめたほうがヨサゲ　</span><span class="WHIT">
<span class='line'>169</span> </span><span class="COMM">//}</span><span class="WHIT">
<span class='line'>170</span> </span><span class="COMM">/**　与えられたオブジェクトとプロパティ同士を比較して　変更状態を返す
<span class='line'>171</span>     引数
<span class='line'>172</span> 対照する基準値（オブジェクト）
<span class='line'>173</span>     戻り値
<span class='line'>174</span> 変更状態コード
<span class='line'>175</span> 0   変化なし    最小標準出力に対応
<span class='line'>176</span> 1   標準変更    拡張標準出力に対応
<span class='line'>177</span> 2   重度変更    フルダンプに対応
<span class='line'>178</span> */</span><span class="WHIT">
<span class='line'>179</span> </span><span class="NAME">nas.AnimationReplacement.prototype.compareWith</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">targetValue</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>180</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">igunoreProps</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="PUNC">[</span><span class="STRN">'contentText'</span><span class="PUNC">,</span><span class="STRN">'source'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>181</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">basicProp</span><span class="WHIT">       </span><span class="PUNC">=</span><span class="PUNC">[</span><span class="STRN">'size'</span><span class="PUNC">,</span><span class="STRN">'offset'</span><span class="PUNC">,</span><span class="STRN">'comment'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>182</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">extendProps</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="PUNC">[</span><span class="STRN">'pegOffset'</span><span class="PUNC">,</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>183</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>184</span> </span><span class="COMM">/** タイミングパラメータに従って指定されたフレームのキー間の補完値を返す
<span class='line'>185</span> 
<span class='line'>186</span>   　置きかえタイムラインの中間値は前方値で代表されるので基本的に戻り値は自分自身
<span class='line'>187</span>     オプションの状態によって（時間的）中間タイミングで後方値に切り替える
<span class='line'>188</span>     return endValue;
<span class='line'>189</span>     又はブランク状態のオブジェクトを返す
<span class='line'>190</span>   　return new nas.newAnimationReplacement("blank");
<span class='line'>191</span> */</span><span class="WHIT">
<span class='line'>192</span> </span><span class="NAME">nas.AnimationReplacement.prototype.interpolate</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">endValue</span><span class="PUNC">,</span><span class="NAME">indexCount</span><span class="PUNC">,</span><span class="NAME">indexOffset</span><span class="PUNC">,</span><span class="NAME">frameCount</span><span class="PUNC">,</span><span class="NAME">frameOffset</span><span class="PUNC">,</span><span class="NAME">props</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>193</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>194</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>195</span> 
<span class='line'>196</span> </span><span class="COMM">/** Contentをパースして　プロパティを設定する内部メソッド
<span class='line'>197</span> 引数でcontentを与えてオブジェクト全体の値を更新することも可能
<span class='line'>198</span> 引数がAnimationRepalcementであった場合は、全プロパティを継承して引き写す
<span class='line'>199</span> ただし引数と同じジョブ内のコレクションに追加を行う場合は、失敗するので要注意
<span class='line'>200</span> 
<span class='line'>201</span> xMap形式のデータをパースする　nas.AnimationXXX シリーズオブジェクトの共通メソッド
<span class='line'>202</span> xMapパーサから呼び出す際に共通でコールされる
<span class='line'>203</span> 引数が与えられない場合は、現在の保持コンテンツを再パースする
<span class='line'>204</span> */</span><span class="WHIT">
<span class='line'>205</span> </span><span class="NAME">nas.AnimationReplacement.prototype.parseContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>206</span> </span><span class="COMM">//    var blankRegex  = new RegExp("^[ｘＸxX×〆0０]$");//カラ判定　システム変数として分離予定</span><span class="WHIT">
<span class='line'>207</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">interpRegex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"^[\-\+=○●・a-zア-ン]$|^\[[^\]]+\]$"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//中間値補間（動画記号）サイン　同上</span><span class="WHIT">
<span class='line'>208</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">valueRegex</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"^[\(&lt;]?([A-Z][\-_\.]?)?[0-9].+[>\)]?$"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//無条件有効値 同上</span><span class="WHIT">
<span class='line'>209</span> </span><span class="COMM">//    var valueRegex  = new RegExp("^[\(&lt;]?[0-9]+[>\)]?$");//無条件有効値 同上</span><span class="WHIT">
<span class='line'>210</span> 
<span class='line'>211</span> </span><span class="COMM">//引数がなければ現在のコンテンツを再パース</span><span class="WHIT">
<span class='line'>212</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>213</span> </span><span class="WHIT">        </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.contentText</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>214</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>215</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>216</span> </span><span class="WHIT">        </span><span class="NAME">this.contentText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>217</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>218</span> </span><span class="COMM">/*
<span class='line'>219</span>     AnimatiopnReplacementの特殊値として
<span class='line'>220</span>     contentText='blank-cell'を設ける
<span class='line'>221</span>     AnimationElementSource("")
<span class='line'>222</span>     サイズは不問　 シンボルとしての「カラセル」
<span class='line'>223</span> 
<span class='line'>224</span> */</span><span class="WHIT">
<span class='line'>225</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'blank-cell'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>226</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isGroup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myContent.indexOf</span><span class="PUNC">(</span><span class="STRN">'['</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>227</span> </span><span class="COMM">//第一形式グループ ^[\&lt;group>\t&lt;typeName>[\t&lt;option-text>[\t&lt;comment>]]\]$</span><span class="WHIT">
<span class='line'>228</span> </span><span class="COMM">//第二形式エントリ ^&lt;group>\t&lt;name>[\t&lt;option-text>[\t&lt;comment>]]$</span><span class="WHIT">
<span class='line'>229</span> 
<span class='line'>230</span> </span><span class="WHIT">    </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">'\n'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>231</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myContent.length</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">line</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>232</span> 
<span class='line'>233</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">isGroup</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="STRN">'['</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">slice</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//ブラケット削除</span><span class="WHIT">
<span class='line'>234</span> 
<span class='line'>235</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^\t(\S+)\s*=\s*(.+)\s*$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>236</span> </span><span class="WHIT">            </span><span class="COMM">//第二形式(タブ開始)でプロパティ別のデータ更新を行う</span><span class="WHIT">
<span class='line'>237</span> </span><span class="WHIT">            </span><span class="NAME">this.extended</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>238</span> 
<span class='line'>239</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myProp</span><span class="PUNC">=</span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">valueArray</span><span class="PUNC">=</span><span class="NAME">csvSimple.parse</span><span class="PUNC">(</span><span class="NAME">RegExp.$2</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>240</span> 
<span class='line'>241</span> </span><span class="WHIT">            </span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">myProp</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>242</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"file"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>243</span> </span><span class="WHIT">                </span><span class="NAME">this.file</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationElementSource</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>244</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>245</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"resolution"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>246</span> </span><span class="WHIT">                </span><span class="NAME">this.resolution</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Resolution</span><span class="PUNC">(</span><span class="NAME">valueArray.join</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>247</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>248</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"resolution.X"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>249</span> </span><span class="WHIT">                </span><span class="NAME">this.resolution.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitResolution</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">this.resolution.type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>250</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>251</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"resolution.Y"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>252</span> </span><span class="WHIT">                </span><span class="NAME">this.resolution.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitResolution</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">this.resolution.type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>253</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>254</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"size"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>255</span> </span><span class="WHIT">                </span><span class="NAME">this.size</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">valueArray.length</span><span class="PUNC">&lt;</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT">
<span class='line'>256</span> </span><span class="WHIT">                    </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Size</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Size</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>257</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>258</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"size.X"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>259</span> </span><span class="WHIT">                </span><span class="NAME">this.size.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>260</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>261</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"size.Y"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>262</span> </span><span class="WHIT">                </span><span class="NAME">this.size.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>263</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>264</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"offset"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>265</span> </span><span class="WHIT">                </span><span class="NAME">this.offset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">valueArray.length</span><span class="PUNC">&lt;</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT">
<span class='line'>266</span> </span><span class="WHIT">                    </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Offset</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Offset</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>267</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>268</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"offset.X"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>269</span> </span><span class="WHIT">                </span><span class="NAME">this.offset.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>270</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>271</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"offset.Y"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>272</span> </span><span class="WHIT">                </span><span class="NAME">this.offset.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>273</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>274</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"offset.R"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>275</span> </span><span class="WHIT">                </span><span class="NAME">this.offset.r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>276</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>277</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"pegOffset"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>278</span> </span><span class="WHIT">                </span><span class="NAME">this.offset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">valueArray.length</span><span class="PUNC">&lt;</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT">
<span class='line'>279</span> </span><span class="WHIT">                    </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Offset</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Offset</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>280</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>281</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"pegOffset.X"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>282</span> </span><span class="WHIT">                </span><span class="NAME">this.offset.x</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>283</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>284</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"pegOffset.Y"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>285</span> </span><span class="WHIT">                </span><span class="NAME">this.offset.y</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>286</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>287</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"pegOffset.R"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>288</span> </span><span class="WHIT">                </span><span class="NAME">this.offset.r</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>289</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>290</span> </span><span class="WHIT">          </span><span class="TOKN">　</span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>291</span> </span><span class="WHIT">                </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">myProp</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>292</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>293</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^(\S+)\t?(\S+)\t?([^\t]+)?\t?(.*)$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>294</span> </span><span class="WHIT">        </span><span class="COMM">//　第一形式の再パース</span><span class="WHIT">
<span class='line'>295</span> </span><span class="COMM">//console.log(myContent[line]);</span><span class="WHIT">
<span class='line'>296</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myGroup</span><span class="PUNC">=</span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//グループの再パースは行われない</span><span class="WHIT">
<span class='line'>297</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="NAME">RegExp.$2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>298</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myComment</span><span class="PUNC">=</span><span class="NAME">RegExp.$4</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>299</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">valueArray</span><span class="PUNC">=</span><span class="NAME">nas.parseDataChank</span><span class="PUNC">(</span><span class="NAME">RegExp.$3</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>300</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">numeProps</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">[</span><span class="STRN">"size"</span><span class="PUNC">,</span><span class="STRN">"x"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="STRN">"size"</span><span class="PUNC">,</span><span class="STRN">"y"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="STRN">"offset"</span><span class="PUNC">,</span><span class="STRN">"x"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="STRN">"offset"</span><span class="PUNC">,</span><span class="STRN">"y"</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>301</span> 
<span class='line'>302</span> </span><span class="COMM">//console.log(myComment);</span><span class="WHIT">
<span class='line'>303</span> </span><span class="COMM">//console.log(myName);</span><span class="WHIT">
<span class='line'>304</span> </span><span class="COMM">//console.log(valueArray);</span><span class="WHIT">
<span class='line'>305</span> </span><span class="COMM">//console.log(this);</span><span class="WHIT">
<span class='line'>306</span> </span><span class="COMM">/*
<span class='line'>307</span>     フィールド文字列であった場合の判定が必要　2018 10 09
<span class='line'>308</span> 
<span class='line'>309</span> case :this.parent == null
<span class='line'>310</span> */</span><span class="WHIT">
<span class='line'>311</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.parent</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">myGroup</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this.parent.name</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>312</span> </span><span class="COMM">//                if(! isGroup) this.name = myName.replace(new RegExp('^'+myGroup+'\-'),"");</span><span class="WHIT">
<span class='line'>313</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">isGroup</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>314</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">numCount</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>315</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vix</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">vix</span><span class="PUNC">&lt;</span><span class="NAME">valueArray.length</span><span class="PUNC">;</span><span class="NAME">vix</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>316</span> </span><span class="WHIT">                    </span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NAME">vix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>317</span> </span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"numeric"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>318</span> </span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"unitValue"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>319</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">numCount</span><span class="PUNC">&lt;</span><span class="NAME">numeProps.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>320</span> </span><span class="WHIT">                            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">numeProps</span><span class="PUNC">[</span><span class="NAME">numCount</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>321</span> </span><span class="WHIT">                                </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">numeProps</span><span class="PUNC">[</span><span class="NAME">numCount</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">numeProps</span><span class="PUNC">[</span><span class="NAME">numCount</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="STRN">'size'</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Size</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Offset</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>322</span> </span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>323</span> </span><span class="WHIT">                            </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">numeProps</span><span class="PUNC">[</span><span class="NAME">numCount</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">numeProps</span><span class="PUNC">[</span><span class="NAME">numCount</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NAME">vix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>324</span> </span><span class="WHIT">                            </span><span class="NAME">numCount</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>325</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>326</span> </span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>327</span> </span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"unitAngle"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>328</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">this.offset</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.offset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Offset</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>329</span> </span><span class="WHIT">                        </span><span class="NAME">this.offset.r</span><span class="PUNC">==</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NAME">vix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>330</span> </span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>331</span> </span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"unitResolution"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>332</span> </span><span class="WHIT">                        </span><span class="NAME">this.resolution</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Resolution</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NAME">vix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>333</span> </span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>334</span> </span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"source"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>335</span> </span><span class="WHIT">                        </span><span class="NAME">this.source</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationElementSource</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NAME">vix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>336</span> </span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>337</span> </span><span class="WHIT">                    </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>338</span> </span><span class="WHIT">                        </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>339</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>340</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>341</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myComment</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.comment</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myComment</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>342</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>343</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>344</span> 
<span class='line'>345</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>346</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>347</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>348</span> </span><span class="COMM">/** 指定フレーム数に内容を展開して配列で返す
<span class='line'>349</span> 引数 :cellCount
<span class='line'>350</span> 戻値 :配列　+ offset
<span class='line'>351</span> */</span><span class="WHIT">
<span class='line'>352</span> </span><span class="NAME">nas.AnimationReplacement.prototype.getStream</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>353</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>354</span> </span><span class="WHIT">    </span><span class="NAME">myResult</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.name</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this.name</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>355</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myResult</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/blank(-cell)?/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="STRN">"×"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>356</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>357</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>358</span> </span><span class="COMM">/**
<span class='line'>359</span>     置きかえタイムライントラックをパースしてセクションコレクションを返す
<span class='line'>360</span>     セクションの値を各トラックごとの値オブジェクトからxMapを介したxMapエレメントに変更する
<span class='line'>361</span> 
<span class='line'>362</span>     パース時にセクションの値判定を行う
<span class='line'>363</span>     ・無効記述
<span class='line'>364</span>     ・有効記述　値あり（xMap既存エレメント）・なし（新規エレメント）
<span class='line'>365</span>     
<span class='line'>366</span>  タイムライントラックをパースする際に統一手順としてトラックに対応するxMapエレメントグループの有無を確認する。
<span class='line'>367</span> 現行Jobにトラックと同名のエレメントグループが、存在しなかった場合（Stageには存在する可能性あり）は、新規にグループを作成してエントリすること。
<span class='line'>368</span> この処理は、トラックパースの前段階で共通で行うことにする
<span class='line'>369</span> 
<span class='line'>370</span> 確認手段は xMap.getElementByName(グループ名)を使用
<span class='line'>371</span> //XpsTimelineTrack.parseTimelineTrack()　メソッドに置く
<span class='line'>372</span> 
<span class='line'>373</span> 
<span class='line'>374</span> 中間値補間区間の空セルに対応するために全体のブランク処理をサブセクションコレクションに置く
<span class='line'>375</span> 置きかえタイムラインのみの処置
<span class='line'>376</span> カラ状態のみを扱うsctionCollectionを併置してセットで扱うので注意
<span class='line'>377</span> 各セクションのvalueは　on/off(true/false)のみでオブジェクトは使用されない　エレメントへのリンクも無い
<span class='line'>378</span> 一つのトラックをパースして二つのセクションコレクションを得る
<span class='line'>379</span> 値側のコレクションは、従来のカラを含むことができるが、このパーサが書き出すデータ上は従来型のカラが含まれることは無い
<span class='line'>380</span> カラ区間の値は先行区間の値となる
<span class='line'>381</span> カラセル区間コレクションは2つの状態しか持ち得ないので、サブセクションは発生しない
<span class='line'>382</span> 
<span class='line'>383</span> 　*/</span><span class="WHIT">
<span class='line'>384</span> </span><span class="NAME">_parseReplacementTrack</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>385</span> </span><span class="COMM">//    var blankRegex  = new RegExp("^[ｘＸxX×〆0０]$");//カラ判定　システム変数として分離予定</span><span class="WHIT">
<span class='line'>386</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">interpRegex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"^[\-\+=○◯●・a-zア-ン]$|^\[[^\]]+\]$"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//中間値補間（動画記号）サイン　同上</span><span class="WHIT">
<span class='line'>387</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">valueRegex</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"^[\(&lt;][^>\)]+[>\)]$|^[\(&lt;]?([A-Z][\-_\.]?)?[0-9]\S+[>\)]?$|^[0-9]+.?$"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//無条件有効値 同上</span><span class="WHIT">
<span class='line'>388</span> </span><span class="COMM">//    var valueRegex  = new RegExp("^[\(&lt;]?([A-Z][\-_\.]?)?[0-9]\S+[>\)]?$|^[0-9]+.?$");//無条件有効値 同上</span><span class="WHIT">
<span class='line'>389</span> </span><span class="WHIT">    </span><span class="COMM">//自分自身(トラック)を親として新規セクションコレクションを作成</span><span class="WHIT">
<span class='line'>390</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myCollectionBlank</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XpsTimelineSectionCollection</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//ブランクベースコレクション</span><span class="WHIT">
<span class='line'>391</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myCollection</span><span class="WHIT">      </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XpsTimelineSectionCollection</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//ベースコレクション</span><span class="WHIT">
<span class='line'>392</span> 
<span class='line'>393</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">appearance</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationAppearance</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">'on'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>394</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">disAppearance</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationAppearance</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">'off'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>395</span> 
<span class='line'>396</span> </span><span class="WHIT">    </span><span class="COMM">//継続時間０で値未定初期セクションを作成</span><span class="WHIT">
<span class='line'>397</span> </span><span class="WHIT">    </span><span class="COMM">//値を持たないセクションをブランク値のオブジェクトとするか？</span><span class="WHIT">
<span class='line'>398</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentSection</span><span class="PUNC">=</span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>399</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>400</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentSubSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>401</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentValue</span><span class="WHIT">      </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDefaultValue</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>402</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">currentValue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">currentValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationReplacement</span><span class="PUNC">(</span><span class="STRN">'system'</span><span class="PUNC">,</span><span class="STRN">'blank-cell'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>403</span> </span><span class="COMM">//console.log(currentValue)</span><span class="WHIT">
<span class='line'>404</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isInterp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>405</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isBlank</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">currentValue</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">currentValue.contentText</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"blank-cell"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="COMM">//デフォルトのブランク状態を取得</span><span class="WHIT">
<span class='line'>406</span> 
<span class='line'>407</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentSectionBlank</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">isBlank</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">myCollectionBlank.addSection</span><span class="PUNC">(</span><span class="NAME">disAppearance</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">myCollectionBlank.addSection</span><span class="PUNC">(</span><span class="NAME">appearance</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>408</span> 
<span class='line'>409</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">valueDetect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>410</span> </span><span class="COMM">/**
<span class='line'>411</span>     タイムライントラックのデフォルト値は、以下の手続きで取得
<span class='line'>412</span>     タイムラインラベルが指定するグループがあらかじめ存在する場合は、そのグループオブジェクトが保持する値
<span class='line'>413</span>     存在しない場合は、新規にグループを作成する。その際にトラックの種別ごとのValueオブジェクトを初期値として登録するのでその値を使用
<span class='line'>414</span>     XpsTimelineTrack.getDefeultValue()側で調整
<span class='line'>415</span>     Replacementの場合基本はブランクだが、必ずしもブランクとは限らないので要注意
<span class='line'>416</span>     トラック上で明示的なブランクが指定された場合は、値にfalse/null/"blank"を与える。
<span class='line'>417</span> */</span><span class="WHIT">
<span class='line'>418</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fix</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">fix</span><span class="PUNC">&lt;</span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="NAME">fix</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>419</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentCell</span><span class="PUNC">=</span><span class="NAME">Xps.sliceReplacementLabel</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//記述をラベルとエントリに分解</span><span class="WHIT">
<span class='line'>420</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">currentCell.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">currentCell.push</span><span class="PUNC">(</span><span class="NAME">this.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="COMM">//エントリにグループ名が含まれないようならばトラックのラベルで補う</span><span class="WHIT">
<span class='line'>421</span> </span><span class="WHIT">        </span><span class="COMM">// ここでデータの形式は [name,groupName] となる</span><span class="WHIT">
<span class='line'>422</span> </span><span class="WHIT">        </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>423</span> </span><span class="WHIT">        </span><span class="NAME">currentSectionBlank.duration</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">     </span><span class="COMM">//セクション長加算</span><span class="WHIT">
<span class='line'>424</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentSubSection</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">currentSubSection.duration</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>425</span> </span><span class="WHIT">        </span><span class="COMM">//未記入データ　これが一番多いので最初に処理しておく(処理高速化のため)</span><span class="WHIT">
<span class='line'>426</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentCell</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^([\|｜;]|\s+)$/</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">currentCell.length</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>427</span> </span><span class="WHIT">        </span><span class="COMM">/*      ブランク判定
<span class='line'>428</span>             値処理に先立ってブランク関連の処理をすべて終了する
<span class='line'>429</span>             ブランク状態切り替え判定 カレントを切り替えて新規セクションを積む
<span class='line'>430</span>         */</span><span class="WHIT">
<span class='line'>431</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">valueDetect</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="COMM">//値検出状態初期化</span><span class="WHIT">
<span class='line'>432</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">blankDetect</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">currentCell</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="NAME">nas.CellDescription.blankRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT">  </span><span class="KEYW">true</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="COMM">//値からブランク状態を検出</span><span class="WHIT">
<span class='line'>433</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">interpDetect</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">currentCell</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="NAME">nas.CellDescription.interpRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="COMM">//括弧つきの補間サインも同時検出へ</span><span class="WHIT">
<span class='line'>434</span> </span><span class="COMM">//console.log(fix+":"+this[fix]+" interp:"+interpDetect + "  blank: " + blankDetect);</span><span class="WHIT">
<span class='line'>435</span> </span><span class="WHIT">        </span><span class="COMM">//ブランク処理判定</span><span class="WHIT">
<span class='line'>436</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">blankDetect</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>437</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">isBlank</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>438</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">fix</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>439</span> </span><span class="WHIT">                        </span><span class="NAME">currentSectionBlank.value</span><span class="PUNC">=</span><span class="NAME">disAppearance</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>440</span> </span><span class="WHIT">                        </span><span class="NAME">currentSection.value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationReplacement</span><span class="PUNC">(</span><span class="STRN">'system'</span><span class="PUNC">,</span><span class="STRN">'blank-cell'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">// *Blank-set</span><span class="WHIT">
<span class='line'>441</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>442</span> </span><span class="WHIT">                        </span><span class="NAME">currentSectionBlank.duration</span><span class="WHIT"> </span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>443</span> </span><span class="WHIT">                        </span><span class="NAME">currentSectionBlank</span><span class="PUNC">=</span><span class="NAME">myCollectionBlank.addSection</span><span class="PUNC">(</span><span class="NAME">disAppearance</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>444</span> </span><span class="WHIT">                        </span><span class="NAME">currentSectionBlank.duration</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>445</span> </span><span class="WHIT">                        </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">--</span><span class="PUNC">;</span><span class="COMM">// *</span><span class="WHIT">
<span class='line'>446</span> </span><span class="WHIT">                        </span><span class="NAME">currentSection</span><span class="PUNC">=</span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="NAME">this.pushEntry</span><span class="PUNC">(</span><span class="STRN">'blank-cell'</span><span class="PUNC">,</span><span class="STRN">'system'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">// *</span><span class="WHIT">
<span class='line'>447</span> </span><span class="WHIT">                        </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="PUNC">;</span><span class="COMM">// *</span><span class="WHIT">
<span class='line'>448</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentSubSection</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>449</span> </span><span class="WHIT">                            </span><span class="NAME">currentSubSection.duration</span><span class="WHIT"> </span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>450</span> </span><span class="WHIT">                            </span><span class="NAME">currentSubSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>451</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>452</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>453</span> </span><span class="WHIT">                    </span><span class="NAME">isBlank</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>454</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>455</span> </span><span class="WHIT">                </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>456</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>457</span> </span><span class="COMM">//         else if(fix==0){    currentSectionBlank.value=appearance; }</span><span class="WHIT">
<span class='line'>458</span> </span><span class="WHIT">        </span><span class="COMM">//中間値補間サインを検出したら中間値処理モード</span><span class="WHIT">
<span class='line'>459</span> </span><span class="WHIT">        </span><span class="COMM">//既定値以外の補間サイン検出が必要>> 規定値のみを補完サインと定義する　他の記述はコメントとして利用</span><span class="WHIT">
<span class='line'>460</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">interpDetect</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>461</span> </span><span class="WHIT">              </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">isBlank</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>462</span> </span><span class="WHIT">                 </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">fix</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>463</span> </span><span class="WHIT">                    </span><span class="NAME">currentSectionBlank.value</span><span class="PUNC">=</span><span class="NAME">appearance</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>464</span> </span><span class="WHIT">                 </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>465</span> </span><span class="WHIT">                    </span><span class="NAME">currentSectionBlank.duration</span><span class="WHIT"> </span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>466</span> </span><span class="WHIT">                    </span><span class="NAME">currentSectionBlank</span><span class="PUNC">=</span><span class="NAME">myCollectionBlank.addSection</span><span class="PUNC">(</span><span class="NAME">appearance</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>467</span> </span><span class="WHIT">                    </span><span class="NAME">currentSectionBlank.duration</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>468</span> </span><span class="WHIT">                 </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>469</span> </span><span class="WHIT">                 </span><span class="NAME">isBlank</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>470</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>471</span> </span><span class="WHIT">              </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">isInterp</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>472</span> </span><span class="WHIT">                </span><span class="COMM">//中間値補間区間開始　カレントセクションを切り替え サブセクションを登録</span><span class="WHIT">
<span class='line'>473</span> </span><span class="WHIT">                </span><span class="NAME">isInterp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>474</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">fix</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>475</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.value</span><span class="PUNC">=</span><span class="STRN">"interpolation"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>476</span> </span><span class="WHIT">                        </span><span class="NAME">currentSection.subSections</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XpsTimelineSectionCollection</span><span class="PUNC">(</span><span class="NAME">currentSection</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>477</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>478</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>479</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection</span><span class="PUNC">=</span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="STRN">"interpolation"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>480</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>481</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>482</span> </span><span class="WHIT">                </span><span class="NAME">currentSubSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentSection.subSections.addSection</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationReplacement</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">currentCell.join</span><span class="PUNC">(</span><span class="STRN">"-"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>483</span> </span><span class="WHIT">                </span><span class="NAME">currentSubSection.duration</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>484</span> </span><span class="WHIT">                </span><span class="COMM">//新規中間値補間セクションを立てる 以降は、モードを抜けるまでカレント固定</span><span class="WHIT">
<span class='line'>485</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>486</span> </span><span class="WHIT">                </span><span class="NAME">currentSubSection.duration</span><span class="WHIT"> </span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>487</span> </span><span class="WHIT">                </span><span class="NAME">currentSubSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentSection.subSections.addSection</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationReplacement</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">currentCell.join</span><span class="PUNC">(</span><span class="STRN">"-"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>488</span> </span><span class="WHIT">                </span><span class="NAME">currentSubSection.duration</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>489</span> </span><span class="WHIT">                </span><span class="COMM">//中間値補間モード内ではサブセクションを登録</span><span class="WHIT">
<span class='line'>490</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>491</span> </span><span class="WHIT">              </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>492</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>493</span> </span><span class="WHIT">        </span><span class="COMM">//区間値を処理</span><span class="WHIT">
<span class='line'>494</span> </span><span class="COMM">/**
<span class='line'>495</span>     既存エントリがない場合、エントリ文字列が条件を満たせば新規エントリとしてxMapにグループとエントリを登録して使用する
<span class='line'>496</span>     それ以外は、無効エントリとなる
<span class='line'>497</span> */</span><span class="WHIT">
<span class='line'>498</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.xParent.parentXps.xMap.getElementByName</span><span class="PUNC">(</span><span class="NAME">currentCell.join</span><span class="PUNC">(</span><span class="STRN">"-"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>499</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentElement</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>500</span> </span><span class="COMM">//console.log("value detcted in xMap:");</span><span class="WHIT">
<span class='line'>501</span> </span><span class="WHIT">            </span><span class="NAME">valueDetect</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>502</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>503</span> </span><span class="COMM">//console.log("value not detcted in xMap: push Entry "+currentCell.reverse().join("-"));</span><span class="WHIT">
<span class='line'>504</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">currentCell</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="NAME">valueRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>505</span> </span><span class="WHIT">                </span><span class="NAME">valueDetect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>506</span> </span><span class="WHIT">                </span><span class="NAME">currentElement</span><span class="PUNC">=</span><span class="NAME">this.pushEntry</span><span class="PUNC">(</span><span class="NAME">currentCell</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">currentCell</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>507</span> </span><span class="WHIT">                </span><span class="NAME">currentElement</span><span class="PUNC">=</span><span class="NAME">this.pushEntry</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">currentCell</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>508</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>509</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>510</span> </span><span class="COMM">//console.log(valueDetect);</span><span class="WHIT">
<span class='line'>511</span> </span><span class="COMM">//console.log(currentElement);</span><span class="WHIT">
<span class='line'>512</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">valueDetect</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>513</span> </span><span class="WHIT">                </span><span class="NAME">currentValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentElement.content</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>514</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isBlank</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>515</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">fix</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>516</span> </span><span class="WHIT">                    </span><span class="NAME">currentSectionBlank.value</span><span class="PUNC">=</span><span class="NAME">appearance</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>517</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>518</span> </span><span class="WHIT">                    </span><span class="NAME">currentSectionBlank.duration</span><span class="WHIT"> </span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>519</span> </span><span class="WHIT">                    </span><span class="NAME">currentSectionBlank</span><span class="PUNC">=</span><span class="NAME">myCollectionBlank.addSection</span><span class="PUNC">(</span><span class="NAME">appearance</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>520</span> </span><span class="WHIT">                    </span><span class="NAME">currentSectionBlank.duration</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>521</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>522</span> </span><span class="WHIT">                </span><span class="NAME">isBlank</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>523</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>524</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isInterp</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>525</span> </span><span class="WHIT">                </span><span class="NAME">isInterp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>526</span> </span><span class="WHIT">                </span><span class="NAME">currentSubSection.duration</span><span class="WHIT"> </span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>527</span> </span><span class="WHIT">                </span><span class="NAME">currentSubSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>528</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>529</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">fix</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>530</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>531</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>532</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>533</span> </span><span class="WHIT">                </span><span class="NAME">currentSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="NAME">currentValue</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>534</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>535</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>536</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>537</span> </span><span class="WHIT">        </span><span class="KEYW">continue</span><span class="WHIT">
<span class='line'>538</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>539</span> </span><span class="COMM">//console.log(myCollection)</span><span class="WHIT">
<span class='line'>540</span> </span><span class="WHIT">    </span><span class="NAME">this.sections</span><span class="WHIT">       </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCollection</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>541</span> </span><span class="WHIT">    </span><span class="NAME">this.sectionsBlank</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCollectionBlank</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>542</span> </span><span class="COMM">//console.log("sections-length:"+myCollection.length +":blank:"+myCollectionBlank.length);</span><span class="WHIT">
<span class='line'>543</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.sections</span><span class="PUNC">;</span><span class="COMM">//ブランク情報の返し方を考えたほうが良いかも</span><span class="WHIT">
<span class='line'>544</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>545</span> 
<span class='line'>546</span> </span><span class="COMM">/*test
<span class='line'>547</span> 
<span class='line'>548</span> XpsTimelineTrack.prototype.parseReplacementTrack=_parseReplacementTrack;
<span class='line'>549</span> XPS.xpsTracks[2].parseReplacementTrack();
<span class='line'>550</span> XPS.xpsTracks[2].sections[1].toString();
<span class='line'>551</span> 
<span class='line'>552</span> XpsTimelineTrack.prototype.parseReplacementTrack=_parseReplacementTrack;
<span class='line'>553</span> 
<span class='line'>554</span> XpsTimelineTrack.prototype.parseCameraWorkTrack=_parseCameraworkTrack;
<span class='line'>555</span> 
<span class='line'>556</span> XpsTimelineTrack.prototype.parseCompositeTrack=_parseCompositeTrack;//コンポジット
<span class='line'>557</span> 
<span class='line'>558</span> //XpsTimelineTrack.prototype.parseTrack=_parseTrack;
<span class='line'>559</span> //XpsTimelineTrack.prototype.parseTrack=_parseTrack;
<span class='line'>560</span> */</span><span class="WHIT">
<span class='line'>561</span> </span><span class="COMM">/**
<span class='line'>562</span> ノートテキスト・タイムシート記述（カメラワーク・エフェクト）オブジェクト
<span class='line'>563</span> 具体的なステージワークやコンポジットワークを抽象化した　シンボリックオブジェクト
<span class='line'>564</span> トラック内には複数のオブジェクトを表記可能
<span class='line'>565</span> 
<span class='line'>566</span> 値区間のみ
<span class='line'>567</span> または値区間にぶら下がった補完区間を一組として扱う
<span class='line'>568</span> トラック名は、基本的に論理的な分類の役割のみをあつかう
<span class='line'>569</span> 
<span class='line'>570</span> 各効果は必要に従ってジオメトリトラック　コンポジットトラックとして分解統合が期待される
<span class='line'>571</span> このトラックのリンクとペアレントは、必ずしも整合性を持たない。
<span class='line'>572</span> 
<span class='line'>573</span> "[A],▽,|,|,|,|,|,PAN,|,|,|,|,|,△,[B]"
<span class='line'>574</span> "[1],▽,|,|,|,|,|,SL→,|,|,|,|,|,△,[2]"
<span class='line'>575</span> "]OL[,|,|,|,|,s-c12,＊,s-c13,|,|,|,|,]OL["
<span class='line'>576</span> "]WIPE[,|,|,|,|,s-c12,＊,s-c13,|,|,|,|,]WIPE["
<span class='line'>577</span> "▲,|,|,FI,|,|,▲"
<span class='line'>578</span> "■","■","■","&lt;黒コマ>","■","■","■"
<span class='line'>579</span> 等のソースストリームをパースする
<span class='line'>580</span> 
<span class='line'>581</span> ＞ブランクセクション   値なしで長さのみがある　Section.value.type = geometryセクションの前後には必ずつく
<span class='line'>582</span> 
<span class='line'>583</span> 区間を開始するエントリー
<span class='line'>584</span>     [ブラケット]値エントリ
<span class='line'>585</span> 後続フレームから値つきgeometry区間を開始
<span class='line'>586</span> 
<span class='line'>587</span>     ]逆ブラケット[エントリ
<span class='line'>588</span> トランジション区間を開始・終了
<span class='line'>589</span> 開始時に終了サインを設定
<span class='line'>590</span> 
<span class='line'>591</span>     空白エントリ
<span class='line'>592</span> 空白区間を開始
<span class='line'>593</span> 何らかの有効エントリーで終了
<span class='line'>594</span> 
<span class='line'>595</span> 
<span class='line'>596</span> 
<span class='line'>597</span> 
<span class='line'>598</span> */</span><span class="WHIT">
<span class='line'>599</span> 
<span class='line'>600</span> </span><span class="NAME">_parseCameraworkTrack</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>601</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myCollection</span><span class="WHIT">       </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XpsTimelineSectionCollection</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//自分自身を親としてセクションコレクションを新作</span><span class="WHIT">
<span class='line'>602</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentSection</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//開始セクションを作成　継続時間０　値は保留</span><span class="WHIT">
<span class='line'>603</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentValue</span><span class="WHIT">       </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationCamerawork</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//コンテンツはカラで初期化も保留</span><span class="WHIT">
<span class='line'>604</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentSymbol</span><span class="WHIT">      </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>605</span> 
<span class='line'>606</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">startNodeRegex</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"^[▼▽⇑●◯◎◆◇★☆┳┬]$"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>607</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endNodes</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>608</span> </span><span class="WHIT">        </span><span class="STRN">"▼"</span><span class="PUNC">:</span><span class="STRN">"▲"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>609</span> </span><span class="WHIT">        </span><span class="STRN">"▽"</span><span class="PUNC">:</span><span class="STRN">"△"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>610</span> </span><span class="WHIT">        </span><span class="STRN">"⇑"</span><span class="PUNC">:</span><span class="STRN">"⇓"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>611</span> </span><span class="WHIT">        </span><span class="STRN">"●"</span><span class="PUNC">:</span><span class="STRN">"●"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>612</span> </span><span class="WHIT">        </span><span class="STRN">"○"</span><span class="PUNC">:</span><span class="STRN">"◯"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>613</span> </span><span class="WHIT">        </span><span class="STRN">"◎"</span><span class="PUNC">:</span><span class="STRN">"◎"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>614</span> </span><span class="WHIT">        </span><span class="STRN">"◆"</span><span class="PUNC">:</span><span class="STRN">"◆"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>615</span> </span><span class="WHIT">        </span><span class="STRN">"◇"</span><span class="PUNC">:</span><span class="STRN">"◇"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>616</span> </span><span class="WHIT">        </span><span class="STRN">"☆"</span><span class="PUNC">:</span><span class="STRN">"☆"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>617</span> </span><span class="WHIT">        </span><span class="STRN">"★"</span><span class="PUNC">:</span><span class="STRN">"★"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>618</span> </span><span class="WHIT">        </span><span class="STRN">"┳"</span><span class="PUNC">:</span><span class="STRN">"┻"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>619</span> </span><span class="WHIT">        </span><span class="STRN">"┬"</span><span class="PUNC">:</span><span class="STRN">"┴"</span><span class="WHIT">
<span class='line'>620</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="COMM">// */</span><span class="WHIT">
<span class='line'>621</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">startNodeId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>622</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endNode</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>623</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lastBracketsId</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>624</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>625</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fix</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">fix</span><span class="PUNC">&lt;</span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="NAME">fix</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>626</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isBlank</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^\s*$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>627</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^\[[^\[]+\]$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">lastBracketsId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fix</span><span class="PUNC">;</span><span class="NAME">isBlank</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>628</span> </span><span class="WHIT">        </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="PUNC">;</span><span class="COMM">//currentセクションの継続長を加算</span><span class="WHIT">
<span class='line'>629</span> 
<span class='line'>630</span> </span><span class="WHIT">         </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">lastBracketsId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">fix</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">currentSection.value</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">currentSection.tailMargin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>631</span> 
<span class='line'>632</span> </span><span class="COMM">//未記入セル カレントが空白セクションならば継続それ以外の場合は、セクション更新して継続</span><span class="WHIT">
<span class='line'>633</span> </span><span class="COMM">//[値]セルは未記入セル扱いにする</span><span class="WHIT">
<span class='line'>634</span> 
<span class='line'>635</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isBlank</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>636</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">currentSection.value</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>637</span> </span><span class="COMM">//console.log(currentSection.value)</span><span class="WHIT">
<span class='line'>638</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>639</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fix</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">lastBracketsId</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>640</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.value.postfix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>641</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.tailMargin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>642</span> </span><span class="COMM">//console.log(currentSection.value.type.join(':'));</span><span class="WHIT">
<span class='line'>643</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>644</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.value.attributes.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">currentSection.value.prefix</span><span class="PUNC">,</span><span class="NAME">currentSection.value.postfix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">'-'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>645</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentSection.value.prefix</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="NAME">currentSection.headMargin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>646</span> </span><span class="COMM">//                currentSection.value.parseContent();</span><span class="WHIT">
<span class='line'>647</span> </span><span class="WHIT">                </span><span class="NAME">currentSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//changeCurrentNull</span><span class="WHIT">
<span class='line'>648</span> </span><span class="WHIT">                 </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fix</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">lastBracketsId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">currentSection.headMargin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>649</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>650</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">endNode</span><span class="PUNC">)</span><span class="WHIT">         </span><span class="NAME">endNode</span><span class="WHIT">       </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="COMM">//終了ノードクリア</span><span class="WHIT">
<span class='line'>651</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentSymbol</span><span class="PUNC">)</span><span class="WHIT">   </span><span class="NAME">currentSymbol</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="COMM">//シンボルクリア</span><span class="WHIT">
<span class='line'>652</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>653</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>654</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>655</span> </span><span class="COMM">//継続バー カレントが空白セクションの場合のみセクション更新して継続</span><span class="WHIT">
<span class='line'>656</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>657</span> </span><span class="WHIT">            </span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="NAME">nas.cameraworkDescriptions.barRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>658</span> </span><span class="WHIT">        </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>659</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">currentSection.value</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>660</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>661</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myCollection.pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>662</span> </span><span class="WHIT">                </span><span class="NAME">currentSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationCamerawork</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//changeCurrent unknown</span><span class="WHIT">
<span class='line'>663</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>664</span> </span><span class="WHIT">                </span><span class="NAME">startNodeId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fix</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>665</span> </span><span class="WHIT">                </span><span class="COMM">// イレギュラー開始なので endNode を設定しない</span><span class="WHIT">
<span class='line'>666</span> </span><span class="WHIT">                </span><span class="NAME">currentSymbol</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.cameraworkDescriptions.get</span><span class="PUNC">(</span><span class="STRN">'unknown'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>667</span> </span><span class="COMM">//先行セクションが[値]セルであった場合</span><span class="WHIT">
<span class='line'>668</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">lastBracketsId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fix</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>669</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.value.prefix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">lastBracketsId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>670</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.headMargin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>671</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="COMM">// */</span><span class="WHIT">
<span class='line'>672</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>673</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>674</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>675</span> </span><span class="COMM">//エンドノードを検出した場合　検出用変数をクリアして　後続のセルを判定して動作を切り分け</span><span class="WHIT">
<span class='line'>676</span> </span><span class="COMM">/*
<span class='line'>677</span>     記述継続の場合のみ先行でセクションを切り替える
<span class='line'>678</span>     後続セルが空白セル||[値]セルならばNOP
<span class='line'>679</span>     
<span class='line'>680</span>     endNode検知
<span class='line'>681</span>     フレーム内容がstartNodeに対応するendNodeでかつ後続フレームが値エントリでない場合のみセクションを閉じる
<span class='line'>682</span>     最終フレーム処理では　startNodeId==durationとなるが、以降の判定はないので放置
<span class='line'>683</span> 
<span class='line'>684</span> */</span><span class="WHIT">
<span class='line'>685</span> </span><span class="WHIT">       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">endNode</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">endNode</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>686</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">fix</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>687</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nextBlank</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>688</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>689</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nextBlank</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^\s*$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>690</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^\[[^\[]+\]$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">nextBlank</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>691</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>692</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">nextBlank</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>693</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mySymbol</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.cameraworkDescriptions.get</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>694</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">detectedName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>695</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^&lt;([\>]+)>$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>696</span> </span><span class="WHIT">                        </span><span class="NAME">detectedName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>697</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">mySymbol</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>698</span> </span><span class="WHIT">                        </span><span class="NAME">detectedName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mySymbol.name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>699</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>700</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myCollection.pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>701</span> </span><span class="WHIT">                    </span><span class="COMM">//if(currentSection.value) currentSection.value.parseContent();</span><span class="WHIT">
<span class='line'>702</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationCamerawork</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">detectedName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//changeCurrent unknown</span><span class="WHIT">
<span class='line'>703</span> </span><span class="WHIT">                    </span><span class="NAME">startNodeId</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fix</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>704</span> </span><span class="WHIT">                    </span><span class="NAME">endNode</span><span class="WHIT">       </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="COMM">//終了ノードクリア</span><span class="WHIT">
<span class='line'>705</span> </span><span class="WHIT">                    </span><span class="NAME">currentSymbol</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="COMM">//シンボルクリア 判定保留</span><span class="WHIT">
<span class='line'>706</span> </span><span class="COMM">//先行セクションが[値]セルであった場合</span><span class="WHIT">
<span class='line'>707</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">lastBracketsId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fix</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>708</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.value.prefix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">lastBracketsId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>709</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.headMargin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>710</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="COMM">// */</span><span class="WHIT">
<span class='line'>711</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>712</span> </span><span class="COMM">//console.log(currentSection.value.type.join(':'))</span><span class="WHIT">
<span class='line'>713</span> </span><span class="WHIT">                </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>714</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>715</span> </span><span class="COMM">//開始ノード（予約語）を検知　強制的に新しい区間を開始</span><span class="WHIT">
<span class='line'>716</span> </span><span class="WHIT">       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="NAME">startNodeRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>717</span> </span><span class="COMM">//区間の開始</span><span class="WHIT">
<span class='line'>718</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">fix</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>719</span> </span><span class="WHIT">                </span><span class="NAME">startNodeId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fix</span><span class="PUNC">;</span><span class="COMM">//シート入力をスタートノードに設定</span><span class="WHIT">
<span class='line'>720</span> </span><span class="WHIT">                </span><span class="NAME">endNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endNodes</span><span class="PUNC">[</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">startNodeId</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="COMM">//頭尾は</span><span class="WHIT">
<span class='line'>721</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>722</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">lastBracketsId</span><span class="PUNC">!=</span><span class="PUNC">(</span><span class="NAME">fix</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myCollection.pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>723</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">lastBracketsId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fix</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>724</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.tailMargin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">                    </span><span class="WHIT">
<span class='line'>725</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>726</span> </span><span class="COMM">//                if(currentSection.value) currentSection.value.parseContent();</span><span class="WHIT">
<span class='line'>727</span> </span><span class="WHIT">                </span><span class="NAME">currentSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationCamerawork</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//changeCurrent</span><span class="WHIT">
<span class='line'>728</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>729</span> </span><span class="COMM">//先行セクションが[値]セルであった場合</span><span class="WHIT">
<span class='line'>730</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">lastBracketsId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fix</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>731</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.value.prefix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">lastBracketsId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>732</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.headMargin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>733</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="COMM">// */</span><span class="WHIT">
<span class='line'>734</span> </span><span class="COMM">//console.log(currentSection.value.type.join(':'))</span><span class="WHIT">
<span class='line'>735</span> </span><span class="WHIT">                </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>736</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>737</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>738</span> </span><span class="COMM">//].*[トランジションエントリ()</span><span class="WHIT">
<span class='line'>739</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/\^][^\[]+\[$/</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>740</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mySymbol</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.cameraworkDescriptions.get</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>741</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>742</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">currentSection.value</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="NAME">endNode</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>743</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">currentSection.value</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>744</span> </span><span class="WHIT">            </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>745</span> </span><span class="COMM">//]transition[区間の開始</span><span class="WHIT">
<span class='line'>746</span> </span><span class="WHIT">                </span><span class="NAME">startNodeId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fix</span><span class="PUNC">;</span><span class="COMM">//シート入力をスタートノードに設定</span><span class="WHIT">
<span class='line'>747</span> </span><span class="WHIT">                </span><span class="NAME">endNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">startNodeId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="COMM">//トランジションの頭尾は一致</span><span class="WHIT">
<span class='line'>748</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">fix</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>749</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.value</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationCamerawork</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">mySymbol</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">mySombol.name</span><span class="PUNC">:</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">startNodeId</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//change Value;</span><span class="WHIT">
<span class='line'>750</span> </span><span class="WHIT">                    </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>751</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>752</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>753</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myCollection.pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>754</span> </span><span class="WHIT">                    </span><span class="COMM">//if(currentSection.value) currentSection.value.parseContent();</span><span class="WHIT">
<span class='line'>755</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationCamerawork</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">mySymbol</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">mySombol.name</span><span class="PUNC">:</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">startNodeId</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//changeCurrent</span><span class="WHIT">
<span class='line'>756</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>757</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>758</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>759</span> </span><span class="COMM">//console.log(currentSection.value.type.join(':'))</span><span class="WHIT">
<span class='line'>760</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>761</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>762</span> </span><span class="COMM">//第一エントリで区間タイプが判別可能な区間の判定</span><span class="WHIT">
<span class='line'>763</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>764</span> </span><span class="WHIT">            </span><span class="NAME">String</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="NAME">nas.cameraworkDescriptions.singleRegex</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>765</span> </span><span class="WHIT">         </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>766</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mySymbol</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.cameraworkDescriptions.get</span><span class="PUNC">(</span><span class="NAME">RegExp.$1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>767</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">mySymbol</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>768</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">currentSection.value</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">currentSection.value.type</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">!=</span><span class="NAME">mySymbol.name</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>769</span> </span><span class="COMM">//Symbol区間の開始</span><span class="WHIT">
<span class='line'>770</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">fix</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>771</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.value</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationCamerawork</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">mySymbol.name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//change Value;</span><span class="WHIT">
<span class='line'>772</span> </span><span class="COMM">//console.log(currentSection.value.type.join(':'))</span><span class="WHIT">
<span class='line'>773</span> </span><span class="WHIT">                    </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>774</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>775</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>776</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myCollection.pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>777</span> </span><span class="WHIT">                    </span><span class="COMM">//if(currentSection.value) currentSection.value.parseContent();</span><span class="WHIT">
<span class='line'>778</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationCamerawork</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">mySymbol.name</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//changeCurrent</span><span class="WHIT">
<span class='line'>779</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>780</span> </span><span class="COMM">//先行セクションが[値]セルであった場合</span><span class="WHIT">
<span class='line'>781</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">lastBracketsId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fix</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>782</span> </span><span class="WHIT">                        </span><span class="NAME">currentSection.value.prefix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">lastBracketsId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>783</span> </span><span class="WHIT">                        </span><span class="NAME">currentSection.headMargin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>784</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="COMM">// */</span><span class="WHIT">
<span class='line'>785</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>786</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>787</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="NAME">fix</span><span class="PUNC">&lt;</span><span class="PUNC">(</span><span class="NAME">this.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">!=</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>788</span> </span><span class="WHIT">            </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>789</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myCollection.pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>790</span> </span><span class="WHIT">                </span><span class="COMM">//if(currentSection.value) currentSection.value.parseContent();</span><span class="WHIT">
<span class='line'>791</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^\s*$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>792</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//changeCurrentNull</span><span class="WHIT">
<span class='line'>793</span> </span><span class="WHIT">                    </span><span class="NAME">endNode</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>794</span> </span><span class="WHIT">                    </span><span class="NAME">currnetSymbol</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>795</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>796</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationCamerawork</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//changeCurrent</span><span class="WHIT">
<span class='line'>797</span> </span><span class="WHIT">                    </span><span class="NAME">startNodeId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fix</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="COMM">//シート入力をスタートノードに設定</span><span class="WHIT">
<span class='line'>798</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">endNode</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">endNodes</span><span class="PUNC">[</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">startNodeId</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">endNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endNodes</span><span class="PUNC">[</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">startNodeId</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>799</span> </span><span class="WHIT">                    </span><span class="NAME">currnetSymbol</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mySymbol</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>800</span> </span><span class="WHIT">               </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>801</span> </span><span class="COMM">//先行セクションが[値]セルであった場合</span><span class="WHIT">
<span class='line'>802</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">lastBracketsId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fix</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>803</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.value.prefix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">lastBracketsId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>804</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.headMargin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>805</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="COMM">// */</span><span class="WHIT">
<span class='line'>806</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>807</span> </span><span class="COMM">//console.log(currentSection.value.type.join(':'))</span><span class="WHIT">
<span class='line'>808</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>809</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>810</span> </span><span class="COMM">/*==================================================================*/</span><span class="WHIT">
<span class='line'>811</span> </span><span class="COMM">//一般セクションの処理</span><span class="WHIT">
<span class='line'>812</span> </span><span class="COMM">//トラック開始フレームであった場合のみ無条件でセクション開始　</span><span class="WHIT">
<span class='line'>813</span> </span><span class="COMM">//セクション開始Idは初期値で更新不用　エンドノードは　予約語内の対応文字列＞シンボルが同定可能ならそのデータ＞開始文字列と同じ</span><span class="WHIT">
<span class='line'>814</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">fix</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">currentSection.value</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>815</span> </span><span class="COMM">//先行セクションが空白であった場合のみセクション開始</span><span class="WHIT">
<span class='line'>816</span> </span><span class="WHIT">            </span><span class="NAME">startNodeId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fix</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>817</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">currentSymbol</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">currentSymbol</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.cameraworkDescriptions.get</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">startNodeId</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>818</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">currentSymbol</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">currentSymbol</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.cameraworkDescriptions.get</span><span class="PUNC">(</span><span class="STRN">'unknown'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>819</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">detectName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>820</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentSymbol.name</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">'unknown'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">detectName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentSymbol.name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>821</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">fix</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>822</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.value</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationCamerawork</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">detectName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//setValueToCurrentSection;</span><span class="WHIT">
<span class='line'>823</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>824</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>825</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">lastBracketsId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fix</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">currentSection.tailMargin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>826</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myCollection.pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>827</span> </span><span class="WHIT">                </span><span class="COMM">//if(currentSection.value) currentSection.value.parseContent();</span><span class="WHIT">
<span class='line'>828</span> </span><span class="WHIT">                </span><span class="NAME">currentSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationCamerawork</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">detectName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//changeCurrent</span><span class="WHIT">
<span class='line'>829</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>830</span> </span><span class="COMM">//先行セクションが[値]セルであった場合のみ</span><span class="WHIT">
<span class='line'>831</span> </span><span class="COMM">//                if((lastBracketsId == (fix-1))&&(currentSymbol.type != "composite")&&(currentSymbol.type != "transition")){}</span><span class="WHIT">
<span class='line'>832</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">lastBracketsId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fix</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>833</span> </span><span class="WHIT">                    </span><span class="COMM">//if(currentSymbol.type != "geometry"){</span><span class="WHIT">
<span class='line'>834</span> </span><span class="WHIT">                    </span><span class="COMM">//    currentSymbol = nas.cameraworkDescriptions.get('SL');</span><span class="WHIT">
<span class='line'>835</span> </span><span class="WHIT">                    </span><span class="COMM">//    currentSection.value=new nas.AnimationCamerawork(null,currentSymbol.name);</span><span class="WHIT">
<span class='line'>836</span> </span><span class="WHIT">                    </span><span class="COMM">//}</span><span class="WHIT">
<span class='line'>837</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.value.prefix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">lastBracketsId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>838</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.headMargin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>839</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>840</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>841</span> </span><span class="WHIT">            </span><span class="COMM">//スタートノードに対応するエンドノードが予約語内にあればそちらを優先</span><span class="WHIT">
<span class='line'>842</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">endNodes</span><span class="PUNC">[</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">startNodeId</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>843</span> </span><span class="WHIT">                </span><span class="NAME">endNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endNodes</span><span class="PUNC">[</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">startNodeId</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>844</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">currentSymbol</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">currentSymbol.nodeSigns.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>845</span> </span><span class="WHIT">                </span><span class="NAME">endNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentSymbol.nodeSigns</span><span class="PUNC">[</span><span class="NAME">currentSymbol.nodeSigns.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>846</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>847</span> </span><span class="WHIT">                </span><span class="NAME">endNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">startNodeId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>848</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>849</span> </span><span class="COMM">//console.log(currentSection.value.type.join(':'))</span><span class="WHIT">
<span class='line'>850</span> </span><span class="COMM">//            continue;</span><span class="WHIT">
<span class='line'>851</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">startNodeId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">fix</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>852</span> </span><span class="COMM">//セルエントリが開始ノードであった場合のみ終了ノードだけを設定する            </span><span class="WHIT">
<span class='line'>853</span> </span><span class="WHIT">            </span><span class="COMM">//スタートノードに対応するエンドノードが予約語内にあればそちらを優先</span><span class="WHIT">
<span class='line'>854</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">endNodes</span><span class="PUNC">[</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">startNodeId</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>855</span> </span><span class="WHIT">                </span><span class="NAME">endNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endNodes</span><span class="PUNC">[</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">startNodeId</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>856</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">currentSymbol</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">currentSymbol.nodeSigns.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>857</span> </span><span class="WHIT">                </span><span class="NAME">endNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentSymbol.nodeSigns</span><span class="PUNC">[</span><span class="NAME">currentSymbol.nodeSigns.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>858</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>859</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>860</span> </span><span class="COMM">//&lt;name>エントリまたはタイプ識別可能エントリ</span><span class="WHIT">
<span class='line'>861</span> </span><span class="COMM">//          当該エントリの前に//セクションが閉じているか否か//セクションが確定しているか否か//の判定が必要</span><span class="WHIT">
<span class='line'>862</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>863</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ckSymbol</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.cameraworkDescriptions.get</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>864</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>865</span> </span><span class="WHIT">            </span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^&lt;([^>]+)>$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">ckSymbol</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>866</span> </span><span class="WHIT">        </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>867</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">detectedName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">ckSymbol</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>868</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">ckSymbol</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>869</span> </span><span class="WHIT">                  </span><span class="NAME">ckSymbol</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.cameraworkDescriptions.get</span><span class="PUNC">(</span><span class="NAME">detectedName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>870</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>871</span> </span><span class="COMM">//console.log(fix + ' : '+ this[fix]);</span><span class="WHIT">
<span class='line'>872</span> </span><span class="COMM">//console.log(ckSymbol);</span><span class="WHIT">
<span class='line'>873</span> </span><span class="COMM">//console.log(this[startNodeId]);</span><span class="WHIT">
<span class='line'>874</span> </span><span class="COMM">/*
<span class='line'>875</span>                 (currentSection.value.type[0]=="transition")||
<span class='line'>876</span>                 (currentSection.value.type[1]=="fadeIn")||
<span class='line'>877</span> */</span><span class="WHIT">
<span class='line'>878</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>879</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="NAME">currentSection.value</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">currentSection.value.name</span><span class="PUNC">==</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>880</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="NAME">currentSection.value.name</span><span class="PUNC">==</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">startNodeId</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>881</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">ckSymbol</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>882</span> </span><span class="WHIT">                    </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">ckSymbol.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">currentSection.value.type</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ckSymbol.name</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">currentSection.value.type</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>883</span> </span><span class="WHIT">                    </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">ckSymbol.nodeSigns.length</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ckSymbol.nodeSigns</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">startNodeId</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>884</span> </span><span class="WHIT">                </span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>885</span> </span><span class="WHIT">            </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>886</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.value.name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">detectedName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>887</span> </span><span class="WHIT">                </span><span class="NAME">currentSymbol</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">ckSymbol</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">ckSymbol</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">nas.cameraworkDescriptions.get</span><span class="PUNC">(</span><span class="NAME">currentSection.value.name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>888</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">currentSymbol</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">currentSymbol</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.cameraworkDescriptions.get</span><span class="PUNC">(</span><span class="STRN">'unknown'</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>889</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.value.type</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">currentSymbol.type</span><span class="PUNC">,</span><span class="NAME">currentSymbol.name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>890</span> </span><span class="COMM">//console.log(fix +': set section value');</span><span class="WHIT">
<span class='line'>891</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>892</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>893</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">lastBracketsId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fix</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">currentSection.tailMargin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>894</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myCollection.pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>895</span> </span><span class="WHIT">                </span><span class="COMM">//if(currentSection.value) currentSection.value.parseContent();</span><span class="WHIT">
<span class='line'>896</span> </span><span class="WHIT">                </span><span class="NAME">currentSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationCamerawork</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">detectedName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//changeCurrent</span><span class="WHIT">
<span class='line'>897</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>898</span> </span><span class="WHIT">                </span><span class="NAME">currentSymbol</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">ckSymbol</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">ckSymbol</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">nas.cameraworkDescriptions.get</span><span class="PUNC">(</span><span class="NAME">currentSection.value.name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>899</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">currentSymbol</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">currentSymbol</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.cameraworkDescriptions.get</span><span class="PUNC">(</span><span class="STRN">'unknown'</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>900</span> </span><span class="COMM">//console.log(fix +': start section');</span><span class="WHIT">
<span class='line'>901</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>902</span> </span><span class="COMM">//先行セクションが[値]セルであった場合</span><span class="WHIT">
<span class='line'>903</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">lastBracketsId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fix</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>904</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.value.prefix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">lastBracketsId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>905</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.headMargin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>906</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>907</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">endNode</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>908</span> </span><span class="WHIT">                </span><span class="NAME">endNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentSymbol.nodeSigns.length</span><span class="PUNC">></span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">currentSymbol.nodeSigns</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="NAME">currentSymbol.nodeSigns</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>909</span> </span><span class="COMM">//&&(this[startNodeId]==currentSymbol.nodeSigns[1])</span><span class="WHIT">
<span class='line'>910</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>911</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="NAME">currentSymbol.nodeSigns.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>912</span> </span><span class="WHIT">            </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>913</span> </span><span class="WHIT">                </span><span class="NAME">endNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentSymbol.nodeSigns</span><span class="PUNC">[</span><span class="NAME">currentSymbol.nodeSigns.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>914</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>915</span> </span><span class="COMM">//console.log(currentSection.value.type.join(':'))</span><span class="WHIT">
<span class='line'>916</span> </span><span class="COMM">//console.log(currentSymbol)</span><span class="WHIT">
<span class='line'>917</span> </span><span class="COMM">//console.log(endNode);</span><span class="WHIT">
<span class='line'>918</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">           </span><span class="WHIT">
<span class='line'>919</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>920</span> </span><span class="COMM">//コメントエントリ</span><span class="WHIT">
<span class='line'>921</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^\(([^\)]+)\)$/</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>922</span> </span><span class="WHIT">            </span><span class="NAME">currentSection.value.comments.push</span><span class="PUNC">(</span><span class="NAME">RegExp.$1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>923</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>924</span> </span><span class="COMM">//interp,start,end以外のエントリーはattributesに積む</span><span class="WHIT">
<span class='line'>925</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>926</span> 
<span class='line'>927</span> </span><span class="WHIT">    </span><span class="NAME">this.sections</span><span class="PUNC">=</span><span class="NAME">myCollection</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>928</span> </span><span class="COMM">//console.log(this.sections)</span><span class="WHIT">
<span class='line'>929</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.sections</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>930</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>931</span> 
<span class='line'>932</span> </span><span class="COMM">/**
<span class='line'>933</span>  *  ジオメトリタイムラインの（区間）値
<span class='line'>934</span>  *  カメラワーク
<span class='line'>935</span>  基本的なサイズは、トラックに設定されたデフォルト値から継承する
<span class='line'>936</span>  
<span class='line'>937</span>  
<span class='line'>938</span> 要素名は[ブラケット]で囲む
<span class='line'>939</span> プロパティの値はブラケットを払ったもの
<span class='line'>940</span>  */</span><span class="WHIT">
<span class='line'>941</span> </span><span class="NAME">nas.AnimationGeometry</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myParent</span><span class="PUNC">,</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>942</span> </span><span class="WHIT">    </span><span class="NAME">this.parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myParent</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">myParent</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT">   </span><span class="PUNC">;</span><span class="COMM">//xMapElementGroup or null</span><span class="WHIT">
<span class='line'>943</span> </span><span class="WHIT">    </span><span class="NAME">this.contentText</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">myContent</span><span class="PUNC">:</span><span class="STRN">''</span><span class="WHIT">   </span><span class="PUNC">;</span><span class="COMM">//xMapのソースを保存する　自動で再構築が行なわれるタイミングがある</span><span class="WHIT">
<span class='line'>944</span> 
<span class='line'>945</span> </span><span class="WHIT">    </span><span class="NAME">this.name</span><span class="WHIT">                                   </span><span class="PUNC">;</span><span class="COMM">//素材名</span><span class="WHIT">
<span class='line'>946</span> </span><span class="WHIT">    </span><span class="NAME">this.source</span><span class="WHIT">                                 </span><span class="PUNC">;</span><span class="COMM">//参照画像データソース　存在する場合は、type="still-reference"で初期化される</span><span class="WHIT">
<span class='line'>947</span> </span><span class="WHIT">    </span><span class="NAME">this.comment</span><span class="PUNC">=</span><span class="STRN">""</span><span class="WHIT">                             </span><span class="PUNC">;</span><span class="COMM">//コメント文字列</span><span class="WHIT">
<span class='line'>948</span> </span><span class="WHIT">    </span><span class="NAME">this.extended</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">                       </span><span class="PUNC">;</span><span class="COMM">//拡張表示フラグ</span><span class="WHIT">
<span class='line'>949</span> 
<span class='line'>950</span> </span><span class="WHIT">    </span><span class="NAME">this.formGeometry</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationField</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//nas.AnimationFieldオブジェクト</span><span class="WHIT">
<span class='line'>951</span> </span><span class="WHIT">    </span><span class="NAME">this.position</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Position</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">      </span><span class="PUNC">;</span><span class="COMM">//要素を配置する位置</span><span class="WHIT">
<span class='line'>952</span> </span><span class="WHIT">    </span><span class="NAME">this.offset</span><span class="WHIT">       </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Offset</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">        </span><span class="PUNC">;</span><span class="COMM">//要素の原点オフセット</span><span class="WHIT">
<span class='line'>953</span> </span><span class="WHIT">    </span><span class="NAME">this.scale</span><span class="WHIT">        </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Scale</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">         </span><span class="PUNC">;</span><span class="COMM">//要素スケール</span><span class="WHIT">
<span class='line'>954</span> </span><span class="WHIT">    </span><span class="NAME">this.t</span><span class="WHIT">            </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.TimingCurve</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>955</span> </span><span class="WHIT">    </span><span class="NAME">this.c</span><span class="WHIT">            </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Curve</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>956</span> </span><span class="WHIT">    </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.position.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>957</span> </span><span class="WHIT">    </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.position.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>958</span> </span><span class="WHIT">    </span><span class="NAME">this.z</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.position.z</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>959</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>960</span> </span><span class="WHIT">    </span><span class="NAME">this.parseContent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>961</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>962</span> 
<span class='line'>963</span> </span><span class="NAME">nas.AnimationGeometry.prototype.constractor</span><span class="PUNC">=</span><span class="NAME">nas.AnimationField.constractor</span><span class="WHIT">
<span class='line'>964</span> 
<span class='line'>965</span> 
<span class='line'>966</span> </span><span class="COMM">/**
<span class='line'>967</span>     文字列化して返す
<span class='line'>968</span>     exportForm
<span class='line'>969</span>     basic
<span class='line'>970</span> source+
<span class='line'>971</span>     extend
<span class='line'>972</span> */</span><span class="WHIT">
<span class='line'>973</span> </span><span class="NAME">nas.AnimationGeometry.prototype.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">exportForm</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>974</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">this.name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="COMM">//無名オブジェクトは空リターン</span><span class="WHIT">
<span class='line'>975</span> </span><span class="COMM">//return this.contentText;//動作確認用ダミー行</span><span class="WHIT">
<span class='line'>976</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">exportForm</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'extend'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>977</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resultArray</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>978</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.position</span><span class="PUNC">)</span><span class="WHIT">   </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="STRN">'\tposition = "'</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.position.toString</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">'"'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>979</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.source</span><span class="PUNC">)</span><span class="WHIT">     </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="STRN">'\tfile = "'</span><span class="WHIT">    </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.source.toString</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">'"'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>980</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.size</span><span class="PUNC">)</span><span class="WHIT">       </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="STRN">'\tsize = '</span><span class="WHIT">     </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.size.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>981</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.offset</span><span class="PUNC">)</span><span class="WHIT">     </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="NAME">this.offset.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>982</span> </span><span class="COMM">//        if(this.offset)   resultArray.push('\toffset = '   + this.offset.toString());</span><span class="WHIT">
<span class='line'>983</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.rotation</span><span class="PUNC">)</span><span class="WHIT">   </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="NAME">this.rotation.toString</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>984</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.comment</span><span class="PUNC">)</span><span class="WHIT">    </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="STRN">'\tcomment = '</span><span class="WHIT">  </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.comment</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>985</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">resultArray.join</span><span class="PUNC">(</span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>986</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">exportForm</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'basic'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>987</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resultArray</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>988</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>989</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.source</span><span class="PUNC">)</span><span class="WHIT">   </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="STRN">'"'</span><span class="PUNC">+</span><span class="NAME">this.source.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">'"'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>990</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.size</span><span class="PUNC">)</span><span class="WHIT">     </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="NAME">this.size.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>991</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.offset</span><span class="PUNC">)</span><span class="WHIT">   </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="NAME">this.offset.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>992</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.rotation</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="NAME">this.rotation.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>993</span> </span><span class="WHIT">        </span><span class="NAME">resultArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">resultArray.join</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>994</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.comment</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="NAME">this.comment</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>995</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">this.parent.name</span><span class="PUNC">,</span><span class="NAME">this.name</span><span class="PUNC">,</span><span class="NAME">resultArray.join</span><span class="PUNC">(</span><span class="STRN">"\t"</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">'\t'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>996</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>997</span> 
<span class='line'>998</span> 
<span class='line'>999</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">exportForm</span><span class="PUNC">==</span><span class="STRN">'extended'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1000</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resultData</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1001</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.source</span><span class="PUNC">)</span><span class="WHIT">     </span><span class="NAME">resultData.push</span><span class="PUNC">(</span><span class="NAME">this.source.toString</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">   </span><span class="WHIT">
<span class='line'>1002</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.size</span><span class="PUNC">)</span><span class="WHIT">       </span><span class="NAME">resultData.push</span><span class="PUNC">(</span><span class="NAME">this.size.toString</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1003</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.position</span><span class="PUNC">)</span><span class="WHIT">   </span><span class="NAME">resultData.push</span><span class="PUNC">(</span><span class="NAME">this.position.toString</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1004</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1005</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1006</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.contentText</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1007</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1008</span> </span><span class="COMM">/**
<span class='line'>1009</span>     コンテンツを与えてパースする
<span class='line'>1010</span>     引数がない場合は自身のコンテンツデータを再パースする
<span class='line'>1011</span> */</span><span class="WHIT">
<span class='line'>1012</span> </span><span class="NAME">nas.AnimationGeometry.prototype.parseContent</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1013</span> </span><span class="COMM">//引数がなければ現在のコンテンツを再パース</span><span class="WHIT">
<span class='line'>1014</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1015</span> </span><span class="WHIT">        </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.contentText</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1016</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1017</span> </span><span class="WHIT">        </span><span class="NAME">this.contentText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1018</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1019</span> 
<span class='line'>1020</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isGroup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myContent.indexOf</span><span class="PUNC">(</span><span class="STRN">'['</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1021</span> </span><span class="COMM">//第一形式グループ ^[\&lt;group>\t&lt;typeName>[\t&lt;option-text>[\t&lt;comment>]]\]$</span><span class="WHIT">
<span class='line'>1022</span> </span><span class="COMM">//第二形式エントリ ^&lt;group>\t&lt;name>[\t&lt;option-text>[\t&lt;comment>]]$</span><span class="WHIT">
<span class='line'>1023</span> 
<span class='line'>1024</span> </span><span class="WHIT">    </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">'\n'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1025</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myContent.length</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">line</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1026</span> 
<span class='line'>1027</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">isGroup</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="STRN">'['</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">slice</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//ブラケット削除</span><span class="WHIT">
<span class='line'>1028</span> 
<span class='line'>1029</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^\t(\S+)\s*=\s*(.+)\s*$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1030</span> </span><span class="WHIT">            </span><span class="COMM">//第二形式(タブ開始)でプロパティ別のデータ更新を行う</span><span class="WHIT">
<span class='line'>1031</span> </span><span class="WHIT">            </span><span class="NAME">this.extended</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1032</span> 
<span class='line'>1033</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myProp</span><span class="PUNC">=</span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">valueArray</span><span class="PUNC">=</span><span class="NAME">csvSimple.parse</span><span class="PUNC">(</span><span class="NAME">RegExp.$2</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1034</span> 
<span class='line'>1035</span> </span><span class="WHIT">            </span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">myProp</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1036</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"file"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1037</span> </span><span class="WHIT">                </span><span class="NAME">this.file</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationElementSource</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1038</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1039</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"position"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1040</span> </span><span class="WHIT">                </span><span class="NAME">this.position</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Position</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1041</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1042</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"position.X"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1043</span> </span><span class="WHIT">                </span><span class="NAME">this.position.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1044</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1045</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"position.Y"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1046</span> </span><span class="WHIT">                </span><span class="NAME">this.position.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1047</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1048</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"offset"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1049</span> </span><span class="WHIT">                </span><span class="NAME">this.offset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">valueArray.length</span><span class="PUNC">&lt;</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT">
<span class='line'>1050</span> </span><span class="WHIT">                    </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Offset</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Offset</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1051</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1052</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"offset.X"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1053</span> </span><span class="WHIT">                </span><span class="NAME">this.offset.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1054</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1055</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"offset.Y"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1056</span> </span><span class="WHIT">                </span><span class="NAME">this.offset.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1057</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1058</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"offset.R"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1059</span> </span><span class="WHIT">                </span><span class="NAME">this.offset.r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1060</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1061</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"scale"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1062</span> </span><span class="WHIT">                </span><span class="NAME">this.scale</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">valueArray.length</span><span class="PUNC">&lt;</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT">
<span class='line'>1063</span> </span><span class="WHIT">                    </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Scale</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Offset</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1064</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1065</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"scale.X"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1066</span> </span><span class="WHIT">                </span><span class="NAME">this.scale.x</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1067</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1068</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"scale.Y"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1069</span> </span><span class="WHIT">                </span><span class="NAME">this.scale.y</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1070</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1071</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"scale.Z"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1072</span> </span><span class="WHIT">                </span><span class="NAME">this.scale.z</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1073</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1074</span> </span><span class="WHIT">          </span><span class="TOKN">　</span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1075</span> </span><span class="WHIT">                </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">myProp</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1076</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1077</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^(\S+)\t?(\S+)\t?([^\t]+)?\t?(.*)$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1078</span> </span><span class="WHIT">        </span><span class="COMM">//　第一形式の再パース</span><span class="WHIT">
<span class='line'>1079</span> </span><span class="COMM">//console.log(myContent[line]);</span><span class="WHIT">
<span class='line'>1080</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myGroup</span><span class="PUNC">=</span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//グループの再パースは行われない</span><span class="WHIT">
<span class='line'>1081</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="NAME">RegExp.$2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1082</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myComment</span><span class="PUNC">=</span><span class="NAME">RegExp.$4</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1083</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">valueArray</span><span class="PUNC">=</span><span class="NAME">nas.parseDataChank</span><span class="PUNC">(</span><span class="NAME">RegExp.$3</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1084</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">numeProps</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">[</span><span class="STRN">"size"</span><span class="PUNC">,</span><span class="STRN">"x"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="STRN">"size"</span><span class="PUNC">,</span><span class="STRN">"y"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="STRN">"offset"</span><span class="PUNC">,</span><span class="STRN">"x"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="STRN">"offset"</span><span class="PUNC">,</span><span class="STRN">"y"</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1085</span> </span><span class="COMM">//console.log(myComment);console.log(valueArray);</span><span class="WHIT">
<span class='line'>1086</span> </span><span class="COMM">//console.log(this);</span><span class="WHIT">
<span class='line'>1087</span> </span><span class="COMM">/*
<span class='line'>1088</span>     フィールド文字列であった場合の判定が必要　2018 10 09
<span class='line'>1089</span> */</span><span class="WHIT">
<span class='line'>1090</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.parent</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.xMapGroup</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">myGroup</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this.parent.name</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1091</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">isGroup</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.name</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">myGroup</span><span class="PUNC">,</span><span class="NAME">myName.replace</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">'^'</span><span class="PUNC">+</span><span class="NAME">myGroup</span><span class="PUNC">+</span><span class="STRN">'\-'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">'-'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1092</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">numCount</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1093</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vix</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">vix</span><span class="PUNC">&lt;</span><span class="NAME">valueArray.length</span><span class="PUNC">;</span><span class="NAME">vix</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1094</span> </span><span class="WHIT">                    </span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NAME">vix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1095</span> </span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"numeric"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1096</span> </span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"unitValue"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1097</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">numCount</span><span class="PUNC">&lt;</span><span class="NAME">numeProps.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1098</span> </span><span class="WHIT">                            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">numeProps</span><span class="PUNC">[</span><span class="NAME">numCount</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1099</span> </span><span class="WHIT">                                </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">numeProps</span><span class="PUNC">[</span><span class="NAME">numCount</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">numeProps</span><span class="PUNC">[</span><span class="NAME">numCount</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="STRN">'size'</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Size</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Offset</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1100</span> </span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1101</span> </span><span class="WHIT">                            </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">numeProps</span><span class="PUNC">[</span><span class="NAME">numCount</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">numeProps</span><span class="PUNC">[</span><span class="NAME">numCount</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitValue</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NAME">vix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1102</span> </span><span class="WHIT">                            </span><span class="NAME">numCount</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1103</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1104</span> </span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1105</span> </span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"unitAngle"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1106</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">this.offset</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.offset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Offset</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1107</span> </span><span class="WHIT">                        </span><span class="NAME">this.offset.r</span><span class="PUNC">==</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.UnitAngle</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NAME">vix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>1108</span> </span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1109</span> </span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"unitResolution"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1110</span> </span><span class="WHIT">                        </span><span class="NAME">this.resolution</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Resolution</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NAME">vix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>1111</span> </span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1112</span> </span><span class="WHIT">                    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"source"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1113</span> </span><span class="WHIT">                        </span><span class="NAME">this.source</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationElementSource</span><span class="PUNC">(</span><span class="NAME">valueArray</span><span class="PUNC">[</span><span class="NAME">vix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>1114</span> </span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1115</span> </span><span class="WHIT">                    </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1116</span> </span><span class="WHIT">                        </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1117</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1118</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1119</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myComment</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.comment</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myComment</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1120</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1121</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1122</span> 
<span class='line'>1123</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1124</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1125</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1126</span> 
<span class='line'>1127</span> </span><span class="NAME">nas.AnimationGeometry.prototype.interpolate</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">endValue</span><span class="PUNC">,</span><span class="NAME">indexCount</span><span class="PUNC">,</span><span class="NAME">indexOffset</span><span class="PUNC">,</span><span class="NAME">frameCount</span><span class="PUNC">,</span><span class="NAME">frameOffset</span><span class="PUNC">,</span><span class="NAME">props</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1128</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="COMM">//置きかえタイムラインの中間値は前方値で代表される</span><span class="WHIT">
<span class='line'>1129</span> </span><span class="WHIT">    </span><span class="COMM">/* オプション状態で中間タイミングで後方値に切り替える（時間で） return endValue;
<span class='line'>1130</span>     　 又はブランク状態のオブジェクトを返す return new nas.newAnimationReplacement("blank");
<span class='line'>1131</span>     */</span><span class="WHIT">
<span class='line'>1132</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1133</span> 
<span class='line'>1134</span> </span><span class="COMM">/** 指定フレーム数に内容を展開して配列で返す
<span class='line'>1135</span>  * @params {Number} cellCount
<span class='line'>1136</span>  * @returns {Array} 配列
<span class='line'>1137</span> */</span><span class="WHIT">
<span class='line'>1138</span> </span><span class="COMM">/*
<span class='line'>1139</span> 値セクションと補完セクションで出力を分ける
<span class='line'>1140</span> 空配列を作成
<span class='line'>1141</span> 値セクションは値を冒頭または末尾に表示
<span class='line'>1142</span> 表示条件
<span class='line'>1143</span>     冒頭　セクションIDがである場合を除き先行セクションが補完セクションであった場合に表示
<span class='line'>1144</span>     末尾　後続セクションが補完セクションであった場合に表示
<span class='line'>1145</span> 補完セクション
<span class='line'>1146</span>     継続長１フレーム・２フレーム　バーサインのみ
<span class='line'>1147</span>     それ以上は、
<span class='line'>1148</span>     開始サイン1,バーサイン 継続長-2,終了サイン1
<span class='line'>1149</span> 
<span class='line'>1150</span> 最少セクション長は　1
<span class='line'>1151</span> 最少セクション長を割ることは認められない　セクション削除は可能
<span class='line'>1152</span> 
<span class='line'>1153</span> ユーザ記述の文字列は可能な限り保存したいが、その仕組は後から　2019.02
<span class='line'>1154</span>  */</span><span class="WHIT">
<span class='line'>1155</span> </span><span class="NAME">nas.AnimationGeometry.prototype.getStream</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1156</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">cellCounts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="COMM">//1  > minimumCount</span><span class="WHIT">
<span class='line'>1157</span> 
<span class='line'>1158</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">minCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="COMM">//name</span><span class="WHIT">
<span class='line'>1159</span> </span><span class="COMM">//    if(this.prefix)  minCount++;</span><span class="WHIT">
<span class='line'>1160</span> </span><span class="COMM">//    if(this.postfix) minCount++;</span><span class="WHIT">
<span class='line'>1161</span> 
<span class='line'>1162</span> </span><span class="COMM">//    var myResult=new Array(cellCounts);</span><span class="WHIT">
<span class='line'>1163</span> 
<span class='line'>1164</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">cellCounts</span><span class="PUNC">=</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//?</span><span class="WHIT">
<span class='line'>1165</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">minCount</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1166</span> </span><span class="COMM">//        var myName = (mySymbol.nodeSigns.length == 1) ?mySymbol.nodeSigns[0]:'&lt;'+this.name+'>';</span><span class="WHIT">
<span class='line'>1167</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1168</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ix</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">cellCounts</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="NAME">ix</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1169</span> </span><span class="WHIT">            </span><span class="COMM">/*if(ix == Math.floor((cellCounts-(1+this.comments.length))/2)){
<span class='line'>1170</span>                 myResult[ix] = "&lt;center>";
<span class='line'>1171</span>                 if(this.comments.length){
<span class='line'>1172</span>                     for (var cx = 0 ;cx&lt;this.comments.length;cx++){
<span class='line'>1173</span>                         myResult[ix+cx+1] = '('+this.comments[cx]+')';
<span class='line'>1174</span>                     }
<span class='line'>1175</span>                     ix += this.comments.length;
<span class='line'>1176</span>                 }
<span class='line'>1177</span>                continue;
<span class='line'>1178</span>             }// */</span><span class="WHIT">
<span class='line'>1179</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1180</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.prefix</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">this.prefix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">concat</span><span class="PUNC">(</span><span class="NAME">myResult</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1181</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.postfix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myResult.concat</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">this.postfix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1182</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1183</span> 
<span class='line'>1184</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1185</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1186</span> </span><span class="COMM">/*
<span class='line'>1187</span> 
<span class='line'>1188</span> ジオメトリ要素、コンポジット要素 では、第三フィールド内の各値は、書式による自動判定をおこなう（順序によらない）
<span class='line'>1189</span> 
<span class='line'>1190</span> ％付き数値判定（strength または　scale）
<span class='line'>1191</span> インチフィールド文字列
<span class='line'>1192</span> フィールド文字列
<span class='line'>1193</span> ジオメトリデータ配列
<span class='line'>1194</span>     単位値と単位角度の組み合わせ
<span class='line'>1195</span> 
<span class='line'>1196</span> これらを判定して、判定から外れたデータをファイルパス（素材識別データ）とみなす
<span class='line'>1197</span> スケール以外の単位省略は不可
<span class='line'>1198</span> 
<span class='line'>1199</span> [PAN	geometry	,12FLD-10]
<span class='line'>1200</span> 
<span class='line'>1201</span> [FI-1	effect]
<span class='line'>1202</span> [TU	geometry]
<span class='line'>1203</span> [透過光	effect]
<span class='line'>1204</span> 
<span class='line'>1205</span> 	field = 10FLD
<span class='line'>1206</span> PAN	[A]	10FLD2S3W12 Quick
<span class='line'>1207</span> 
<span class='line'>1208</span> 
<span class='line'>1209</span> [FI-A	effect	"",,,	コメントですです]
<span class='line'>1210</span> 
<span class='line'>1211</span> 
<span class='line'>1212</span> 	geometry
<span class='line'>1213</span> [FLDString][,"file-path"]
<span class='line'>1214</span> 	1,2
<span class='line'>1215</span> [FLDString[,left,top[,rotation]]][,"file-path"]
<span class='line'>1216</span> 	1,2,3,4,5
<span class='line'>1217</span> [width,height[,left,top[,rotation]]][,"file-path"]
<span class='line'>1218</span> 	1,2,3,4,5,6
<span class='line'>1219</span> 
<span class='line'>1220</span> Target.match(/^[\d]+\.?[\d]*FLD()?$/i)
<span class='line'>1221</span> 
<span class='line'>1222</span> 
<span class='line'>1223</span> 	effect
<span class='line'>1224</span> [strength[,blendingMode]][,file-path]
<span class='line'>1225</span> 	1,2,3
<span class='line'>1226</span> 
<span class='line'>1227</span> (Target).match(/^[+-]?[\d]+\.?[\d]*\%?$/);//％付き数値判定
<span class='line'>1228</span> (new nas.BlendingMode[Target]);//ブレンドモード判定
<span class='line'>1229</span> 上記以外はファイルパス
<span class='line'>1230</span> 50%,normal
<span class='line'>1231</span> 50%,"/path/file-name.ext"
<span class='line'>1232</span> 
<span class='line'>1233</span> 
<span class='line'>1234</span> [WXP	effect	50%,normal	カットいっぱい]
<span class='line'>1235</span> 
<span class='line'>1236</span> [FI	effect	0%]
<span class='line'>1237</span> FI	&lt;10%>	normal
<span class='line'>1238</span> FI	&lt;0.01>		
<span class='line'>1239</span> */</span><span class="WHIT">
<span class='line'>1240</span> </span><span class="COMM">/* TEST
<span class='line'>1241</span> var A=new nas.AnimationGeometry(null,
<span class='line'>1242</span> `[PAN	GEOMETRY]
<span class='line'>1243</span> 	size=252mm,142.875mm
<span class='line'>1244</span> 	position=0mm,0mm,0mm
<span class='line'>1245</span> 	offset=0mm,104.875mm
<span class='line'>1246</span> 	rotation=0d
<span class='line'>1247</span> 	comment=10in/StanderdFrame/16:9/HDTV
<span class='line'>1248</span> # 作品データの継承があるのでこのサンプルでは本来は記述不要
<span class='line'>1249</span> `);
<span class='line'>1250</span> A.toString();
<span class='line'>1251</span> */</span><span class="WHIT">
<span class='line'>1252</span> </span><span class="COMM">/*
<span class='line'>1253</span>     カメラワークトラックをパースしてセクションコレクションを返す
<span class='line'>1254</span>     option:(geometry|stagework)
<span class='line'>1255</span>     セクションの状態は
<span class='line'>1256</span>     値：
<span class='line'>1257</span>         あり>有値セクション
<span class='line'>1258</span>             何らかの値オブジェクトを持つ値セクション　この継続時間中トラックの持つ値は変化しない最短で１フレーム
<span class='line'>1259</span>         なし>中間値補間セクション
<span class='line'>1260</span>             valueプロパティが空で値オブジェクトを持たない
<span class='line'>1261</span>             中間値補間サブセクションコレクションを持つ
<span class='line'>1262</span>     geometryタイムライントラックセクションの開始、終了判定
<span class='line'>1263</span>     セクションは「値区間(セクション)」と「中間値補間区間(セクション)」の２種に分類される
<span class='line'>1264</span>     中間値セクションは必ず前後に値セクションを持つ
<span class='line'>1265</span>     値区間は連続することが可能
<span class='line'>1266</span>     値区間は最低でも１フレームの継続時間を持ち、そのトラックの返す値nas.AnimationGeometryオブジェクトを保持する
<span class='line'>1267</span> 
<span class='line'>1268</span>     補間区間は、値オブジェクトを持たず、サブセクションコレクションを持ち　前後の値区間の中間値を補間して戻す
<span class='line'>1269</span>     サブセクションは値としてnas.ValueInterpolatorオブジェクトを持つ
<span class='line'>1270</span>     
<span class='line'>1271</span>     補間区間は補間区間開始ノードで開始され終了ノードで閉じる
<span class='line'>1272</span>     
<span class='line'>1273</span>     入力としては開始ノードと終了ノードはそれぞれ対応するサインを対で使用することが求められる
<span class='line'>1274</span>     特定の開始ノードで初期化された補間区間は、明示的に開始ノードと対の終了ノードで閉じられるか又は
<span class='line'>1275</span>     後続の値エントリが宣言されて値区間が開始されるまでの間継続される
<span class='line'>1276</span>     中間値補間区間はその区間が閉じられるまでの間　基本的にすべての空白以外のエントリが副補間区間を初期化する。
<span class='line'>1277</span>     開始ノードは必ず副補間区間を開始するが、終了ノードは副補間区間を開始するとは限らない。
<span class='line'>1278</span>         
<span class='line'>1279</span>     終了ノードが中間値補間ノードとなるかならないかの判定
<span class='line'>1280</span>   　
<span class='line'>1281</span>   　区間内の終了ノードを除く中間値生成ノードの数がdurationの整数分の１である（割り切れる）場合（＝ 均等フレーミング）の場合
<span class='line'>1282</span>   　終了ノードは中間値を初期化しない。
<span class='line'>1283</span>   　
<span class='line'>1284</span>   　タイミングが乱れ打ちの中間値補間を行う場合は、終了ノードを利用せずにタイミング指定を行うものとする
<span class='line'>1285</span>   　実際に開始ノードと終了ノードのみの区間があった場合は、中間値指定ノードでシートセルを埋めるように促すほうが良い
<span class='line'>1286</span> */</span><span class="WHIT">
<span class='line'>1287</span> </span><span class="NAME">_parseGeometryTrack</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1288</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myCollection</span><span class="WHIT">      </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XpsTimelineSectionCollection</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//自分自身を親としてセクションコレクションを新作</span><span class="WHIT">
<span class='line'>1289</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentSection</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//開始セクションを作成　継続時間０　値は保留</span><span class="WHIT">
<span class='line'>1290</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentSubSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="COMM">//操作サブセクションへの参照　値はカラ 処理中は操作対象オブジェクトへの参照</span><span class="WHIT">
<span class='line'>1291</span> </span><span class="COMM">//    var currentValue      = new nas.AnimationGeometry(null,"");//コンテンツはカラで初期化も保留</span><span class="WHIT">
<span class='line'>1292</span> </span><span class="COMM">//初期コンテンツは、継承のためにトラックに関連するxMapGroup.contentを求めて利用する。</span><span class="WHIT">
<span class='line'>1293</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">trackGroup</span><span class="WHIT">        </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.xParent.parentXps.xMap.getElementByName</span><span class="PUNC">(</span><span class="NAME">this.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1294</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">trackGroup</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1295</span> </span><span class="WHIT">        </span><span class="NAME">trackGroup</span><span class="WHIT">        </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">new_xMapElement</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>1296</span> </span><span class="WHIT">            </span><span class="NAME">this.id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1297</span> </span><span class="WHIT">            </span><span class="STRN">'geometry'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1298</span> </span><span class="WHIT">            </span><span class="NAME">this.xParent.parentXps.currentJob</span><span class="WHIT">
<span class='line'>1299</span> </span><span class="WHIT">        </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1300</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentValue</span><span class="WHIT">      </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">trackGroup.content</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1301</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentNodeSign</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="COMM">//否で初期化(確認用)</span><span class="WHIT">
<span class='line'>1302</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">valueDetect</span><span class="WHIT">       </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="COMM">//否で初期化(確認用)</span><span class="WHIT">
<span class='line'>1303</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">startNodeRegex</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"^[▼▽●◯◎◆◇★☆]$"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1304</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endNodes</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1305</span> </span><span class="WHIT">        </span><span class="STRN">"▼"</span><span class="PUNC">:</span><span class="STRN">"▲"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1306</span> </span><span class="WHIT">        </span><span class="STRN">"▽"</span><span class="PUNC">:</span><span class="STRN">"△"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1307</span> </span><span class="WHIT">        </span><span class="STRN">"●"</span><span class="PUNC">:</span><span class="STRN">"●"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1308</span> </span><span class="WHIT">        </span><span class="STRN">"○"</span><span class="PUNC">:</span><span class="STRN">"◯"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1309</span> </span><span class="WHIT">        </span><span class="STRN">"◎"</span><span class="PUNC">:</span><span class="STRN">"◎"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1310</span> </span><span class="WHIT">        </span><span class="STRN">"◆"</span><span class="PUNC">:</span><span class="STRN">"◆"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1311</span> </span><span class="WHIT">        </span><span class="STRN">"◇"</span><span class="PUNC">:</span><span class="STRN">"◇"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1312</span> </span><span class="WHIT">        </span><span class="STRN">"☆"</span><span class="PUNC">:</span><span class="STRN">"☆"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1313</span> </span><span class="WHIT">        </span><span class="STRN">"★"</span><span class="PUNC">:</span><span class="STRN">"★"</span><span class="WHIT">
<span class='line'>1314</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1315</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fix</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">fix</span><span class="PUNC">&lt;</span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="NAME">fix</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1316</span> </span><span class="WHIT">        </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="PUNC">;</span><span class="COMM">//currentセクションの継続長を加算</span><span class="WHIT">
<span class='line'>1317</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">currentSubSection</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">currentSubSection.duration</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="PUNC">;</span><span class="COMM">//currentセクションの継続長を加算</span><span class="WHIT">
<span class='line'>1318</span> </span><span class="COMM">//未記入データ　これが一番多いので最初に処理しておく</span><span class="WHIT">
<span class='line'>1319</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1320</span> </span><span class="COMM">//中間値補間セクション終了ノード(対で処理する方)</span><span class="WHIT">
<span class='line'>1321</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="NAME">currentNodeSign</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1322</span> </span><span class="WHIT">            </span><span class="COMM">//補間サブセクションを初期化するかどうかを判定</span><span class="WHIT">
<span class='line'>1323</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NAME">currentSection.subSections.length</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1324</span> </span><span class="WHIT">                </span><span class="NAME">currentSubSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentSection.subSections.addSection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//割り切れない場合サブセクションを初期化</span><span class="WHIT">
<span class='line'>1325</span> </span><span class="WHIT">                </span><span class="NAME">currentSubSection.duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="COMM">//必ず1</span><span class="WHIT">
<span class='line'>1326</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1327</span> </span><span class="WHIT">            </span><span class="NAME">currentNodeSign</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="COMM">//補間区間終了ノードクリア</span><span class="WHIT">
<span class='line'>1328</span> </span><span class="WHIT">            </span><span class="NAME">currentSection</span><span class="PUNC">=</span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// 新規値セクション追加</span><span class="WHIT">
<span class='line'>1329</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1330</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1331</span> </span><span class="COMM">/* この正規表現は仮でハードコーディング　あとで設定ファイルからの反映に変更予定*/</span><span class="WHIT">
<span class='line'>1332</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="NAME">startNodeRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1333</span> </span><span class="COMM">/*
<span class='line'>1334</span>     予約開始ノードサイン検出
<span class='line'>1335</span> 予約語の開始ノードサインを検出したので対応する終了ノードをセットする
<span class='line'>1336</span> 第一区間が補間区間であった場合、トラックのデフォルト値を先行区間の値とする。
<span class='line'>1337</span> 第一区間は、値区間　補間区間のいずれでも良いので初期区間の値は保留されている
<span class='line'>1338</span> 検出したサインがカレントノードサインと一致していたら補間区間終了それ以外は副補間区間のエントリ初期化
<span class='line'>1339</span> セクションノードサイン
<span class='line'>1340</span> 予約語
<span class='line'>1341</span>     /^[▼▽↑●○◎◆◇★☆]$/
<span class='line'>1342</span>     特殊ノードとして中間値補間区間を開き、同じサインで当該の区間を閉じる
<span class='line'>1343</span>     予約語以外の中間値指定ノードには閉鎖機能がない
<span class='line'>1344</span>     値指定ノード以外は基本的にすべて中間値指定ノードとする
<span class='line'>1345</span>     空白エントリ・予約語以外の記述は値を指定するノードか否かを判定する。
<span class='line'>1346</span>     明示的に値を生成するノードを切り分け　残るエントリはｘMapに問い合わせを行い値を持たないエントリを中間値発生ノードとして扱う
<span class='line'>1347</span> */</span><span class="WHIT">
<span class='line'>1348</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentNodeSign</span><span class="PUNC">==</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1349</span> </span><span class="WHIT">                </span><span class="NAME">currentNodeSign</span><span class="PUNC">=</span><span class="NAME">endNodes</span><span class="PUNC">[</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="COMM">//予約語で開いたので終了ノードを設定する</span><span class="WHIT">
<span class='line'>1350</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">fix</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1351</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.subSections</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XpsTimelineSectionCollection</span><span class="PUNC">(</span><span class="NAME">currentSection</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//第一フレームだった場合のみ第一セクションを補間区間に変換</span><span class="WHIT">
<span class='line'>1352</span> </span><span class="WHIT">                    </span><span class="NAME">currentSubSection</span><span class="PUNC">=</span><span class="NAME">currentSection.subSections.addSection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//同時に第一サブセクションを初期化</span><span class="WHIT">
<span class='line'>1353</span> </span><span class="WHIT">                    </span><span class="NAME">currentSubSection.duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1354</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1355</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1356</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="STRN">"interpolation"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//それ以外は新規補間セクション追加</span><span class="WHIT">
<span class='line'>1357</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1358</span> </span><span class="WHIT">                    </span><span class="NAME">currentSubSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentSection.subSections.addSection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1359</span> </span><span class="WHIT">                    </span><span class="NAME">currentSubSection.duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1360</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1361</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1362</span> </span><span class="WHIT">                </span><span class="NAME">currentSubSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentSection.subSections.addSection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1363</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1364</span> </span><span class="WHIT">            </span><span class="NAME">currentSubSection.duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1365</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1366</span> </span><span class="COMM">//予約ノードサイン外</span><span class="WHIT">
<span class='line'>1367</span> </span><span class="COMM">/**
<span class='line'>1368</span> valueDetect = fale;
<span class='line'>1369</span> 値指定ノード\[[^\]]+\]を検出した場合、セルエントリーの角括弧を払って評価値を得る　かつ　フラグを立てる　(valueDetect = true)
<span class='line'>1370</span> それ以外はセルエントリーを評価値とする
<span class='line'>1371</span>     xMapで評価値をエントリ検索
<span class='line'>1372</span>     マップエントリがない場合でかつ　valueDetect == true なら　エントリを作成してそれを値として使用
<span class='line'>1373</span>     エントリがあれば valueDetect = true なければ false
<span class='line'>1374</span> valueDetect==true
<span class='line'>1375</span>     カレントセクションが中間値補間セクションだった場合はカレントセクションをクロースして検出した値をもつ値セクションを初期化する
<span class='line'>1376</span>     カレントセクションの値が未設定の場合、カレントセクションの値を設定
<span class='line'>1377</span>     カレントセクションに値がある場合は新規の値セクションを初期化
<span class='line'>1378</span> valueDetect==false
<span class='line'>1379</span>     エントリがない場合は中間値指定ノードとなる
<span class='line'>1380</span>     カレントセクションが中間値補間セクションだった場合は新規に副補間区間を初期化
<span class='line'>1381</span>     値区間だった場合は新規に中間値補間セクションを初期化して第一副補間区間を初期化する
<span class='line'>1382</span>     トラック内無効記述（コメント）は現在許可されない。
<span class='line'>1383</span> */</span><span class="WHIT">
<span class='line'>1384</span> </span><span class="WHIT">    </span><span class="NAME">valueDetect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1385</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^\[([^\]])\]$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1386</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">checkValue</span><span class="PUNC">=</span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1387</span> </span><span class="WHIT">        </span><span class="NAME">valueDetect</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1388</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1389</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">checkValue</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1390</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1391</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.xParent.parentXps.xMap.getElementByName</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">this.id</span><span class="PUNC">,</span><span class="NAME">checkValue</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">'-'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//グループIDを加える</span><span class="WHIT">
<span class='line'>1392</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">currentElement</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">valueDetect</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1393</span> </span><span class="WHIT">       </span><span class="NAME">currentElement</span><span class="PUNC">=</span><span class="NAME">this.xParent.parentXps.xMap.new_xMapElement</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>1394</span> </span><span class="WHIT">            </span><span class="NAME">checkValue</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1395</span> </span><span class="WHIT">            </span><span class="STRN">'geometry'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1396</span> </span><span class="WHIT">            </span><span class="NAME">this.xParent.parentXps.currentJob</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1397</span> </span><span class="WHIT">            </span><span class="PUNC">[</span><span class="NAME">this.id</span><span class="PUNC">,</span><span class="NAME">checkValue</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">'-'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1398</span> </span><span class="WHIT">        </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1399</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1400</span> </span><span class="WHIT">        </span><span class="NAME">valueDetect</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">currentElement</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="KEYW">true</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1401</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1402</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentElement</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1403</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentNodeSign</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1404</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.duration</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="COMM">//閉鎖ノード無しで前セクションを閉じるので加算したdurationをキャンセル</span><span class="WHIT">
<span class='line'>1405</span> </span><span class="WHIT">                    </span><span class="NAME">currentNodeSign</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="COMM">//補間区間終了ノードクリア</span><span class="WHIT">
<span class='line'>1406</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="NAME">currentElement</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//新規セクション追加</span><span class="WHIT">
<span class='line'>1407</span> </span><span class="WHIT">                    </span><span class="NAME">currentSubSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1408</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1409</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentSection.value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1410</span> </span><span class="WHIT">                        </span><span class="NAME">currentSection.duration</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="COMM">//閉鎖ノード無しで前セクションを閉じるので加算したdurationをキャンセル</span><span class="WHIT">
<span class='line'>1411</span> </span><span class="WHIT">                        </span><span class="NAME">currentSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="NAME">currentElement</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//新規セクション追加</span><span class="WHIT">
<span class='line'>1412</span> </span><span class="WHIT">                        </span><span class="NAME">currentSubSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1413</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1414</span> </span><span class="WHIT">                        </span><span class="NAME">currentSection.value</span><span class="PUNC">=</span><span class="NAME">currentElement.content</span><span class="PUNC">;</span><span class="COMM">//値を遅延設定</span><span class="WHIT">
<span class='line'>1415</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1416</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">               </span><span class="WHIT">
<span class='line'>1417</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentNodeSign</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1418</span> </span><span class="COMM">//               console.log("fix:"+fix);</span><span class="WHIT">
<span class='line'>1419</span> </span><span class="TOKN">　</span><span class="TOKN">　</span><span class="TOKN">　</span><span class="WHIT">         </span><span class="NAME">currentSubSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentSection.subSections.addSection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1420</span> </span><span class="TOKN">　</span><span class="TOKN">　</span><span class="TOKN">　</span><span class="WHIT">         </span><span class="NAME">currentSubSection.duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1421</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1422</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1423</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1424</span> </span><span class="WHIT">    </span><span class="NAME">this.sections</span><span class="PUNC">=</span><span class="NAME">myCollection</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1425</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.sections</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1426</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1427</span> 
<span class='line'>1428</span> </span><span class="COMM">/**
<span class='line'>1429</span>  *  コンポジットタイムラインの（区間）値
<span class='line'>1430</span>  *  エフェクト
<span class='line'>1431</span>  要素名は、可能な限り[name]角括弧で囲む 囲まれていた場合括弧は払って記録する
<span class='line'>1432</span> 要素名が数値　または　　%つき数値であった場合は strength の値として使用する
<span class='line'>1433</span> 1.0                 基数1 浮動小数点値
<span class='line'>1434</span> 100%    100/100     100分率値
<span class='line'>1435</span> 1000‰  1000/1000   1000分率値
<span class='line'>1436</span> 
<span class='line'>1437</span> 要素名が指定されない場合は、[START],[01],[02]…[END]を自動で割り付ける
<span class='line'>1438</span> 
<span class='line'>1439</span> 例
<span class='line'>1440</span> [WXP    composite   50%]
<span class='line'>1441</span> WXP [75%]   
<span class='line'>1442</span> 
<span class='line'>1443</span> 
<span class='line'>1444</span>  */</span><span class="WHIT">
<span class='line'>1445</span> </span><span class="NAME">nas.AnimationComposite</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myParent</span><span class="PUNC">,</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1446</span> </span><span class="WHIT">    </span><span class="NAME">this.parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myParent</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">myParent</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT">   </span><span class="PUNC">;</span><span class="COMM">//xMapElementGroup or null</span><span class="WHIT">
<span class='line'>1447</span> </span><span class="WHIT">    </span><span class="NAME">this.contentText</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">myContent</span><span class="PUNC">:</span><span class="STRN">''</span><span class="WHIT">   </span><span class="PUNC">;</span><span class="COMM">//xMapのソースを保存する　自動で再構築が行なわれるタイミングがある</span><span class="WHIT">
<span class='line'>1448</span> 
<span class='line'>1449</span> </span><span class="WHIT">    </span><span class="NAME">this.name</span><span class="WHIT">                                   </span><span class="PUNC">;</span><span class="COMM">//ｘMap素材名</span><span class="WHIT">
<span class='line'>1450</span> </span><span class="WHIT">    </span><span class="NAME">this.source</span><span class="WHIT">                                 </span><span class="PUNC">;</span><span class="COMM">//参照画像データソース　nas.AnimationElementSource</span><span class="WHIT">
<span class='line'>1451</span> </span><span class="WHIT">    </span><span class="NAME">this.comment</span><span class="PUNC">=</span><span class="STRN">""</span><span class="WHIT">                             </span><span class="PUNC">;</span><span class="COMM">//コメント文字列 xMap attribute</span><span class="WHIT">
<span class='line'>1452</span> </span><span class="WHIT">    </span><span class="NAME">this.extended</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">                       </span><span class="PUNC">;</span><span class="COMM">//拡張表示フラグ</span><span class="WHIT">
<span class='line'>1453</span> 
<span class='line'>1454</span> </span><span class="WHIT">    </span><span class="NAME">this.effect</span><span class="WHIT">                                 </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1455</span> </span><span class="WHIT">    </span><span class="NAME">this.blendingMode</span><span class="WHIT">                           </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1456</span> </span><span class="WHIT">    </span><span class="NAME">this.strength</span><span class="WHIT">                               </span><span class="PUNC">;</span><span class="COMM">// ? </span><span class="WHIT">
<span class='line'>1457</span> </span><span class="WHIT">    </span><span class="NAME">this.t</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.TimingCurve</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">              </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1458</span> </span><span class="WHIT">    </span><span class="NAME">this.c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.Curve</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">                    </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1459</span> 
<span class='line'>1460</span> </span><span class="WHIT">    </span><span class="NAME">this.parseContent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1461</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1462</span> </span><span class="COMM">/**
<span class='line'>1463</span>     中間点取得
<span class='line'>1464</span> 自身の値とターゲット値の中間の値を求める
<span class='line'>1465</span> 
<span class='line'>1466</span> 引数
<span class='line'>1467</span>     endValue        ターゲット値
<span class='line'>1468</span>     indexCount      
<span class='line'>1469</span>     indexOffset
<span class='line'>1470</span>     frameCount
<span class='line'>1471</span>     frameOffset
<span class='line'>1472</span>     props    
<span class='line'>1473</span> */</span><span class="WHIT">
<span class='line'>1474</span> </span><span class="NAME">nas.AnimationComposite.prototype.interpolate</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">endValue</span><span class="PUNC">,</span><span class="NAME">indexCount</span><span class="PUNC">,</span><span class="NAME">indexOffset</span><span class="PUNC">,</span><span class="NAME">frameCount</span><span class="PUNC">,</span><span class="NAME">frameOffset</span><span class="PUNC">,</span><span class="NAME">props</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1475</span> </span><span class="WHIT">    </span><span class="NAME">myResult</span><span class="PUNC">=</span><span class="NAME">Object.create</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1476</span> </span><span class="WHIT">    </span><span class="NAME">myResult.strength</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.strength</span><span class="PUNC">+</span><span class="NAME">endValue.strength</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">indexCount</span><span class="PUNC">/</span><span class="NAME">indexCount</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">// 仮値リニア補間</span><span class="WHIT">
<span class='line'>1477</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="COMM">//コンポジットタイムラインの中間値は濃度値のみ</span><span class="WHIT">
<span class='line'>1478</span> 
<span class='line'>1479</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1480</span> </span><span class="COMM">/**
<span class='line'>1481</span>     xMapデータのために文字列化して返す　予定だが
<span class='line'>1482</span>     今はダミー
<span class='line'>1483</span> */</span><span class="WHIT">
<span class='line'>1484</span> </span><span class="NAME">nas.AnimationComposite.prototype.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">exportForm</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1485</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.contentText</span><span class="PUNC">;</span><span class="COMM">//動作確認用ダミー行</span><span class="WHIT">
<span class='line'>1486</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1487</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">props</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="STRN">'effect'</span><span class="PUNC">,</span><span class="STRN">'blendingMode'</span><span class="PUNC">,</span><span class="STRN">'strength'</span><span class="PUNC">,</span><span class="STRN">'t'</span><span class="PUNC">,</span><span class="STRN">'c'</span><span class="PUNC">,</span><span class="STRN">'comment'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1488</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1489</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pid</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">pid</span><span class="PUNC">&lt;</span><span class="NAME">props.length</span><span class="PUNC">;</span><span class="NAME">pid</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1490</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">props</span><span class="PUNC">[</span><span class="NAME">pid</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1491</span> </span><span class="WHIT">            </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'\t'</span><span class="PUNC">+</span><span class="NAME">props</span><span class="PUNC">[</span><span class="NAME">pid</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">' = '</span><span class="PUNC">+</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">props</span><span class="PUNC">[</span><span class="NAME">pid</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>1492</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1493</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1494</span> 
<span class='line'>1495</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">exportForm</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'extend'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1496</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resultArray</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1497</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.source</span><span class="PUNC">)</span><span class="WHIT">         </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="STRN">'\tfile = "'</span><span class="WHIT">    </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.source.toString</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">'"'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1498</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.effect</span><span class="PUNC">)</span><span class="WHIT">         </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="STRN">'\teffect = '</span><span class="WHIT">     </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.effect</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1499</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.blendingMode</span><span class="PUNC">)</span><span class="WHIT">   </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="STRN">'\tblendingMode = '</span><span class="WHIT">   </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.blendingMode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1500</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.strength</span><span class="PUNC">)</span><span class="WHIT">       </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="STRN">'\tstrength = '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.strength</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1501</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.t</span><span class="PUNC">)</span><span class="WHIT">              </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="STRN">'\tT = '</span><span class="WHIT">  </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.t.toString</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1502</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.c</span><span class="PUNC">)</span><span class="WHIT">              </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="STRN">'\tC = '</span><span class="WHIT">  </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.c.toString</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1503</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.comment</span><span class="PUNC">)</span><span class="WHIT">        </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="STRN">'\tcomment = '</span><span class="WHIT">  </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.comment</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1504</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">resultArray.join</span><span class="PUNC">(</span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1505</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">exportForm</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'basic'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1506</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resultArray</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1507</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1508</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.source</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1509</span> </span><span class="WHIT">            </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="STRN">'"'</span><span class="PUNC">+</span><span class="NAME">this.source.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">'"'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1510</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1511</span> </span><span class="WHIT">            </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1512</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1513</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.size</span><span class="PUNC">)</span><span class="WHIT">     </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="NAME">this.size.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1514</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.offset</span><span class="PUNC">)</span><span class="WHIT">   </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="NAME">this.offset.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1515</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.rotation</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="NAME">this.rotation.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1516</span> </span><span class="WHIT">        </span><span class="NAME">resultArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">resultArray.join</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1517</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.comment</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="NAME">this.comment</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1518</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">this.parent.name</span><span class="PUNC">,</span><span class="NAME">this.name</span><span class="PUNC">,</span><span class="NAME">resultArray.join</span><span class="PUNC">(</span><span class="STRN">"\t"</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">'\t'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1519</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1520</span> 
<span class='line'>1521</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1522</span> </span><span class="COMM">/**
<span class='line'>1523</span>     コンテンツを与えてパースする
<span class='line'>1524</span>     引数がない場合は自身のコンテンツデータを再パースする
<span class='line'>1525</span> [FI COMPOSITE]
<span class='line'>1526</span> FI  100%    
<span class='line'>1527</span> 
<span class='line'>1528</span> */</span><span class="WHIT">
<span class='line'>1529</span> </span><span class="NAME">nas.AnimationComposite.prototype.parseContent</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1530</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1531</span> </span><span class="WHIT">        </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.contentText</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1532</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1533</span> </span><span class="WHIT">    </span><span class="NAME">this.contentText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1534</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1535</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1536</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1537</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1538</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1539</span> </span><span class="WHIT">    </span><span class="NAME">this.contentText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1540</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1541</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1542</span> </span><span class="NAME">nas.AnimationComposite.prototype.getStream</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1543</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1544</span> </span><span class="WHIT">    </span><span class="NAME">myResult</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1545</span> 
<span class='line'>1546</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myResult.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">6</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="NAME">myResult</span><span class="PUNC">[</span><span class="NAME">myResult.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.name</span><span class="WHIT">
<span class='line'>1547</span> 
<span class='line'>1548</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1549</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1550</span> </span><span class="COMM">/**
<span class='line'>1551</span>     コンポジットトラックをパースしてセクションコレクションを返す
<span class='line'>1552</span>     option:(effect|sfx|composite)
<span class='line'>1553</span>     セクションの状態は
<span class='line'>1554</span>     値：
<span class='line'>1555</span>         あり>有値セクション
<span class='line'>1556</span>             何らかの値オブジェクトを持つ値セクション　この継続時間中トラックの持つ値は変化しない最短で１フレーム
<span class='line'>1557</span>         なし>中間値補間セクション
<span class='line'>1558</span>             valueプロパティが空で値オブジェクトを持たない
<span class='line'>1559</span>             中間値補間サブセクションコレクションを持つ
<span class='line'>1560</span>     compositeタイムライントラックセクションの開始、終了判定
<span class='line'>1561</span>     セクションは「値区間(セクション)」と「中間値補間区間(セクション)」の２種に分類される
<span class='line'>1562</span>     中間値セクションは必ず前後に値セクションを持つ
<span class='line'>1563</span>     値区間は連続することが可能
<span class='line'>1564</span>     値区間は最低でも１フレームの継続時間を持ち、そのトラックの返す値を保持する
<span class='line'>1565</span>     補間区間は、値オブジェクトを持たず、サブセクションコレクションを持ち　前後の値区間の中間値を補間して戻す
<span class='line'>1566</span>     補間区間は補間区間開始セパレータで開始され終了セパレータで閉じる
<span class='line'>1567</span>     入力としては開始セパレータと終了セパレータが同一のエントリを対で使用することが求められる
<span class='line'>1568</span>     開始セパレータで宣言された補間区間は、明示的に開始セパレータと対の終了セパレータで閉じられるか又は
<span class='line'>1569</span>     後続の値エントリを宣言して値区間を開始されくまでの間継続される
<span class='line'>1570</span>     補間区間はその区間が閉じられるまでの間　すべての空白以外のエントリが副補間区間を開始する。
<span class='line'>1571</span>     補間区間中すべてのエントリが空白であった場合に限り、空白区間がすべて副補間区間のエントリとなる
<span class='line'>1572</span>     （＝補間区間に何も間に置かなかったトラックは１コマ撮りの補間区間となる）
<span class='line'>1573</span> */</span><span class="WHIT">
<span class='line'>1574</span> </span><span class="NAME">_parseCompositeTrack</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1575</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myCollection</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XpsTimelineSectionCollection</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//自分自身を親としてセクションコレクションを新作</span><span class="WHIT">
<span class='line'>1576</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentSection</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//開始セクションを作成　継続時間０　値は保留</span><span class="WHIT">
<span class='line'>1577</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentSubSection</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="COMM">//操作サブセクションへの参照　値はカラ 処理中は操作対象オブジェクトへの参照</span><span class="WHIT">
<span class='line'>1578</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentComposite</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationComposite</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//コンテンツはカラで初期化も保留</span><span class="WHIT">
<span class='line'>1579</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentNodeSign</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="COMM">//否で初期化(確認用)</span><span class="WHIT">
<span class='line'>1580</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">valueDetect</span><span class="WHIT">        </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="COMM">//否で初期化(確認用)</span><span class="WHIT">
<span class='line'>1581</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1582</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fix</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">fix</span><span class="PUNC">&lt;</span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="NAME">fix</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1583</span> </span><span class="WHIT">        </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="PUNC">;</span><span class="COMM">//currentセクションの継続長を加算</span><span class="WHIT">
<span class='line'>1584</span> </span><span class="WHIT">        </span><span class="COMM">//未記入データ　これが一番多いので最初に処理しておく</span><span class="WHIT">
<span class='line'>1585</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1586</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1587</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1588</span> </span><span class="WHIT">        </span><span class="COMM">//区間の値</span><span class="WHIT">
<span class='line'>1589</span> </span><span class="WHIT">        </span><span class="COMM">//中間値補間セクション開始セパレータ(対で処理する方)</span><span class="WHIT">
<span class='line'>1590</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1591</span> </span><span class="COMM">/** この正規表現は仮でハードコーディング　あとで設定ファイルからの反映に変更予定*/</span><span class="WHIT">
<span class='line'>1592</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^[▼▲▽△●○◎◆◇☆★]$|^\][^\]]+\[$|^\)[^\(]+\($/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1593</span> </span><span class="COMM">/**
<span class='line'>1594</span>     ノードサイン検出
<span class='line'>1595</span> 第一区間が補間区間であった場合、トラックのデフォルト値を先行区間の値とする。
<span class='line'>1596</span> 第一区間は、値区間　補間区間のいずれでも良いので初期区間の値は保留されている
<span class='line'>1597</span> currentNodeSignがfalseであった場合はセクション開始
<span class='line'>1598</span> それ以外の場合、補間区間のエントリ中でのサイン検出
<span class='line'>1599</span> 検出したサインがカレントノードサインと一致していたら補間区間終了それ以外は副補間区間のエントリ初期化
<span class='line'>1600</span> セクションノードサイン
<span class='line'>1601</span> 予約語
<span class='line'>1602</span>     /^[▼▲▽△●○◎◆◇☆★]$|^\][^\]+]\[$|^\)[^\(+]\($/
<span class='line'>1603</span>     特殊ノードとして中間値補間区間を開き、同じサインで当該の区間を閉じる
<span class='line'>1604</span>     予約語以外の中間値指定ノードには閉鎖機能がない
<span class='line'>1605</span>     値指定ノード以外は基本的にすべて中間値指定ノードとする
<span class='line'>1606</span>     空白エントリ・予約語以外の記述は値を指定するノードか否かを判定する。
<span class='line'>1607</span>     明示的に値を生成するノードを切り分け　残るエントリはｘMapに問い合わせを行い値を持たないエントリを中間値発生ノードとして扱う
<span class='line'>1608</span> */</span><span class="WHIT">
<span class='line'>1609</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentNodeSign</span><span class="PUNC">==</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1610</span> </span><span class="WHIT">                </span><span class="NAME">currentNodeSign</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="COMM">//予約語で開いたのでノードを控える</span><span class="WHIT">
<span class='line'>1611</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">fix</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1612</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.subSections</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XpsTimelineSectionCollection</span><span class="PUNC">(</span><span class="NAME">currentSection</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//第一フレームだった場合のみ第一セクションを補間区間に変換</span><span class="WHIT">
<span class='line'>1613</span> </span><span class="WHIT">                    </span><span class="NAME">currentSubSection</span><span class="PUNC">=</span><span class="NAME">currentSection.subSections.addSection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//同時に第一サブセクションを初期化</span><span class="WHIT">
<span class='line'>1614</span> </span><span class="WHIT">                    </span><span class="NAME">currentSubSection.duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1615</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1616</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1617</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="STRN">"interpolation"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//それ以外は新規補間セクション追加</span><span class="WHIT">
<span class='line'>1618</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1619</span> </span><span class="WHIT">                    </span><span class="NAME">currentSubSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentSection.subSections.addSection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1620</span> </span><span class="WHIT">                    </span><span class="NAME">currentSubSection.duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1621</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1622</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.subSections.addSection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//オープンと同時に第一サブセクションを初期化</span><span class="WHIT">
<span class='line'>1623</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentNodeSign</span><span class="PUNC">==</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1624</span> </span><span class="WHIT">                </span><span class="COMM">//開始ノードと一致</span><span class="WHIT">
<span class='line'>1625</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NAME">currentSection.subSections.length</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1626</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.subSections.addSection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//割り切れない場合サブセクションを初期化</span><span class="WHIT">
<span class='line'>1627</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1628</span> </span><span class="WHIT">                </span><span class="NAME">currentNodeSign</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="COMM">//補間区間終了ノードクリア</span><span class="WHIT">
<span class='line'>1629</span> </span><span class="WHIT">                </span><span class="NAME">currentSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// 新規セクション追加　終了ノードで閉じたので加算はなし</span><span class="WHIT">
<span class='line'>1630</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1631</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.subSections.addSection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1632</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1633</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1634</span> </span><span class="COMM">//予約ノードサイン外</span><span class="WHIT">
<span class='line'>1635</span> </span><span class="COMM">/**
<span class='line'>1636</span> valueDetect = fale;
<span class='line'>1637</span> 値指定ノード[値]を検出した場合、セルエントリーからBracketsを払って評価値を得る　かつ　フラグを立てる　(valueDetect = true)
<span class='line'>1638</span> それ以外はセルエントリーを評価値とする
<span class='line'>1639</span>     xMapで評価値をエントリ検索
<span class='line'>1640</span>     マップエントリがない場合でかつ　valueDetect == true なら　エントリを作成してそれを値として使用
<span class='line'>1641</span>     エントリがあれば valueDetect = true なければ false
<span class='line'>1642</span> valueDetect==true
<span class='line'>1643</span>     カレントセクションが中間値補間セクションだった場合はカレントセクションをクロースして検出した値をもつ値セクションを初期化する
<span class='line'>1644</span>     カレントセクションの値が未設定の場合、カレントセクションの値を設定
<span class='line'>1645</span>     カレントセクションに値がある場合は新規の値セクションを初期化
<span class='line'>1646</span> valueDetect==false
<span class='line'>1647</span>     エントリがない場合は中間値指定ノードとなる
<span class='line'>1648</span>     カレントセクションが中間値補間セクションだった場合は新規に副補間区間を初期化
<span class='line'>1649</span>     値区間だった場合は新規に中間値補間セクションを初期化して第一副補間区間を初期化する
<span class='line'>1650</span>     トラック内無効記述（コメント）は現在許可されない。
<span class='line'>1651</span> */</span><span class="WHIT">
<span class='line'>1652</span> </span><span class="WHIT">    </span><span class="NAME">valueDetect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1653</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^\[([^\]]+)\]$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1654</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">checkValue</span><span class="PUNC">=</span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1655</span> </span><span class="WHIT">        </span><span class="NAME">valueDetect</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1656</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1657</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">checkValue</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1658</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1659</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentEntry</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.xParent.parentXps.xMap.getElementByName</span><span class="PUNC">(</span><span class="NAME">checkValue</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1660</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">currentEntry</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">valueDetect</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1661</span> </span><span class="WHIT">        </span><span class="COMM">//new_MapElement(name,Object xMapGroup,Object Job)</span><span class="WHIT">
<span class='line'>1662</span> </span><span class="COMM">//        currentEntry=xMap.new_xMapElement(checkValue,MAP.getElementByName(this.id),this.xParent.parentXps.currentJob);</span><span class="WHIT">
<span class='line'>1663</span> </span><span class="WHIT">        </span><span class="NAME">currentEntry</span><span class="PUNC">=</span><span class="NAME">checkValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1664</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1665</span> </span><span class="WHIT">        </span><span class="NAME">valueDetect</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">currentEntry</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="KEYW">true</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1666</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1667</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentEntry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1668</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentNodeSign</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1669</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection.duration</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="COMM">//閉鎖ノード無しで前セクションを閉じるので加算したdurationをキャンセル</span><span class="WHIT">
<span class='line'>1670</span> </span><span class="WHIT">                    </span><span class="NAME">currentNodeSign</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="COMM">//補間区間終了ノードクリア</span><span class="WHIT">
<span class='line'>1671</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="NAME">currentEntry</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//新規セクション追加</span><span class="WHIT">
<span class='line'>1672</span> </span><span class="WHIT">                    </span><span class="NAME">currentSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationComposite</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">currentEntry</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//新規セクション追加</span><span class="WHIT">
<span class='line'>1673</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1674</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentSection.value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1675</span> </span><span class="WHIT">                        </span><span class="NAME">currentSection.duration</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="COMM">//閉鎖ノード無しで前セクションを閉じるので加算したdurationをキャンセル</span><span class="WHIT">
<span class='line'>1676</span> </span><span class="WHIT">                        </span><span class="NAME">currentSection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="NAME">currentEntry</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//新規セクション追加</span><span class="WHIT">
<span class='line'>1677</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1678</span> </span><span class="WHIT">                        </span><span class="NAME">currentSection.value</span><span class="PUNC">=</span><span class="NAME">currentEntry</span><span class="PUNC">;</span><span class="COMM">//値を遅延設定</span><span class="WHIT">
<span class='line'>1679</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1680</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">               </span><span class="WHIT">
<span class='line'>1681</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentNodeSign</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1682</span> </span><span class="TOKN">　</span><span class="TOKN">　</span><span class="TOKN">　</span><span class="WHIT">         </span><span class="NAME">currentSubSection</span><span class="PUNC">=</span><span class="NAME">currentSection.subSections.addSection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1683</span> </span><span class="TOKN">　</span><span class="TOKN">　</span><span class="TOKN">　</span><span class="WHIT">         </span><span class="NAME">currentSubSection.duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1684</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1685</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1686</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1687</span> </span><span class="WHIT">    </span><span class="NAME">this.sections</span><span class="PUNC">=</span><span class="NAME">myCollection</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1688</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.sections</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1689</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1690</span> 
<span class='line'>1691</span> </span><span class="COMM">/*
<span class='line'>1692</span> 簡易オブジェクトで実装
<span class='line'>1693</span> エレメントのラップもしない
<span class='line'>1694</span> 
<span class='line'>1695</span> nas.AnimationDialog Object
<span class='line'>1696</span> 　同名のオブジェクトとの互換はあまり考えない
<span class='line'>1697</span> 　名前が同じだけと思うが吉
<span class='line'>1698</span> 　タイムシートサウンドトラックの値となる
<span class='line'>1699</span> 　外部ファイルリンクはこの際割愛
<span class='line'>1700</span> 
<span class='line'>1701</span>     現在のプロパティ
<span class='line'>1702</span>     Property
<span class='line'>1703</span> 
<span class='line'>1704</span>     getStream(cellCount);
<span class='line'>1705</span> タイムシート用のストリームを配列で返す（内部利用メソッド）
<span class='line'>1706</span> 引数のカウントはデータを配置するオブジェクト継続フレーム数　０〜
<span class='line'>1707</span> （値は継続時間を持たない）
<span class='line'>1708</span> 引数０の際はラベルとセパレータ分の配列を返す
<span class='line'>1709</span> 
<span class='line'>1710</span>     toString(cellCount);
<span class='line'>1711</span> 引数のカウントに従ってタイムシート上での利用のためcsvストリームで戻す
<span class='line'>1712</span> それ以外の場合はコンテントテクストを戻す（メソッド）
<span class='line'>1713</span> 
<span class='line'>1714</span>     contentText;    String
<span class='line'>1715</span> 内容テキスト原文　"たぬきさん(off)「ぽん！(SE:ポン)ぽこ！&lt;BGM:開始>りん！[光る！]」"
<span class='line'>1716</span>     name;    String
<span class='line'>1717</span> ラベルとなる名称    "たぬきさん"
<span class='line'>1718</span> 
<span class='line'>1719</span>     bodyText;    String
<span class='line'>1720</span> 台詞本体のテキスト　"ぽん！ぽこ！りん！"
<span class='line'>1721</span> 
<span class='line'>1722</span>     attributes;    Array
<span class='line'>1723</span> オブジェクト属性の配列 ["(off)"] 
<span class='line'>1724</span> 
<span class='line'>1725</span>     comments;    Array
<span class='line'>1726</span> ノートコメントコレクション配列 [[3,"(SE:ポン)"],[6,"&lt;BGM:開始>"],[9,"[光る！]"]]
<span class='line'>1727</span> コメントのインデックスはbodyText内の挿入点　シート展開時は、bodyText.length+comments.length のフレームを再配置する
<span class='line'>1728</span> */</span><span class="WHIT">
<span class='line'>1729</span> </span><span class="NAME">nas.AnimationDialog</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myParent</span><span class="PUNC">,</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1730</span> </span><span class="WHIT">    </span><span class="NAME">this.parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myParent</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">myParent</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT">   </span><span class="PUNC">;</span><span class="COMM">//xMapElementGroup or null</span><span class="WHIT">
<span class='line'>1731</span> </span><span class="WHIT">    </span><span class="NAME">this.contentText</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">;</span><span class="COMM">//xMapのソーステキストを保存する　自動で再構築が行なわれるタイミングがある</span><span class="WHIT">
<span class='line'>1732</span> 
<span class='line'>1733</span> </span><span class="WHIT">    </span><span class="NAME">this.name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="STRN">''</span><span class="WHIT">                               </span><span class="PUNC">;</span><span class="COMM">//xMap素材名（=話者の名称　＊重複あり　＊空白あり）</span><span class="WHIT">
<span class='line'>1734</span> </span><span class="WHIT">    </span><span class="NAME">this.file</span><span class="WHIT">                                   </span><span class="PUNC">;</span><span class="COMM">//nas.AnimationElementSource</span><span class="WHIT">
<span class='line'>1735</span> </span><span class="WHIT">    </span><span class="NAME">this.comment</span><span class="WHIT">                                </span><span class="PUNC">;</span><span class="COMM">//</span><span class="WHIT">
<span class='line'>1736</span> </span><span class="WHIT">    </span><span class="NAME">this.extended</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT">                        </span><span class="PUNC">;</span><span class="COMM">//必ずtrue</span><span class="WHIT">
<span class='line'>1737</span> 
<span class='line'>1738</span> </span><span class="WHIT">    </span><span class="NAME">this.bodyText</span><span class="PUNC">=</span><span class="STRN">""</span><span class="WHIT">                            </span><span class="PUNC">;</span><span class="COMM">//セリフ等の本体コメント</span><span class="WHIT">
<span class='line'>1739</span> </span><span class="WHIT">    </span><span class="NAME">this.attributes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="WHIT">                         </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1740</span> </span><span class="WHIT">    </span><span class="NAME">this.comments</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="WHIT">                         </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1741</span> </span><span class="WHIT">    </span><span class="NAME">this.isDialog</span><span class="WHIT">                               </span><span class="PUNC">;</span><span class="COMM">//ダイアログセクショングフラグ</span><span class="WHIT">
<span class='line'>1742</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1743</span> </span><span class="WHIT">    </span><span class="NAME">this.parseContent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">                         </span><span class="PUNC">;</span><span class="COMM">//作成時に一回パースする</span><span class="WHIT">
<span class='line'>1744</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1745</span> </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>1746</span> </span><span class="COMM">/*
<span class='line'>1747</span>     初期化時の内容テキスト（シナリオ型式）をパースしてオブジェクト化するメソッド
<span class='line'>1748</span>     本来は自動実行だが、今回は必要に従ってコールする
<span class='line'>1749</span>     "ダブルクォーテーション",'シングルクォーテーション',「かぎかっこ」で囲まれた文字列はダイアログとして処理する
<span class='line'>1750</span>     それ以外はサウンドノード
<span class='line'>1751</span>     
<span class='line'>1752</span> */</span><span class="WHIT">
<span class='line'>1753</span> </span><span class="NAME">nas.AnimationDialog.prototype.parseContent</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1754</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.contentText</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1755</span> </span><span class="COMM">//xMapパーサからのグループエントリーデータなのでコンテンツをクリアして終了</span><span class="WHIT">
<span class='line'>1756</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myContent.indexOf</span><span class="PUNC">(</span><span class="STRN">'['</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1757</span> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'detect GroupEntry :'</span><span class="PUNC">+</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1758</span> </span><span class="WHIT">        </span><span class="NAME">this.contentText</span><span class="PUNC">=</span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1759</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1760</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1761</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.parent</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>1762</span> </span><span class="WHIT">        </span><span class="PUNC">(</span><span class="NAME">myContent.indexOf</span><span class="PUNC">(</span><span class="NAME">this.parent.name</span><span class="PUNC">+</span><span class="STRN">'\t'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>1763</span> </span><span class="WHIT">        </span><span class="PUNC">(</span><span class="NAME">myContent.match</span><span class="PUNC">(</span><span class="REGX">/^[\S]+\t[\S]+/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1764</span> </span><span class="WHIT">    </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1765</span> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'XXXXXXX entry :'</span><span class="PUNC">+</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1766</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myContents</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myContent.split</span><span class="PUNC">(</span><span class="STRN">'\n'</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">'\t'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1767</span> </span><span class="COMM">//xMapパーサからのエントリ登録データなのでコンテンツを初期化</span><span class="WHIT">
<span class='line'>1768</span> </span><span class="COMM">//第三エントリが存在した場合source propertyを設定する</span><span class="WHIT">
<span class='line'>1769</span> </span><span class="WHIT">        </span><span class="NAME">this.name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myContents</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1770</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myContents.length</span><span class="PUNC">></span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.file</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationElementSource</span><span class="PUNC">(</span><span class="NAME">myContents.slice</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">' '</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1771</span> </span><span class="WHIT">        </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myContent.split</span><span class="PUNC">(</span><span class="STRN">'\n'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">splice</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">'\n'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1772</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1773</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myContent.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1774</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1775</span> </span><span class="COMM">//        if(myContent.match(/^([^"'「]*)["'「]([^"'」]*)["'」]?\s$/) ) {};//"</span><span class="WHIT">
<span class='line'>1776</span> </span><span class="COMM">//        if(myContent.match(/^([^「]*)「([^」]*)」?\s$/) ) {}</span><span class="WHIT">
<span class='line'>1777</span> </span><span class="COMM">//        if(myContent.match(/^([^「]*)「(.*)/)){}</span><span class="WHIT">
<span class='line'>1778</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myContent.match</span><span class="PUNC">(</span><span class="REGX">/^([^「"']*)[「"']([^」"']*)/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1779</span> </span><span class="WHIT">            </span><span class="NAME">this.name</span><span class="PUNC">=</span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1780</span> </span><span class="WHIT">            </span><span class="NAME">this.bodyText</span><span class="PUNC">=</span><span class="NAME">RegExp.$2.replace</span><span class="PUNC">(</span><span class="REGX">/」\s*$/</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1781</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1782</span> </span><span class="WHIT">            </span><span class="NAME">this.name</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1783</span> </span><span class="WHIT">            </span><span class="NAME">this.bodyText</span><span class="PUNC">=</span><span class="NAME">myContent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1784</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1785</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myAttributes</span><span class="PUNC">=</span><span class="NAME">nas.normalizeStr</span><span class="PUNC">(</span><span class="NAME">this.name</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/\(([^)]+)\)/g</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1786</span> </span><span class="COMM">//        var myAttributes=this.name.match(/\(([^)]+)\)/g);</span><span class="WHIT">
<span class='line'>1787</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myAttributes</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1788</span> </span><span class="WHIT">            </span><span class="NAME">this.attributes</span><span class="PUNC">=</span><span class="NAME">myAttributes</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1789</span> </span><span class="WHIT">            </span><span class="NAME">this.name</span><span class="PUNC">=</span><span class="NAME">this.name.slice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">nas.normalizeStr</span><span class="PUNC">(</span><span class="NAME">this.name</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="STRN">'('</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1790</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1791</span> </span><span class="WHIT">        </span><span class="COMM">//                    本文内からコメントを抽出</span><span class="WHIT">
<span class='line'>1792</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myComments</span><span class="PUNC">=</span><span class="NAME">this.bodyText.match</span><span class="PUNC">(</span><span class="REGX">/(&lt;[^&lt;>]+>|\[[^\[\]]+\]|\([^\(\)]+\))|＜[^＜]+＞|〈[^〈]+〉|（[^（]+）|［[^［]+］/g</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1793</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myComments</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1794</span> </span><span class="WHIT">            </span><span class="NAME">this.comments</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="COMM">//newArray　再初期化</span><span class="WHIT">
<span class='line'>1795</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myString</span><span class="PUNC">=</span><span class="NAME">this.bodyText</span><span class="PUNC">;</span><span class="COMM">//修正テキスト</span><span class="WHIT">
<span class='line'>1796</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">prevIndex</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">noteOffset</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1797</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cix</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">cix</span><span class="PUNC">&lt;</span><span class="NAME">myComments.length</span><span class="PUNC">;</span><span class="NAME">cix</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1798</span> </span><span class="WHIT">                </span><span class="NAME">noteOffset</span><span class="PUNC">=</span><span class="NAME">myString.indexOf</span><span class="PUNC">(</span><span class="NAME">myComments</span><span class="PUNC">[</span><span class="NAME">cix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//修正テキスト内コメント挿入位置</span><span class="WHIT">
<span class='line'>1799</span> </span><span class="WHIT">                </span><span class="NAME">this.comments.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">prevIndex</span><span class="PUNC">+</span><span class="NAME">noteOffset</span><span class="PUNC">,</span><span class="NAME">myComments</span><span class="PUNC">[</span><span class="NAME">cix</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1800</span> </span><span class="WHIT">                </span><span class="NAME">prevIndex</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">noteOffset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1801</span> </span><span class="WHIT">                </span><span class="NAME">myString</span><span class="PUNC">=</span><span class="NAME">myString.slice</span><span class="PUNC">(</span><span class="NAME">noteOffset</span><span class="PUNC">+</span><span class="NAME">myComments</span><span class="PUNC">[</span><span class="NAME">cix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1802</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1803</span> </span><span class="WHIT">            </span><span class="NAME">this.bodyText</span><span class="PUNC">=</span><span class="NAME">this.bodyText.replace</span><span class="PUNC">(</span><span class="REGX">/(&lt;[^&lt;>]+>|\[[^\[\]]+\]|\([^\(\)]+\))|＜[^＜]+＞|〈[^〈]+〉|（[^（]+）|［[^［]+］/g</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1804</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1805</span> </span><span class="WHIT">        </span><span class="NAME">this.contentText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1806</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="WHIT">
<span class='line'>1807</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1808</span> </span><span class="WHIT">    </span><span class="COMM">//内容テキストが空</span><span class="WHIT">
<span class='line'>1809</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1810</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1811</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1812</span> </span><span class="COMM">/*
<span class='line'>1813</span> toStringはプロパティを組み上げてMap記述用のテキストを返す
<span class='line'>1814</span> ダイアログの場合はシナリオ型式のテキスト
<span class='line'>1815</span> 
<span class='line'>1816</span> 引数に正の数値でセルカウントが与えられた場合は、XPS上への展開配列ストリームで戻す。
<span class='line'>1817</span> 展開配列は　getStream() メソッドで得る
<span class='line'>1818</span> getStreamメソッドに統一してオフセットつき配列で戻す方式に変更 2018.12
<span class='line'>1819</span> 
<span class='line'>1820</span> 
<span class='line'>1821</span> 
<span class='line'>1822</span> ＊各Valueの標準形式
<span class='line'>1823</span> 
<span class='line'>1824</span> toString メソッドの共通オプションとして
<span class='line'>1825</span> 引数
<span class='line'>1826</span>     basic         xMap用１行エントリ
<span class='line'>1827</span>     なし/extended シナリオ形式
<span class='line'>1828</span>     
<span class='line'>1829</span> dialogオブジェクトに関しては、標準形式と拡張形式は同じものとなるので注意
<span class='line'>1830</span> 
<span class='line'>1831</span> */</span><span class="WHIT">
<span class='line'>1832</span> </span><span class="NAME">nas.AnimationDialog.prototype.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">exportForm</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1833</span> </span><span class="COMM">//  if((isFinite(exportForm))&&(exportForm > 0)){</span><span class="WHIT">
<span class='line'>1834</span> </span><span class="COMM">//受け渡しをJSON経由にするか否かはペンディング　JSONStringの場合はString.split厳禁 </span><span class="WHIT">
<span class='line'>1835</span> </span><span class="COMM">//    return JSON.stringify(this.getStream(exportForm));</span><span class="WHIT">
<span class='line'>1836</span> </span><span class="COMM">//    return (this.getStream(exportForm)).join();</span><span class="WHIT">
<span class='line'>1837</span> </span><span class="COMM">//  }else{}</span><span class="WHIT">
<span class='line'>1838</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">exportForm</span><span class="PUNC">==</span><span class="STRN">'basic'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1839</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">this.parent.name</span><span class="PUNC">,</span><span class="NAME">this.name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1840</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.file</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="STRN">'"'</span><span class="PUNC">+</span><span class="NAME">this.file.toString</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">'"'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1841</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult.join</span><span class="PUNC">(</span><span class="STRN">'\t'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1842</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1843</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">=</span><span class="NAME">this.name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1844</span> </span><span class="WHIT">        </span><span class="NAME">myResult</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.attributes.join</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1845</span> </span><span class="WHIT">        </span><span class="NAME">myResult</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">"「"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1846</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">startPt</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1847</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.comments.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endPt</span><span class="PUNC">=</span><span class="NAME">this.comments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endPt</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1848</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cix</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">cix</span><span class="PUNC">&lt;</span><span class="NAME">this.comments.length</span><span class="PUNC">;</span><span class="NAME">cix</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1849</span> </span><span class="WHIT">            </span><span class="NAME">myResult</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.bodyText.slice</span><span class="PUNC">(</span><span class="NAME">startPt</span><span class="PUNC">,</span><span class="NAME">endPt</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">this.comments</span><span class="PUNC">[</span><span class="NAME">cix</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1850</span> </span><span class="WHIT">            </span><span class="NAME">startPt</span><span class="PUNC">=</span><span class="NAME">endPt</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1851</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">cix</span><span class="PUNC">&lt;</span><span class="NAME">this.comments.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">endPt</span><span class="PUNC">=</span><span class="NAME">this.comments</span><span class="PUNC">[</span><span class="NAME">cix</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1852</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1853</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">startPt</span><span class="PUNC">&lt;</span><span class="NAME">this.bodyText.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">myResult</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.bodyText.slice</span><span class="PUNC">(</span><span class="NAME">startPt</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1854</span> </span><span class="WHIT">        </span><span class="NAME">myResult</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">"」"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1855</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.file</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="STRN">'\tfile="'</span><span class="PUNC">+</span><span class="NAME">this.file.toString</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">'"'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1856</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myResult</span><span class="PUNC">==</span><span class="STRN">'「」'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1857</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1858</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1859</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1860</span> </span><span class="COMM">/*    test
<span class='line'>1861</span> A=new  nas.AnimationDialog("たぬきさん(off)「ぽん！(SE:ポン)ぽこ！&lt;BGM:開始>りん！[光る！]とうりゃぁー！！」");
<span class='line'>1862</span> A.parseContent();
<span class='line'>1863</span> console.log(A)
<span class='line'>1864</span> 
<span class='line'>1865</span> */</span><span class="WHIT">
<span class='line'>1866</span> </span><span class="COMM">/** 値を配列でもどす
<span class='line'>1867</span> 引数: cellCount
<span class='line'>1868</span> 戻値: セルのデータ並び配列＋オフセット量
<span class='line'>1869</span> cellCountが与えられることが前提で配列を組む
<span class='line'>1870</span> ダイアログ展開時に限り、与えられた引数に対して　前方側にname,attributes+開始セパレータ　後方側に終了セパレータ分のフレームが追加される
<span class='line'>1871</span> 引数が０でもラベルとセパレータ分のデータが戻る
<span class='line'>1872</span> ダイアログに限り指定の継続フレーム数より要素数が増える
<span class='line'>1873</span> これをstartOffsetとして配列のプロパティに追加して戻す
<span class='line'>1874</span> */</span><span class="WHIT">
<span class='line'>1875</span> </span><span class="NAME">nas.AnimationDialog.prototype.getStream</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1876</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">cellCounts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.contents.length</span><span class="PUNC">+</span><span class="NAME">this.comments.length</span><span class="PUNC">+</span><span class="NAME">this.attributes.length</span><span class="PUNC">+</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1877</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="NAME">cellCounts</span><span class="PUNC">=</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1878</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1879</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1880</span> </span><span class="COMM">//        myResult.startOffset = -(this.attributes.length + 2);//name,attributes,startSign パース時にセクションにストア</span><span class="WHIT">
<span class='line'>1881</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">this.name</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="NAME">this.name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//ラベルあれば</span><span class="WHIT">
<span class='line'>1882</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">aid</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">aid</span><span class="PUNC">&lt;</span><span class="NAME">this.attributes.length</span><span class="PUNC">;</span><span class="NAME">aid</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="NAME">this.attributes</span><span class="PUNC">[</span><span class="NAME">aid</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="COMM">//アトリビュート</span><span class="WHIT">
<span class='line'>1883</span> </span><span class="WHIT">    </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="STRN">'----'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//開始セパレータ</span><span class="WHIT">
<span class='line'>1884</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">entryCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.bodyText.length</span><span class="PUNC">+</span><span class="NAME">this.comments.length</span><span class="PUNC">;</span><span class="COMM">//テキスト文字数とコメント数を加算</span><span class="WHIT">
<span class='line'>1885</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dataCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//データカウントを０で初期化</span><span class="WHIT">
<span class='line'>1886</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">textIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//テクストインデックス</span><span class="WHIT">
<span class='line'>1887</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">commentIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//コメントインデックス</span><span class="WHIT">
<span class='line'>1888</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dataStep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cellCounts</span><span class="PUNC">/</span><span class="NAME">entryCount</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="COMM">//データステップ</span><span class="WHIT">
<span class='line'>1889</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cnt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">cnt</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">cellCounts</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">cnt</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1890</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">entryCount</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">cellCounts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">cnt</span><span class="PUNC">:</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">cnt</span><span class="PUNC">/</span><span class="NAME">dataStep</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//配置Index</span><span class="WHIT">
<span class='line'>1891</span> </span><span class="WHIT">        </span><span class="COMM">//挿入点判定</span><span class="WHIT">
<span class='line'>1892</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dataCount</span><span class="PUNC">==</span><span class="NAME">myIndex</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1893</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.comments</span><span class="PUNC">[</span><span class="NAME">commentIndex</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.comments</span><span class="PUNC">[</span><span class="NAME">commentIndex</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="NAME">textIndex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1894</span> </span><span class="WHIT">                </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="NAME">this.comments</span><span class="PUNC">[</span><span class="NAME">commentIndex</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1895</span> </span><span class="WHIT">                </span><span class="NAME">commentIndex</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1896</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1897</span> </span><span class="WHIT">                </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="NAME">this.bodyText.charAt</span><span class="PUNC">(</span><span class="NAME">textIndex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1898</span> </span><span class="WHIT">                </span><span class="NAME">textIndex</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1899</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1900</span> </span><span class="WHIT">            </span><span class="NAME">dataCount</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1901</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1902</span> </span><span class="WHIT">            </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1903</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1904</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1905</span> </span><span class="WHIT">    </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="STRN">'----'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1906</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1907</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1908</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1909</span> </span><span class="COMM">//TEST </span><span class="WHIT">
<span class='line'>1910</span> </span><span class="COMM">/*
<span class='line'>1911</span>         タイムラインをダイアログパースする
<span class='line'>1912</span>     タイムライントラックのメソッド
<span class='line'>1913</span>     引数なし
<span class='line'>1914</span>     音響開始マーカーのために、本来XPSのプロパティを確認しないといけないが、
<span class='line'>1915</span>     今回は省略
<span class='line'>1916</span>     開始マーカーは省略不可でフレーム０からしか位置できない（＝音響の開始は第１フレームから）
<span class='line'>1917</span>     後から仕様に合わせて再調整
<span class='line'>1918</span>     判定内容は
<span class='line'>1919</span>     /^[-_]{3,4}$/    開始・終了マーカー
<span class='line'>1920</span>     /^\([^\)]+\)$|^&lt;[^>]+>$|^\[[^\]]+\]$/    インラインコメント
<span class='line'>1921</span>     その他は
<span class='line'>1922</span>     ブランク中ならばラベル
<span class='line'>1923</span>     音響Object区間ならばコンテントテキストに積む　空白は無視する
<span class='line'>1924</span>     ⇒セリフ中の空白は消失するので、空白で調整をとっている台詞は不可
<span class='line'>1925</span>     オリジナルとの照合が必要な場合は本文中の空白を削除した状態で評価すること
<span class='line'>1926</span>     
<span class='line'>1927</span>     トラックの内容をパースしてセクションコレクションを構築する機能はトラック自身に持たせる
<span class='line'>1928</span>     その際、トラックの種別毎に別のパーサを呼び出すことが必要なのでその調整を行う
<span class='line'>1929</span>     
<span class='line'>1930</span>         タイムライントラックのメソッドにする
<span class='line'>1931</span>         ストリームはトラックの内容を使う
<span class='line'>1932</span>         新規にセクションコレクションを作り、正常な処理終了後に先にあるセクションコレクションを上書きする
<span class='line'>1933</span>         ＊作成中に、同じ内容のセクションはキャッシュとして使用する？
<span class='line'>1934</span>         戻り値はビルドに成功したセクション数(最低で１セクション)
<span class='line'>1935</span>         値として　無音区間の音響オブジェクト（値）を作るか又は現状のままfalse(null)等で処理するかは一考
<span class='line'>1936</span> */</span><span class="WHIT">
<span class='line'>1937</span> </span><span class="COMM">/*
<span class='line'>1938</span> _parseSoundTrack =function(){
<span class='line'>1939</span>     var myCollection = new XpsTimelineSectionCollection(this);//自分自身を親としてセクションコレクションを新作
<span class='line'>1940</span>     //この実装では開始マーカーが０フレームにしか位置できないので必ずブランクセクションが発生する
<span class='line'>1941</span>     //継続時間０で先に作成 同時にカラのサウンドObjectを生成
<span class='line'>1942</span>     var currentSection=myCollection.addSection(null);//区間値false
<span class='line'>1943</span>     var currentSound=new nas.AnimationDialog("");//第一有値区間の値　コンテンツはカラで初期化も保留
<span class='line'>1944</span>     for (var fix=0;fix&lt;this.length;fix++){
<span class='line'>1945</span>         currentSection.duration ++;//currentセクションの継続長を加算
<span class='line'>1946</span>         //未記入データ　最も多いので最初に判定しておく
<span class='line'>1947</span>         if(this[fix]=="") continue;
<span class='line'>1948</span>         //括弧でエスケープされたコメント又は属性
<span class='line'>1949</span>         if(this[fix].match(/(^\([^\)]+\)$|^&lt;[^>]+>$|^\[[^\]]+\]$)/)){
<span class='line'>1950</span>             if(currentSection.value){
<span class='line'>1951</span>                 currentSound.comments.push([currentSound.bodyText.length,RegExp.$1]);
<span class='line'>1952</span>             }else{
<span class='line'>1953</span>                 currentSound.attributes.push(RegExp.$1);
<span class='line'>1954</span>             }
<span class='line'>1955</span>             continue;
<span class='line'>1956</span>         }
<span class='line'>1957</span>         //セクションセパレータ　少ない
<span class='line'>1958</span>         if(this[fix].match(/^[-_]{3,4}$/)){
<span class='line'>1959</span>             if(currentSection.value){
<span class='line'>1960</span> //終了マーカー処理
<span class='line'>1961</span>                 currentSection.duration --;//加算した継続長をキャンセル
<span class='line'>1962</span>                 currentSection.value.contentText=currentSound.toString();//先の有値セクションをフラッシュして
<span class='line'>1963</span>                 currentSection=myCollection.addSection(null);//新規のカラセクションを作る
<span class='line'>1964</span>                 currentSection.duration ++;//キャンセル分を後方区間に加算
<span class='line'>1965</span>                 currentSound=new nas.AnimationDialog("");//サウンドを新規作成
<span class='line'>1966</span>             }else{
<span class='line'>1967</span> //開始マーカー処理
<span class='line'>1968</span> //引数をサウンドオブジェクトでなくxMapElementに変更予定
<span class='line'>1969</span> //                nas.new_MapElement(name,Object xMapGroup,Object Job);
<span class='line'>1970</span>                 currentSection=myCollection.addSection(currentSound);//新規有値セクション作成
<span class='line'>1971</span> //                currentSection.value.
<span class='line'>1972</span>             }
<span class='line'>1973</span>                         continue;
<span class='line'>1974</span>         }
<span class='line'>1975</span> //判定を全て抜けたデータは本文又はラベル　ラベルは上書きで更新
<span class='line'>1976</span> //ラベル無しの音声オブジェクトは無しのまま保存　必要に従って先行オブジェクトのラベルを引継ぐ
<span class='line'>1977</span>         if(currentSection.value){
<span class='line'>1978</span>             if(this[fix]=="|") this[fix]="ー";
<span class='line'>1979</span>             currentSound.bodyText+=this[fix];
<span class='line'>1980</span>         }else{
<span class='line'>1981</span>             currentSound.name=this[fix];
<span class='line'>1982</span>         }
<span class='line'>1983</span>     }
<span class='line'>1984</span>     this.sections=myCollection;
<span class='line'>1985</span>     return this.sections;
<span class='line'>1986</span> }
<span class='line'>1987</span> */</span><span class="WHIT">
<span class='line'>1988</span> </span><span class="NAME">_parseSoundTrack</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1989</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myCollection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XpsTimelineSectionCollection</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//自分自身を親としてセクションコレクションを新作</span><span class="WHIT">
<span class='line'>1990</span> </span><span class="WHIT">    </span><span class="COMM">//この実装では開始マーカーが０フレームにしか位置できないので必ずブランクセクションが発生する</span><span class="WHIT">
<span class='line'>1991</span> </span><span class="WHIT">    </span><span class="COMM">//継続時間０で先に作成 同時にカラのサウンドObjectを生成</span><span class="WHIT">
<span class='line'>1992</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">groupName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1993</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myGroup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.xParent.parentXps.xMap.getElementByName</span><span class="PUNC">(</span><span class="NAME">groupName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1994</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myGroup</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myGroup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.xParent.parentXps.xMap.new_xMapElement</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>1995</span> </span><span class="WHIT">        </span><span class="NAME">this.id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1996</span> </span><span class="WHIT">        </span><span class="STRN">'dialog'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1997</span> </span><span class="WHIT">        </span><span class="NAME">this.xParent.parentXps.xMap.currentJob</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1998</span> </span><span class="WHIT">        </span><span class="STRN">""</span><span class="WHIT">
<span class='line'>1999</span> </span><span class="WHIT">    </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="COMM">//nas.xMapGroup(groupName,'dialog',null);//new nas.xMapGroup(myName,myOption,myLink);</span><span class="WHIT">
<span class='line'>2000</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentSection</span><span class="PUNC">=</span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//区間値false</span><span class="WHIT">
<span class='line'>2001</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentSound</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationDialog</span><span class="PUNC">(</span><span class="NAME">myGroup</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//第一有値区間の値コンテンツはカラで初期化も保留</span><span class="WHIT">
<span class='line'>2002</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fix</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">fix</span><span class="PUNC">&lt;</span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="NAME">fix</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2003</span> </span><span class="WHIT">        </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="PUNC">;</span><span class="COMM">//currentセクションの継続長を加算</span><span class="WHIT">
<span class='line'>2004</span> </span><span class="WHIT">        </span><span class="COMM">//未記入データ最も多いので最初に判定しておく</span><span class="WHIT">
<span class='line'>2005</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2006</span> </span><span class="WHIT">        </span><span class="COMM">//括弧でエスケープされたコメント又は属性</span><span class="WHIT">
<span class='line'>2007</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/(^\([^\)]+\)$|^&lt;[^>]+>$|^\[[^\]]+\]$)/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2008</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentSection.value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2009</span> </span><span class="WHIT">                </span><span class="NAME">currentSound.comments.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">currentSound.bodyText.length</span><span class="PUNC">,</span><span class="NAME">RegExp.$1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2010</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2011</span> </span><span class="WHIT">                </span><span class="NAME">currentSound.attributes.push</span><span class="PUNC">(</span><span class="NAME">RegExp.$1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2012</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2013</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2014</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2015</span> </span><span class="WHIT">        </span><span class="COMM">//セクションセパレータ少ない</span><span class="WHIT">
<span class='line'>2016</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^[-_~^〜＿ー￣]{3,4}$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2017</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentSection.value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2018</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">--</span><span class="PUNC">;</span><span class="COMM">//加算した継続長をキャンセル</span><span class="WHIT">
<span class='line'>2019</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.value.contentText</span><span class="PUNC">=</span><span class="NAME">currentSound.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//先の有値セクションをフラッシュして</span><span class="WHIT">
<span class='line'>2020</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.tailMargin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="COMM">//-1</span><span class="WHIT">
<span class='line'>2021</span> </span><span class="WHIT">                </span><span class="NAME">currentSection</span><span class="PUNC">=</span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//新規のブランクセクションを作る</span><span class="WHIT">
<span class='line'>2022</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.headMargin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2023</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="PUNC">;</span><span class="COMM">//キャンセル分を後方区間に加算</span><span class="WHIT">
<span class='line'>2024</span> </span><span class="WHIT">                </span><span class="NAME">currentSound</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationDialog</span><span class="PUNC">(</span><span class="NAME">groupName</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//サウンドを新規作成</span><span class="WHIT">
<span class='line'>2025</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2026</span> </span><span class="COMM">//引数をサウンドオブジェクトでなくxMapElementに変更予定</span><span class="WHIT">
<span class='line'>2027</span> </span><span class="COMM">//                nas.new_MapElement(name,Object xMapGroup,Object Job);</span><span class="WHIT">
<span class='line'>2028</span> </span><span class="COMM">//console.log(currentSound.name);</span><span class="WHIT">
<span class='line'>2029</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sectionOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentSound.name</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2030</span> </span><span class="WHIT">                </span><span class="NAME">sectionOffset</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentSound.attributes.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2031</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.tailMargin</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">sectionOffset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2032</span> </span><span class="WHIT">                </span><span class="NAME">currentSection</span><span class="PUNC">=</span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="NAME">currentSound</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//新規有値セクション作成</span><span class="WHIT">
<span class='line'>2033</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.headMargin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sectionOffset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2034</span> </span><span class="COMM">//console.log('ValuedSection offset :'+ sectionOffset)</span><span class="WHIT">
<span class='line'>2035</span> </span><span class="COMM">//                currentSection.value.</span><span class="WHIT">
<span class='line'>2036</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2037</span> </span><span class="WHIT">                        </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2038</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2039</span> </span><span class="COMM">//判定を全て抜けたデータは本文又はラベルは上書きで更新</span><span class="WHIT">
<span class='line'>2040</span> </span><span class="COMM">//ラベル無しの音声オブジェクトは無しのまま保存必要に従って先行オブジェクトのラベルを引継ぐ</span><span class="WHIT">
<span class='line'>2041</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentSection.value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2042</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="STRN">"|"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="STRN">"ー"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2043</span> </span><span class="WHIT">            </span><span class="NAME">currentSound.bodyText</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2044</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2045</span> </span><span class="WHIT">            </span><span class="NAME">currentSound.name</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2046</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2047</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2048</span> </span><span class="COMM">// 最終セクションは必ずブランクセクションになるのでtailMarginを設定する</span><span class="WHIT">
<span class='line'>2049</span> </span><span class="COMM">// 最終セクションが長さ０の有値セクションになる可能性があるので注意！</span><span class="WHIT">
<span class='line'>2050</span> </span><span class="COMM">//    currentSection.tailMargin = -1;</span><span class="WHIT">
<span class='line'>2051</span> </span><span class="WHIT">    </span><span class="NAME">this.sections</span><span class="PUNC">=</span><span class="NAME">myCollection</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2052</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.sections</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2053</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2054</span> 
<span class='line'>2055</span> </span><span class="COMM">/** //test
<span class='line'>2056</span> XpsTimelineTrack.prototype.parseSoundTrack=_parseSoundTrack;
<span class='line'>2057</span> XPS.xpsTracks[0].parseSoundTrack();
<span class='line'>2058</span> XPS.xpsTracks[0].sections[1].toString();
<span class='line'>2059</span> 
<span class='line'>2060</span> XpsTimelineTrack.prototype.parseSoundTrack=_parseSoundTrack;
<span class='line'>2061</span> //XpsTimelineTrack.prototype.parseDialogTrack=_parseDialogTrack;
<span class='line'>2062</span> 
<span class='line'>2063</span> //XpsTimelineTrack.prototype.parseKeyAnimationTrack=_parsekeyAnimationTrack;
<span class='line'>2064</span> //XpsTimelineTrack.prototype.parseAnimationTrack=_parseAnimationTrack;
<span class='line'>2065</span> XpsTimelineTrack.prototype.parseReplacementTrack=_parseReplacementTrack;
<span class='line'>2066</span> 
<span class='line'>2067</span> XpsTimelineTrack.prototype.parseCameraWorkTrack=_parseCameraworkTrack;
<span class='line'>2068</span> 
<span class='line'>2069</span> XpsTimelineTrack.prototype.parseCompositeTrack=_parseCompositeTrack;//コンポジット
<span class='line'>2070</span> 
<span class='line'>2071</span> //XpsTimelineTrack.prototype.parseTrack=_parseTrack;
<span class='line'>2072</span> //XpsTimelineTrack.prototype.parseTrack=_parseTrack;
<span class='line'>2073</span> */</span><span class="WHIT">
<span class='line'>2074</span> </span><span class="COMM">/**
<span class='line'>2075</span> 
<span class='line'>2076</span>     タイムラインをパースしてセクション及びその値を求めるメソッド
<span class='line'>2077</span>     タイムライン種別ごとにパースするオブジェクトが異なるので
<span class='line'>2078</span>     各オブジェクトに特化したパーサが必要
<span class='line'>2079</span>     別々のパーサを作ってセクションパーサから呼び出して使用する
<span class='line'>2080</span>     Sound
<span class='line'>2081</span>         parseSoundTrack
<span class='line'>2082</span>         *parseDialogTrack
<span class='line'>2083</span>     Replacement
<span class='line'>2084</span>         parseKyeDrawind(補間区間あり)
<span class='line'>2085</span>         parseAnimationCell(確定タイムライン)
<span class='line'>2086</span>     Geometry
<span class='line'>2087</span>         parseCameraworkTrack
<span class='line'>2088</span>     Composite
<span class='line'>2089</span>         parseEffectTrack
<span class='line'>2090</span>     各々のパーサは、データ配列を入力としてセクションコレクションを返す
<span class='line'>2091</span>     各コレクションの要素はタイムラインセクションオブジェクト
<span class='line'>2092</span>     値はタイムライン種別ごとに異なるがセクション自体は共通オブジェクトとなる
<span class='line'>2093</span> 
<span class='line'>2094</span> XpsTimelineTrack.prototype.parseTimelineTrack = function(){
<span class='line'>2095</span>     switch(this.option){
<span class='line'>2096</span>         case "dialog":;
<span class='line'>2097</span>             return this.parseDialogTrack();
<span class='line'>2098</span>         break;
<span class='line'>2099</span>         case "sound":;
<span class='line'>2100</span>             return this.parseSoundTrack();
<span class='line'>2101</span>         break;
<span class='line'>2102</span>         case "cell":;
<span class='line'>2103</span>         case "timing":;
<span class='line'>2104</span>         case "replacement":;
<span class='line'>2105</span>             return this.parseReplacementTrack();
<span class='line'>2106</span>         break;
<span class='line'>2107</span>         case "camerawork":;
<span class='line'>2108</span>         case "camera":;
<span class='line'>2109</span>             return this.parseCameraworkTrack();
<span class='line'>2110</span>         break;
<span class='line'>2111</span>         case "effect":;
<span class='line'>2112</span>         case "sfx":;
<span class='line'>2113</span>         case "composit":;
<span class='line'>2114</span>             return this.parseCompositeTrack();
<span class='line'>2115</span>         break;
<span class='line'>2116</span>     }
<span class='line'>2117</span> }
<span class='line'>2118</span> */</span><span class="WHIT">
<span class='line'>2119</span> </span><span class="COMM">/** Xpsに対するエージェントオブジェクト
<span class='line'>2120</span>  *  
<span class='line'>2121</span>  *  XpsデータをxMapに対して登録する際の代理オブジェクト
<span class='line'>2122</span>  *
<span class='line'>2123</span>  *　
<span class='line'>2124</span>  *
<span class='line'>2125</span>  *
<span class='line'>2126</span>  *
<span class='line'>2127</span>  *
<span class='line'>2128</span>  *
<span class='line'>2129</span>  *
<span class='line'>2130</span>  */</span><span class="WHIT">
<span class='line'>2131</span> </span><span class="NAME">nas.XpsAgent</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myParent</span><span class="PUNC">,</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2132</span> </span><span class="WHIT">    </span><span class="NAME">this.parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myParent</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">myParent</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT">     </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2133</span> </span><span class="WHIT">    </span><span class="NAME">this.contentText</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">;</span><span class="COMM">//xMapのソースを保存する　自動で再構築が行なわれるタイミングがある</span><span class="WHIT">
<span class='line'>2134</span> 
<span class='line'>2135</span> </span><span class="WHIT">    </span><span class="NAME">this.name</span><span class="WHIT">                                     </span><span class="PUNC">;</span><span class="COMM">//素材名</span><span class="WHIT">
<span class='line'>2136</span> </span><span class="WHIT">    </span><span class="NAME">this.source</span><span class="WHIT">                                   </span><span class="PUNC">;</span><span class="COMM">//nas.AnimationElementSource</span><span class="WHIT">
<span class='line'>2137</span> </span><span class="WHIT">    </span><span class="NAME">this.comment</span><span class="WHIT">                                  </span><span class="PUNC">;</span><span class="COMM">//コメント文字列　エレメントの注釈プロパティ-xMap編集UIのみで確認できる</span><span class="WHIT">
<span class='line'>2138</span> </span><span class="WHIT">    </span><span class="NAME">this.extended</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2139</span> 
<span class='line'>2140</span> </span><span class="WHIT">    </span><span class="NAME">this.attributes</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2141</span> </span><span class="WHIT">    </span><span class="NAME">this.comments</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2142</span> 
<span class='line'>2143</span> </span><span class="WHIT">    </span><span class="NAME">this.parseContent</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2144</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2145</span> </span><span class="COMM">/**
<span class='line'>2146</span>     文字列化して返す
<span class='line'>2147</span> */</span><span class="WHIT">
<span class='line'>2148</span> </span><span class="NAME">nas.XpsAgent.prototype.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">exportForm</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2149</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.contentText</span><span class="PUNC">;</span><span class="COMM">//動作確認用ダミー行</span><span class="WHIT">
<span class='line'>2150</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2151</span> </span><span class="COMM">/**
<span class='line'>2152</span>     コンテンツを与えてパースする
<span class='line'>2153</span>     引数がない場合は自身のコンテンツデータを再パースする
<span class='line'>2154</span>     戻り値はオブジェクト自身
<span class='line'>2155</span> */</span><span class="WHIT">
<span class='line'>2156</span> </span><span class="NAME">nas.XpsAgent.prototype.parseContent</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2157</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2158</span> </span><span class="WHIT">        </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.contentText</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2159</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2160</span> </span><span class="WHIT">    </span><span class="NAME">this.contentText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2161</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2162</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2163</span> </span><span class="COMM">/** タイムシートに記述されるカメラワークの抽象化クラス
<span class='line'>2164</span>  *
<span class='line'>2165</span>  *　FI,FO,OL,WIPE
<span class='line'>2166</span>  *　SL,PAN,TILT,TU,TB
<span class='line'>2167</span>  *  等々の実際の処理に展開される抽象化シンボルを扱うクラスオブジェクト
<span class='line'>2168</span>  *　シンボルデータベースnas.cameraDescriptionsを参照する
<span class='line'>2169</span>  *  シンボルを扱うため基本的にはｘMapとのリレーションがダイアログと同様にトラックに対する強い接続を持たない
<span class='line'>2170</span>  *  （=トラックが単なるキャリアとなる　グループ内部のオブジェクト毎に再構成が必要）
<span class='line'>2171</span>  *　cameraworkトラックのセクション値
<span class='line'>2172</span>  *  
<span class='line'>2173</span>  * nas.AimationCamerawork
<span class='line'>2174</span>  ex.
<span class='line'>2175</span> targets name attributes descriptions comments
<span class='line'>2176</span> symbol:◎
<span class='line'>2177</span>     symbol記述は、演出効果等で他の分類に収まらないかまたは複合的な状態を表す記述に対して用いられる分類
<span class='line'>2178</span>     例えば
<span class='line'>2179</span>     follow:symbol
<span class='line'>2180</span>     followSL:geometry
<span class='line'>2181</span> 
<span class='line'>2182</span> transition:＊
<span class='line'>2183</span>      トラジション記述の場合はターゲットの指定が不可欠
<span class='line'>2184</span> ]x[ または　]>&lt;[ でトランジションの対象となる素材指定ができる
<span class='line'>2185</span> 外ブラケットは解釈しない
<span class='line'>2186</span> 対象が複数の場合はカンマで分離
<span class='line'>2187</span> 処理シンボルは省略可能　その場合は無名トランジションとして扱う（オーバーラップディゾルブを補う？）
<span class='line'>2188</span>     ex.(transition)
<span class='line'>2189</span> s-c12]>&lt;[s-c13   &lt;OL> (3+0)
<span class='line'>2190</span> s-c12]>&lt;[s-c13   &lt;WIPE>(2+0)
<span class='line'>2191</span> A-1,B-3]>&lt;[A-2,B-4 &lt;中OL> (0+18)
<span class='line'>2192</span> 
<span class='line'>2193</span> 
<span class='line'>2194</span> geometry:☆
<span class='line'>2195</span>     name attributes.join('-') comments .join(',')
<span class='line'>2196</span>     ex.(geometry)
<span class='line'>2197</span> &lt;PAN> [A]-[B] ＞２つまで、　これ以上はセクション側で連結する 
<span class='line'>2198</span> &lt;TU> [A]-[B]
<span class='line'>2199</span> A,B,C &lt;slide> [1]-[2]-[3] ([2],[3]間フェアリング)
<span class='line'>2200</span> 
<span class='line'>2201</span> &lt;follow> → (stage ← 2mm/k)
<span class='line'>2202</span> 
<span class='line'>2203</span>     ex.(geometry.zigzag)
<span class='line'>2204</span> 
<span class='line'>2205</span> composite:○
<span class='line'>2206</span>     ex.(composite.fi fo)
<span class='line'>2207</span> &lt;FI> ▲ (1+12)
<span class='line'>2208</span> &lt;FO> ▼ (time)
<span class='line'>2209</span> 
<span class='line'>2210</span> effect:□
<span class='line'>2211</span>     ex.(effect)
<span class='line'>2212</span> BG,A,E &lt;透過光> 強 
<span class='line'>2213</span> 
<span class='line'>2214</span> ***"effect"は予約タイプ現在（2019時点）使用されていない
<span class='line'>2215</span> 
<span class='line'>2216</span> xps description sample
<span class='line'>2217</span> CAM1
<span class='line'>2218</span> [start]  &lt;後続セクション属性として保存
<span class='line'>2219</span> ▼   ┐
<span class='line'>2220</span> |   中間値補完区間が同時にカメラワークのセクションとなる
<span class='line'>2221</span> |   この区間の名称及びサブプロパティは前置の形で前方セクションに置かれる
<span class='line'>2222</span> |   前方セクションは必ずブランクセクションに（セリフと同様に扱う）
<span class='line'>2223</span> PAN     nameは中央配置
<span class='line'>2224</span> |       表示優先順位は name>startNode>endNode>bar
<span class='line'>2225</span> |
<span class='line'>2226</span> |
<span class='line'>2227</span> ▲   ┘
<span class='line'>2228</span> [end]   &lt;先行セクションの属性値として保存
<span class='line'>2229</span> 
<span class='line'>2230</span>  */</span><span class="WHIT">
<span class='line'>2231</span> </span><span class="NAME">nas.AnimationCameraworkPrefix</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2232</span> </span><span class="WHIT">    </span><span class="NAME">symbol</span><span class="PUNC">:</span><span class="STRN">"◎"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2233</span> </span><span class="WHIT">    </span><span class="NAME">transition</span><span class="PUNC">:</span><span class="STRN">"＊"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2234</span> </span><span class="WHIT">    </span><span class="NAME">geometry</span><span class="PUNC">:</span><span class="STRN">"☆"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2235</span> </span><span class="WHIT">    </span><span class="NAME">composite</span><span class="PUNC">:</span><span class="STRN">"○"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2236</span> </span><span class="WHIT">    </span><span class="NAME">effect</span><span class="PUNC">:</span><span class="STRN">"□"</span><span class="WHIT">
<span class='line'>2237</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2238</span> </span><span class="NAME">nas.AnimationCamerawork</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myParent</span><span class="PUNC">,</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2239</span> </span><span class="WHIT">    </span><span class="NAME">this.parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myParent</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">myParent</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT">     </span><span class="PUNC">;</span><span class="COMM">//xMapElementGroup or null</span><span class="WHIT">
<span class='line'>2240</span> </span><span class="WHIT">    </span><span class="NAME">this.contentText</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">;</span><span class="COMM">//xMapのソースを保存する　自動で再構築が行なわれるタイミングがある</span><span class="WHIT">
<span class='line'>2241</span> 
<span class='line'>2242</span> </span><span class="WHIT">    </span><span class="NAME">this.name</span><span class="WHIT"> </span><span class="TOKN">　</span><span class="TOKN">　</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="WHIT">                            </span><span class="PUNC">;</span><span class="COMM">//カメラワークシンボル名　値を識別する名称&lt;矢括弧>でセパレート 正規化が行われた場合のトラック名になる</span><span class="WHIT">
<span class='line'>2243</span> </span><span class="WHIT">    </span><span class="NAME">this.file</span><span class="WHIT">                                     </span><span class="PUNC">;</span><span class="COMM">//nas.AnimationElementSource（設定されない）</span><span class="WHIT">
<span class='line'>2244</span> </span><span class="WHIT">    </span><span class="NAME">this.comment</span><span class="WHIT">                                  </span><span class="PUNC">;</span><span class="COMM">//コメント文字列　エレメントの注釈プロパティ-xMap編集UIのみで確認できる（設定されない）</span><span class="WHIT">
<span class='line'>2245</span> </span><span class="WHIT">    </span><span class="NAME">this.extended</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT">                          </span><span class="PUNC">;</span><span class="COMM">//常にtrue</span><span class="WHIT">
<span class='line'>2246</span> 
<span class='line'>2247</span> </span><span class="WHIT">    </span><span class="NAME">this.type</span><span class="WHIT">         </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">'symbol'</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">]</span><span class="WHIT">             </span><span class="PUNC">;</span><span class="COMM">//typeStringArray　symbol,geometry,compositeをマスタータイプ　サブタイプでエフェクトの種類が記録される DBとの対照で決定する</span><span class="WHIT">
<span class='line'>2248</span> </span><span class="WHIT">    </span><span class="NAME">this.attributes</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="WHIT">                        </span><span class="PUNC">;</span><span class="COMM">//セパレートされていない文字列のうちnameにならなかったもの　通常は撮影指定コメント</span><span class="WHIT">
<span class='line'>2249</span> </span><span class="WHIT">    </span><span class="NAME">this.comments</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="WHIT">                        </span><span class="PUNC">;</span><span class="COMM">//丸かっこでセパレートされたコメントの中身</span><span class="WHIT">
<span class='line'>2250</span> </span><span class="WHIT">    </span><span class="NAME">this.descriptions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="WHIT">                        </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2251</span> </span><span class="WHIT">    </span><span class="NAME">this.targets</span><span class="WHIT">      </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="WHIT">                        </span><span class="PUNC">;</span><span class="COMM">//ワーク対象素材配列空の場合はカット全体が対象　トランジションの場合は必ず２要素の配列</span><span class="WHIT">
<span class='line'>2252</span> </span><span class="WHIT">                                                  </span><span class="PUNC">;</span><span class="COMM">//分割されたコンテンツ冒頭で、トラックIDと一致するもの　A,B,BG,BOOK等</span><span class="WHIT">
<span class='line'>2253</span> </span><span class="WHIT">                                                  </span><span class="PUNC">;</span><span class="COMM">//トランジションの場合は分離要件を調整する</span><span class="WHIT">
<span class='line'>2254</span> </span><span class="WHIT">    </span><span class="NAME">this.prefix</span><span class="PUNC">;</span><span class="WHIT">                                   </span><span class="COMM">//セクション冒頭で[ブラケット]で囲まれる表示</span><span class="WHIT">
<span class='line'>2255</span> </span><span class="WHIT">    </span><span class="NAME">this.postfix</span><span class="PUNC">;</span><span class="WHIT">                                  </span><span class="COMM">//セクション末尾で[ブラケット]で囲まれる表示</span><span class="WHIT">
<span class='line'>2256</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>2257</span> </span><span class="WHIT">    </span><span class="NAME">this.parseContent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2258</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2259</span> </span><span class="COMM">/**
<span class='line'>2260</span>     文字列化して返す
<span class='line'>2261</span>     
<span class='line'>2262</span> 書式は
<span class='line'>2263</span>     対象素材（省略可　省略時はカット全体）
<span class='line'>2264</span>     効果・識別名
<span class='line'>2265</span>     付属パラメータ（タイプごとに定義）composite,transition,geometry,effect,zigzag,fi,fo,stroboIn,stroboOut 等
<span class='line'>2266</span> symbol:(未分類)
<span class='line'>2267</span> 
<span class='line'>2268</span> 
<span class='line'>2269</span> 連結条件は、トラック内でガードバンドを挟んで同じtarget,type,name のセクションが隣接している場合のみ
<span class='line'>2270</span> カメラワーク（シンボル）トラック内のセクションは、ガードバンドがあってもなくても良い
<span class='line'>2271</span> ジオメトリカメラワークトラック値セクションの前後には最低１フレームのガードバンドが入る
<span class='line'>2272</span> 引数：    exportForm   出力書式
<span class='line'>2273</span>     basic         :xMap用１行エントリ
<span class='line'>2274</span>     ナシ/extend   :タイムシートメモ形式１行エントリ
<span class='line'>2275</span> */</span><span class="WHIT">
<span class='line'>2276</span> </span><span class="NAME">nas.AnimationCamerawork.prototype.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">exportForm</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2277</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">this.name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="COMM">//</span><span class="WHIT">
<span class='line'>2278</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">exportForm</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'basic'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2279</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resultArray</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">this.parent</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">this.parent.name</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">this.name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2280</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.file</span><span class="PUNC">)</span><span class="WHIT">         </span><span class="NAME">resultArray.push</span><span class="PUNC">(</span><span class="STRN">'"'</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.file.toString</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">'"'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2281</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">resultArray.join</span><span class="PUNC">(</span><span class="STRN">"\t"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2282</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2283</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">descriptionPrefix</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2284</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2285</span> </span><span class="COMM">//target</span><span class="WHIT">
<span class='line'>2286</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.targets.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2287</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.type</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="STRN">'transition'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2288</span> </span><span class="WHIT">            </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">this.targets</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="STRN">"]>&lt;["</span><span class="PUNC">,</span><span class="NAME">this.targets</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2289</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">       </span><span class="WHIT">
<span class='line'>2290</span> </span><span class="WHIT">            </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="NAME">this.targets.join</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2291</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2292</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2293</span> </span><span class="COMM">//warkName</span><span class="WHIT">
<span class='line'>2294</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">this.name</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="STRN">'&lt;'</span><span class="PUNC">+</span><span class="NAME">this.name</span><span class="PUNC">+</span><span class="STRN">'>'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//文字列は&lt;矢括弧>でセパレートする</span><span class="WHIT">
<span class='line'>2295</span> </span><span class="COMM">//attribute</span><span class="WHIT">
<span class='line'>2296</span> </span><span class="WHIT">    </span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">this.type</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2297</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"symbol"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2298</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.attributes.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="NAME">this.attributes.join</span><span class="PUNC">(</span><span class="STRN">" "</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2299</span> </span><span class="WHIT">    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2300</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"transition"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2301</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"composite"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2302</span> </span><span class="WHIT">    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"geometry"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2303</span> </span><span class="WHIT">    </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2304</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.attributes.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="NAME">this.attributes.join</span><span class="PUNC">(</span><span class="STRN">"-"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>2305</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2306</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.descriptions.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="NAME">this.descriptions.join</span><span class="PUNC">(</span><span class="STRN">' '</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2307</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.comments.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="STRN">'('</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.comments.join</span><span class="PUNC">(</span><span class="STRN">') ('</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">')'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2308</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>2309</span> </span><span class="WHIT">    </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myResult.join</span><span class="PUNC">(</span><span class="STRN">' '</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2310</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.file</span><span class="PUNC">)</span><span class="WHIT">         </span><span class="NAME">myResult</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="STRN">'\n\tfile="'</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.file.toString</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">'"'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2311</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">nas.AnimationCameraworkPrefix</span><span class="PUNC">[</span><span class="NAME">this.type</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="STRN">' '</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2312</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2313</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2314</span> </span><span class="COMM">/*TEST
<span class='line'>2315</span> A = new nas.AnimationCamerawork(null,"A,B,C &lt;FI> ▲ (1+12)");
<span class='line'>2316</span> B = new nas.AnimationCamerawork({name:'CAM1'},"&lt;PAN> [A]-[B]-[C] (2+13) (ラスト早く)");
<span class='line'>2317</span> */</span><span class="WHIT">
<span class='line'>2318</span> </span><span class="COMM">/**
<span class='line'>2319</span>     コンテンツを与えてパースする
<span class='line'>2320</span>     引数がない場合は自身のコンテンツデータを再パースする
<span class='line'>2321</span>     xMapの記述は、基本的にダイアログと同等。入力はメモ欄に記述するテキストとほぼ等価
<span class='line'>2322</span>     メモ記述ライン冒頭が段落マーク（◎＊○●◇◆☆★等の強調サイン）だった場合はそれを無視して評価する
<span class='line'>2323</span>     toStringでえられる文字列を自動でメモ記述欄にカット間トランジションと同様に表示する（ユーザ指定外）
<span class='line'>2324</span>     メモ欄にユーザが入力した記述はメモ内容をパースして、カメラワーク記述を認識した場合タイムシートへの挿入を問い合わせる？
<span class='line'>2325</span> 
<span class='line'>2326</span>     例
<span class='line'>2327</span> ★ A,B,C &lt;Slide> ↑ [1]→[2]→[3] 
<span class='line'>2328</span> ☆ クロコマ
<span class='line'>2329</span> ※ pan [A]-[B]
<span class='line'>2330</span> ＊ follow 
<span class='line'>2331</span> ○
<span class='line'>2332</span> ◯
<span class='line'>2333</span> ●
<span class='line'>2334</span> ■　黒コマ
<span class='line'>2335</span> □　白コマ
<span class='line'>2336</span> ＜＜
<span class='line'>2337</span> ＜
<span class='line'>2338</span> 
<span class='line'>2339</span> 等になる
<span class='line'>2340</span> コンマ区切りのフィールド（フレーム）数に関わりなく
<span class='line'>2341</span> name        明示的&lt;シンボル名>・暗示的シンボル名
<span class='line'>2342</span> prefix      コンテンツ頭の[ブラケット]で囲まれた要素
<span class='line'>2343</span> postfix     コンテンツ末尾の[ブラケット]で囲まれた要素
<span class='line'>2344</span> attributes  カッコのないむき出しの要素　基本的に素材ターゲット、transitionターゲットの場合は配列の配列
<span class='line'>2345</span> comments    (丸かっこ)で囲まれた要素　数値指定　尺指定はこの形式で統一
<span class='line'>2346</span> 省略サインはすべて無視
<span class='line'>2347</span> 
<span class='line'>2348</span> トランジションのセパレータは　/\](x|>&lt;|.+)\[/
<span class='line'>2349</span> 
<span class='line'>2350</span> 
<span class='line'>2351</span> xMap上の記述の形式
<span class='line'>2352</span> [CAM1   CAMERAWORK]
<span class='line'>2353</span>     グループ（トラック）登録
<span class='line'>2354</span> グループ（トラック）に、記述上の位置を示す以上の意味はない。
<span class='line'>2355</span> デフォルト値には有効な値が存在しない。
<span class='line'>2356</span> 空白セクションに対応する「無効値」がデフォルト値となる。
<span class='line'>2357</span> よってグループ記述に対する値のパースは「名前だけを持った無効値」を返す。
<span class='line'>2358</span> */</span><span class="WHIT">
<span class='line'>2359</span> </span><span class="NAME">nas.AnimationCamerawork.prototype.parseContent</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2360</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2361</span> </span><span class="WHIT">        </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.contentText</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2362</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2363</span> 
<span class='line'>2364</span> </span><span class="COMM">//xMapパーサからのグループエントリーデータなのでコンテンツをクリアして終了</span><span class="WHIT">
<span class='line'>2365</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myContent.indexOf</span><span class="PUNC">(</span><span class="STRN">'['</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2366</span> </span><span class="COMM">//console.log('detect GroupEntry :'+myContent);</span><span class="WHIT">
<span class='line'>2367</span> </span><span class="WHIT">    </span><span class="NAME">this.contentText</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2368</span> </span><span class="COMM">//    this.name         = undefined;</span><span class="WHIT">
<span class='line'>2369</span> </span><span class="COMM">//    this.file         = undefined;</span><span class="WHIT">
<span class='line'>2370</span> </span><span class="COMM">//    this.comment      = undefined;</span><span class="WHIT">
<span class='line'>2371</span> </span><span class="COMM">//    this.type         = ['symbol',''];</span><span class="WHIT">
<span class='line'>2372</span> </span><span class="COMM">//    this.attributes   = [];</span><span class="WHIT">
<span class='line'>2373</span> </span><span class="COMM">//    this.comments     = [];</span><span class="WHIT">
<span class='line'>2374</span> </span><span class="COMM">//    this.descriptions = [];</span><span class="WHIT">
<span class='line'>2375</span> </span><span class="COMM">//    this.targets      = [];</span><span class="WHIT">
<span class='line'>2376</span> </span><span class="COMM">//    this.prefix       =undefined;</span><span class="WHIT">
<span class='line'>2377</span> </span><span class="COMM">//    this.postfix      =undefined;</span><span class="WHIT">
<span class='line'>2378</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2379</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2380</span> </span><span class="WHIT">    </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.normalizeStr</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2381</span> </span><span class="WHIT">    </span><span class="NAME">myContentLines</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myContent.split</span><span class="PUNC">(</span><span class="STRN">'\n'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2382</span> </span><span class="WHIT">    </span><span class="NAME">this.attributes</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2383</span> </span><span class="WHIT">    </span><span class="NAME">this.comments</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2384</span> </span><span class="WHIT">    </span><span class="NAME">this.descriptions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2385</span> </span><span class="WHIT">    </span><span class="NAME">this.targets</span><span class="WHIT">      </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2386</span> </span><span class="WHIT">    </span><span class="NAME">this.prefix</span><span class="WHIT">       </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2387</span> </span><span class="WHIT">    </span><span class="NAME">this.postfix</span><span class="WHIT">      </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2388</span> 
<span class='line'>2389</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myName</span><span class="WHIT">        </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2390</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myTargets</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2391</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myProps</span><span class="WHIT">       </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2392</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bracketValues</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2393</span> 
<span class='line'>2394</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lid</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">lid</span><span class="PUNC">&lt;</span><span class="NAME">myContentLines.length</span><span class="PUNC">;</span><span class="NAME">lid</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2395</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">myContentLines</span><span class="PUNC">[</span><span class="NAME">lid</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="COMM">//カメラワークでは意味を持たないので空白行スキップ</span><span class="WHIT">
<span class='line'>2396</span> </span><span class="COMM">//console.log([myContentLines[lid].indexOf(this.parent.name+'\t')])</span><span class="WHIT">
<span class='line'>2397</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.parent</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>2398</span> </span><span class="WHIT">        </span><span class="PUNC">(</span><span class="NAME">myContentLines</span><span class="PUNC">[</span><span class="NAME">lid</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="NAME">this.parent.name</span><span class="PUNC">+</span><span class="STRN">'\t'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>2399</span> </span><span class="WHIT">        </span><span class="PUNC">(</span><span class="NAME">myContentLines</span><span class="PUNC">[</span><span class="NAME">lid</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^[\S]+\t[\S]+/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2400</span> </span><span class="WHIT">    </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2401</span> </span><span class="COMM">//console.log('XXXXXXX entry :'+myContentLines[lid]);</span><span class="WHIT">
<span class='line'>2402</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myContents</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myContentLines</span><span class="PUNC">[</span><span class="NAME">lid</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">'\t'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2403</span> </span><span class="COMM">//xMapパーサからのエントリ登録データなのでコンテンツを初期化</span><span class="WHIT">
<span class='line'>2404</span> </span><span class="COMM">//第三エントリが存在した場合source propertyを設定する</span><span class="WHIT">
<span class='line'>2405</span> </span><span class="WHIT">        </span><span class="NAME">this.name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myContents</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2406</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myContents.length</span><span class="PUNC">></span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.file</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationElementSource</span><span class="PUNC">(</span><span class="NAME">myContents.slice</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">' '</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2407</span> </span><span class="WHIT">        </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2408</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2409</span> </span><span class="COMM">//プロパティ単独記述　プロパティ別のパースが必要だが、ここで処理しないほうが良いかも　その場合はtoString側も要修正</span><span class="WHIT">
<span class='line'>2410</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myContentLines</span><span class="PUNC">[</span><span class="NAME">lid</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^\t([^=\s]+)=(.+)/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2411</span> </span><span class="COMM">//console.log('single propertiy =========================='+ myContent+'+++++');</span><span class="WHIT">
<span class='line'>2412</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myPrp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myVlu</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2413</span> </span><span class="WHIT">        </span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">myPrp</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2414</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'file'</span><span class="PUNC">:</span><span class="NAME">this.file</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationElementSource</span><span class="PUNC">(</span><span class="NAME">myVlu</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2415</span> </span><span class="WHIT">        </span><span class="KEYW">default</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">myPrp</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">myVlu</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2416</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2417</span> </span><span class="WHIT">        </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2418</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2419</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myContents</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myContentLines</span><span class="PUNC">[</span><span class="NAME">lid</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/^[◎*◯○●・◇◆☆★]/g</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\s+/g</span><span class="PUNC">,</span><span class="STRN">'\t'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">'\t'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2420</span> </span><span class="COMM">//console.log(this.parent.name);</span><span class="WHIT">
<span class='line'>2421</span> </span><span class="COMM">//console.log(myContents);</span><span class="WHIT">
<span class='line'>2422</span> </span><span class="COMM">//    var myName        = '';</span><span class="WHIT">
<span class='line'>2423</span> </span><span class="COMM">//    var myTargets     = [];</span><span class="WHIT">
<span class='line'>2424</span> </span><span class="COMM">//    var myProps       = [];</span><span class="WHIT">
<span class='line'>2425</span> </span><span class="COMM">//    var bracketValues = [];</span><span class="WHIT">
<span class='line'>2426</span> 
<span class='line'>2427</span> </span><span class="COMM">//name検出</span><span class="WHIT">
<span class='line'>2428</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myContent.match</span><span class="PUNC">(</span><span class="REGX">/&lt;([^&lt;]+)>/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2429</span> </span><span class="WHIT">        </span><span class="NAME">myName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp.$1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2430</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myContents.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2431</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myWord</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2432</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">cix</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myContents.length</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">cix</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2433</span> </span><span class="WHIT">            </span><span class="COMM">//書式上カメラワーク指定外のエントリをスキップ</span><span class="WHIT">
<span class='line'>2434</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myContents</span><span class="PUNC">[</span><span class="NAME">cix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^\[|^\(|(cell|セル|BG.*|BOOK.*)$|\)$|,/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2435</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">myWord</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myWord</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myContents</span><span class="PUNC">[</span><span class="NAME">cix</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="COMM">//最初の候補単語を控える</span><span class="WHIT">
<span class='line'>2436</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nas.cameraworkDescriptions.get</span><span class="PUNC">(</span><span class="NAME">myContents</span><span class="PUNC">[</span><span class="NAME">cix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2437</span> </span><span class="WHIT">                </span><span class="NAME">myName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myContents</span><span class="PUNC">[</span><span class="NAME">cix</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2438</span> </span><span class="WHIT">                </span><span class="NAME">myContents.splice</span><span class="PUNC">(</span><span class="NAME">cix</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2439</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2440</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2441</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>2442</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">myName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myWord</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">myWord</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="COMM">//！注意点！</span><span class="WHIT">
<span class='line'>2443</span> </span><span class="COMM">/*  カメラワークの名称を取得できなかった場合は、遅延解決のため必ず""(空文字列)に設定のこと　*/</span><span class="WHIT">
<span class='line'>2444</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2445</span> </span><span class="COMM">// トランジション検出</span><span class="WHIT">
<span class='line'>2446</span> </span><span class="COMM">//  カメラワークタイプがトランジションに固定されて名前はトランジションのサブタイプ（種別）情報となる</span><span class="WHIT">
<span class='line'>2447</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">detectTransition</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myContent.match</span><span class="PUNC">(</span><span class="REGX">/([^\[\s]+)\]([^\[\-ー→]+)\[([^\]\s]+)/i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2448</span> </span><span class="COMM">//console.log(detectTransition);</span><span class="WHIT">
<span class='line'>2449</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">detectTransition</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2450</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myName</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">detectTransition</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">myName</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">detectTransition</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2451</span> </span><span class="WHIT">        </span><span class="NAME">this.targets</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">detectTransition</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">detectTransition</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">   </span><span class="WHIT">
<span class='line'>2452</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myName.match</span><span class="PUNC">(</span><span class="REGX">/x|>&lt;/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'transition'</span><span class="PUNC">;</span><span class="COMM">//noname transition sign</span><span class="WHIT">
<span class='line'>2453</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2454</span> </span><span class="WHIT">    </span><span class="NAME">this.name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2455</span> </span><span class="COMM">//検出したシンボルからタイプ</span><span class="WHIT">
<span class='line'>2456</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mySymbol</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.cameraworkDescriptions.get</span><span class="PUNC">(</span><span class="NAME">this.name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2457</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">mySymbol</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">mySymbol</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.cameraworkDescriptions.get</span><span class="PUNC">(</span><span class="STRN">'unknown'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2458</span> </span><span class="COMM">/*symbol未検出時はユーザ指定を促すか？*/</span><span class="WHIT">
<span class='line'>2459</span> </span><span class="WHIT">    </span><span class="NAME">this.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">mySymbol.type</span><span class="PUNC">,</span><span class="NAME">mySymbol.name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2460</span> 
<span class='line'>2461</span> </span><span class="COMM">//コメント検出</span><span class="WHIT">
<span class='line'>2462</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">commentsGet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myContent.match</span><span class="PUNC">(</span><span class="REGX">/\(([^\)]+)\)/g</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2463</span> </span><span class="COMM">//コメントリダクション</span><span class="WHIT">
<span class='line'>2464</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">commentsGet</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2465</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="NAME">cix</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">commentsGet.length</span><span class="PUNC">;</span><span class="NAME">cix</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2466</span> </span><span class="WHIT">            </span><span class="NAME">commentsGet</span><span class="PUNC">[</span><span class="NAME">cix</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">commentsGet</span><span class="PUNC">[</span><span class="NAME">cix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/^\(\s*|\s*\)$/gi</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2467</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">commentsGet</span><span class="PUNC">[</span><span class="NAME">cix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2468</span> </span><span class="WHIT">            </span><span class="NAME">this.comments.push</span><span class="PUNC">(</span><span class="NAME">commentsGet</span><span class="PUNC">[</span><span class="NAME">cix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2469</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2470</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2471</span> 
<span class='line'>2472</span> </span><span class="COMM">//タイプ別に残りの属性値を判別</span><span class="WHIT">
<span class='line'>2473</span> </span><span class="COMM">//console.log(myContents);</span><span class="WHIT">
<span class='line'>2474</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">cix</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myContents.length</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">cix</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2475</span> </span><span class="COMM">//transition指定エントリをスキップ</span><span class="WHIT">
<span class='line'>2476</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">detectTransition</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">myContents</span><span class="PUNC">[</span><span class="NAME">cix</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">detectTransition</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2477</span> </span><span class="COMM">//console.log(myContents[cix]);</span><span class="WHIT">
<span class='line'>2478</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2479</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2480</span> </span><span class="COMM">//コメント取得済みなのでスキップ</span><span class="WHIT">
<span class='line'>2481</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myContents</span><span class="PUNC">[</span><span class="NAME">cix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^\(|\)&/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2482</span> </span><span class="COMM">//カメラワーク名スキップ</span><span class="WHIT">
<span class='line'>2483</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">checkName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myContents</span><span class="PUNC">[</span><span class="NAME">cix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">'&lt;?'</span><span class="PUNC">+</span><span class="NAME">this.name</span><span class="PUNC">+</span><span class="STRN">'>?'</span><span class="PUNC">,</span><span class="STRN">'i'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2484</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">checkName</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">checkName</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2485</span> </span><span class="COMM">//console.log(checkName);</span><span class="WHIT">
<span class='line'>2486</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2487</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2488</span> </span><span class="COMM">//ターゲット検出</span><span class="WHIT">
<span class='line'>2489</span> </span><span class="COMM">//この時点ではポストフィックスと空エントリが含まれる</span><span class="WHIT">
<span class='line'>2490</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myContents</span><span class="PUNC">[</span><span class="NAME">cix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/(cell|セル)$|(BG.*|BOOK.*)$|,/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2491</span> </span><span class="COMM">//console.log(myContents[cix]);</span><span class="WHIT">
<span class='line'>2492</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">myContents</span><span class="PUNC">[</span><span class="NAME">cix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2493</span> </span><span class="WHIT">                </span><span class="NAME">myTargets</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myTargets.concat</span><span class="PUNC">(</span><span class="NAME">myContents</span><span class="PUNC">[</span><span class="NAME">cix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2494</span> </span><span class="WHIT">                </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2495</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2496</span> </span><span class="WHIT">                </span><span class="NAME">myTargets.push</span><span class="PUNC">(</span><span class="NAME">myContents</span><span class="PUNC">[</span><span class="NAME">cix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2497</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2498</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2499</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2500</span> </span><span class="COMM">//残りはすべてアトリビュート</span><span class="WHIT">
<span class='line'>2501</span> </span><span class="COMM">//[ブラケット]</span><span class="WHIT">
<span class='line'>2502</span> </span><span class="COMM">//console.log(myContents[cix]);</span><span class="WHIT">
<span class='line'>2503</span> </span><span class="WHIT">       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">myContents</span><span class="PUNC">[</span><span class="NAME">cix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^(\[[^\]]+\][-ー→]?)+/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2504</span> </span><span class="WHIT">            </span><span class="NAME">bracketValues</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bracketValues.concat</span><span class="PUNC">(</span><span class="NAME">myContents</span><span class="PUNC">[</span><span class="NAME">cix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/[-ー→]/g</span><span class="PUNC">,</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2505</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="WHIT">
<span class='line'>2506</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2507</span> </span><span class="WHIT">        </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.type</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2508</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"composite"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2509</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">mySymbol.nodeSigns</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">mySymbol.nodeSigns.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">myProps.indexOf</span><span class="PUNC">(</span><span class="NAME">mySymbol.nodeSigns</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2510</span> </span><span class="WHIT">                </span><span class="NAME">myProps.push</span><span class="PUNC">(</span><span class="NAME">mySymbol.nodeSigns</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2511</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2512</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"geometry"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2513</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"transition"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2514</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"symbol"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2515</span> </span><span class="WHIT">        </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2516</span> </span><span class="WHIT">            </span><span class="NAME">myProps.push</span><span class="PUNC">(</span><span class="NAME">myContents</span><span class="PUNC">[</span><span class="NAME">cix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2517</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>2518</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2519</span> </span><span class="COMM">//myTargetsリダクション</span><span class="WHIT">
<span class='line'>2520</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>2521</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="NAME">tix</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myTargets.length</span><span class="PUNC">;</span><span class="NAME">tix</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2522</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">myTargets</span><span class="PUNC">[</span><span class="NAME">tix</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.targets.push</span><span class="PUNC">(</span><span class="NAME">myTargets</span><span class="PUNC">[</span><span class="NAME">tix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2523</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">myTargets</span><span class="PUNC">[</span><span class="NAME">tix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2524</span> </span><span class="WHIT">        </span><span class="NAME">this.targets.push</span><span class="PUNC">(</span><span class="NAME">myTargets</span><span class="PUNC">[</span><span class="NAME">tix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/(cell|セル)$/gi</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2525</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2526</span> </span><span class="COMM">//bracketValuesリダクション</span><span class="WHIT">
<span class='line'>2527</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="NAME">bix</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">bracketValues.length</span><span class="PUNC">;</span><span class="NAME">bix</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2528</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">bracketValues</span><span class="PUNC">[</span><span class="NAME">bix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2529</span> </span><span class="WHIT">        </span><span class="NAME">this.attributes.push</span><span class="PUNC">(</span><span class="NAME">bracketValues</span><span class="PUNC">[</span><span class="NAME">bix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2530</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">this.prefix</span><span class="PUNC">)</span><span class="WHIT">                   </span><span class="NAME">this.prefix</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bracketValues</span><span class="PUNC">[</span><span class="NAME">bix</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2531</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2532</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.prefix</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">this.postfix</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.postfix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.attributes</span><span class="PUNC">[</span><span class="NAME">this.attributes.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2533</span> </span><span class="COMM">//myPropsリダクション</span><span class="WHIT">
<span class='line'>2534</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="NAME">pix</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">myProps.length</span><span class="PUNC">;</span><span class="NAME">pix</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2535</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">myProps</span><span class="PUNC">[</span><span class="NAME">pix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2536</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isGroup</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2537</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.parent</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.parent</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.xMapGroup</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">isGroup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.parent.link.stage.line.parent.getElementByName</span><span class="PUNC">(</span><span class="NAME">myProps</span><span class="PUNC">[</span><span class="NAME">pix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2538</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">isGroup</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">isGroup</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">nas.xMapGroup</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2539</span> </span><span class="WHIT">            </span><span class="NAME">this.targets.push</span><span class="PUNC">(</span><span class="NAME">myProps</span><span class="PUNC">[</span><span class="NAME">pix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2540</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2541</span> </span><span class="WHIT">            </span><span class="NAME">this.descriptions.push</span><span class="PUNC">(</span><span class="NAME">myProps</span><span class="PUNC">[</span><span class="NAME">pix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2542</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2543</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2544</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2545</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2546</span> </span><span class="WHIT">    </span><span class="NAME">this.contentText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//(myContent)?String(myContent):"";</span><span class="WHIT">
<span class='line'>2547</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2548</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2549</span> </span><span class="COMM">/* TEST
<span class='line'>2550</span> new nas.AnimationCamerawork(null,"A,B,Cセル BG BOOK2 BOOK3 SL　[A]-[B] (じんわり)");
<span class='line'>2551</span> 
<span class='line'>2552</span> new nas.AnimationCamerawork(null,"slide");
<span class='line'>2553</span> new nas.AnimationCamerawork(null,"BOOK3 FI ()");
<span class='line'>2554</span> new nas.AnimationCamerawork(null,"クロコマ");
<span class='line'>2555</span> 
<span class='line'>2556</span> */</span><span class="WHIT">
<span class='line'>2557</span> 
<span class='line'>2558</span> 
<span class='line'>2559</span> </span><span class="COMM">/**
<span class='line'>2560</span> 
<span class='line'>2561</span> ストリームの構造
<span class='line'>2562</span> [A] prefix
<span class='line'>2563</span> ▽   StartSign
<span class='line'>2564</span> |       interpSign
<span class='line'>2565</span> |
<span class='line'>2566</span> &lt;PAN>       name
<span class='line'>2567</span> |
<span class='line'>2568</span> |
<span class='line'>2569</span> △   EndSign
<span class='line'>2570</span> [B] postfix
<span class='line'>2571</span> 
<span class='line'>2572</span> ブラケット値以外のアトリビュートが記録されないので何らかの処置を取る
<span class='line'>2573</span> コメント表示を行う必要がある
<span class='line'>2574</span> メモ欄に流し込んで、両方を合成処理するか？
<span class='line'>2575</span> 
<span class='line'>2576</span> 
<span class='line'>2577</span> prfix&lt;postfix&lt;name&lt;StartSign&lt;endSign&lt;interpSign
<span class='line'>2578</span> */</span><span class="WHIT">
<span class='line'>2579</span> </span><span class="NAME">nas.AnimationCamerawork.prototype.getStream</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2580</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">cellCounts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="COMM">//1  > minimumCount</span><span class="WHIT">
<span class='line'>2581</span> 
<span class='line'>2582</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">minCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="COMM">//name</span><span class="WHIT">
<span class='line'>2583</span> </span><span class="COMM">//    if(this.prefix)  minCount++;</span><span class="WHIT">
<span class='line'>2584</span> </span><span class="COMM">//    if(this.postfix) minCount++;</span><span class="WHIT">
<span class='line'>2585</span> 
<span class='line'>2586</span> 
<span class='line'>2587</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="NAME">cellCounts</span><span class="PUNC">=</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2588</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">minCount</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2589</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mySymbol</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.cameraworkDescriptions.get</span><span class="PUNC">(</span><span class="NAME">this.type</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2590</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="NAME">mySymbol</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">mySymbol</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nas.cameraworkDescriptions.get</span><span class="PUNC">(</span><span class="STRN">'bar'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2591</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mySymbol.nodeSigns.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="NAME">mySymbol.nodeSigns</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="STRN">'&lt;'</span><span class="PUNC">+</span><span class="NAME">this.name</span><span class="PUNC">+</span><span class="STRN">'>'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2592</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2593</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ix</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">cellCounts</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="NAME">ix</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2594</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">ix</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">+</span><span class="NAME">this.comments.length</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2595</span> </span><span class="WHIT">                </span><span class="NAME">myResult</span><span class="PUNC">[</span><span class="NAME">ix</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2596</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.comments.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2597</span> </span><span class="WHIT">                    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="NAME">cx</span><span class="PUNC">&lt;</span><span class="NAME">this.comments.length</span><span class="PUNC">;</span><span class="NAME">cx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2598</span> </span><span class="WHIT">                        </span><span class="NAME">myResult</span><span class="PUNC">[</span><span class="NAME">ix</span><span class="PUNC">+</span><span class="NAME">cx</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'('</span><span class="PUNC">+</span><span class="NAME">this.comments</span><span class="PUNC">[</span><span class="NAME">cx</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">')'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2599</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2600</span> </span><span class="WHIT">                    </span><span class="NAME">ix</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.comments.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2601</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2602</span> </span><span class="WHIT">               </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2603</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2604</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">ix</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">mySymbol.nodeSigns</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2605</span> </span><span class="WHIT">                </span><span class="NAME">myResult</span><span class="PUNC">[</span><span class="NAME">ix</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mySymbol.nodeSigns</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2606</span> </span><span class="WHIT">                </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2607</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2608</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">ix</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">mySymbol.nodeSigns</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2609</span> </span><span class="WHIT">                </span><span class="NAME">myResult</span><span class="PUNC">[</span><span class="NAME">ix</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mySymbol.nodeSigns</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">mySymbol.nodeSigns</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="NAME">mySymbol.nodeSigns</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2610</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2611</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2612</span> </span><span class="WHIT">            </span><span class="NAME">myResult</span><span class="PUNC">[</span><span class="NAME">ix</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mySymbol.nodeSigns</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2613</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2614</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.prefix</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">this.prefix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">concat</span><span class="PUNC">(</span><span class="NAME">myResult</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2615</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.postfix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">myResult.concat</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">this.postfix</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2616</span> </span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2617</span> </span><span class="WHIT">     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2618</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2619</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2620</span> 
<span class='line'>2621</span> 
<span class='line'>2622</span> </span><span class="COMM">/** 単純な記録が必要な場合のオブジェクト
<span class='line'>2623</span>  *　基礎的なデータを保持
<span class='line'>2624</span>  *  コンテの記述等がこの値で保持される
<span class='line'>2625</span>  *  また共通に要求されるメソッドの雛形
<span class='line'>2626</span>  *
<span class='line'>2627</span>  *  タイムシートのトラックの値として利用されることはない
<span class='line'>2628</span>  */</span><span class="WHIT">
<span class='line'>2629</span> </span><span class="NAME">nas.StoryboardDescription</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myParent</span><span class="PUNC">,</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2630</span> </span><span class="WHIT">    </span><span class="NAME">this.parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myParent</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">myParent</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT">     </span><span class="PUNC">;</span><span class="COMM">//xMapElementGroup or null</span><span class="WHIT">
<span class='line'>2631</span> </span><span class="WHIT">    </span><span class="NAME">this.contentText</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">;</span><span class="COMM">//xMapのソースを保存する　自動で再構築が行なわれるタイミングがある</span><span class="WHIT">
<span class='line'>2632</span> </span><span class="COMM">/** ex.
<span class='line'>2633</span> [description   text]
<span class='line'>2634</span> description s-c4
<span class='line'>2635</span> #----------------------------------------------------------------
<span class='line'>2636</span> 	カメラ背中側から
<span class='line'>2637</span> 	&lt;PAN↑UP>
<span class='line'>2638</span> 	立てかけた猟銃　その他　猟師さん風荷物など見える
<span class='line'>2639</span> 	
<span class='line'>2640</span> 	バタバタとうちわであおぐ
<span class='line'>2641</span> #----------------------------------------------------------------    
<span class='line'>2642</span> 絵コンテのト書きに相当する行頭のタブを払って記録される
<span class='line'>2643</span> */</span><span class="WHIT">
<span class='line'>2644</span> 
<span class='line'>2645</span> </span><span class="WHIT">    </span><span class="NAME">this.name</span><span class="WHIT">                                     </span><span class="PUNC">;</span><span class="COMM">//素材名</span><span class="WHIT">
<span class='line'>2646</span> </span><span class="WHIT">    </span><span class="NAME">this.source</span><span class="WHIT">                                   </span><span class="PUNC">;</span><span class="COMM">//nas.AnimationElementSource</span><span class="WHIT">
<span class='line'>2647</span> </span><span class="WHIT">    </span><span class="NAME">this.comment</span><span class="WHIT">                                  </span><span class="PUNC">;</span><span class="COMM">//コメント文字列　エレメントの注釈プロパティ-xMap編集UIのみで確認できる</span><span class="WHIT">
<span class='line'>2648</span> </span><span class="WHIT">    </span><span class="NAME">this.extended</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2649</span> 
<span class='line'>2650</span> </span><span class="WHIT">    </span><span class="NAME">this.type</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">//typeString　storyBoardText </span><span class="WHIT">
<span class='line'>2651</span> </span><span class="WHIT">    </span><span class="NAME">this.attributes</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2652</span> </span><span class="WHIT">    </span><span class="NAME">this.comments</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2653</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>2654</span> </span><span class="WHIT">    </span><span class="NAME">this.parseContent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2655</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2656</span> </span><span class="COMM">/**
<span class='line'>2657</span>     文字列化して返す
<span class='line'>2658</span> */</span><span class="WHIT">
<span class='line'>2659</span> </span><span class="NAME">nas.StoryboardDescription.prototype.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">exportForm</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2660</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.contentText</span><span class="PUNC">;</span><span class="COMM">//動作確認用ダミー行</span><span class="WHIT">
<span class='line'>2661</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2662</span> </span><span class="COMM">/**
<span class='line'>2663</span>     コンテンツを与えてパースする
<span class='line'>2664</span>     引数がない場合は自身のコンテンツデータを再パースする
<span class='line'>2665</span> */</span><span class="WHIT">
<span class='line'>2666</span> </span><span class="NAME">nas.StoryboardDescription.prototype.parseContent</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2667</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2668</span> </span><span class="WHIT">        </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.contentText</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2669</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2670</span> </span><span class="WHIT">    </span><span class="NAME">this.contentText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2671</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2672</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2673</span> 
<span class='line'>2674</span> </span><span class="NAME">nas.StoryboardDescription.prototype.getStream</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2675</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getContent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//cellCounts = this.getContent().length;?</span><span class="WHIT">
<span class='line'>2676</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="NAME">cellCounts</span><span class="PUNC">=</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2677</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2678</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">cellCounts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2679</span> </span><span class="WHIT">    </span><span class="NAME">myResult</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.name</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this.name</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2680</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>2681</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">this.name</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="NAME">this.name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//ラベルあれば</span><span class="WHIT">
<span class='line'>2682</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">aid</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">aid</span><span class="PUNC">&lt;</span><span class="NAME">this.attributes.length</span><span class="PUNC">;</span><span class="NAME">aid</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="NAME">this.attributes</span><span class="PUNC">[</span><span class="NAME">aid</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="COMM">//アトリビュート</span><span class="WHIT">
<span class='line'>2683</span> </span><span class="WHIT">    </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="STRN">'----'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//開始セパレータ</span><span class="WHIT">
<span class='line'>2684</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">entryCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.bodyText.length</span><span class="PUNC">+</span><span class="NAME">this.comments.length</span><span class="PUNC">;</span><span class="COMM">//テキスト文字数とコメント数を加算</span><span class="WHIT">
<span class='line'>2685</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dataCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//データカウントを０で初期化</span><span class="WHIT">
<span class='line'>2686</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">textIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//テクストインデックス</span><span class="WHIT">
<span class='line'>2687</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">commentIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="COMM">//コメントインデックス</span><span class="WHIT">
<span class='line'>2688</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dataStep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cellCounts</span><span class="PUNC">/</span><span class="NAME">entryCount</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="COMM">//データステップ</span><span class="WHIT">
<span class='line'>2689</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cnt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">cnt</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">cellCounts</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">cnt</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2690</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">entryCount</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">cellCounts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">cnt</span><span class="PUNC">:</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">cnt</span><span class="PUNC">/</span><span class="NAME">dataStep</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//配置Index</span><span class="WHIT">
<span class='line'>2691</span> </span><span class="WHIT">        </span><span class="COMM">//挿入点判定</span><span class="WHIT">
<span class='line'>2692</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dataCount</span><span class="PUNC">==</span><span class="NAME">myIndex</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2693</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.comments</span><span class="PUNC">[</span><span class="NAME">commentIndex</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.comments</span><span class="PUNC">[</span><span class="NAME">commentIndex</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="NAME">textIndex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2694</span> </span><span class="WHIT">                </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="NAME">this.comments</span><span class="PUNC">[</span><span class="NAME">commentIndex</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2695</span> </span><span class="WHIT">                </span><span class="NAME">commentIndex</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2696</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2697</span> </span><span class="WHIT">                </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="NAME">this.bodyText.charAt</span><span class="PUNC">(</span><span class="NAME">textIndex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2698</span> </span><span class="WHIT">                </span><span class="NAME">textIndex</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2699</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2700</span> </span><span class="WHIT">            </span><span class="NAME">dataCount</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2701</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2702</span> </span><span class="WHIT">            </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2703</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2704</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2705</span> </span><span class="WHIT">    </span><span class="NAME">myResult.push</span><span class="PUNC">(</span><span class="STRN">'----'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2706</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">myResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2707</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2708</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2709</span> 
<span class='line'>2710</span> </span><span class="COMM">/** nas.AnimationAppearance
<span class='line'>2711</span>  *  
<span class='line'>2712</span>  *  ブランク（カラセル）管理セクションで使用されるアピアランスに特化した値
<span class='line'>2713</span>  *　値は ON-OFF 状態をbooleanで持つ
<span class='line'>2714</span>  *　ソース等のプロパティは持たない 一時的な値でありｘMapに記述されることはない
<span class='line'>2715</span>  *　コンテントテキスト
<span class='line'>2716</span>  *
<span class='line'>2717</span>  */</span><span class="WHIT">
<span class='line'>2718</span> </span><span class="NAME">nas.AnimationAppearance</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myParent</span><span class="PUNC">,</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2719</span> </span><span class="WHIT">    </span><span class="NAME">this.parent</span><span class="WHIT">      </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myParent</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">myParent</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT">     </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2720</span> </span><span class="WHIT">    </span><span class="NAME">this.contentText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"on"</span><span class="WHIT">       </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2721</span> </span><span class="WHIT">    </span><span class="NAME">this.appearance</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">       </span><span class="PUNC">;</span><span class="COMM">//表示状態を表す</span><span class="WHIT">
<span class='line'>2722</span> 
<span class='line'>2723</span> </span><span class="WHIT">    </span><span class="NAME">this.parseContent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2724</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2725</span> </span><span class="COMM">/**
<span class='line'>2726</span>     文字列化して返す
<span class='line'>2727</span> */</span><span class="WHIT">
<span class='line'>2728</span> </span><span class="NAME">nas.AnimationAppearance.prototype.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">exportForm</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2729</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.appearance</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">"ON"</span><span class="PUNC">:</span><span class="STRN">"OFF"</span><span class="PUNC">;</span><span class="COMM">//動作確認用ダミー行</span><span class="WHIT">
<span class='line'>2730</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2731</span> </span><span class="COMM">/**
<span class='line'>2732</span>     コンテンツを与えてパースする
<span class='line'>2733</span>     引数がない場合は自身のコンテンツデータを再パースする
<span class='line'>2734</span>     xMapのエントリを扱うためCellDescriptionの持つ正規表現オブジェクトを直接使用しない
<span class='line'>2735</span>     戻り値はオブジェクト自身
<span class='line'>2736</span> */</span><span class="WHIT">
<span class='line'>2737</span> </span><span class="NAME">nas.AnimationAppearance.prototype.parseContent</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">myContent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2738</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">blankRegex</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"^(\\b|blank(-cell)?|off|false|empty|"</span><span class="PUNC">+</span><span class="NAME">nas.CellDescription.blankSigns.join</span><span class="PUNC">(</span><span class="STRN">"|"</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">")$"</span><span class="PUNC">,</span><span class="STRN">"i"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2739</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2740</span> </span><span class="WHIT">        </span><span class="NAME">myContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.contentText</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2741</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2742</span> 
<span class='line'>2743</span> </span><span class="WHIT">    </span><span class="NAME">this.appearance</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.contentText.match</span><span class="PUNC">(</span><span class="NAME">blankRegex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2744</span> 
<span class='line'>2745</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2746</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2747</span> </span><span class="COMM">/*静止画トラックのパース
<span class='line'>2748</span> 静止画トラックは基本的に置き換えのない静止画のみを扱う
<span class='line'>2749</span> 値は AnimationAppearanceに画像名（AnimationSource）を与えて使用する
<span class='line'>2750</span> 認識するセル記述は　[on/off][true/false][empty/full][blank/fill][disappearance/appearance][0/1]等の二項記述
<span class='line'>2751</span> 
<span class='line'>2752</span> 入れ替えが必要な場合は、ReplacementTrackを使用するかまたは複数の静止画トラックを使用すること
<span class='line'>2753</span> */</span><span class="WHIT">
<span class='line'>2754</span> </span><span class="NAME">_parseStillTrack</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2755</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myCollection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XpsTimelineSectionCollection</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//自分自身を親としてセクションコレクションを新作</span><span class="WHIT">
<span class='line'>2756</span> </span><span class="WHIT">    </span><span class="COMM">//この実装では開始マーカーが０フレームにしか位置できないので必ずブランクセクションが発生する</span><span class="WHIT">
<span class='line'>2757</span> </span><span class="WHIT">    </span><span class="COMM">//継続時間０で先に作成 同時にカラのサウンドObjectを生成</span><span class="WHIT">
<span class='line'>2758</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">groupName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2759</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myGroup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.xParent.parentXps.xMap.getElementByName</span><span class="PUNC">(</span><span class="NAME">groupName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2760</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">myGroup</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">myGroup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.xParent.parentXps.xMap.new_xMapElement</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>2761</span> </span><span class="WHIT">        </span><span class="NAME">this.id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2762</span> </span><span class="WHIT">        </span><span class="STRN">'CELL'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2763</span> </span><span class="WHIT">        </span><span class="NAME">this.xParent.parentXps.xMap.currentJob</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2764</span> </span><span class="WHIT">        </span><span class="PUNC">[</span><span class="NAME">this.id</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">'\t'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2765</span> </span><span class="WHIT">    </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="COMM">//nas.xMapGroup(groupName,'dialog',null);//new nas.xMapGroup(myName,myOption,myLink);</span><span class="WHIT">
<span class='line'>2766</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentValue</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationAppearance</span><span class="PUNC">(</span><span class="NAME">myGroup</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//第一有値区間の値コンテンツはカラで初期化も保留</span><span class="WHIT">
<span class='line'>2767</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentSection</span><span class="PUNC">=</span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//区間値false</span><span class="WHIT">
<span class='line'>2768</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fix</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">fix</span><span class="PUNC">&lt;</span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="NAME">fix</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2769</span> </span><span class="WHIT">        </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="PUNC">;</span><span class="COMM">//currentセクションの継続長を加算</span><span class="WHIT">
<span class='line'>2770</span> </span><span class="WHIT">        </span><span class="COMM">//未記入データ最も多いので最初に判定しておく</span><span class="WHIT">
<span class='line'>2771</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2772</span> </span><span class="WHIT">        </span><span class="COMM">//括弧でエスケープされたコメント又は属性</span><span class="WHIT">
<span class='line'>2773</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/(^\([^\)]+\)$|^&lt;[^>]+>$|^\[[^\]]+\]$)/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2774</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentSection.value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2775</span> </span><span class="WHIT">                </span><span class="NAME">currentSound.comments.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">currentSound.bodyText.length</span><span class="PUNC">,</span><span class="NAME">RegExp.$1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2776</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2777</span> </span><span class="WHIT">                </span><span class="NAME">currentSound.attributes.push</span><span class="PUNC">(</span><span class="NAME">RegExp.$1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2778</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2779</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2780</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2781</span> </span><span class="WHIT">        </span><span class="COMM">//セクションセパレータ少ない</span><span class="WHIT">
<span class='line'>2782</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/^[-_~^〜＿ー￣]{3,4}$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2783</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentSection.value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2784</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">--</span><span class="PUNC">;</span><span class="COMM">//加算した継続長をキャンセル</span><span class="WHIT">
<span class='line'>2785</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.value.contentText</span><span class="PUNC">=</span><span class="NAME">currentSound.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//先の有値セクションをフラッシュして</span><span class="WHIT">
<span class='line'>2786</span> </span><span class="WHIT">                </span><span class="NAME">currentSection</span><span class="PUNC">=</span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//新規のカラセクションを作る</span><span class="WHIT">
<span class='line'>2787</span> </span><span class="WHIT">                </span><span class="NAME">currentSection.duration</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="PUNC">;</span><span class="COMM">//キャンセル分を後方区間に加算</span><span class="WHIT">
<span class='line'>2788</span> </span><span class="WHIT">                </span><span class="NAME">currentSound</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nas.AnimationDialog</span><span class="PUNC">(</span><span class="NAME">groupName</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//サウンドを新規作成</span><span class="WHIT">
<span class='line'>2789</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2790</span> </span><span class="COMM">//引数をサウンドオブジェクトでなくxMapElementに変更予定</span><span class="WHIT">
<span class='line'>2791</span> </span><span class="COMM">//                nas.new_MapElement(name,Object xMapGroup,Object Job);</span><span class="WHIT">
<span class='line'>2792</span> </span><span class="WHIT">                </span><span class="NAME">currentSection</span><span class="PUNC">=</span><span class="NAME">myCollection.addSection</span><span class="PUNC">(</span><span class="NAME">currentSound</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//新規有値セクション作成</span><span class="WHIT">
<span class='line'>2793</span> </span><span class="COMM">//                currentSection.value.</span><span class="WHIT">
<span class='line'>2794</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2795</span> </span><span class="WHIT">                        </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2796</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2797</span> </span><span class="COMM">//判定を全て抜けたデータは本文又はラベルラベルは上書きで更新</span><span class="WHIT">
<span class='line'>2798</span> </span><span class="COMM">//ラベル無しの音声オブジェクトは無しのまま保存必要に従って先行オブジェクトのラベルを引継ぐ</span><span class="WHIT">
<span class='line'>2799</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentSection.value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2800</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="STRN">"|"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="STRN">"ー"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2801</span> </span><span class="WHIT">            </span><span class="NAME">currentSound.bodyText</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2802</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2803</span> </span><span class="WHIT">            </span><span class="NAME">currentSound.name</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">fix</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2804</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2805</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2806</span> </span><span class="WHIT">    </span><span class="NAME">this.sections</span><span class="PUNC">=</span><span class="NAME">myCollection</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2807</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.sections</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2808</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2809</span> </span><span class="COMM">//test</span><span class="WHIT">
<span class='line'>2810</span> </span></pre></body></html>