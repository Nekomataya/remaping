/**
    タイムシートのルックを保持する変数群

	SheetBaseColor	:タイムシート背景色-
	SelectedColor	:フォーカス色
	RapidModeColor	:ラピッドモードフォーカス色
	FloatModeColor	:"#88eeee",移動中のフローティング色
	SectionModeColor:"#ccffcc",区間選択色
	SpinAreaColor	:"red"	,スピン範囲色
	SelectionColor	:"#f8f8dd",選択範囲色
	FootStampColor	:"#fff0f0",diff背景色-
	EditingColor	:"#eebbbb",編集中インジケータ色
	SelectingColor	:"#ccccaa",
	    
	CellWidthUnit	:"px",指定単位
	TimeGuideWidth	    :36,フレーム/TCエリア
	ActionWidth         :20,参照シートのトラック幅（一律）
	DialogWidth	        :36,セリフ/音声トラック幅
	SheetCellWidth	    :42,通常セルのトラック幅
	SheetCellNarrow	    :4,折りたたみ時のトラック幅
	StillCellWidth	    :12,静止画トラック幅
	SfxCellWidth	    :46,コンポジットトラック幅
	CameraCellWidth     :52,ジオメトリトラック幅
	CommentWidth        :120,フレームコメント幅
	ColumnSeparatorWidth:4,シートカラムマージン幅 
	
    
￣￣￣
セクション編集モードへの移行

フォーカスのあるセル上でセクション編集を有効にするコマンド発行
トラック内のフレームをダブルクリックで実行

フォーカスをセクションの先頭（最もフレーム番号の小さな）フレームに置く（移動可能性あり）

セクションのプロパティは、開始フレーム、継続フレーム

セクション編集中は常に同トラック内の前後のセクションを編集するので注意

実際は選択中のセクションと他ラック全体で仮の値を作って、確定操作時に実際のセクション操作を行う

可能な操作は、
    全体の前後方向移動
    ヘッドの移動
    テイルの移動
ヘッド及びテイルは、お互いをオーバーパス可能
その場合テールとヘッドが入れ替わる

*/
<hr style="margin-top:0" />
/**
     区間操作メソッド
     移動・前延伸・後延伸を一つのルーチンで処理する
     区間設定(開始アドレス,継続時間,オフセットアドレス)
     
*/
xUI.sectionManipulate = function(){
    
}

セクションの編集に際して以下の動作を行う
	モードチェンジ
カーソルのあるタイムラインをパースしてカーソル位置のセクションを操作対象セクションにする
実際の編集単位はトラック全体
mdChg('section')に組み込む
//操作対象トラックを取得
var myTargetTrack=xUI.XPS.xpsTracks[xUI.Select[0]];
//操作対象セクションを取得
var myTargetSection=myTargetTrack.getSectionByFrame(xUI.Select[1]);
//操作対象セクションを選択状態にする
xUI.selectCell([
	xUI.Select[0],
	myTargetSection.startOffset()
]);
xUI.selection([
	xUI.Select[0],
	myTargetSection.startOffset()+myTargetSection.duration-1
]);
xUI.mdChg('section');


マニピュレーションメソッドは、タイムラインコレクション（＝トラック）に対して発行したほうが良い
コレクション.sectionManipulate(targetSectionID,targetFrame,newDuration)

各配下の対象セクションに対して（削除を含む）増減要求を発行する
セクションは増減要求を受けて自己の再構成を行う
　Section.setDuration(newDuration);
セクションの値を参照して各値は新しい継続時間に展開される
必要に従って値自身が自分の値を書き換える

値がnas.ValueInterpolator オブジェクトだった場合は、subSections の編集が必要
サブセクションの選択（編集）をするべきか否かチェック

基本的には、
カメラワーク、エフェクトはサブセクション選択を行わない
置き換えトラックはサブセクション選択を可能にする？

カメラワークやエフェクトの操作主眼は、補間区間の延伸になる。
この操作中は補間区間を構成するサブセクションを選択する意味は失われる。
サブセクション選択は行われない。
値区間のダブルクリックまたは区間編集モード遷移操作は、
継続時間1フレームの「新規補間区間（効果）」の作成及びその選択に割付け
またその両端の区間の値指定？

ダイアログトラックの操作主眼は、値区間の延伸となる。
この場合、無音区間（値==null）の選択は操作上の違和感を伴うので望ましくない。
無音区間のダブルクリックまたは区間編集モード遷移操作は継続時間1フレームの「新規値区間（セリフ）」または「音響パーツ」の作成＋選択に割り当てるべきである。

単に無音区間の選択を排除するのみでも可
その場合操作パスとしては　選択状態で音響編集パネルを呼び出す。
	カーソルが有効値区間ならばその区間をターゲットにして区間編集モードに遷移
	カーソルが無効値区間なら選択範囲を新規の値区間にして同モード遷移



置き換えトラックの

セクションマニピュレーションの手順

コレクション側で区間数の増減と各継続時間の解決を行う
	０．編集バッファ作成
新規の編集済みコレクションを作成する

	１．前方挿入はあるか
(ターゲットID==0)&&(スタートオフセット>0)の場合 新規のデフォルトセクションを編集バッファにID0で挿入する。
これ以外のケースでは元のセクションが消失することはあっても新規セクションの挿入はない。

	２．被影響セクションを特定
前方及び後方セクション群で継続時間の影響を受けるセクションを順次キューする
前方挿入セクションは必ず被影響セクションである
被影響セクションは前後ひとつづつとは限らない
継続時間０になるセクションも被影響セクションとする
当該セクションは削除される

元コレクションに含まれるセクションを順次判定
	前方区間群
	当該区間
	後方区間の順に処理

継続時間の無くなったセクションはスキップして
[旧ID,新ID,新継続時間]　のチャンクでキューに積む？


	　３．継続時間の残ったセクションを新規のコレクションに積む
新規の継続時間となったセクションは セクション.setDuration メソッドで内容を更新して新規のコレクションを作成する。

オリジナル（モード中は固定）のコレクションから新規（都度新規）のコレクション(=トラック)を作成してストリームに変換　xUI.put() で解決する

セクションオブジェクトには、シートセルデータを持たせていないのでコレクション更新は基本的に意味がない

　　XpsTimelineSection.toString(duration) メソッドで指定長に展開したストリームを取得する
　　
　　
セリフ（ダイアログ）セクション編集パネル

	セクション編集のパラメータと追従
	パラメータの直接編集
	パネルを呼び出した際に
		セクション編集モードなら編集中のセクションで初期化
		通常モードならセクション編集モードに遷移して編集開始


マウス・キー操作割付
	MOUSE:
	セリフトラック上でダブルクリック
指定したシートセルを含む区間編集状態に遷移
セリフトラックに限り空白区間は選択状態になるのみ

	選択された区間を再度ダブルクリック
セクションのプロパティ編集パネルを（あれば）呼び出し・消去
	
	区間編集状態でクリックドラッグ
		区間先頭、区間終端
端点のみを移動（継続時間が変わる）
		それ以外の区間内セル
区間全体を移動（継続時間を維持）

		対象トラック外
			クリック
編集を確定してモード解除
			[shift]+クリック
			[ctrl]+クリック
編集を破棄してモード解除

		対象トラック内
			クリック
近接側の区間端点を起点にしてクリック位置へ区間全体を移動

			[shift]+クリック
区間後端点をクリック位置へ移動継続時間は変更
			[ctrl]+クリック
区間前端点をクリック位置へ移動継続時間は変更

	キー操作:
	セリフトラックにフォーカスがある状態で
		　[ctrl]+[shift]+[ENTER]
フォーカスのあるシートセルを含む区間編集状態に遷移
セリフトラックに限り空白区間は選択状態になるのみ

	区間編集状態(edmode==2)

		[ENTER]
確定+モード解除

		[ctrl]+[ENTER]
		[ctrl]+[↑],[ctrl]+[↓]
操作オフセットを0 + edmode=3 区間前端を移動
				 
		[shift]+[ENTER]
		 [shift]+[↑],[shift]+[↓]
操作オフセットを区間後端 + edmode=3 区間後端を移動

		[ctrl]+[shift]+[ENTER]
		 [↑],[↓]
操作オフセットを区間中央 + edmode=3 全体を移動

		[esc]
編集破棄+モード解除

　	 区間フロート状態(edmode==3)

		 [↑],[↓]
アップデート
		上記以外　edmode = 2


edmode>=2の際の　ctrl+xyz他特殊キーの挙動調整

